{"file_contents":{"frontend/src/pages/AdminReports.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { Navigate, Link } from 'react-router-dom';\nimport { adminAPI } from '../services/adminAPI';\nimport toast from 'react-hot-toast';\nimport {\n  FiAlertTriangle,\n  FiArrowLeft,\n  FiFlag,\n} from 'react-icons/fi';\n\nconst AdminReports = () => {\n  const { user } = useAuth();\n  const [reports, setReports] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (user?.role === 'admin') {\n      fetchReports();\n    }\n  }, [user]);\n\n  const fetchReports = async () => {\n    try {\n      setLoading(true);\n      const response = await adminAPI.getReports();\n      setReports(response.data.data);\n    } catch (error) {\n      toast.error('Failed to fetch reports');\n      console.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Check if user is admin\n  if (!user || user.role !== 'admin') {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center\">\n              <Link\n                to=\"/admin\"\n                className=\"mr-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\n              >\n                <FiArrowLeft className=\"w-6 h-6 text-gray-600 dark:text-gray-300\" />\n              </Link>\n              <div>\n                <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white flex items-center\">\n                  <FiFlag className=\"mr-2\" />\n                  Reported Content\n                </h1>\n                <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n                  Review and manage reported content\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Reports Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {loading ? (\n          <div className=\"flex justify-center py-12\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n          </div>\n        ) : reports.length === 0 ? (\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-12 text-center\">\n            <FiAlertTriangle className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">\n              No Reports Yet\n            </h3>\n            <p className=\"text-gray-500 dark:text-gray-400\">\n              All reported content will appear here. The reports feature is coming soon!\n            </p>\n          </div>\n        ) : (\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow\">\n            {/* Reports list will be displayed here when implemented */}\n            <p className=\"p-6 text-gray-500 dark:text-gray-400 text-center\">\n              Reports feature will be available soon\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AdminReports;\n","size_bytes":3269},"frontend/src/services/adminAPI.js":{"content":"import api from './api';\n\n// Admin API Service\nexport const adminAPI = {\n  // Dashboard Stats\n  getDashboardStats: () => api.get('/admin/stats'),\n\n  // Users Management\n  getAllUsers: (page = 1, limit = 20) => api.get(`/admin/users?page=${page}&limit=${limit}`),\n  deleteUser: (userId) => api.delete(`/admin/users/${userId}`),\n  toggleBanUser: (userId) => api.put(`/admin/users/${userId}/ban`),\n  toggleVerifyUser: (userId) => api.put(`/admin/users/${userId}/verify`),\n  changeUserRole: (userId, role) => api.put(`/admin/users/${userId}/role`, { role }),\n\n  // Posts Management\n  getAllPosts: (page = 1, limit = 20) => api.get(`/admin/posts?page=${page}&limit=${limit}`),\n  deletePost: (postId) => api.delete(`/admin/posts/${postId}`),\n\n  // Role Requests\n  getRoleRequests: (page = 1, limit = 20) => api.get(`/admin/role-requests?page=${page}&limit=${limit}`),\n  approveRoleRequest: (userId) => api.post(`/admin/role-requests/${userId}/approve`),\n  declineRoleRequest: (userId) => api.post(`/admin/role-requests/${userId}/decline`),\n};\n\nexport default adminAPI;\n","size_bytes":1063},"backend/render.yaml":{"content":"# Render configuration for friendflix Backend\n\nservices:\n  - type: web\n    name: friendflix-backend\n    env: node\n    region: oregon\n    plan: free\n    buildCommand: npm install\n    startCommand: npm start\n    envVars:\n      - key: NODE_ENV\n        value: production\n      - key: MONGO_URI\n        sync: false  # Set in Render dashboard\n      - key: JWT_SECRET\n        sync: false  # Set in Render dashboard\n      - key: CLOUDINARY_CLOUD_NAME\n        sync: false  # Set in Render dashboard\n      - key: CLOUDINARY_API_KEY\n        sync: false  # Set in Render dashboard\n      - key: CLOUDINARY_API_SECRET\n        sync: false  # Set in Render dashboard\n","size_bytes":649},"backend/models/Message.js":{"content":"import mongoose from 'mongoose';\n\nconst messageSchema = new mongoose.Schema(\n  {\n    sender: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    receiver: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    text: {\n      type: String,\n      trim: true,\n      maxlength: [1000, 'Message cannot exceed 1000 characters'],\n    },\n    image: {\n      type: String,\n    },\n    video: {\n      type: String,\n    },\n    audio: {\n      type: String,\n    },\n    audioDurationSec: {\n      type: Number,\n    },\n    fileUrl: {\n      type: String,\n    },\n    fileName: {\n      type: String,\n    },\n    expiresAt: {\n      type: Date,\n    },\n    read: {\n      type: Boolean,\n      default: false,\n    },\n    readAt: {\n      type: Date,\n    },\n    reactions: [\n      {\n        user: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'User',\n        },\n        emoji: {\n          type: String,\n        },\n        createdAt: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\nmessageSchema.index({ sender: 1, receiver: 1, createdAt: -1 });\nmessageSchema.index({ receiver: 1, read: 1 });\nmessageSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 });\n\nconst Message = mongoose.model('Message', messageSchema);\n\nexport default Message;\n","size_bytes":1419},"frontend/src/pages/Playlists.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { playlistAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { FiPlus, FiPlay, FiLock, FiGlobe, FiTrash2, FiEdit2 } from 'react-icons/fi';\nimport Navbar from '../components/Navbar';\nimport BottomNav from '../components/BottomNav';\nimport Loader from '../components/Loader';\n\nfunction Playlists() {\n  const [playlists, setPlaylists] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [newPlaylist, setNewPlaylist] = useState({ title: '', description: '', visibility: 'public' });\n  const { userId } = useParams();\n  const navigate = useNavigate();\n  const currentUser = JSON.parse(localStorage.getItem('user') || '{}');\n\n  useEffect(() => {\n    fetchPlaylists();\n  }, [userId]);\n\n  const fetchPlaylists = async () => {\n    try {\n      setLoading(true);\n      const targetUserId = userId || currentUser._id;\n      const response = await playlistAPI.getUserPlaylists(targetUserId);\n      setPlaylists(response.data.playlists || []);\n    } catch (error) {\n      console.error('Error fetching playlists:', error);\n      toast.error('Failed to load playlists');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreatePlaylist = async (e) => {\n    e.preventDefault();\n    if (!newPlaylist.title.trim()) {\n      toast.error('Playlist title is required');\n      return;\n    }\n\n    try {\n      await playlistAPI.createPlaylist(newPlaylist);\n      toast.success('Playlist created!');\n      setShowCreateModal(false);\n      setNewPlaylist({ title: '', description: '', visibility: 'public' });\n      fetchPlaylists();\n    } catch (error) {\n      console.error('Error creating playlist:', error);\n      toast.error('Failed to create playlist');\n    }\n  };\n\n  const handleDeletePlaylist = async (playlistId) => {\n    if (!confirm('Are you sure you want to delete this playlist?')) return;\n\n    try {\n      await playlistAPI.deletePlaylist(playlistId);\n      toast.success('Playlist deleted');\n      fetchPlaylists();\n    } catch (error) {\n      console.error('Error deleting playlist:', error);\n      toast.error('Failed to delete playlist');\n    }\n  };\n\n  if (loading) return <Loader />;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <Navbar />\n      \n      <div className=\"max-w-7xl mx-auto px-4 py-6 pb-20\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n            {!userId || userId === currentUser._id ? 'My Playlists' : `${userId}'s Playlists`}\n          </h1>\n          {(!userId || userId === currentUser._id) && (\n            <button\n              onClick={() => setShowCreateModal(true)}\n              className=\"flex items-center gap-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-lg hover:opacity-90\"\n            >\n              <FiPlus /> New Playlist\n            </button>\n          )}\n        </div>\n\n        {playlists.length === 0 ? (\n          <div className=\"text-center py-20\">\n            <p className=\"text-gray-500 dark:text-gray-400 text-lg\">No playlists yet</p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {playlists.map((playlist) => (\n              <div\n                key={playlist._id}\n                className=\"bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition cursor-pointer\"\n                onClick={() => navigate(`/playlist/${playlist._id}`)}\n              >\n                <div className=\"aspect-video bg-gradient-to-br from-purple-500 to-pink-500 rounded-t-lg flex items-center justify-center\">\n                  <FiPlay className=\"w-16 h-16 text-white opacity-80\" />\n                </div>\n                <div className=\"p-4\">\n                  <div className=\"flex justify-between items-start mb-2\">\n                    <h3 className=\"font-semibold text-gray-900 dark:text-white line-clamp-1\">\n                      {playlist.title}\n                    </h3>\n                    {playlist.visibility === 'private' ? (\n                      <FiLock className=\"text-gray-500\" />\n                    ) : (\n                      <FiGlobe className=\"text-gray-500\" />\n                    )}\n                  </div>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-3\">\n                    {playlist.description || 'No description'}\n                  </p>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-500\">\n                      {playlist.videoCount} videos\n                    </span>\n                    {playlist.creator._id === currentUser._id && (\n                      <div className=\"flex gap-2\" onClick={(e) => e.stopPropagation()}>\n                        <button\n                          className=\"text-blue-500 hover:text-blue-600\"\n                          onClick={() => navigate(`/playlist/${playlist._id}/edit`)}\n                        >\n                          <FiEdit2 />\n                        </button>\n                        <button\n                          className=\"text-red-500 hover:text-red-600\"\n                          onClick={() => handleDeletePlaylist(playlist._id)}\n                        >\n                          <FiTrash2 />\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6\">\n            <h2 className=\"text-2xl font-bold mb-4 text-gray-900 dark:text-white\">Create New Playlist</h2>\n            <form onSubmit={handleCreatePlaylist}>\n              <input\n                type=\"text\"\n                placeholder=\"Playlist title\"\n                className=\"w-full p-3 border rounded-lg mb-3 dark:bg-gray-700 dark:text-white\"\n                value={newPlaylist.title}\n                onChange={(e) => setNewPlaylist({ ...newPlaylist, title: e.target.value })}\n              />\n              <textarea\n                placeholder=\"Description (optional)\"\n                className=\"w-full p-3 border rounded-lg mb-3 dark:bg-gray-700 dark:text-white\"\n                rows=\"3\"\n                value={newPlaylist.description}\n                onChange={(e) => setNewPlaylist({ ...newPlaylist, description: e.target.value })}\n              />\n              <select\n                className=\"w-full p-3 border rounded-lg mb-4 dark:bg-gray-700 dark:text-white\"\n                value={newPlaylist.visibility}\n                onChange={(e) => setNewPlaylist({ ...newPlaylist, visibility: e.target.value })}\n              >\n                <option value=\"public\">Public</option>\n                <option value=\"unlisted\">Unlisted</option>\n                <option value=\"private\">Private</option>\n              </select>\n              <div className=\"flex gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg\"\n                >\n                  Create\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      <BottomNav />\n    </div>\n  );\n}\n\nexport default Playlists;\n","size_bytes":7995},"backend/models/Conversation.js":{"content":"import mongoose from 'mongoose';\n\nconst conversationSchema = new mongoose.Schema(\n  {\n    participants: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n        required: true,\n      },\n    ],\n    starredBy: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    archivedBy: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    lastMessage: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Message',\n    },\n    lastActivity: {\n      type: Date,\n      default: Date.now,\n    },\n    readReceiptsDisabledBy: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    typingIndicatorDisabledBy: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    messageExpiryHours: {\n      type: Number,\n      default: null,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Ensure participants array has exactly 2 users\nconversationSchema.pre('save', function (next) {\n  if (this.participants.length !== 2) {\n    return next(new Error('Conversation must have exactly 2 participants'));\n  }\n  next();\n});\n\n// Index for faster queries\nconversationSchema.index({ participants: 1, lastActivity: -1 });\nconversationSchema.index({ starredBy: 1 });\nconversationSchema.index({ archivedBy: 1 });\n\n// Static method to find or create conversation\nconversationSchema.statics.findOrCreate = async function (user1Id, user2Id) {\n  let conversation = await this.findOne({\n    participants: { $all: [user1Id, user2Id] },\n  });\n\n  if (!conversation) {\n    conversation = await this.create({\n      participants: [user1Id, user2Id],\n    });\n  }\n\n  return conversation;\n};\n\nconst Conversation = mongoose.model('Conversation', conversationSchema);\n\nexport default Conversation;\n","size_bytes":1843},"README.md":{"content":"# ğŸ¨ friendflix - Next-Gen Social Media Platform\n\n<div align=\"center\">\n\n![friendflix Logo](https://img.shields.io/badge/friendflix-Ultimate-purple?style=for-the-badge&logo=instagram)\n![Version](https://img.shields.io/badge/version-2.0.0-pink?style=for-the-badge)\n![License](https://img.shields.io/badge/license-MIT-amber?style=for-the-badge)\n\n**A modern, feature-rich social media platform with unique Purple/Pink/Amber design and 15+ advanced features**\n\n</div>\n\n## âœ¨ Features\n\n### Core Features\n- ğŸ” **Authentication** - JWT-based auth with bcrypt password hashing\n- ğŸ‘¤ **User Profiles** - Customizable profiles with avatar, bio, subscriber/subscribed\n- ğŸ“¸ **Posts** - Create posts with image/video uploads via Cloudinary\n- â¤ï¸ **Interactions** - Like and comment on posts in real-time\n- ğŸ”” **Notifications** - Real-time notifications via Socket.io\n- ğŸ” **Search** - Find users by username or name\n- ğŸ’¾ **Save & Archive** - Save favorite posts and archive your own\n- ğŸ“– **Stories** - Create and view 24-hour stories\n- ğŸ¬ **Reels** - Short-form video content\n- ğŸ’¬ **Messages** - Real-time direct messaging\n- ğŸŒ **Explore** - Discover trending content and hashtags\n- ğŸ“Š **Analytics** - View your content performance\n- ğŸ“… **Schedule Posts** - Plan your content in advance\n- ğŸ‘¥ **Close Friends** - Share content with select subscriber\n- ğŸ“± **Responsive Design** - Mobile-first design with Tailwind CSS\n- âš¡ **Real-time Updates** - Live likes, comments, and notifications\n\n### Admin Features (NEW! ğŸ‰)\n- ğŸ” **Admin Panel** - Complete admin dashboard with statistics\n- ğŸ‘¥ **User Management** - View, search, verify, ban/unban, delete users\n- ğŸ“¸ **Post Management** - View, search, and moderate posts\n- ğŸ›¡ï¸ **Role Management** - Assign user roles (user/creator/business/admin)\n- ğŸ“Š **Dashboard Stats** - Monitor platform metrics and activity\n- ğŸ” **Search & Filter** - Advanced search for users and posts\n- âš¡ **Quick Actions** - Perform bulk operations efficiently\n\n**[ğŸ“– Admin Panel Setup Guide](ADMIN_SETUP.md)** | **[ğŸ“˜ Full Admin Documentation](ADMIN_PANEL_GUIDE.md)**\n\n## ğŸ› ï¸ Tech Stack\n\n### Backend\n- Node.js & Express.js\n- MongoDB & Mongoose\n- JWT & bcrypt\n- Socket.io\n- Cloudinary\n- Multer\n\n### Frontend\n- React.js (Vite)\n- React Router DOM\n- Tailwind CSS\n- Axios\n- Socket.io Client\n- React Hot Toast\n- React Icons\n\n## ğŸ“ Project Structure\n\n```\nfriendflix/\nâ”œâ”€â”€ backend/\nâ”‚   â”œâ”€â”€ config/\nâ”‚   â”œâ”€â”€ controllers/\nâ”‚   â”œâ”€â”€ middleware/\nâ”‚   â”œâ”€â”€ models/\nâ”‚   â”œâ”€â”€ routes/\nâ”‚   â”œâ”€â”€ socket/\nâ”‚   â”œâ”€â”€ server.js\nâ”‚   â””â”€â”€ package.json\nâ”œâ”€â”€ frontend/\nâ”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”œâ”€â”€ components/\nâ”‚   â”‚   â”œâ”€â”€ context/\nâ”‚   â”‚   â”œâ”€â”€ pages/\nâ”‚   â”‚   â”œâ”€â”€ services/\nâ”‚   â”‚   â”œâ”€â”€ utils/\nâ”‚   â”‚   â”œâ”€â”€ App.jsx\nâ”‚   â”‚   â””â”€â”€ main.jsx\nâ”‚   â””â”€â”€ package.json\nâ””â”€â”€ README.md\n```\n\n## ğŸš€ Installation & Setup\n\n### Prerequisites\n\n- Node.js (v16 or higher)\n- MongoDB (local or Atlas)\n- Cloudinary account (free tier works)\n\n### 1ï¸âƒ£ Clone or Setup Project\n\n```bash\n# If you have the files, navigate to the project root\ncd friendflix\n```\n\n### 2ï¸âƒ£ Backend Setup\n\n```bash\n# Navigate to backend folder\ncd backend\n\n# Install dependencies\nnpm install\n\n# Create .env file\ncp .env.example .env\n\n# Edit .env file with your credentials:\n# MONGO_URI=your_mongodb_connection_string\n# JWT_SECRET=your_secret_key_here\n# CLOUDINARY_CLOUD_NAME=your_cloudinary_cloud_name\n# CLOUDINARY_API_KEY=your_cloudinary_api_key\n# CLOUDINARY_API_SECRET=your_cloudinary_api_secret\n```\n\n**Getting Cloudinary Credentials:**\n1. Sign up at https://cloudinary.com (free tier)\n2. Go to Dashboard\n3. Copy Cloud Name, API Key, and API Secret\n\n### 3ï¸âƒ£ Frontend Setup\n\n```bash\n# Navigate to frontend folder (from root)\ncd frontend\n\n# Install dependencies\nnpm install\n\n# Create .env file\ncp .env.example .env\n\n# Edit .env file if needed (default values work for local dev):\n# VITE_API_URL=http://localhost:5000/api\n# VITE_SOCKET_URL=http://localhost:5000\n```\n\n### 4ï¸âƒ£ Running the Application\n\n**Option 1: Run Both Servers Separately**\n\nTerminal 1 - Backend:\n```bash\ncd backend\nnpm run dev\n# Backend will run on http://localhost:5000\n```\n\nTerminal 2 - Frontend:\n```bash\ncd frontend\nnpm run dev\n# Frontend will run on http://localhost:5173\n```\n\n**Option 2: Production Build**\n\n```bash\n# Build frontend\ncd frontend\nnpm run build\n\n# Serve frontend from backend (optional)\ncd ../backend\nnpm start\n```\n\n### 5ï¸âƒ£ Access the Application\n\nOpen your browser and navigate to:\n- **Frontend**: http://localhost:5173\n- **Backend API**: http://localhost:5000\n\n## ğŸ” Admin Panel Setup\n\n### Quick Start\n\n**Make any user an admin:**\n```bash\ncd backend\nnode scripts/makeUserAdmin.js your-email@example.com\n```\n\n**Access admin panel:**\n1. Login with admin account\n2. Go to Settings â†’ Click \"Admin Panel\" button\n3. Or navigate to `/admin`\n\n**Admin Features:**\n- Dashboard with real-time statistics\n- User management (verify, ban, delete)\n- Post moderation and deletion\n- Role-based access control\n- Search and filter capabilities\n\nFor detailed setup instructions, see [ADMIN_SETUP.md](ADMIN_SETUP.md)\n\n## ğŸ“ Environment Variables\n\n### Backend (.env)\n\n```env\nMONGO_URI=mongodb://localhost:27017/friendflix\nJWT_SECRET=your_super_secret_jwt_key_change_in_production\nPORT=5000\nCLOUDINARY_CLOUD_NAME=your_cloudinary_cloud_name\nCLOUDINARY_API_KEY=your_cloudinary_api_key\nCLOUDINARY_API_SECRET=your_cloudinary_api_secret\nFRONTEND_URL=http://localhost:5173\nNODE_ENV=development\n```\n\n### Frontend (.env)\n\n```env\nVITE_API_URL=http://localhost:5000/api\nVITE_SOCKET_URL=http://localhost:5000\n```\n\n## ğŸ¯ API Endpoints\n\n### Admin (Protected - Admin Only)\n- `GET /api/admin/stats` - Get dashboard statistics\n- `GET /api/admin/users` - Get all users (paginated)\n- `DELETE /api/admin/users/:userId` - Delete user\n- `PUT /api/admin/users/:userId/ban` - Ban/unban user\n- `PUT /api/admin/users/:userId/verify` - Verify/unverify user\n- `PUT /api/admin/users/:userId/role` - Change user role\n- `GET /api/admin/posts` - Get all posts (paginated)\n- `DELETE /api/admin/posts/:postId` - Delete post\n- `GET /api/admin/reports` - Get reported content\n- `GET /api/admin/search` - Search users/posts\n\n### Authentication\n- `POST /api/auth/register` - Register new user\n- `POST /api/auth/login` - Login user\n- `GET /api/auth/me` - Get current user\n- `POST /api/auth/logout` - Logout user\n\n### Users\n- `GET /api/users/:username` - Get user profile\n- `PUT /api/users/profile` - Update profile\n- `POST /api/users/:id/follow` - Follow/unfollow user\n- `GET /api/users/search?q=query` - Search users\n- `GET /api/users/suggestions` - Get user suggestions\n\n### Posts\n- `POST /api/posts` - Create new post\n- `GET /api/posts/feed` - Get feed posts\n- `GET /api/posts/:id` - Get single post\n- `DELETE /api/posts/:id` - Delete post\n- `POST /api/posts/:id/like` - Like/unlike post\n- `POST /api/posts/:id/comment` - Add comment\n- `GET /api/posts/:id/comments` - Get post comments\n- `DELETE /api/posts/:postId/comments/:commentId` - Delete comment\n\n### Notifications\n- `GET /api/notifications` - Get notifications\n- `PUT /api/notifications/:id/read` - Mark as read\n- `PUT /api/notifications/read-all` - Mark all as read\n- `DELETE /api/notifications/:id` - Delete notification\n\n## ğŸ”§ Troubleshooting\n\n### Port Already in Use\n```bash\n# Kill process on port 5000 (backend)\n# Windows\nnetstat -ano | findstr :5000\ntaskkill /PID <PID> /F\n\n# Mac/Linux\nlsof -ti:5000 | xargs kill -9\n```\n\n### MongoDB Connection Issues\n- Ensure MongoDB is running locally or use MongoDB Atlas\n- Check your connection string in .env\n- Whitelist your IP in MongoDB Atlas\n\n### Cloudinary Upload Issues\n- Verify your Cloudinary credentials\n- Check file size limits (max 5MB in current config)\n- Ensure internet connection for uploads\n\n### Socket.io Connection Issues\n- Check if backend server is running\n- Verify CORS settings in backend\n- Check browser console for connection errors\n\n## ğŸ“± Usage Guide\n\n1. **Sign Up** - Create a new account\n2. **Complete Profile** - Go to Settings and update your profile\n3. **Upload Post** - Click the + icon to create your first post\n4. **Follow Users** - Search for users and follow them\n5. **Interact** - Like and comment on posts\n6. **Check Notifications** - View real-time notifications\n\n## ğŸ¨ Customization\n\n### Change Theme Colors\nEdit `frontend/tailwind.config.js`:\n```javascript\ncolors: {\n  primary: '#0095f6', // Change this\n  // ... other colors\n}\n```\n\n### Modify Upload Limits\nEdit `backend/config/cloudinary.js`:\n```javascript\nlimits: {\n  fileSize: 5 * 1024 * 1024, // Change this (in bytes)\n}\n```\n\n## ğŸš€ Deployment\n\n### Backend (Heroku/Railway/Render)\n1. Push code to GitHub\n2. Connect to your hosting platform\n3. Set environment variables\n4. Deploy\n\n### Frontend (Vercel/Netlify)\n1. Push code to GitHub\n2. Connect to Vercel/Netlify\n3. Set build command: `npm run build`\n4. Set output directory: `dist`\n5. Add environment variables\n6. Deploy\n\n## ğŸ“„ License\n\nMIT License - feel free to use this project for learning or commercial purposes.\n\n## ğŸ‘¨â€ğŸ’» Author\n\nBuilt with â¤ï¸ using MERN Stack\n\n## ğŸ™ Acknowledgments\n\n- Inspired by Instagram\n- Built for learning purposes\n- Community contributions welcome\n\n---\n\n**Happy Coding! ğŸ‰**\n\nFor issues or questions, please create an issue in the repository.\n","size_bytes":9426},"backend/models/Group.js":{"content":"import mongoose from 'mongoose';\n\nconst groupSchema = new mongoose.Schema(\n  {\n    name: {\n      type: String,\n      required: [true, 'Group name is required'],\n      trim: true,\n      maxlength: [50, 'Group name cannot exceed 50 characters'],\n    },\n    description: {\n      type: String,\n      maxlength: [200, 'Description cannot exceed 200 characters'],\n      default: '',\n    },\n    avatar: {\n      type: String,\n      default: 'https://ui-avatars.com/api/?name=Group&background=8B5CF6&color=fff',\n    },\n    admin: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    members: [\n      {\n        user: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'User',\n          required: true,\n        },\n        joinedAt: {\n          type: Date,\n          default: Date.now,\n        },\n        role: {\n          type: String,\n          enum: ['admin', 'member'],\n          default: 'member',\n        },\n      },\n    ],\n    lastMessage: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'GroupMessage',\n    },\n    lastMessageAt: {\n      type: Date,\n      default: Date.now,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\ngroupSchema.index({ 'members.user': 1 });\ngroupSchema.index({ admin: 1 });\n\nconst Group = mongoose.model('Group', groupSchema);\n\nexport default Group;\n","size_bytes":1363},"frontend/src/components/ImageCarousel.jsx":{"content":"import { useState } from 'react';\nimport { AiOutlineLeft, AiOutlineRight } from 'react-icons/ai';\nimport DoubleTapLike from './DoubleTapLike';\n\nconst ImageCarousel = ({ media, onLike, isLiked }) => {\n  const [currentIndex, setCurrentIndex] = useState(0);\n\n  const nextSlide = () => {\n    setCurrentIndex((prev) => (prev + 1) % media.length);\n  };\n\n  const previousSlide = () => {\n    setCurrentIndex((prev) => (prev - 1 + media.length) % media.length);\n  };\n\n  // Handle all possible media formats\n  let mediaArray = [];\n  \n  if (!media) {\n    return null;\n  }\n  \n  // If media is array\n  if (Array.isArray(media)) {\n    mediaArray = media.filter(m => m && m.url); // Filter out invalid entries\n  }\n  // If media is string (old format - just URL)\n  else if (typeof media === 'string') {\n    mediaArray = [{ url: media, type: 'image' }];\n  }\n  // If media is object with url property\n  else if (media.url) {\n    mediaArray = [media];\n  }\n  \n  if (mediaArray.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"relative w-full bg-black\">\n      <DoubleTapLike onLike={onLike} isLiked={isLiked}>\n        {/* Current Media */}\n        {mediaArray[currentIndex].type === 'video' ? (\n          <video\n            src={mediaArray[currentIndex].url}\n            controls\n            className=\"w-full max-h-[600px] object-contain\"\n          />\n        ) : (\n          <img\n            src={mediaArray[currentIndex].url}\n            alt=\"Post\"\n            className=\"w-full max-h-[600px] object-contain\"\n          />\n        )}\n\n        {/* Navigation Buttons */}\n        {mediaArray.length > 1 && (\n          <>\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                previousSlide();\n              }}\n              className=\"absolute left-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition\"\n            >\n              <AiOutlineLeft size={24} />\n            </button>\n\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                nextSlide();\n              }}\n              className=\"absolute right-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition\"\n            >\n              <AiOutlineRight size={24} />\n            </button>\n          </>\n        )}\n\n        {/* Indicators */}\n        {mediaArray.length > 1 && (\n          <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2\">\n            {mediaArray.map((_, index) => (\n              <button\n                key={index}\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setCurrentIndex(index);\n                }}\n                className={`w-2 h-2 rounded-full transition ${\n                  index === currentIndex\n                    ? 'bg-white w-8'\n                    : 'bg-white/50'\n                }`}\n              />\n            ))}\n          </div>\n        )}\n\n        {/* Counter */}\n        {mediaArray.length > 1 && (\n          <div className=\"absolute top-4 right-4 bg-black/70 text-white px-3 py-1 rounded-full text-sm\">\n            {currentIndex + 1} / {mediaArray.length}\n          </div>\n        )}\n      </DoubleTapLike>\n    </div>\n  );\n};\n\nexport default ImageCarousel;\n","size_bytes":3337},"backend/controllers/groupController.js":{"content":"import Group from '../models/Group.js';\nimport GroupMessage from '../models/GroupMessage.js';\nimport User from '../models/User.js';\nimport Notification from '../models/Notification.js';\n\n// @desc    Create a new group\n// @route   POST /api/groups\n// @access  Private\nexport const createGroup = async (req, res) => {\n  try {\n    const { name, description, memberIds } = req.body;\n\n    if (!name) {\n      return res.status(400).json({\n        success: false,\n        message: 'Group name is required',\n      });\n    }\n\n    if (!memberIds || memberIds.length === 0) {\n      return res.status(400).json({\n        success: false,\n        message: 'At least one member is required',\n      });\n    }\n\n    // Create members array with admin\n    const members = [\n      {\n        user: req.user._id,\n        role: 'admin',\n      },\n    ];\n\n    // Add other members\n    memberIds.forEach((userId) => {\n      if (userId !== req.user._id.toString()) {\n        members.push({\n          user: userId,\n          role: 'member',\n        });\n      }\n    });\n\n    const group = await Group.create({\n      name,\n      description,\n      admin: req.user._id,\n      members,\n      avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=8B5CF6&color=fff`,\n    });\n\n    const populatedGroup = await Group.findById(group._id)\n      .populate('members.user', 'username fullName avatar')\n      .populate('admin', 'username fullName avatar');\n\n    // Emit socket event to all members\n    const io = req.app.get('io');\n    members.forEach((member) => {\n      io.to(member.user.toString()).emit('newGroup', populatedGroup);\n    });\n\n    res.status(201).json({\n      success: true,\n      message: 'Group created successfully',\n      data: populatedGroup,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get all user's groups\n// @route   GET /api/groups\n// @access  Private\nexport const getUserGroups = async (req, res) => {\n  try {\n    const groups = await Group.find({\n      'members.user': req.user._id,\n    })\n      .populate('members.user', 'username fullName avatar')\n      .populate('admin', 'username fullName avatar')\n      .populate('lastMessage')\n      .sort({ lastMessageAt: -1 });\n\n    res.json({\n      success: true,\n      data: groups,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get group by ID\n// @route   GET /api/groups/:groupId\n// @access  Private\nexport const getGroupById = async (req, res) => {\n  try {\n    const group = await Group.findById(req.params.groupId)\n      .populate('members.user', 'username fullName avatar')\n      .populate('admin', 'username fullName avatar');\n\n    if (!group) {\n      return res.status(404).json({\n        success: false,\n        message: 'Group not found',\n      });\n    }\n\n    // Check if user is a member\n    const isMember = group.members.some(\n      (member) => member.user._id.toString() === req.user._id.toString()\n    );\n\n    if (!isMember) {\n      return res.status(403).json({\n        success: false,\n        message: 'You are not a member of this group',\n      });\n    }\n\n    res.json({\n      success: true,\n      data: group,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Send message to group\n// @route   POST /api/groups/:groupId/messages\n// @access  Private\nexport const sendGroupMessage = async (req, res) => {\n  try {\n    const { text } = req.body;\n    const { groupId } = req.params;\n\n    if (!text) {\n      return res.status(400).json({\n        success: false,\n        message: 'Message text is required',\n      });\n    }\n\n    // Check if group exists and user is a member\n    const group = await Group.findById(groupId);\n    \n    if (!group) {\n      return res.status(404).json({\n        success: false,\n        message: 'Group not found',\n      });\n    }\n\n    const isMember = group.members.some(\n      (member) => member.user.toString() === req.user._id.toString()\n    );\n\n    if (!isMember) {\n      return res.status(403).json({\n        success: false,\n        message: 'You are not a member of this group',\n      });\n    }\n\n    // Create message\n    const message = await GroupMessage.create({\n      group: groupId,\n      sender: req.user._id,\n      text,\n    });\n\n    const populatedMessage = await GroupMessage.findById(message._id)\n      .populate('sender', 'username fullName avatar');\n\n    // Update group's last message\n    group.lastMessage = message._id;\n    group.lastMessageAt = new Date();\n    await group.save();\n\n    // Emit socket event to all group members and create notifications\n    const io = req.app.get('io');\n    group.members.forEach(async (member) => {\n      io.to(member.user.toString()).emit('newGroupMessage', {\n        groupId,\n        message: populatedMessage,\n      });\n      // Skip notifying the sender\n      if (member.user.toString() !== req.user._id.toString()) {\n        try {\n          const notif = await Notification.create({\n            recipient: member.user,\n            sender: req.user._id,\n            type: 'group_message',\n            group: group._id,\n            message: `${populatedMessage.sender.username} in ${group.name}: ${text.substring(0, 120)}`,\n          });\n          io.to(member.user.toString()).emit('notification', notif);\n        } catch (e) {\n          console.error('Failed to create group message notification:', e?.message);\n        }\n      }\n    });\n\n    res.status(201).json({\n      success: true,\n      data: populatedMessage,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get group messages\n// @route   GET /api/groups/:groupId/messages\n// @access  Private\nexport const getGroupMessages = async (req, res) => {\n  try {\n    const { groupId } = req.params;\n\n    // Check if group exists and user is a member\n    const group = await Group.findById(groupId);\n    \n    if (!group) {\n      return res.status(404).json({\n        success: false,\n        message: 'Group not found',\n      });\n    }\n\n    const isMember = group.members.some(\n      (member) => member.user.toString() === req.user._id.toString()\n    );\n\n    if (!isMember) {\n      return res.status(403).json({\n        success: false,\n        message: 'You are not a member of this group',\n      });\n    }\n\n    const messages = await GroupMessage.find({ group: groupId })\n      .populate('sender', 'username fullName avatar')\n      .sort({ createdAt: 1 })\n      .limit(100);\n\n    res.json({\n      success: true,\n      data: messages,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Add member to group\n// @route   POST /api/groups/:groupId/members\n// @access  Private (Admin only)\nexport const addGroupMember = async (req, res) => {\n  try {\n    const { groupId } = req.params;\n    const { userId } = req.body;\n\n    const group = await Group.findById(groupId);\n\n    if (!group) {\n      return res.status(404).json({\n        success: false,\n        message: 'Group not found',\n      });\n    }\n\n    // Check if user is admin\n    if (group.admin.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Only admin can add members',\n      });\n    }\n\n    // Check if user is already a member\n    const isMember = group.members.some(\n      (member) => member.user.toString() === userId\n    );\n\n    if (isMember) {\n      return res.status(400).json({\n        success: false,\n        message: 'User is already a member',\n      });\n    }\n\n    group.members.push({\n      user: userId,\n      role: 'member',\n    });\n\n    await group.save();\n\n    const populatedGroup = await Group.findById(groupId)\n      .populate('members.user', 'username fullName avatar')\n      .populate('admin', 'username fullName avatar');\n\n    // Emit socket event\n    const io = req.app.get('io');\n    io.to(userId).emit('addedToGroup', populatedGroup);\n    \n    group.members.forEach((member) => {\n      io.to(member.user.toString()).emit('groupMemberAdded', {\n        groupId,\n        newMember: userId,\n      });\n    });\n\n    res.json({\n      success: true,\n      message: 'Member added successfully',\n      data: populatedGroup,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Leave group\n// @route   DELETE /api/groups/:groupId/leave\n// @access  Private\nexport const leaveGroup = async (req, res) => {\n  try {\n    const { groupId } = req.params;\n\n    const group = await Group.findById(groupId);\n\n    if (!group) {\n      return res.status(404).json({\n        success: false,\n        message: 'Group not found',\n      });\n    }\n\n    // Remove user from members\n    group.members = group.members.filter(\n      (member) => member.user.toString() !== req.user._id.toString()\n    );\n\n    await group.save();\n\n    // Emit socket event\n    const io = req.app.get('io');\n    group.members.forEach((member) => {\n      io.to(member.user.toString()).emit('memberLeftGroup', {\n        groupId,\n        userId: req.user._id,\n      });\n    });\n\n    res.json({\n      success: true,\n      message: 'Left group successfully',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n","size_bytes":9496},"frontend/src/pages/Trending.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { trendingAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { FiTrendingUp, FiHash, FiUsers, FiPlay } from 'react-icons/fi';\nimport Navbar from '../components/Navbar';\nimport BottomNav from '../components/BottomNav';\nimport Loader from '../components/Loader';\n\nfunction Trending() {\n  const [activeTab, setActiveTab] = useState('videos');\n  const [videos, setVideos] = useState([]);\n  const [hashtags, setHashtags] = useState([]);\n  const [creators, setCreators] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [timeframe, setTimeframe] = useState('7d');\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    fetchTrendingData();\n  }, [activeTab, timeframe]);\n\n  const fetchTrendingData = async () => {\n    try {\n      setLoading(true);\n      if (activeTab === 'videos') {\n        const response = await trendingAPI.getTrendingVideos(timeframe);\n        setVideos(response.data.videos || []);\n      } else if (activeTab === 'hashtags') {\n        const response = await trendingAPI.getTrendingHashtags();\n        setHashtags(response.data.hashtags || []);\n      } else if (activeTab === 'creators') {\n        const response = await trendingAPI.getTrendingCreators();\n        setCreators(response.data.creators || []);\n      }\n    } catch (error) {\n      console.error('Error fetching trending data:', error);\n      toast.error('Failed to load trending data');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <Navbar />\n      \n      <div className=\"max-w-7xl mx-auto px-4 py-6 pb-20\">\n        <div className=\"flex items-center gap-3 mb-6\">\n          <FiTrendingUp className=\"w-8 h-8 text-purple-500\" />\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Trending</h1>\n        </div>\n\n        <div className=\"flex gap-2 mb-6 overflow-x-auto pb-2\">\n          <button\n            onClick={() => setActiveTab('videos')}\n            className={`px-6 py-2 rounded-lg whitespace-nowrap ${\n              activeTab === 'videos'\n                ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white'\n                : 'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300'\n            }`}\n          >\n            Videos\n          </button>\n          <button\n            onClick={() => setActiveTab('hashtags')}\n            className={`px-6 py-2 rounded-lg whitespace-nowrap ${\n              activeTab === 'hashtags'\n                ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white'\n                : 'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300'\n            }`}\n          >\n            Hashtags\n          </button>\n          <button\n            onClick={() => setActiveTab('creators')}\n            className={`px-6 py-2 rounded-lg whitespace-nowrap ${\n              activeTab === 'creators'\n                ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white'\n                : 'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300'\n            }`}\n          >\n            Creators\n          </button>\n        </div>\n\n        {activeTab === 'videos' && (\n          <div className=\"flex gap-2 mb-6\">\n            <button\n              onClick={() => setTimeframe('1d')}\n              className={`px-4 py-2 rounded-lg text-sm ${\n                timeframe === '1d'\n                  ? 'bg-purple-500 text-white'\n                  : 'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300'\n              }`}\n            >\n              Today\n            </button>\n            <button\n              onClick={() => setTimeframe('7d')}\n              className={`px-4 py-2 rounded-lg text-sm ${\n                timeframe === '7d'\n                  ? 'bg-purple-500 text-white'\n                  : 'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300'\n              }`}\n            >\n              This Week\n            </button>\n            <button\n              onClick={() => setTimeframe('30d')}\n              className={`px-4 py-2 rounded-lg text-sm ${\n                timeframe === '30d'\n                  ? 'bg-purple-500 text-white'\n                  : 'bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300'\n              }`}\n            >\n              This Month\n            </button>\n          </div>\n        )}\n\n        {loading ? (\n          <Loader />\n        ) : (\n          <div>\n            {activeTab === 'videos' && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n                {videos.map((video, index) => (\n                  <div\n                    key={video._id}\n                    className=\"bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition cursor-pointer\"\n                    onClick={() => navigate(video.category === 'short' ? `/reels/${video._id}` : `/videos/${video._id}`)}\n                  >\n                    <div className=\"relative aspect-video bg-gray-200 dark:bg-gray-700 rounded-t-lg overflow-hidden\">\n                      {video.media && video.media[0] && (\n                        <img\n                          src={video.thumbnailUrl || video.media[0].url}\n                          alt={video.title}\n                          className=\"w-full h-full object-cover\"\n                        />\n                      )}\n                      <div className=\"absolute top-2 left-2 bg-purple-500 text-white px-2 py-1 rounded text-xs font-bold\">\n                        #{index + 1}\n                      </div>\n                    </div>\n                    <div className=\"p-3\">\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white line-clamp-2 mb-1\">\n                        {video.title || 'Untitled'}\n                      </h3>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        {video.author?.username}\n                      </p>\n                      <div className=\"flex justify-between text-xs text-gray-500 mt-2\">\n                        <span>{video.viewCount || 0} views</span>\n                        <span>{video.likeCount || 0} likes</span>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {activeTab === 'hashtags' && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {hashtags.map((tag, index) => (\n                  <div\n                    key={index}\n                    className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-6 cursor-pointer hover:shadow-lg transition\"\n                    onClick={() => navigate(`/hashtag/${tag.hashtag}`)}\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"bg-purple-100 dark:bg-purple-900/20 p-4 rounded-full\">\n                        <FiHash className=\"w-8 h-8 text-purple-500\" />\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-lg font-bold text-gray-900 dark:text-white\">\n                          #{tag.hashtag}\n                        </h3>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          {tag.postCount} posts\n                        </p>\n                      </div>\n                      <div className=\"text-2xl font-bold text-purple-500\">\n                        #{index + 1}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {activeTab === 'creators' && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {creators.map((creator, index) => (\n                  <div\n                    key={creator._id}\n                    className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-6 cursor-pointer hover:shadow-lg transition\"\n                    onClick={() => navigate(`/profile/${creator.username}`)}\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"relative\">\n                        <img\n                          src={creator.profilePicture || '/default-avatar.png'}\n                          alt={creator.username}\n                          className=\"w-16 h-16 rounded-full object-cover\"\n                        />\n                        <div className=\"absolute -top-1 -right-1 bg-purple-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold\">\n                          {index + 1}\n                        </div>\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-bold text-gray-900 dark:text-white\">\n                          {creator.fullName || creator.username}\n                        </h3>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          @{creator.username}\n                        </p>\n                        <p className=\"text-sm text-gray-500 mt-1\">\n                          {creator.followerCount} subscriber\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      <BottomNav />\n    </div>\n  );\n}\n\nexport default Trending;\n","size_bytes":9615},"backend/controllers/notificationController.js":{"content":"import Notification from '../models/Notification.js';\n\n// @desc    Get user notifications\n// @route   GET /api/notifications\n// @access  Private\nexport const getNotifications = async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 20;\n    const skip = (page - 1) * limit;\n\n    const notifications = await Notification.find({ recipient: req.user._id })\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit)\n      .populate('sender', 'username fullName avatar')\n      .populate('post', 'mediaUrl');\n\n    const unreadCount = await Notification.countDocuments({\n      recipient: req.user._id,\n      read: false,\n    });\n\n    const total = await Notification.countDocuments({\n      recipient: req.user._id,\n    });\n\n    res.status(200).json({\n      success: true,\n      data: notifications,\n      unreadCount,\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit),\n      },\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Mark notification as read\n// @route   PUT /api/notifications/:id/read\n// @access  Private\nexport const markAsRead = async (req, res) => {\n  try {\n    const notification = await Notification.findById(req.params.id);\n\n    if (!notification) {\n      return res.status(404).json({\n        success: false,\n        message: 'Notification not found',\n      });\n    }\n\n    if (notification.recipient.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized',\n      });\n    }\n\n    notification.read = true;\n    await notification.save();\n\n    res.status(200).json({\n      success: true,\n      message: 'Notification marked as read',\n      data: notification,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Mark all notifications as read\n// @route   PUT /api/notifications/read-all\n// @access  Private\nexport const markAllAsRead = async (req, res) => {\n  try {\n    await Notification.updateMany(\n      { recipient: req.user._id, read: false },\n      { read: true }\n    );\n\n    res.status(200).json({\n      success: true,\n      message: 'All notifications marked as read',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Delete notification\n// @route   DELETE /api/notifications/:id\n// @access  Private\nexport const deleteNotification = async (req, res) => {\n  try {\n    const notification = await Notification.findById(req.params.id);\n\n    if (!notification) {\n      return res.status(404).json({\n        success: false,\n        message: 'Notification not found',\n      });\n    }\n\n    if (notification.recipient.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized',\n      });\n    }\n\n    await notification.deleteOne();\n\n    res.status(200).json({\n      success: true,\n      message: 'Notification deleted successfully',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n","size_bytes":3308},"backend/config/db.js":{"content":"import mongoose from 'mongoose';\n\nconst connectDB = async () => {\n  try {\n    const isLocalMongo = process.env.MONGO_URI?.includes('localhost') || process.env.MONGO_URI?.includes('127.0.0.1');\n    console.log(`ğŸ”§ Attempting to connect to ${isLocalMongo ? 'Local MongoDB' : 'MongoDB Atlas'}...`);\n    console.log('ğŸ“ Connection string:', process.env.MONGO_URI?.replace(/mongodb(\\+srv)?:\\/\\/([^:]+):([^@]+)@/, 'mongodb$1://username:password@'));\n    \n    const conn = await mongoose.connect(process.env.MONGO_URI, {\n      useNewUrlParser: true,\n      useUnifiedTopology: true,\n    });\n\n    console.log(`âœ… MongoDB Connected: ${conn.connection.host}`);\n    console.log(`ğŸ“Š Database: ${conn.connection.name}`);\n    \n    // Verify we can actually query the database\n    const collections = await mongoose.connection.db.listCollections().toArray();\n    console.log(`ğŸ“ Collections found: ${collections.length}`);\n    collections.forEach(collection => {\n      console.log(`   - ${collection.name}`);\n    });\n    \n  } catch (error) {\n    console.error(`âŒ MongoDB Connection Error: ${error.message}`);\n    \n    // More specific error handling\n    if (error.name === 'MongoServerError') {\n      if (error.code === 8000) {\n        console.log('ğŸ” Authentication failed - check username/password in connection string');\n      } else if (error.code === 13) {\n        console.log('ğŸš« Permission denied - check Atlas user privileges');\n      }\n    } else if (error.name === 'MongoNetworkError') {\n      console.log('ğŸŒ Network error - check your IP whitelist in Atlas');\n    } else if (error.name === 'MongooseServerSelectionError') {\n      console.log('ğŸ”Œ Cannot reach Atlas cluster - check network connection');\n    }\n    \n    process.exit(1);\n  }\n};\n\nexport default connectDB;","size_bytes":1783},"frontend/src/components/PostCard.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { postAPI } from '../services/api';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\nimport {\n  AiOutlineHeart,\n  AiFillHeart,\n  AiOutlineComment,\n  AiOutlineDelete,\n  AiOutlineShareAlt,\n} from 'react-icons/ai';\nimport { BsBookmark, BsBookmarkFill, BsThreeDots, BsArchive } from 'react-icons/bs';\nimport { FiSend } from 'react-icons/fi';\nimport { timeAgo } from '../utils/timeAgo';\nimport CommentBox from './CommentBox';\nimport ImageCarousel from './ImageCarousel';\nimport CaptionWithLinks from './CaptionWithLinks';\n\nconst PostCard = ({ post: initialPost, onDelete }) => {\n  const { user } = useAuth();\n  const [post, setPost] = useState(initialPost);\n  const [showComments, setShowComments] = useState(false);\n  const [showMenu, setShowMenu] = useState(false);\n  const [isLiked, setIsLiked] = useState(post.likes.includes(user?._id));\n  const [likesCount, setLikesCount] = useState(post.likes.length);\n  const [isSaved, setIsSaved] = useState(false);\n  const [isArchived, setIsArchived] = useState(post.isArchived || false);\n\n  useEffect(() => {\n    socketService.on('postLiked', (data) => {\n      if (data.postId === post._id) {\n        setLikesCount(data.likesCount);\n      }\n    });\n\n    socketService.on('newComment', (data) => {\n      if (data.postId === post._id) {\n        setPost((prev) => ({\n          ...prev,\n          comments: [...prev.comments, data.comment],\n        }));\n      }\n    });\n\n    return () => {\n      socketService.off('postLiked');\n      socketService.off('newComment');\n    };\n  }, [post._id]);\n\n  const handleLike = async () => {\n    try {\n      const response = await postAPI.likePost(post._id);\n      setIsLiked(response.data.isLiked);\n      setLikesCount(response.data.likesCount);\n    } catch (error) {\n      toast.error('Failed to like post');\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      const response = await postAPI.savePost(post._id);\n      setIsSaved(response.data.isSaved);\n      toast.success(response.data.message);\n    } catch (error) {\n      toast.error('Failed to save post');\n    }\n  };\n\n  const handleDelete = async () => {\n    if (window.confirm('Are you sure you want to delete this post?')) {\n      try {\n        await postAPI.deletePost(post._id);\n        toast.success('Post deleted successfully');\n        onDelete?.(post._id);\n      } catch (error) {\n        toast.error('Failed to delete post');\n      }\n    }\n  };\n\n  const handleArchive = async () => {\n    try {\n      const response = await postAPI.archivePost(post._id);\n      setIsArchived(response.data.isArchived);\n      toast.success(response.data.message);\n      setShowMenu(false);\n      if (response.data.isArchived) {\n        onDelete?.(post._id);\n      }\n    } catch (error) {\n      toast.error('Failed to archive post');\n    }\n  };\n\n  const getCategoryBadge = () => {\n    if (!post.category) return null;\n    \n    const badges = {\n      image: { icon: 'ğŸ“¸', label: 'Photo', color: 'from-primary-400 to-primary-600' },\n      short: { icon: 'ğŸ¬', label: 'Short', color: 'from-secondary-400 to-secondary-600' },\n      long: { icon: 'ğŸ¥', label: 'Video', color: 'from-accent-400 to-accent-600' },\n    };\n\n    const badge = badges[post.category] || badges.image;\n    const duration = typeof post.durationSec === 'number' \n      ? `${Math.floor(post.durationSec/60)}:${String(post.durationSec%60).padStart(2,'0')}` \n      : '';\n\n    return (\n      <span className={`inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-gradient-to-r ${badge.color} text-white text-xs font-bold shadow-sm`}>\n        <span>{badge.icon}</span>\n        <span>{badge.label}</span>\n        {duration && <span className=\"opacity-90\">Â· {duration}</span>}\n      </span>\n    );\n  };\n\n  return (\n    <div className=\"card mb-6 overflow-hidden animate-fadeIn hover:shadow-card-hover transition-all duration-300\">\n      {/* Post Header */}\n      <div className=\"flex items-center justify-between p-4 pb-3\">\n        <Link\n          to={`/profile/${post.author.username}`}\n          className=\"flex items-center gap-3 group\"\n        >\n          <div className=\"relative\">\n            <img\n              src={post.author.avatar}\n              alt={post.author.username}\n              className=\"h-11 w-11 rounded-full object-cover ring-2 ring-gray-200 dark:ring-dark-border group-hover:ring-primary-400 transition-all duration-200\"\n            />\n            <div className=\"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-success-500 rounded-full border-2 border-white dark:border-dark-card\"></div>\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-0.5\">\n              <p className=\"font-bold text-gray-900 dark:text-white truncate group-hover:text-primary-500 transition-colors\">\n                {post.author.username}\n              </p>\n              {getCategoryBadge()}\n            </div>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">{timeAgo(post.createdAt)}</p>\n          </div>\n        </Link>\n\n        {user?._id === post.author._id && (\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowMenu(!showMenu)}\n              className=\"p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-dark-card-hover transition-colors text-gray-600 dark:text-gray-400\"\n            >\n              <BsThreeDots size={20} />\n            </button>\n\n            {showMenu && (\n              <>\n                <div className=\"fixed inset-0 z-40\" onClick={() => setShowMenu(false)}></div>\n                <div className=\"absolute right-0 mt-2 w-48 card p-2 z-50 animate-scale-in\">\n                  <button\n                    onClick={handleArchive}\n                    className=\"flex items-center gap-3 w-full px-4 py-2.5 rounded-xl hover:bg-gray-100 dark:hover:bg-dark-card-hover text-gray-700 dark:text-gray-300 transition-colors\"\n                  >\n                    <BsArchive className=\"w-4 h-4\" />\n                    <span className=\"font-medium\">{isArchived ? 'Unarchive' : 'Archive'}</span>\n                  </button>\n                  <button\n                    onClick={handleDelete}\n                    className=\"flex items-center gap-3 w-full px-4 py-2.5 rounded-xl hover:bg-danger-50 dark:hover:bg-danger-900/20 text-danger-500 transition-colors\"\n                  >\n                    <AiOutlineDelete className=\"w-4 h-4\" />\n                    <span className=\"font-medium\">Delete</span>\n                  </button>\n                </div>\n              </>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Post Media with Carousel */}\n      {(post.media?.length > 0 || post.mediaUrl) ? (\n        <ImageCarousel\n          media={\n            post.media && post.media.length > 0\n              ? post.media\n              : post.mediaUrl\n              ? [{ url: post.mediaUrl, type: post.mediaType || 'image' }]\n              : null\n          }\n          onLike={handleLike}\n          isLiked={isLiked}\n        />\n      ) : (\n        <div className=\"w-full h-64 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-dark-card dark:to-dark-card-hover flex items-center justify-center\">\n          <div className=\"text-center\">\n            <span className=\"text-4xl mb-2 block\">ğŸ“·</span>\n            <p className=\"text-gray-500 dark:text-gray-400 font-medium\">No media available</p>\n          </div>\n        </div>\n      )}\n\n      {/* Post Actions */}\n      <div className=\"p-4 pt-3\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-3\">\n            <button \n              onClick={handleLike} \n              className={`p-2 rounded-xl transition-all duration-200 ${\n                isLiked \n                  ? 'bg-danger-50 dark:bg-danger-900/20 scale-110' \n                  : 'hover:bg-gray-100 dark:hover:bg-dark-card-hover hover:scale-110'\n              }`}\n            >\n              {isLiked ? (\n                <AiFillHeart size={26} className=\"text-danger-500 animate-like-burst\" />\n              ) : (\n                <AiOutlineHeart size={26} className=\"text-gray-700 dark:text-gray-300\" />\n              )}\n            </button>\n\n            <button\n              onClick={() => setShowComments(!showComments)}\n              className={`p-2 rounded-xl transition-all duration-200 ${\n                showComments\n                  ? 'bg-info-50 dark:bg-info-900/20'\n                  : 'hover:bg-gray-100 dark:hover:bg-dark-card-hover'\n              } hover:scale-110`}\n            >\n              <AiOutlineComment size={26} className={showComments ? 'text-info-500' : 'text-gray-700 dark:text-gray-300'} />\n            </button>\n\n            <button className=\"p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-dark-card-hover transition-all duration-200 hover:scale-110\">\n              <FiSend size={24} className=\"text-gray-700 dark:text-gray-300\" />\n            </button>\n          </div>\n\n          <button \n            onClick={handleSave} \n            className={`p-2 rounded-xl transition-all duration-200 ${\n              isSaved \n                ? 'bg-warning-50 dark:bg-warning-900/20 scale-110' \n                : 'hover:bg-gray-100 dark:hover:bg-dark-card-hover hover:scale-110'\n            }`}\n          >\n            {isSaved ? (\n              <BsBookmarkFill size={24} className=\"text-warning-500\" />\n            ) : (\n              <BsBookmark size={24} className=\"text-gray-700 dark:text-gray-300\" />\n            )}\n          </button>\n        </div>\n\n        {/* Likes Count */}\n        {likesCount > 0 && (\n          <p className=\"font-bold text-gray-900 dark:text-white mb-3\">\n            {likesCount.toLocaleString()} {likesCount === 1 ? 'like' : 'likes'}\n          </p>\n        )}\n\n        {/* Caption with Hashtags & Mentions */}\n        {post.caption && (\n          <div className=\"mb-3\">\n            <CaptionWithLinks caption={post.caption} author={post.author} />\n          </div>\n        )}\n\n        {/* Location */}\n        {post.location && (\n          <div className=\"flex items-center gap-2 mb-3 text-sm text-gray-600 dark:text-gray-400\">\n            <span className=\"text-base\">ğŸ“</span>\n            <span className=\"font-medium\">{post.location}</span>\n          </div>\n        )}\n\n        {/* Comments Preview */}\n        {post.comments.length > 0 && !showComments && (\n          <button\n            onClick={() => setShowComments(true)}\n            className=\"text-gray-500 dark:text-gray-400 text-sm font-medium hover:text-gray-700 dark:hover:text-gray-300 transition-colors mb-2\"\n          >\n            View all {post.comments.length} {post.comments.length === 1 ? 'comment' : 'comments'}\n          </button>\n        )}\n\n        {/* Comments Section */}\n        {showComments && <CommentBox post={post} setPost={setPost} />}\n      </div>\n    </div>\n  );\n};\n\nexport default PostCard;\n","size_bytes":11040},"frontend/src/pages/AdminPosts.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { Navigate, Link } from 'react-router-dom';\nimport { adminAPI } from '../services/adminAPI';\nimport toast from 'react-hot-toast';\nimport {\n  FiImage,\n  FiSearch,\n  FiTrash2,\n  FiArrowLeft,\n  FiChevronLeft,\n  FiChevronRight,\n  FiHeart,\n  FiMessageCircle,\n  FiEye,\n} from 'react-icons/fi';\n\nconst AdminPosts = () => {\n  const { user } = useAuth();\n  const [posts, setPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [total, setTotal] = useState(0);\n  const [selectedPost, setSelectedPost] = useState(null);\n\n  useEffect(() => {\n    if (user?.role === 'admin') {\n      fetchPosts();\n    }\n  }, [user, currentPage]);\n\n  const fetchPosts = async () => {\n    try {\n      setLoading(true);\n      const response = await adminAPI.getAllPosts(currentPage, 20);\n      setPosts(response.data.data.posts);\n      setTotalPages(response.data.data.totalPages);\n      setTotal(response.data.data.total);\n    } catch (error) {\n      toast.error('Failed to fetch posts');\n      console.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSearch = async () => {\n    if (!searchQuery.trim()) {\n      fetchPosts();\n      return;\n    }\n\n    try {\n      setLoading(true);\n      const response = await adminAPI.adminSearch(searchQuery, 'posts');\n      setPosts(response.data.data);\n    } catch (error) {\n      toast.error('Search failed');\n      console.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDeletePost = async (postId) => {\n    if (!confirm('Are you sure you want to delete this post? This action cannot be undone.')) {\n      return;\n    }\n\n    try {\n      await adminAPI.deletePost(postId);\n      toast.success('Post deleted successfully');\n      fetchPosts();\n      setSelectedPost(null);\n    } catch (error) {\n      toast.error('Failed to delete post');\n      console.error(error);\n    }\n  };\n\n  // Check if user is admin\n  if (!user || user.role !== 'admin') {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center flex-1 min-w-0\">\n              <Link\n                to=\"/admin\"\n                className=\"mr-2 sm:mr-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition flex-shrink-0\"\n              >\n                <FiArrowLeft className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-600 dark:text-gray-300\" />\n              </Link>\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white flex items-center\">\n                  <FiImage className=\"mr-1 sm:mr-2 flex-shrink-0\" />\n                  <span className=\"truncate\">Post Management</span>\n                </h1>\n                <p className=\"mt-1 text-xs sm:text-sm text-gray-500 dark:text-gray-400\">\n                  Total {total} posts\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Search Bar */}\n          <div className=\"mt-4 sm:mt-6\">\n            <div className=\"flex gap-2\">\n              <div className=\"flex-1 relative\">\n                <FiSearch className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  onKeyPress={(e) => e.key === 'Enter' && handleSearch()}\n                  placeholder=\"Search posts...\"\n                  className=\"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n              </div>\n              <button\n                onClick={handleSearch}\n                className=\"px-4 sm:px-6 py-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition flex-shrink-0\"\n              >\n                Search\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Posts Grid */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8\">\n        {loading ? (\n          <div className=\"flex justify-center py-12\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n          </div>\n        ) : posts.length === 0 ? (\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-12 text-center\">\n            <FiImage className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">\n              No posts found\n            </h3>\n            <p className=\"text-gray-500 dark:text-gray-400\">\n              Try adjusting your search criteria\n            </p>\n          </div>\n        ) : (\n          <>\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4 lg:gap-6\">\n              {posts.map((post) => (\n                <div\n                  key={post._id}\n                  className=\"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden hover:shadow-lg transition cursor-pointer\"\n                  onClick={() => setSelectedPost(post)}\n                >\n                  {/* Post Image */}\n                  <div className=\"relative aspect-square bg-gray-100 dark:bg-gray-700\">\n                    {post.media && post.media.length > 0 ? (\n                      post.media[0].type === 'video' ? (\n                        <video\n                          src={post.media[0].url}\n                          className=\"w-full h-full object-cover\"\n                        />\n                      ) : (\n                        <img\n                          src={post.media[0].url}\n                          alt=\"Post\"\n                          className=\"w-full h-full object-cover\"\n                        />\n                      )\n                    ) : (\n                      <div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\">\n                        <FiImage className=\"w-12 h-12 text-gray-400\" />\n                      </div>\n                    )}\n                    <div className=\"absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs\">\n                      {post.media?.length || 0} media\n                    </div>\n                  </div>\n\n                  {/* Post Info */}\n                  <div className=\"p-2 sm:p-3 lg:p-4\">\n                    <div className=\"flex items-center mb-2\">\n                      <img\n                        src={post.user?.avatar}\n                        alt={post.user?.username}\n                        className=\"w-6 h-6 sm:w-8 sm:h-8 rounded-full object-cover flex-shrink-0\"\n                      />\n                      <div className=\"ml-1 sm:ml-2 min-w-0 flex-1\">\n                        <Link\n                          to={`/profile/${post.user?.username}`}\n                          className=\"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white hover:text-blue-500 truncate block\"\n                          onClick={(e) => e.stopPropagation()}\n                        >\n                          @{post.user?.username}\n                        </Link>\n                      </div>\n                    </div>\n\n                    <p className=\"text-xs sm:text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-2 hidden sm:block\">\n                      {post.caption || 'No caption'}\n                    </p>\n\n                    <div className=\"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-500 dark:text-gray-400\">\n                      <div className=\"flex items-center\">\n                        <FiHeart className=\"w-3 h-3 sm:w-4 sm:h-4 mr-0.5 sm:mr-1\" />\n                        {post.likes?.length || 0}\n                      </div>\n                      <div className=\"flex items-center\">\n                        <FiMessageCircle className=\"w-3 h-3 sm:w-4 sm:h-4 mr-0.5 sm:mr-1\" />\n                        {post.comments?.length || 0}\n                      </div>\n                    </div>\n\n                    <div className=\"mt-2 sm:mt-3 text-xs text-gray-400 hidden sm:block\">\n                      {new Date(post.createdAt).toLocaleDateString()}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Pagination */}\n            {totalPages > 1 && (\n              <div className=\"mt-8 flex items-center justify-between\">\n                <div className=\"text-sm text-gray-700 dark:text-gray-300\">\n                  Page {currentPage} of {totalPages}\n                </div>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => setCurrentPage((prev) => Math.max(1, prev - 1))}\n                    disabled={currentPage === 1}\n                    className=\"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition\"\n                  >\n                    <FiChevronLeft className=\"w-5 h-5\" />\n                  </button>\n                  <button\n                    onClick={() => setCurrentPage((prev) => Math.min(totalPages, prev + 1))}\n                    disabled={currentPage === totalPages}\n                    className=\"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition\"\n                  >\n                    <FiChevronRight className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Post Detail Modal */}\n      {selectedPost && (\n        <div\n          className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4\"\n          onClick={() => setSelectedPost(null)}\n        >\n          <div\n            className=\"bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            {/* Modal Header */}\n            <div className=\"flex items-center justify-between p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10\">\n              <h3 className=\"text-base sm:text-lg font-semibold text-gray-900 dark:text-white\">\n                Post Details\n              </h3>\n              <button\n                onClick={() => setSelectedPost(null)}\n                className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition text-xl\"\n              >\n                âœ•\n              </button>\n            </div>\n\n            {/* Modal Content */}\n            <div className=\"p-4 sm:p-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6\">\n                {/* Media */}\n                <div className=\"md:order-1\">\n                  {selectedPost.media && selectedPost.media.length > 0 && (\n                    <div className=\"space-y-3 sm:space-y-4\">\n                      {selectedPost.media.map((item, index) => (\n                        <div key={index} className=\"rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700\">\n                          {item.type === 'video' ? (\n                            <video src={item.url} controls className=\"w-full\" />\n                          ) : (\n                            <img src={item.url} alt=\"Post media\" className=\"w-full\" />\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n\n                {/* Info */}\n                <div className=\"md:order-2\">\n                  <div className=\"flex items-center mb-3 sm:mb-4\">\n                    <img\n                      src={selectedPost.user?.avatar}\n                      alt={selectedPost.user?.username}\n                      className=\"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover flex-shrink-0\"\n                    />\n                    <div className=\"ml-2 sm:ml-3 min-w-0 flex-1\">\n                      <Link\n                        to={`/profile/${selectedPost.user?.username}`}\n                        className=\"text-sm sm:text-base font-semibold text-gray-900 dark:text-white hover:text-blue-500 truncate block\"\n                      >\n                        {selectedPost.user?.fullName}\n                      </Link>\n                      <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400 truncate\">\n                        @{selectedPost.user?.username}\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"mb-3 sm:mb-4\">\n                    <h4 className=\"text-sm sm:text-base font-semibold text-gray-900 dark:text-white mb-2\">\n                      Caption\n                    </h4>\n                    <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n                      {selectedPost.caption || 'No caption'}\n                    </p>\n                  </div>\n\n                  <div className=\"mb-3 sm:mb-4\">\n                    <h4 className=\"text-sm sm:text-base font-semibold text-gray-900 dark:text-white mb-2\">\n                      Statistics\n                    </h4>\n                    <div className=\"grid grid-cols-2 gap-3 sm:gap-4\">\n                      <div className=\"bg-gray-50 dark:bg-gray-700 p-2 sm:p-3 rounded-lg\">\n                        <div className=\"flex items-center text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-1\">\n                          <FiHeart className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\n                          Likes\n                        </div>\n                        <div className=\"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white\">\n                          {selectedPost.likes?.length || 0}\n                        </div>\n                      </div>\n                      <div className=\"bg-gray-50 dark:bg-gray-700 p-2 sm:p-3 rounded-lg\">\n                        <div className=\"flex items-center text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-1\">\n                          <FiMessageCircle className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\n                          Comments\n                        </div>\n                        <div className=\"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white\">\n                          {selectedPost.comments?.length || 0}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"mb-3 sm:mb-4\">\n                    <h4 className=\"text-sm sm:text-base font-semibold text-gray-900 dark:text-white mb-2\">\n                      Post Information\n                    </h4>\n                    <div className=\"space-y-2 text-xs sm:text-sm\">\n                      <div className=\"flex justify-between gap-2\">\n                        <span className=\"text-gray-500 dark:text-gray-400 flex-shrink-0\">Posted:</span>\n                        <span className=\"text-gray-900 dark:text-white text-right\">\n                          {new Date(selectedPost.createdAt).toLocaleString()}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between gap-2\">\n                        <span className=\"text-gray-500 dark:text-gray-400 flex-shrink-0\">Post ID:</span>\n                        <span className=\"text-gray-900 dark:text-white font-mono text-xs truncate\">\n                          {selectedPost._id}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"pt-3 sm:pt-4 border-t border-gray-200 dark:border-gray-700\">\n                    <button\n                      onClick={() => handleDeletePost(selectedPost._id)}\n                      className=\"w-full px-4 py-2 sm:py-3 text-sm sm:text-base bg-red-500 text-white rounded-lg hover:bg-red-600 transition flex items-center justify-center font-medium\"\n                    >\n                      <FiTrash2 className=\"mr-2\" />\n                      Delete Post\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AdminPosts;\n","size_bytes":17154},"frontend/src/components/VoiceRecorder.jsx":{"content":"import { useState, useRef } from 'react';\nimport { BsMic, BsStopCircle, BsTrash } from 'react-icons/bs';\nimport { AiOutlineSend } from 'react-icons/ai';\nimport toast from 'react-hot-toast';\n\nconst VoiceRecorder = ({ onSend }) => {\n  const [isRecording, setIsRecording] = useState(false);\n  const [audioBlob, setAudioBlob] = useState(null);\n  const [recordingTime, setRecordingTime] = useState(0);\n  const [audioURL, setAudioURL] = useState('');\n  \n  const mediaRecorder = useRef(null);\n  const timerInterval = useRef(null);\n  const audioChunks = useRef([]);\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      mediaRecorder.current = new MediaRecorder(stream);\n      audioChunks.current = [];\n\n      mediaRecorder.current.ondataavailable = (event) => {\n        audioChunks.current.push(event.data);\n      };\n\n      mediaRecorder.current.onstop = () => {\n        const blob = new Blob(audioChunks.current, { type: 'audio/webm' });\n        const url = URL.createObjectURL(blob);\n        setAudioBlob(blob);\n        setAudioURL(url);\n        \n        // Stop all tracks\n        stream.getTracks().forEach((track) => track.stop());\n      };\n\n      mediaRecorder.current.start();\n      setIsRecording(true);\n      \n      // Start timer\n      timerInterval.current = setInterval(() => {\n        setRecordingTime((prev) => prev + 1);\n      }, 1000);\n      \n      toast.success('Recording started');\n    } catch (error) {\n      console.error('Failed to start recording:', error);\n      toast.error('Failed to access microphone');\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorder.current && isRecording) {\n      mediaRecorder.current.stop();\n      setIsRecording(false);\n      clearInterval(timerInterval.current);\n    }\n  };\n\n  const cancelRecording = () => {\n    if (isRecording) {\n      mediaRecorder.current.stop();\n      setIsRecording(false);\n    }\n    setAudioBlob(null);\n    setAudioURL('');\n    setRecordingTime(0);\n    clearInterval(timerInterval.current);\n  };\n\n  const sendVoiceMessage = () => {\n    if (audioBlob) {\n      onSend(audioBlob, recordingTime);\n      cancelRecording();\n    }\n  };\n\n  const formatTime = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"flex items-center space-x-2\">\n      {!isRecording && !audioBlob ? (\n        // Start Recording Button\n        <button\n          onClick={startRecording}\n          className=\"p-3 bg-gradient-primary rounded-full text-white hover:shadow-glow transition-all hover:scale-110\"\n        >\n          <BsMic size={24} />\n        </button>\n      ) : isRecording ? (\n        // Recording UI\n        <div className=\"flex items-center space-x-3 flex-1 bg-red-50 dark:bg-red-900/20 rounded-2xl px-4 py-3 animate-pulse\">\n          <div className=\"w-3 h-3 bg-red-500 rounded-full animate-pulse\"></div>\n          <span className=\"text-red-500 font-semibold\">{formatTime(recordingTime)}</span>\n          <div className=\"flex-1 flex space-x-2\">\n            <div className=\"w-1 h-8 bg-red-500 rounded animate-pulse\"></div>\n            <div className=\"w-1 h-6 bg-red-500 rounded animate-pulse\" style={{ animationDelay: '0.1s' }}></div>\n            <div className=\"w-1 h-10 bg-red-500 rounded animate-pulse\" style={{ animationDelay: '0.2s' }}></div>\n            <div className=\"w-1 h-7 bg-red-500 rounded animate-pulse\" style={{ animationDelay: '0.3s' }}></div>\n          </div>\n          <button\n            onClick={stopRecording}\n            className=\"p-2 bg-red-500 rounded-full text-white hover:bg-red-600\"\n          >\n            <BsStopCircle size={20} />\n          </button>\n        </div>\n      ) : (\n        // Preview & Send UI\n        <div className=\"flex items-center space-x-2 flex-1 bg-purple-50 dark:bg-purple-900/20 rounded-2xl px-4 py-3\">\n          <audio src={audioURL} controls className=\"flex-1 h-10\" />\n          <button\n            onClick={cancelRecording}\n            className=\"p-2 bg-red-500 rounded-full text-white hover:bg-red-600\"\n          >\n            <BsTrash size={18} />\n          </button>\n          <button\n            onClick={sendVoiceMessage}\n            className=\"p-2 bg-gradient-primary rounded-full text-white hover:shadow-glow\"\n          >\n            <AiOutlineSend size={20} />\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default VoiceRecorder;\n","size_bytes":4510},"frontend/src/pages/CloseFriends.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { userAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { BsStar, BsStarFill } from 'react-icons/bs';\nimport { AiOutlineSearch } from 'react-icons/ai';\n\nconst CloseFriends = () => {\n  const { user } = useAuth();\n  const [closeFriends, setCloseFriends] = useState([]);\n  const [allsubscribed, setAllsubscribed] = useState([]);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const fetchData = async () => {\n    try {\n      const response = await userAPI.getProfile(user.username);\n      const subscribed = response.data.data.subscribed;\n      \n      setAllsubscribed(subscribed);\n      // Get close friends from localStorage for now\n      const saved = JSON.parse(localStorage.getItem('closeFriends') || '[]');\n      setCloseFriends(saved);\n    } catch (error) {\n      console.error('Failed to load data:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const toggleCloseFriend = (friendId) => {\n    let updated;\n    if (closeFriends.includes(friendId)) {\n      updated = closeFriends.filter(id => id !== friendId);\n      toast.success('Removed from close friends');\n    } else {\n      updated = [...closeFriends, friendId];\n      toast.success('Added to close friends');\n    }\n    \n    setCloseFriends(updated);\n    localStorage.setItem('closeFriends', JSON.stringify(updated));\n  };\n\n  const isCloseFriend = (friendId) => closeFriends.includes(friendId);\n\n  const filteredsubscribed = allsubscribed.filter(friend =>\n    friend.username.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    friend.fullName.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-purple-500\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-amber-50 dark:from-dark-bg dark:via-dark-bg dark:to-dark-bg pb-20 md:pb-8\">\n      <div className=\"max-w-4xl mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"bg-gradient-secondary text-white rounded-3xl p-8 mb-8 shadow-glow\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-4xl font-bold mb-2 flex items-center\">\n                <BsStarFill className=\"mr-3 text-yellow-300\" />\n                Close Friends\n              </h1>\n              <p className=\"text-purple-100\">Share stories only with your close friends</p>\n            </div>\n            <div className=\"hidden md:block\">\n              <div className=\"bg-white/20 backdrop-blur-lg rounded-2xl px-6 py-3\">\n                <p className=\"text-3xl font-bold\">{closeFriends.length}</p>\n                <p className=\"text-sm text-purple-100\">Selected</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Info Card */}\n        <div className=\"card p-6 mb-6\">\n          <h3 className=\"font-bold text-lg mb-2 dark:text-white flex items-center\">\n            <span className=\"text-2xl mr-2\">ğŸ’¡</span>\n            How it works\n          </h3>\n          <ul className=\"space-y-2 text-sm text-gray-600 dark:text-gray-400\">\n            <li>âœ“ Only close friends can see stories marked for them</li>\n            <li>âœ“ Close friends see a green ring around your story</li>\n            <li>âœ“ You can add or remove friends anytime</li>\n            <li>âœ“ Friends won't be notified when you add/remove them</li>\n          </ul>\n        </div>\n\n        {/* Search */}\n        <div className=\"mb-6\">\n          <div className=\"relative\">\n            <AiOutlineSearch className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400\" size={20} />\n            <input\n              type=\"text\"\n              placeholder=\"Search subscribed...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"w-full pl-12 pr-4 py-3 bg-white dark:bg-dark-card border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:border-primary focus:outline-none dark:text-white\"\n            />\n          </div>\n        </div>\n\n        {/* Friends List */}\n        <div className=\"card overflow-hidden\">\n          <div className=\"divide-y divide-gray-200 dark:divide-dark-border\">\n            {filteredsubscribed.length === 0 ? (\n              <div className=\"p-12 text-center\">\n                <p className=\"text-gray-500 dark:text-gray-400\">\n                  {searchQuery ? 'No users found' : 'You are not subscribed anyone yet'}\n                </p>\n              </div>\n            ) : (\n              filteredsubscribed.map((friend) => (\n                <div\n                  key={friend._id}\n                  className=\"flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-dark-border/50 transition\"\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    <img\n                      src={friend.avatar}\n                      alt={friend.username}\n                      className=\"w-14 h-14 rounded-full object-cover\"\n                    />\n                    <div>\n                      <p className=\"font-semibold dark:text-white\">{friend.username}</p>\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                        {friend.fullName}\n                      </p>\n                    </div>\n                  </div>\n\n                  <button\n                    onClick={() => toggleCloseFriend(friend._id)}\n                    className={`p-3 rounded-full transition-all ${\n                      isCloseFriend(friend._id)\n                        ? 'bg-gradient-primary shadow-glow'\n                        : 'bg-gray-200 dark:bg-dark-border hover:bg-gray-300 dark:hover:bg-dark-border/80'\n                    }`}\n                  >\n                    {isCloseFriend(friend._id) ? (\n                      <BsStarFill size={24} className=\"text-yellow-300\" />\n                    ) : (\n                      <BsStar size={24} className=\"text-gray-600 dark:text-gray-400\" />\n                    )}\n                  </button>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n\n        {/* Stats */}\n        <div className=\"grid grid-cols-3 gap-4 mt-6\">\n          <div className=\"card p-4 text-center\">\n            <p className=\"text-3xl font-bold bg-gradient-primary bg-clip-text text-transparent\">\n              {allsubscribed.length}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">subscribed</p>\n          </div>\n          <div className=\"card p-4 text-center\">\n            <p className=\"text-3xl font-bold bg-gradient-primary bg-clip-text text-transparent\">\n              {closeFriends.length}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Close Friends</p>\n          </div>\n          <div className=\"card p-4 text-center\">\n            <p className=\"text-3xl font-bold bg-gradient-primary bg-clip-text text-transparent\">\n              {allsubscribed.length - closeFriends.length}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Others</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CloseFriends;\n","size_bytes":7551},"backend/routes/creatorRoutes.js":{"content":"import express from 'express';\nimport { protect } from '../middleware/authMiddleware.js';\nimport User from '../models/User.js';\nimport Revenue from '../models/Revenue.js';\nimport Post from '../models/Post.js';\n\nconst router = express.Router();\n\n// @route   POST /api/creator/enable-monetization\n// @desc    Apply for creator monetization\n// @access  Private\nrouter.post('/enable-monetization', protect, async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n\n    // Check eligibility\n    if (user.subscriber.length < 1000) {\n      return res.status(400).json({\n        success: false,\n        message: 'You need at least 1,000 subscriber to enable monetization',\n      });\n    }\n\n    if (user.totalWatchTime < 4000) {\n      return res.status(400).json({\n        success: false,\n        message: 'You need at least 4,000 minutes of watch time in the last 12 months',\n      });\n    }\n\n    user.isMonetizationEnabled = true;\n    user.monetizationApproved = true; // Auto-approve for demo\n    await user.save();\n\n    res.json({\n      success: true,\n      message: 'Monetization enabled! You can now earn from your content.',\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\n// @route   GET /api/creator/analytics\n// @desc    Get creator analytics\n// @access  Private\nrouter.get('/analytics', protect, async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n\n    // Get revenue data\n    const totalRevenue = await Revenue.aggregate([\n      { $match: { creator: req.user._id } },\n      {\n        $group: {\n          _id: null,\n          total: { $sum: '$amount' },\n          pending: {\n            $sum: {\n              $cond: [{ $eq: ['$isPaid', false] }, '$amount', 0],\n            },\n          },\n        },\n      },\n    ]);\n\n    // Get monthly revenue\n    const monthlyRevenue = await Revenue.aggregate([\n      { $match: { creator: req.user._id } },\n      {\n        $group: {\n          _id: { month: '$month', year: '$year' },\n          total: { $sum: '$amount' },\n        },\n      },\n      { $sort: { '_id.year': -1, '_id.month': -1 } },\n      { $limit: 12 },\n    ]);\n\n    // Get revenue by source\n    const revenueBySource = await Revenue.aggregate([\n      { $match: { creator: req.user._id } },\n      {\n        $group: {\n          _id: '$source',\n          total: { $sum: '$amount' },\n        },\n      },\n    ]);\n\n    // Get top performing posts\n    const topPosts = await Post.find({ author: req.user._id })\n      .sort('-views')\n      .limit(10)\n      .select('title views likes category createdAt media');\n\n    res.json({\n      success: true,\n      data: {\n        overview: {\n          totalEarnings: totalRevenue[0]?.total || 0,\n          pendingPayout: totalRevenue[0]?.pending || 0,\n          subscribers: user.subscribersCount,\n          totalWatchTime: user.totalWatchTime,\n          subscriber: user.subscriber.length,\n        },\n        monthlyRevenue,\n        revenueBySource,\n        topPosts,\n      },\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\n// @route   POST /api/creator/track-view\n// @desc    Track video view for analytics (called from frontend)\n// @access  Private\nrouter.post('/track-view', protect, async (req, res) => {\n  try {\n    const { postId, watchTime } = req.body; // watchTime in seconds\n\n    const post = await Post.findById(postId).populate('author');\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    // Update post views\n    post.views = (post.views || 0) + 1;\n    await post.save();\n\n    // Update creator's total watch time\n    if (post.author) {\n      await User.findByIdAndUpdate(post.author._id, {\n        $inc: {\n          totalWatchTime: Math.floor(watchTime / 60), // Convert to minutes\n          totalShortViews: post.category === 'short' ? 1 : 0,\n        },\n      });\n\n      // Calculate revenue (simplified - $0.001 per view for demo)\n      if (post.author.monetizationApproved) {\n        const revenue = 0.001; // $0.001 per view\n        \n        await Revenue.create({\n          creator: post.author._id,\n          source: post.category === 'short' ? 'shorts_fund' : 'ad_revenue',\n          amount: revenue,\n          post: post._id,\n          description: `View on ${post.title}`,\n          month: new Date().getMonth() + 1,\n          year: new Date().getFullYear(),\n        });\n\n        await User.findByIdAndUpdate(post.author._id, {\n          $inc: {\n            totalEarnings: revenue,\n            pendingPayout: revenue,\n            shortsEarnings: post.category === 'short' ? revenue : 0,\n          },\n        });\n      }\n    }\n\n    res.json({ success: true, message: 'View tracked' });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\n// @route   GET /api/creator/earnings\n// @desc    Get earnings breakdown\n// @access  Private\nrouter.get('/earnings', protect, async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n\n    const recentEarnings = await Revenue.find({ creator: req.user._id })\n      .sort('-createdAt')\n      .limit(50)\n      .populate('post', 'title');\n\n    res.json({\n      success: true,\n      data: {\n        totalEarnings: user.totalEarnings,\n        pendingPayout: user.pendingPayout,\n        shortsEarnings: user.shortsEarnings,\n        recentEarnings,\n      },\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\nexport default router;\n","size_bytes":5578},"backend/scripts/makeUserAdmin.js":{"content":"import mongoose from 'mongoose';\nimport dotenv from 'dotenv';\nimport User from '../models/User.js';\n\n// Load environment variables\ndotenv.config();\n\nconst makeUserAdmin = async (emailOrUsername) => {\n  try {\n    // Connect to database\n    await mongoose.connect(process.env.MONGO_URI);\n    console.log('âœ… Connected to MongoDB');\n\n    // Find user by email or username\n    const user = await User.findOne({\n      $or: [{ email: emailOrUsername }, { username: emailOrUsername }],\n    });\n\n    if (!user) {\n      console.log('âŒ User not found with email/username:', emailOrUsername);\n      process.exit(1);\n    }\n\n    // Check if already admin\n    if (user.role === 'admin') {\n      console.log('â„¹ï¸  User is already an admin');\n      console.log('ğŸ‘¤ User Details:');\n      console.log('   Name:', user.fullName);\n      console.log('   Username:', user.username);\n      console.log('   Email:', user.email);\n      console.log('   Role:', user.role);\n      process.exit(0);\n    }\n\n    // Update user role to admin\n    user.role = 'admin';\n    await user.save();\n\n    console.log('âœ… User successfully made admin!');\n    console.log('ğŸ‘¤ User Details:');\n    console.log('   Name:', user.fullName);\n    console.log('   Username:', user.username);\n    console.log('   Email:', user.email);\n    console.log('   Previous Role:', user.role === 'admin' ? 'user' : user.role);\n    console.log('   New Role:', user.role);\n    console.log('\\nğŸ” User can now access admin panel at: /admin');\n\n    process.exit(0);\n  } catch (error) {\n    console.error('âŒ Error:', error.message);\n    process.exit(1);\n  }\n};\n\n// Get email/username from command line arguments\nconst emailOrUsername = process.argv[2];\n\nif (!emailOrUsername) {\n  console.log('âŒ Please provide email or username');\n  console.log('Usage: node makeUserAdmin.js <email-or-username>');\n  console.log('Example: node makeUserAdmin.js user@example.com');\n  console.log('Example: node makeUserAdmin.js johndoe');\n  process.exit(1);\n}\n\nmakeUserAdmin(emailOrUsername);\n","size_bytes":2025},"backend/models/Revenue.js":{"content":"import mongoose from 'mongoose';\n\nconst revenueSchema = new mongoose.Schema(\n  {\n    creator: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    source: {\n      type: String,\n      enum: ['ad_revenue', 'super_chat', 'shorts_fund', 'premium_views', 'subscription'],\n      required: true,\n    },\n    amount: {\n      type: Number,\n      required: true,\n    },\n    currency: {\n      type: String,\n      default: 'USD',\n    },\n    post: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Post',\n    },\n    liveStream: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'LiveStream',\n    },\n    description: {\n      type: String,\n    },\n    isPaid: {\n      type: Boolean,\n      default: false,\n    },\n    paidAt: {\n      type: Date,\n    },\n    month: {\n      type: Number, // 1-12\n    },\n    year: {\n      type: Number,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Indexes\nrevenueSchema.index({ creator: 1, isPaid: 1 });\nrevenueSchema.index({ month: 1, year: 1 });\nrevenueSchema.index({ source: 1 });\n\nconst Revenue = mongoose.model('Revenue', revenueSchema);\n\nexport default Revenue;\n","size_bytes":1143},"backend/routes/postRoutes.js":{"content":"import express from 'express';\nimport {\n  createPost,\n  getFeedPosts,\n  getPost,\n  deletePost,\n  likePost,\n  addComment,\n  getPostComments,\n  deleteComment,\n  savePost,\n  getSavedPosts,\n  archivePost,\n  replyToComment,\n  pinComment,\n  unpinComment,\n} from '../controllers/postController.js';\nimport { protect } from '../middleware/authMiddleware.js';\nimport { upload, uploadMultiple } from '../config/minio.js';\nimport { uploadLimiter } from '../middleware/rateLimitMiddleware.js';\n\nconst router = express.Router();\n\nrouter.post('/', protect, uploadLimiter, upload.fields([{ name: 'media', maxCount: 10 }, { name: 'thumbnail', maxCount: 1 }]), createPost);\nrouter.get('/feed', protect, getFeedPosts);\nrouter.get('/saved', protect, getSavedPosts);\nrouter.get('/:id', getPost);\nrouter.delete('/:id', protect, deletePost);\nrouter.post('/:id/like', protect, likePost);\nrouter.post('/:id/save', protect, savePost);\nrouter.post('/:id/archive', protect, archivePost);\nrouter.post('/:id/comment', protect, addComment);\nrouter.get('/:id/comments', getPostComments);\nrouter.delete('/:postId/comments/:commentId', protect, deleteComment);\nrouter.post('/:postId/comments/:commentId/reply', protect, replyToComment);\nrouter.post('/:postId/pin/:commentId', protect, pinComment);\nrouter.post('/:postId/unpin', protect, unpinComment);\n\nexport default router;\n","size_bytes":1343},"frontend/src/components/StoriesBar.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { storyAPI } from '../services/api';\nimport { AiOutlinePlus } from 'react-icons/ai';\n\nconst StoriesBar = () => {\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const [stories, setStories] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchStories();\n  }, []);\n\n  const fetchStories = async () => {\n    try {\n      const response = await storyAPI.getsubscribedStories();\n      setStories(response.data.data);\n    } catch (error) {\n      console.error('Failed to load stories:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleStoryClick = (authorId) => {\n    navigate(`/stories/${authorId}`);\n  };\n\n  return (\n    <div className=\"card p-5 mb-6 animate-slide-up\">\n      <div className=\"flex gap-4 overflow-x-auto scrollbar-hide pb-1\">\n        {/* Add Your Story */}\n        <div\n          onClick={() => navigate('/stories/create')}\n          className=\"flex-shrink-0 cursor-pointer group\"\n        >\n          <div className=\"relative\">\n            <div className=\"absolute inset-0 bg-gradient-sunset rounded-full blur-md opacity-0 group-hover:opacity-70 transition-opacity duration-300\"></div>\n            <div className=\"relative\">\n              <img\n                src={user?.avatar}\n                alt={user?.username}\n                className=\"h-16 w-16 rounded-full object-cover ring-4 ring-gray-200 dark:ring-dark-border group-hover:ring-primary-400 transition-all duration-300\"\n              />\n              <div className=\"absolute bottom-0 right-0 bg-gradient-primary rounded-full p-1.5 shadow-lg ring-4 ring-white dark:ring-dark-card group-hover:scale-110 transition-transform duration-300\">\n                <AiOutlinePlus size={14} className=\"text-white\" />\n              </div>\n            </div>\n          </div>\n          <p className=\"text-xs text-center mt-2 font-medium text-gray-700 dark:text-gray-300 group-hover:text-primary-500 transition-colors\">\n            Your Story\n          </p>\n        </div>\n\n        {/* Stories from subscribed */}\n        {stories.map((storyGroup) => (\n          <div\n            key={storyGroup.author._id}\n            onClick={() => handleStoryClick(storyGroup.author._id)}\n            className=\"flex-shrink-0 cursor-pointer group\"\n          >\n            <div className=\"relative\">\n              {!storyGroup.hasViewed && (\n                <div className=\"absolute inset-0 bg-gradient-sunset rounded-full blur-md opacity-70 group-hover:opacity-100 transition-opacity duration-300\"></div>\n              )}\n              <div\n                className={`relative h-16 w-16 rounded-full p-0.5 ${\n                  storyGroup.hasViewed\n                    ? 'ring-4 ring-gray-300 dark:ring-dark-border'\n                    : 'bg-gradient-sunset shadow-glow'\n                }`}\n              >\n                <img\n                  src={storyGroup.author.avatar}\n                  alt={storyGroup.author.username}\n                  className=\"h-full w-full rounded-full object-cover ring-4 ring-white dark:ring-dark-card group-hover:scale-105 transition-transform duration-300\"\n                />\n              </div>\n            </div>\n            <p className={`text-xs text-center mt-2 truncate w-16 font-medium transition-colors ${\n              storyGroup.hasViewed\n                ? 'text-gray-500 dark:text-gray-400'\n                : 'text-gray-900 dark:text-white group-hover:text-primary-500'\n            }`}>\n              {storyGroup.author.username}\n            </p>\n          </div>\n        ))}\n\n        {/* Loading Skeletons */}\n        {loading && (\n          <>\n            {[1, 2, 3, 4, 5].map((i) => (\n              <div key={i} className=\"flex-shrink-0 animate-pulse\">\n                <div className=\"h-16 w-16 rounded-full skeleton\"></div>\n                <div className=\"h-3 w-16 skeleton rounded-full mt-2\"></div>\n              </div>\n            ))}\n          </>\n        )}\n\n        {/* Empty State */}\n        {!loading && stories.length === 0 && (\n          <div className=\"flex-1 flex flex-col items-center justify-center py-6 text-center\">\n            <span className=\"text-4xl mb-2\">ğŸ“±</span>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400 font-medium\">\n              No stories yet. Be the first to share!\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default StoriesBar;\n","size_bytes":4554},"DEPLOYMENT_GUIDE.md":{"content":"# friendflix Deployment Guide\n\n## Recommended: Render (Backend) + Netlify (Frontend)\n\nThis guide covers deploying your friendflix app with Socket.io support.\n\n---\n\n## ğŸš€ Part 1: Deploy Backend to Render\n\n### Why Render?\n- âœ… Free tier available\n- âœ… Full WebSocket/Socket.io support\n- âœ… Easy deployment from GitHub\n- âœ… Automatic HTTPS\n\n### Steps:\n\n1. **Push Your Code to GitHub**\n   ```bash\n   git add .\n   git commit -m \"Prepare for deployment\"\n   git push origin main\n   ```\n\n2. **Create Render Account**\n   - Go to [render.com](https://render.com)\n   - Sign up with GitHub\n\n3. **Create New Web Service**\n   - Click \"New +\" â†’ \"Web Service\"\n   - Connect your GitHub repository\n   - Select your friendflix repo\n\n4. **Configure Build Settings**\n   - **Name**: `friendflix-backend`\n   - **Region**: Choose closest to your users\n   - **Branch**: `main`\n   - **Root Directory**: `backend`\n   - **Environment**: `Node`\n   - **Build Command**: `npm install`\n   - **Start Command**: `npm start`\n   - **Plan**: Free\n\n5. **Add Environment Variables**\n   Click \"Environment\" and add:\n   ```\n   NODE_ENV=production\n   MONGO_URI=<your-mongodb-atlas-uri>\n   JWT_SECRET=<your-jwt-secret>\n   CLOUDINARY_CLOUD_NAME=<your-cloudinary-cloud-name>\n   CLOUDINARY_API_KEY=<your-cloudinary-api-key>\n   CLOUDINARY_API_SECRET=<your-cloudinary-api-secret>\n   ```\n\n6. **Deploy**\n   - Click \"Create Web Service\"\n   - Wait for deployment (2-3 minutes)\n   - Note your backend URL: `https://friendflix-backend.onrender.com`\n\n---\n\n## ğŸ¨ Part 2: Deploy Frontend to Netlify\n\n### Steps:\n\n1. **Create Netlify Account**\n   - Go to [netlify.com](https://netlify.com)\n   - Sign up with GitHub\n\n2. **Create New Site**\n   - Click \"Add new site\" â†’ \"Import an existing project\"\n   - Connect to GitHub\n   - Select your friendflix repository\n\n3. **Configure Build Settings**\n   - **Base directory**: `frontend`\n   - **Build command**: `npm run build`\n   - **Publish directory**: `frontend/dist`\n\n4. **Add Environment Variables**\n   Go to \"Site configuration\" â†’ \"Environment variables\":\n   ```\n   VITE_API_URL=https://friendflix-backend.onrender.com/api\n   VITE_SOCKET_URL=https://friendflix-backend.onrender.com\n   ```\n   âš ï¸ **Important**: Replace with your actual Render backend URL from Part 1\n\n5. **Deploy**\n   - Click \"Deploy site\"\n   - Wait for build to complete\n   - Your site will be live at: `https://your-site-name.netlify.app`\n\n---\n\n## ğŸ”§ Update Backend CORS\n\nAfter deploying frontend, update your backend CORS to allow the Netlify domain:\n\n1. Go to your Render dashboard\n2. Open your backend service\n3. Go to \"Environment\" tab\n4. Add environment variable:\n   ```\n   FRONTEND_URL=https://your-site-name.netlify.app\n   ```\n\nOr manually update `backend/server.js` to include your Netlify URL in the `allowedOrigins` array.\n\n---\n\n## ğŸ“± Custom Domain (Optional)\n\n### For Netlify Frontend:\n1. Go to \"Domain settings\"\n2. Click \"Add custom domain\"\n3. Follow DNS configuration steps\n\n### For Render Backend:\n1. Go to \"Settings\" â†’ \"Custom Domain\"\n2. Add your domain\n3. Configure DNS records\n\n---\n\n## âœ… Post-Deployment Checklist\n\n- [ ] Backend is running on Render\n- [ ] Frontend is deployed on Netlify\n- [ ] Environment variables are set correctly\n- [ ] CORS allows Netlify domain\n- [ ] Test user registration\n- [ ] Test login\n- [ ] Test post creation\n- [ ] Test real-time features (messages, notifications)\n- [ ] Test Socket.io connection (check browser console)\n\n---\n\n## ğŸ› Troubleshooting\n\n### Socket.io Not Connecting\n- Check backend URL in `VITE_SOCKET_URL`\n- Verify CORS settings include your Netlify domain\n- Check browser console for connection errors\n- Ensure Render service is running (free tier may sleep after inactivity)\n\n### Images Not Uploading\n- Verify Cloudinary credentials in Render environment variables\n- Check file size limits (max 10MB configured)\n\n### 404 Errors on Frontend Routes\n- Ensure `netlify.toml` redirects are configured\n- Redeploy if needed\n\n### Database Connection Issues\n- Whitelist Render's IP in MongoDB Atlas (or use 0.0.0.0/0)\n- Verify MONGO_URI is correct\n\n---\n\n## ğŸ’° Free Tier Limitations\n\n### Render Free Tier:\n- Services sleep after 15 minutes of inactivity\n- First request after sleep takes ~30 seconds\n- 750 hours/month (enough for one service)\n\n**Solution**: Use a free uptime monitoring service like [UptimeRobot](https://uptimerobot.com) to ping your backend every 10 minutes to keep it awake.\n\n### Netlify Free Tier:\n- 100GB bandwidth/month\n- 300 build minutes/month\n- Unlimited sites\n\n---\n\n## ğŸš€ Alternative: Deploy to Railway\n\nIf you prefer Railway over Render:\n\n1. Go to [railway.app](https://railway.app)\n2. \"New Project\" â†’ \"Deploy from GitHub repo\"\n3. Select your repo\n4. Set root directory to `backend`\n5. Add same environment variables\n6. Railway auto-detects Node.js and deploys\n\nRailway provides $5 free credit monthly.\n\n---\n\n## ğŸ“ Notes\n\n- **MongoDB Atlas**: Make sure to whitelist `0.0.0.0/0` (all IPs) in Network Access for cloud deployments\n- **Cloudinary**: Free tier: 25GB storage, 25GB bandwidth/month\n- **Auto-deploy**: Both Render and Netlify support auto-deploy on git push\n\n---\n\n## ğŸ¯ Quick Deploy Summary\n\n```bash\n# 1. Deploy Backend to Render\n# - Connect GitHub repo\n# - Set root directory: backend\n# - Add environment variables\n# - Deploy\n\n# 2. Deploy Frontend to Netlify\n# - Connect GitHub repo\n# - Set base directory: frontend\n# - Add VITE_API_URL and VITE_SOCKET_URL\n# - Deploy\n\n# 3. Update backend CORS with Netlify URL\n# 4. Test all features\n# 5. Done! ğŸ‰\n```\n\nYour friendflix app is now live with full Socket.io support!\n","size_bytes":5590},"ADMIN_SETUP.md":{"content":"# ğŸš€ Admin Panel Quick Setup Guide\n\n## Step 1: Create Admin User\n\n### Option A: Using Command Line Script (Recommended)\n\n```bash\ncd backend\nnode scripts/makeUserAdmin.js your-email@example.com\n```\n\nOr using username:\n```bash\nnode scripts/makeUserAdmin.js your_username\n```\n\n### Option B: Using MongoDB Compass\n\n1. Open MongoDB Compass\n2. Connect to your database\n3. Find the `users` collection\n4. Find your user document\n5. Edit the document and set `role: \"admin\"`\n6. Save changes\n\n### Option C: Using MongoDB Shell (mongosh)\n\n```javascript\n// Connect to your database\nmongosh \"your-connection-string\"\n\n// Switch to your database\nuse friendflix\n\n// Update user role to admin\ndb.users.updateOne(\n  { email: \"your-email@example.com\" },\n  { $set: { role: \"admin\" } }\n)\n```\n\n### Option D: Using Node.js Script\n\nCreate a file `makeAdmin.js`:\n\n```javascript\nimport mongoose from 'mongoose';\nimport User from './models/User.js';\n\nconst MONGO_URI = 'your-mongodb-uri';\nconst USER_EMAIL = 'your-email@example.com';\n\nmongoose.connect(MONGO_URI).then(async () => {\n  const user = await User.findOne({ email: USER_EMAIL });\n  if (user) {\n    user.role = 'admin';\n    await user.save();\n    console.log('âœ… User is now admin!');\n  }\n  process.exit(0);\n});\n```\n\nRun it:\n```bash\nnode makeAdmin.js\n```\n\n## Step 2: Verify Admin Access\n\n### List All Admins\n```bash\ncd backend\nnode scripts/listAdmins.js\n```\n\nThis will show all users with admin role.\n\n## Step 3: Access Admin Panel\n\n1. **Login** to your account with admin credentials\n2. **Navigate** to Settings page (`/settings`)\n3. **Click** on \"Admin Panel\" button (red/pink gradient button)\n4. Or directly go to: `http://localhost:5173/admin`\n\n## Step 4: Explore Admin Features\n\n### Dashboard\n- View overall statistics\n- See active users\n- Monitor new registrations\n- Track content creation\n\n### User Management\n- View all users\n- Search for specific users\n- Verify users (add blue checkmark)\n- Ban/Unban users\n- Change user roles\n- Delete users (careful!)\n\n### Post Management\n- View all posts\n- Search posts\n- View post details\n- Delete inappropriate content\n\n## Admin Routes\n\n```\n/admin              - Main dashboard\n/admin/users        - User management\n/admin/posts        - Post management  \n/admin/reports      - Reports (coming soon)\n```\n\n## Testing Admin Functions\n\n### Test User Verification\n1. Go to `/admin/users`\n2. Find a test user\n3. Click the verify button (blue checkmark icon)\n4. User should now have verified badge\n\n### Test User Ban\n1. Go to `/admin/users`\n2. Find a test user\n3. Click the ban button (yellow X icon)\n4. User status should change to \"Banned\"\n\n### Test Post Deletion\n1. Go to `/admin/posts`\n2. Click on any post to view details\n3. Click \"Delete Post\" button\n4. Confirm deletion\n5. Post should be removed\n\n## Common Issues\n\n### Issue: \"Access Denied\" Error\n**Solution:** \n- Verify user role is set to \"admin\" in database\n- Logout and login again\n- Clear browser cache\n\n### Issue: Admin Panel Button Not Showing\n**Solution:**\n- Check if user role is \"admin\"\n- Refresh the page\n- Check browser console for errors\n\n### Issue: API Errors (403/401)\n**Solution:**\n- Verify backend server is running\n- Check if adminMiddleware is working\n- Verify JWT token is valid\n- Check backend logs\n\n## Security Checklist\n\n- [ ] Use strong password for admin accounts\n- [ ] Don't share admin credentials\n- [ ] Limit number of admin users\n- [ ] Regularly review admin actions\n- [ ] Keep admin privileges confidential\n- [ ] Monitor suspicious activities\n- [ ] Document all admin actions\n\n## Quick Commands\n\n```bash\n# Make user admin\nnode scripts/makeUserAdmin.js user@example.com\n\n# List all admins\nnode scripts/listAdmins.js\n\n# Start backend server\ncd backend\nnpm run dev\n\n# Start frontend server\ncd frontend\nnpm run dev\n```\n\n## Admin Roles Hierarchy\n\n```\nadmin     - Full access to everything\ncreator   - Extra features for content creation\nbusiness  - Business account features\nuser      - Regular user (default)\n```\n\n## Next Steps\n\n1. âœ… Create admin user\n2. âœ… Login with admin account\n3. âœ… Access admin panel\n4. âœ… Explore dashboard\n5. âœ… Test user management\n6. âœ… Test post moderation\n7. âœ… Review documentation\n\n## Need Help?\n\n- Read full documentation: [ADMIN_PANEL_GUIDE.md](ADMIN_PANEL_GUIDE.md)\n- Check backend logs for errors\n- Review browser console for frontend errors\n- Verify MongoDB connection\n\n---\n\n**Setup Time:** ~5 minutes  \n**Difficulty:** Easy  \n**Prerequisites:** Running friendflix app with MongoDB\n\nGood luck with your admin panel! ğŸ‰\n","size_bytes":4524},"frontend/src/components/ProtectedRoute.jsx":{"content":"import { Navigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport Loader from './Loader';\n\nconst ProtectedRoute = ({ children }) => {\n  const { user, loading } = useAuth();\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  if (!user) {\n    return <Navigate to=\"/login\" replace />;\n  }\n\n  return children;\n};\n\nexport default ProtectedRoute;\n","size_bytes":374},"frontend/src/components/CaptionWithLinks.jsx":{"content":"import { Link } from 'react-router-dom';\n\nconst CaptionWithLinks = ({ caption, author }) => {\n  if (!caption) return null;\n\n  const parts = caption.split(/(\\s+)/);\n\n  return (\n    <p className=\"mb-2 dark:text-white\">\n      <Link\n        to={`/profile/${author.username}`}\n        className=\"font-semibold mr-2 hover:underline\"\n      >\n        {author.username}\n      </Link>\n      {parts.map((part, index) => {\n        // Hashtag\n        if (part.startsWith('#')) {\n          return (\n            <Link\n              key={index}\n              to={`/explore/tags/${part.substring(1)}`}\n              className=\"text-primary hover:underline\"\n            >\n              {part}\n            </Link>\n          );\n        }\n        // Mention\n        else if (part.startsWith('@')) {\n          return (\n            <Link\n              key={index}\n              to={`/profile/${part.substring(1)}`}\n              className=\"text-primary hover:underline\"\n            >\n              {part}\n            </Link>\n          );\n        }\n        // Regular text\n        else {\n          return <span key={index}>{part}</span>;\n        }\n      })}\n    </p>\n  );\n};\n\nexport default CaptionWithLinks;\n","size_bytes":1185},"backend/routes/notificationRoutes.js":{"content":"import express from 'express';\nimport {\n  getNotifications,\n  markAsRead,\n  markAllAsRead,\n  deleteNotification,\n} from '../controllers/notificationController.js';\nimport { protect } from '../middleware/authMiddleware.js';\n\nconst router = express.Router();\n\nrouter.get('/', protect, getNotifications);\nrouter.put('/:id/read', protect, markAsRead);\nrouter.put('/read-all', protect, markAllAsRead);\nrouter.delete('/:id', protect, deleteNotification);\n\nexport default router;\n","size_bytes":473},"backend/routes/storyRoutes.js":{"content":"import express from 'express';\nimport {\n  createStory,\n  getsubscribedStories,\n  getUserStories,\n  viewStory,\n  replyToStory,\n  deleteStory,\n} from '../controllers/storyController.js';\nimport { protect } from '../middleware/authMiddleware.js';\nimport { upload } from '../config/minio.js';\n\nconst router = express.Router();\n\nrouter.post('/', protect, upload.single('media'), createStory);\nrouter.get('/subscribed', protect, getsubscribedStories);\nrouter.get('/user/:userId', protect, getUserStories);\nrouter.post('/:id/view', protect, viewStory);\nrouter.post('/:id/reply', protect, replyToStory);\nrouter.delete('/:id', protect, deleteStory);\n\nexport default router;\n","size_bytes":662},"backend/middleware/errorMiddleware.js":{"content":"// Global error handler\nexport const errorHandler = (err, req, res, next) => {\n  const statusCode = res.statusCode === 200 ? 500 : res.statusCode;\n\n  res.status(statusCode).json({\n    success: false,\n    message: err.message,\n    stack: process.env.NODE_ENV === 'production' ? null : err.stack,\n  });\n};\n\n// Not Found handler\nexport const notFound = (req, res, next) => {\n  const error = new Error(`Not Found - ${req.originalUrl}`);\n  res.status(404);\n  next(error);\n};\n","size_bytes":470},"SAVED_POSTS_ACCESS.md":{"content":"# ğŸ’¾ Saved Posts Access Karne Ke 3 Tarike\n\n## 1ï¸âƒ£ Navbar Profile Menu Se (Easiest)\n1. Top-right corner mein apni profile pic pe click karo\n2. Dropdown menu mein **\"ğŸ”– Saved\"** option dikhega\n3. Click karo â†’ Saved posts page khul jayega\n\n## 2ï¸âƒ£ Direct URL Se\nBrowser mein type karo: `http://localhost:5173/saved`\n\n## 3ï¸âƒ£ Profile Page Se (Add Karenge)\nProfile page pe \"Saved\" tab add kar sakte hain\n\n---\n\n## Current Location:\n**Navbar â†’ Profile Picture â†’ Saved** âœ…\n\nAlready working! Test karo:\n1. Koi post pe bookmark icon (ğŸ”–) click karo\n2. Navbar pe profile pic click karo\n3. \"Saved\" option pe click karo\n4. Saved posts dikhengi!\n\n\n\n\napi key deepa seek -- sk-c9bdd0c0914f4cc0b4b325de34c407fd","size_bytes":717},"CLOUDINARY_SETUP.md":{"content":"# â˜ï¸ Cloudinary Setup Guide\n\n## Why Do You Need Cloudinary?\n\nCloudinary is a cloud-based service for storing and serving images/videos. friendflix uses it to:\n- Store user profile pictures\n- Store post images and videos\n- Store story media\n- Optimize images automatically\n- Serve media via CDN (fast loading)\n\n---\n\n## ğŸ†“ Getting Free Cloudinary Account\n\n### Step 1: Sign Up\n1. Go to: **https://cloudinary.com/users/register_free**\n2. Fill in your details:\n   - Email\n   - Password\n   - Choose \"Developer\" as your role\n3. Verify your email\n\n### Step 2: Get Your Credentials\nAfter signing up, you'll be taken to the **Dashboard**:\n\n1. You'll see a section called **\"Account Details\"** or **\"Product Environment Credentials\"**\n2. Copy these three values:\n   - **Cloud Name** (e.g., `dxxxxxx`)\n   - **API Key** (e.g., `123456789012345`)\n   - **API Secret** (e.g., `abcdefghijklmnopqrstuvwxyz`)\n\n**Screenshot locations:**\n```\nDashboard â†’ Account Details\nâ”œâ”€â”€ Cloud Name: dxxxxxx\nâ”œâ”€â”€ API Key: 123456789012345\nâ””â”€â”€ API Secret: [Show/Hide] abcdefghijklmnopqrstuvwxyz\n```\n\n### Step 3: Add to Your .env File\n\nOpen `backend/.env` and add:\n\n```env\nCLOUDINARY_CLOUD_NAME=your_cloud_name_here\nCLOUDINARY_API_KEY=your_api_key_here\nCLOUDINARY_API_SECRET=your_api_secret_here\n```\n\n**Example:**\n```env\nCLOUDINARY_CLOUD_NAME=dgl9hs1lj\nCLOUDINARY_API_KEY=959923823129428\nCLOUDINARY_API_SECRET=TzGdBpCzrAbzG0KfppOLEBVtNaQ\n```\n\n### Step 4: Restart Your Server\n\n```bash\ncd backend\nnpm start\n```\n\nYou should see:\n```\nâœ… Cloudinary configured successfully!\n```\n\n---\n\n## ğŸš€ Alternative: Run Without Cloudinary (Testing Only)\n\nIf you want to test the app without file uploads:\n\n1. Make sure you have at least these in `.env`:\n   ```env\n   MONGO_URI=your_mongodb_connection_string\n   JWT_SECRET=your_secret_key_here\n   ```\n\n2. The server will now start with a warning:\n   ```\n   âš ï¸  Cloudinary not configured - file uploads will be disabled\n   ```\n\n3. You can still:\n   - âœ… Sign up / Login\n   - âœ… Follow users\n   - âœ… Like posts\n   - âœ… Comment\n   - âœ… Send messages\n   - âŒ Upload images/videos (will show error)\n\n---\n\n## ğŸ”’ Security Best Practices\n\n### âœ… DO:\n- Keep your API Secret private\n- Add `.env` to `.gitignore` (already done)\n- Use different credentials for development/production\n- Regenerate secrets if exposed\n\n### âŒ DON'T:\n- Commit `.env` to Git\n- Share credentials publicly\n- Use production credentials in development\n- Hardcode credentials in your code\n\n---\n\n## ğŸ“Š Cloudinary Free Tier Limits\n\nThe free plan includes:\n- âœ… **25 GB** storage\n- âœ… **25 GB** bandwidth/month\n- âœ… **25,000** transformations/month\n- âœ… Unlimited image/video uploads\n\nThis is **more than enough** for development and small projects!\n\n---\n\n## ğŸ› ï¸ Troubleshooting\n\n### Error: \"Cloudinary API Key is not set\"\n**Solution:** Make sure you've added all three credentials to `.env`\n\n### Error: \"Invalid credentials\"\n**Solution:** \n1. Double-check you copied the credentials correctly\n2. No extra spaces or quotes\n3. Make sure you're using the right account\n\n### Error: \"Upload failed\"\n**Solutions:**\n1. Check your internet connection\n2. Verify file size is under 5MB\n3. Ensure file is an image or video\n4. Check Cloudinary dashboard for quota limits\n\n### Server won't start\n**Solution:** \n1. Make sure you have `MONGO_URI` and `JWT_SECRET` in `.env`\n2. These are now required, Cloudinary is optional\n\n---\n\n## ğŸ”„ Alternative: Use Local Storage (Advanced)\n\nIf you don't want to use Cloudinary, you can modify the code to store files locally:\n\n1. **Install packages:**\n   ```bash\n   npm install multer\n   ```\n\n2. **Update `backend/config/cloudinary.js`** to use local storage:\n   ```javascript\n   const storage = multer.diskStorage({\n     destination: (req, file, cb) => {\n       cb(null, 'uploads/');\n     },\n     filename: (req, file, cb) => {\n       cb(null, Date.now() + '-' + file.originalname);\n     },\n   });\n   ```\n\n3. **Create uploads folder:**\n   ```bash\n   mkdir backend/uploads\n   ```\n\n4. **Serve static files in server.js:**\n   ```javascript\n   app.use('/uploads', express.static('uploads'));\n   ```\n\nâš ï¸ **Note:** Local storage is not recommended for production. Use cloud storage instead.\n\n---\n\n## ğŸ“š Additional Resources\n\n- [Cloudinary Documentation](https://cloudinary.com/documentation)\n- [Cloudinary Node.js SDK](https://cloudinary.com/documentation/node_integration)\n- [Image Transformation Guide](https://cloudinary.com/documentation/image_transformations)\n\n---\n\n## âœ… Verification Checklist\n\nAfter setup, verify everything works:\n\n- [ ] Server starts without errors\n- [ ] Can upload profile picture\n- [ ] Can create a post with image\n- [ ] Can create a story\n- [ ] Images load in the app\n- [ ] Check Cloudinary dashboard for uploads\n\n---\n\n## ğŸ†˜ Still Having Issues?\n\n1. **Check environment variables:**\n   ```bash\n   cd backend\n   node -e \"require('dotenv').config(); console.log(process.env.CLOUDINARY_CLOUD_NAME)\"\n   ```\n\n2. **Test Cloudinary connection:**\n   ```bash\n   node test-cloudinary.js\n   ```\n\n3. **Review server logs** for specific error messages\n\n4. **Contact support** if credentials aren't working\n\n---\n\n**Happy coding! ğŸ‰**\n","size_bytes":5184},"frontend/src/App.jsx":{"content":"import { BrowserRouter as Router, Routes, Route, Navigate, Link } from 'react-router-dom';\nimport { Toaster } from 'react-hot-toast';\nimport { AuthProvider } from './context/AuthContext';\nimport { ThemeProvider } from './context/ThemeContext';\nimport ProtectedRoute from './components/ProtectedRoute';\nimport Navbar from './components/Navbar';\nimport BottomNav from './components/BottomNav';\nimport ErrorBoundary from './components/ErrorBoundary';\nimport socketService from './services/socket';\nimport { Suspense, lazy, useState, useEffect, useRef } from 'react';\n\n// Pages (lazy-loaded)\nconst Login = lazy(() => import('./pages/Login'));\nconst Signup = lazy(() => import('./pages/Signup'));\nconst Feed = lazy(() => import('./pages/Feed'));\nconst Upload = lazy(() => import('./pages/Upload'));\nconst Profile = lazy(() => import('./pages/Profile'));\nconst Search = lazy(() => import('./pages/Search'));\nconst Notifications = lazy(() => import('./pages/Notifications'));\nconst Settings = lazy(() => import('./pages/Settings'));\nconst Messages = lazy(() => import('./pages/Messages'));\nconst Chat = lazy(() => import('./pages/Chat'));\nconst Groups = lazy(() => import('./pages/Groups'));\nconst CreateStory = lazy(() => import('./pages/CreateStory'));\nconst StoryViewer = lazy(() => import('./pages/StoryViewer'));\nconst Saved = lazy(() => import('./pages/Saved'));\nconst Archive = lazy(() => import('./pages/Archive'));\nconst Explore = lazy(() => import('./pages/Explore'));\nconst Reels = lazy(() => import('./pages/Reels'));\nconst Videos = lazy(() => import('./pages/Videos'));\nconst Premium = lazy(() => import('./pages/Premium'));\nconst CreatorDashboard = lazy(() => import('./pages/CreatorDashboard'));\nconst VideoCall = lazy(() => import('./pages/VideoCall'));\nconst AudioCall = lazy(() => import('./pages/AudioCall'));\nconst Analytics = lazy(() => import('./pages/Analytics'));\nconst GroupChat = lazy(() => import('./pages/GroupChat'));\nconst LiveStream = lazy(() => import('./pages/LiveStream'));\nconst CloseFriends = lazy(() => import('./pages/CloseFriends'));\nconst SchedulePost = lazy(() => import('./pages/SchedulePost'));\nconst AdminDashboard = lazy(() => import('./pages/AdminDashboard'));\nconst AdminUsers = lazy(() => import('./pages/AdminUsers'));\nconst AdminPosts = lazy(() => import('./pages/AdminPosts'));\nconst AdminReports = lazy(() => import('./pages/AdminReports'));\nconst Playlists = lazy(() => import('./pages/Playlists'));\nconst WatchLater = lazy(() => import('./pages/WatchLater'));\nconst Community = lazy(() => import('./pages/Community'));\nconst Trending = lazy(() => import('./pages/Trending'));\n\nfunction App() {\n  const [incomingCall, setIncomingCall] = useState(null);\n  const audioCtxRef = useRef(null);\n  const gainRef = useRef(null);\n  const oscRef = useRef(null);\n  const ringIntervalRef = useRef(null);\n  const vibrateIntervalRef = useRef(null);\n  const [ringMuted, setRingMuted] = useState(() => {\n    try { return JSON.parse(localStorage.getItem('ringMuted') || 'false'); } catch { return false; }\n  });\n  const [ringVolume, setRingVolume] = useState(() => {\n    try { const v = parseFloat(localStorage.getItem('ringVolume') || '0.2'); return isNaN(v) ? 0.2 : Math.min(Math.max(v, 0), 1); } catch { return 0.2; }\n  });\n\n  const startRingtone = () => {\n    try {\n      if (audioCtxRef.current) return; // already ringing\n      const AudioContextClass = window.AudioContext || window.webkitAudioContext;\n      if (!AudioContextClass || ringMuted) return;\n      const ctx = new AudioContextClass();\n      const gain = ctx.createGain();\n      gain.gain.value = 0;\n      const osc = ctx.createOscillator();\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(440, ctx.currentTime);\n      osc.connect(gain);\n      gain.connect(ctx.destination);\n      osc.start();\n      audioCtxRef.current = ctx;\n      gainRef.current = gain;\n      oscRef.current = osc;\n      ringIntervalRef.current = setInterval(() => {\n        if (!gainRef.current) return;\n        const v = gainRef.current.gain.value;\n        gainRef.current.gain.value = v > 0 ? 0 : ringVolume;\n      }, 500);\n    } catch (e) {\n      // ignore ringtone errors\n    }\n  };\n\n  const stopRingtone = () => {\n    try {\n      if (ringIntervalRef.current) {\n        clearInterval(ringIntervalRef.current);\n        ringIntervalRef.current = null;\n      }\n      if (gainRef.current) {\n        gainRef.current.gain.value = 0;\n      }\n      if (oscRef.current) {\n        try { oscRef.current.stop(); } catch {}\n        oscRef.current = null;\n      }\n      if (audioCtxRef.current) {\n        try { audioCtxRef.current.close(); } catch {}\n        audioCtxRef.current = null;\n      }\n    } catch (e) {\n      // ignore\n    }\n  };\n  const startVibrate = () => {\n    try {\n      if (ringMuted) return;\n      if ('vibrate' in navigator) {\n        navigator.vibrate([300, 200, 300]);\n        vibrateIntervalRef.current = setInterval(() => navigator.vibrate([300, 200, 300]), 1500);\n      }\n    } catch {}\n  };\n\n  const stopVibrate = () => {\n    try {\n      if (vibrateIntervalRef.current) {\n        clearInterval(vibrateIntervalRef.current);\n        vibrateIntervalRef.current = null;\n      }\n      if ('vibrate' in navigator) {\n        navigator.vibrate(0);\n      }\n    } catch {}\n  };\n  useEffect(() => {\n    const handleCallInvite = (payload) => {\n      setIncomingCall(payload);\n      startRingtone();\n      startVibrate();\n    };\n    const handleCallDecline = () => {\n      setIncomingCall(null);\n      stopRingtone();\n      stopVibrate();\n    };\n    socketService.on('call:invite', handleCallInvite);\n    socketService.on('call:decline', handleCallDecline);\n    return () => {\n      socketService.off('call:invite', handleCallInvite);\n      socketService.off('call:decline', handleCallDecline);\n      stopRingtone();\n      stopVibrate();\n    };\n  }, []);\n  return (\n    <ThemeProvider>\n      <AuthProvider>\n        <Router future={{ v7_relativeSplatPath: true, v7_startTransition: true }}>\n        <Toaster\n          position=\"top-center\"\n          toastOptions={{\n            duration: 3000,\n            style: {\n              background: '#333',\n              color: '#fff',\n            },\n            success: {\n              iconTheme: {\n                primary: '#10b981',\n                secondary: '#fff',\n              },\n            },\n            error: {\n              iconTheme: {\n                primary: '#ef4444',\n                secondary: '#fff',\n              },\n            },\n          }}\n        />\n\n          <ErrorBoundary>\n            <Suspense fallback={<div className=\"p-6 text-center text-gray-600 dark:text-gray-300\">Loading...</div>}>\n              <Routes>\n          {/* Public Routes */}\n          <Route path=\"/login\" element={<Login />} />\n          <Route path=\"/register\" element={<Signup />} />\n\n          {/* Protected Routes */}\n          <Route\n            path=\"/\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Feed />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/upload\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Upload />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/profile/:username\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Profile />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/search\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Search />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/notifications\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Notifications />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/settings\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Settings />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/saved\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Saved />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/archive\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Archive />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/explore\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Explore />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/explore/tags/:tag\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                {(() => { const Hashtag = lazy(() => import('./pages/Hashtag')); return <Hashtag />; })()}\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/reels\"\n            element={\n              <ProtectedRoute>\n                <Reels />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/videos\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Videos />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/premium\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Premium />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/creator\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <CreatorDashboard />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/video-call/:roomId\"\n            element={\n              <ProtectedRoute>\n                <VideoCall />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/audio-call/:roomId\"\n            element={\n              <ProtectedRoute>\n                <AudioCall />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/analytics\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Analytics />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/group/:groupId\"\n            element={\n              <ProtectedRoute>\n                <GroupChat />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/live/:streamId\"\n            element={\n              <ProtectedRoute>\n                <LiveStream />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/close-friends\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <CloseFriends />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/schedule\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <SchedulePost />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/messages\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Messages />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/groups\"\n            element={\n              <ProtectedRoute>\n                <Navbar />\n                <Groups />\n                <BottomNav />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/messages/:username\"\n            element={\n              <ProtectedRoute>\n                <Chat />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/stories/create\"\n            element={\n              <ProtectedRoute>\n                <CreateStory />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/stories/:userId\"\n            element={\n              <ProtectedRoute>\n                <StoryViewer />\n              </ProtectedRoute>\n            }\n          />\n\n          {/* Admin Routes */}\n          <Route\n            path=\"/admin\"\n            element={\n              <ProtectedRoute>\n                <AdminDashboard />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/admin/users\"\n            element={\n              <ProtectedRoute>\n                <AdminUsers />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/admin/posts\"\n            element={\n              <ProtectedRoute>\n                <AdminPosts />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/admin/reports\"\n            element={\n              <ProtectedRoute>\n                <AdminReports />\n              </ProtectedRoute>\n            }\n          />\n\n          {/* New Features Routes */}\n          <Route\n            path=\"/playlists\"\n            element={\n              <ProtectedRoute>\n                <Playlists />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/playlists/:userId\"\n            element={\n              <ProtectedRoute>\n                <Playlists />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/watch-later\"\n            element={\n              <ProtectedRoute>\n                <WatchLater />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/community\"\n            element={\n              <ProtectedRoute>\n                <Community />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/community/:userId\"\n            element={\n              <ProtectedRoute>\n                <Community />\n              </ProtectedRoute>\n            }\n          />\n\n          <Route\n            path=\"/trending\"\n            element={\n              <ProtectedRoute>\n                <Trending />\n              </ProtectedRoute>\n            }\n          />\n\n          {/* Catch all - redirect to feed */}\n          <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\n              </Routes>\n              {incomingCall && (\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n                  <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-6 w-80 border dark:border-gray-700\">\n                    <h3 className=\"text-lg font-semibold dark:text-white mb-2\">Incoming {incomingCall.type || 'call'}</h3>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-300 mb-4\">From: {incomingCall.from}</p>\n                    <div className=\"mb-4 flex items-center gap-3\">\n                      <label className=\"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300\">\n                        <input type=\"checkbox\" checked={ringMuted} onChange={(e) => { const val = e.target.checked; setRingMuted(val); try { localStorage.setItem('ringMuted', JSON.stringify(val)); } catch {} }} />\n                        Mute ringtone\n                      </label>\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-sm text-gray-700 dark:text-gray-300\">Vol</span>\n                        <input type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" value={ringVolume} onChange={(e) => { const v = parseFloat(e.target.value); setRingVolume(v); try { localStorage.setItem('ringVolume', String(v)); } catch {} if (gainRef.current) gainRef.current.gain.value = v; }} />\n                      </div>\n                    </div>\n                    <div className=\"flex justify-end gap-2\">\n                      <button\n                        className=\"px-4 py-2 border rounded dark:border-gray-600 dark:text-white\"\n                        onClick={() => {\n                          socketService.emit('call:decline', { to: incomingCall.from, roomId: incomingCall.roomId });\n                          stopRingtone();\n                          stopVibrate();\n                          setIncomingCall(null);\n                        }}\n                      >\n                        Decline\n                      </button>\n                      <button\n                        className=\"px-4 py-2 bg-primary text-white rounded\"\n                        onClick={(e) => {\n                          e.preventDefault();\n                          const path = `/${(incomingCall.type === 'video' ? 'video-call' : 'audio-call')}/${incomingCall.roomId}`;\n                          stopRingtone();\n                          stopVibrate();\n                          setIncomingCall(null);\n                          try {\n                            // Ensure navigation even if Link fails\n                            window.location.href = path;\n                          } catch {\n                            // Fallback no-op\n                          }\n                        }}\n                      >\n                        Accept\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </Suspense>\n          </ErrorBoundary>\n      </Router>\n    </AuthProvider>\n  </ThemeProvider>\n  );\n}\n\nexport default App;\n","size_bytes":18169},"frontend/src/pages/Profile.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { userAPI, postAPI } from '../services/api';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\nimport Loader from '../components/Loader';\nimport { AiOutlineSetting, AiOutlineMessage } from 'react-icons/ai';\nimport { BsGrid3X3, BsBookmark, BsGear, BsArchive, BsGraphUp, BsCameraVideo } from 'react-icons/bs';\nimport Highlights from '../components/Highlights';\nimport VerifiedBadge from '../components/VerifiedBadge';\nimport { BiLogOut } from 'react-icons/bi';\n\nconst Profile = () => {\n  const { username } = useParams();\n  const navigate = useNavigate();\n  const { user: currentUser, logout } = useAuth();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [issubscribed, setIssubscribed] = useState(false);\n  const [followLoading, setFollowLoading] = useState(false);\n  const [showSettingsMenu, setShowSettingsMenu] = useState(false);\n  const [isOnline, setIsOnline] = useState(false);\n  const [selectedCategory, setSelectedCategory] = useState('all');\n\n  useEffect(() => {\n    fetchUserProfile();\n\n    // Listen for online status\n    socketService.on('userOnline', (userId) => {\n      if (userId === user?._id) {\n        setIsOnline(true);\n      }\n    });\n\n    socketService.on('userOffline', (userId) => {\n      if (userId === user?._id) {\n        setIsOnline(false);\n      }\n    });\n\n    return () => {\n      socketService.off('userOnline');\n      socketService.off('userOffline');\n    };\n  }, [username, user]);\n\n  const fetchUserProfile = async () => {\n    try {\n      const response = await userAPI.getProfile(username);\n      setUser(response.data.data);\n      setIssubscribed(response.data.data.subscriber.some(\n        (follower) => follower._id === currentUser?._id\n      ));\n    } catch (error) {\n      toast.error('Failed to load profile');\n      navigate('/');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleFollow = async () => {\n    setFollowLoading(true);\n    try {\n      const response = await userAPI.followUser(user._id);\n      setIssubscribed(response.data.issubscribed);\n      \n      // Update follower count\n      setUser((prev) => ({\n        ...prev,\n        subscriber: response.data.issubscribed\n          ? [...prev.subscriber, currentUser]\n          : prev.subscriber.filter((f) => f._id !== currentUser._id),\n      }));\n      \n      toast.success(response.data.message);\n    } catch (error) {\n      toast.error('Failed to follow/unfollow');\n    } finally {\n      setFollowLoading(false);\n    }\n  };\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  const isOwnProfile = currentUser?._id === user._id;\n\n  const handleLogout = () => {\n    logout();\n    navigate('/login');\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto\">\n      {/* Cover Image */}\n      <div className=\"relative h-48 md:h-64 bg-gradient-to-br from-purple-400 via-pink-400 to-amber-400 overflow-hidden\">\n        <img\n          src={user.coverImage || '/default-bg.jpg'}\n          alt=\"Cover\"\n          className=\"w-full h-full object-cover\"\n          onError={(e) => {\n            e.target.src = 'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=1200&h=400&fit=crop';\n          }}\n        />\n      </div>\n      \n      <div className=\"px-4 pb-8\">\n      {/* Profile Header */}\n      <div className=\"flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-12 mb-12 -mt-16 md:-mt-20\">\n        {/* Avatar */}\n        <div className=\"relative\">\n          <img\n            src={user.avatar || '/default-avatar.png'}\n            alt={user.username}\n            className=\"h-32 w-32 md:h-40 md:w-40 rounded-full object-cover border-4 border-white dark:border-gray-900 shadow-xl\"\n            onError={(e) => {\n              e.target.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.username) + '&background=random&size=200';\n            }}\n          />\n          {/* Online Status - Only for other users */}\n          {!isOwnProfile && isOnline && (\n            <span className=\"absolute bottom-2 right-2 w-6 h-6 md:w-8 md:h-8 bg-green-500 border-4 border-white dark:border-gray-900 rounded-full\"></span>\n          )}\n        </div>\n\n        {/* Profile Info */}\n        <div className=\"flex-1 text-center md:text-left\">\n          <div className=\"flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4 mb-4\">\n            <h1 className=\"text-2xl font-light dark:text-white\">{user.username}</h1>\n            \n            {isOwnProfile ? (\n              <div className=\"relative\">\n                <button\n                  onClick={() => setShowSettingsMenu(!showSettingsMenu)}\n                  className=\"btn-outline flex items-center space-x-2\"\n                >\n                  <AiOutlineSetting />\n                  <span>Settings</span>\n                </button>\n\n                {/* Settings Dropdown Menu */}\n                {showSettingsMenu && (\n                  <div className=\"absolute top-12 left-0 md:left-auto md:right-0 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-xl py-2 border border-gray-200 dark:border-gray-700 z-50 animate-fadeIn\">\n                    <Link\n                      to=\"/settings\"\n                      className=\"flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition\"\n                      onClick={() => setShowSettingsMenu(false)}\n                    >\n                      <BsGear size={20} />\n                      <div>\n                        <p className=\"font-semibold\">Edit Profile</p>\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">Change your info</p>\n                      </div>\n                    </Link>\n\n                    <Link\n                      to=\"/analytics\"\n                      className=\"flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition\"\n                      onClick={() => setShowSettingsMenu(false)}\n                    >\n                      <BsGraphUp size={20} />\n                      <div>\n                        <p className=\"font-semibold\">Analytics</p>\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">View insights</p>\n                      </div>\n                    </Link>\n\n                    <Link\n                      to=\"/saved\"\n                      className=\"flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition\"\n                      onClick={() => setShowSettingsMenu(false)}\n                    >\n                      <BsBookmark size={20} />\n                      <div>\n                        <p className=\"font-semibold\">Saved Posts</p>\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">View saved items</p>\n                      </div>\n                    </Link>\n\n                    <Link\n                      to=\"/archive\"\n                      className=\"flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition\"\n                      onClick={() => setShowSettingsMenu(false)}\n                    >\n                      <BsArchive size={20} />\n                      <div>\n                        <p className=\"font-semibold\">Archive</p>\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">Hidden posts</p>\n                      </div>\n                    </Link>\n\n                    <hr className=\"my-2 border-gray-200 dark:border-gray-700\" />\n\n                    <button\n                      onClick={handleLogout}\n                      className=\"flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 text-red-500 w-full transition\"\n                    >\n                      <BiLogOut size={20} />\n                      <div className=\"text-left\">\n                        <p className=\"font-semibold\">Logout</p>\n                        <p className=\"text-xs\">Sign out of friendflix</p>\n                      </div>\n                    </button>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"flex items-center space-x-2\">\n                <button\n                  onClick={handleFollow}\n                  disabled={followLoading}\n                  className={`px-8 py-1.5 rounded-lg font-semibold ${\n                    issubscribed\n                      ? 'btn-secondary'\n                      : 'btn-primary'\n                  }`}\n                >\n                  {followLoading ? '...' : issubscribed ? 'subscribed' : 'Follow'}\n                </button>\n                <button\n                  onClick={() => navigate(`/messages/${user.username}`)}\n                  className=\"px-6 py-1.5 bg-gray-200 dark:bg-dark-border rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition flex items-center space-x-2\"\n                >\n                  <AiOutlineMessage size={18} />\n                  <span>Message</span>\n                </button>\n              </div>\n            )}\n          </div>\n\n          {/* Stats */}\n          <div className=\"flex justify-center md:justify-start space-x-8 mb-4 dark:text-white\">\n            <div>\n              <span className=\"font-semibold bg-gradient-primary bg-clip-text text-transparent dark:bg-none dark:text-white\">\n                {user.posts.length}\n              </span>{' '}\n              posts\n            </div>\n            <div>\n              <span className=\"font-semibold bg-gradient-primary bg-clip-text text-transparent dark:bg-none dark:text-white\">\n                {user.subscriber.length}\n              </span>{' '}\n              subscriber\n            </div>\n            <div>\n              <span className=\"font-semibold bg-gradient-primary bg-clip-text text-transparent dark:bg-none dark:text-white\">\n                {user.subscribed.length}\n              </span>{' '}\n              subscribed\n            </div>\n          </div>\n\n          {/* Bio */}\n          <div>\n            <p className=\"font-semibold flex items-center dark:text-white\">\n              {user.fullName}\n              {user.isVerified && <VerifiedBadge className=\"ml-2\" />}\n            </p>\n            {user.bio && <p className=\"text-gray-700 dark:text-gray-300 mt-1\">{user.bio}</p>}\n            {user.gender && user.gender !== 'prefer_not_to_say' && (\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Gender: {user.gender}</p>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Story Highlights */}\n      {isOwnProfile && (\n        <div className=\"border-t border-gray-300 dark:border-dark-border pt-6\">\n          <Highlights\n            highlights={[]}\n            onCreateHighlight={() => console.log('Create highlight')}\n            onViewHighlight={(h) => console.log('View highlight', h)}\n          />\n        </div>\n      )}\n\n      {/* Posts Grid */}\n      <div className=\"border-t border-gray-300 dark:border-dark-border pt-8\">\n        <div className=\"flex items-center justify-center space-x-2 mb-8 text-sm font-semibold text-gray-600\">\n          <BsGrid3X3 />\n          <span>POSTS</span>\n        </div>\n\n        {/* Category Tabs */}\n        <div className=\"flex justify-center gap-2 mb-6\">\n          <button type=\"button\" className={`btn-outline ${selectedCategory==='all'?'ring-2 ring-primary':''}`} onClick={()=>setSelectedCategory('all')}>All</button>\n          <button type=\"button\" className={`btn-outline ${selectedCategory==='image'?'ring-2 ring-primary':''}`} onClick={()=>setSelectedCategory('image')}>Images</button>\n          <button type=\"button\" className={`btn-outline ${selectedCategory==='short'?'ring-2 ring-primary':''}`} onClick={()=>setSelectedCategory('short')}>Shorts</button>\n          <button type=\"button\" className={`btn-outline ${selectedCategory==='long'?'ring-2 ring-primary':''}`} onClick={()=>setSelectedCategory('long')}>Long</button>\n        </div>\n\n        {user.posts.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-gray-500 text-xl mb-2\">No Posts Yet</p>\n            {isOwnProfile && (\n              <button\n                onClick={() => navigate('/upload')}\n                className=\"btn-primary mt-4\"\n              >\n                Create Your First Post\n              </button>\n            )}\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-3 gap-1 md:gap-4\">\n            {(user.posts || [])\n              .filter((p)=> selectedCategory==='all' ? true : (p.category||p.mediaType)===selectedCategory)\n              .map((post) => {\n                const isVideo = (post.media && post.media[0]?.type === 'video') || post.mediaType === 'video' || post.category === 'short' || post.category === 'long';\n                const durationSec = post.durationSec || 0;\n                return (\n                  <div\n                    key={post._id}\n                    onClick={() => navigate(`/post/${post._id}`)}\n                    className=\"aspect-square cursor-pointer group relative overflow-hidden rounded-md\"\n                  >\n                    {isVideo ? (\n                      <div className=\"w-full h-full bg-black flex items-center justify-center\">\n                        <BsCameraVideo className=\"text-white opacity-80\" size={32} />\n                        {durationSec > 0 && (\n                          <div className=\"absolute bottom-2 right-2 bg-black/70 text-white px-2 py-1 rounded text-xs\">\n                            {Math.floor(durationSec/60)}:{String(durationSec%60).padStart(2,'0')}\n                          </div>\n                        )}\n                      </div>\n                    ) : (\n                      <img\n                        src={post.media?.[0]?.url || post.mediaUrl}\n                        alt=\"Post\"\n                        className=\"w-full h-full object-cover\"\n                      />\n                    )}\n                    {/* Category Badge */}\n                    <div className=\"absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded\">\n                      {(post.category || (isVideo ? (durationSec>60? 'long':'short') : 'image'))}\n                    </div>\n                  </div>\n                );\n              })}\n          </div>\n        )}\n      </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Profile;\n","size_bytes":14600},"backend/controllers/messageController.js":{"content":"import Message from '../models/Message.js';\nimport User from '../models/User.js';\nimport Conversation from '../models/Conversation.js';\nimport { uploadToStorage } from '../config/minio.js';\n\n// @desc    Send voice message\n// @route   POST /api/messages/:receiverId/voice\n// @access  Private\nexport const sendVoiceMessage = async (req, res) => {\n  try {\n    const receiverId = req.params.receiverId;\n\n    // Validate receiver\n    const receiver = await User.findById(receiverId);\n    if (!receiver) {\n      return res.status(404).json({ success: false, message: 'User not found' });\n    }\n\n    if (!req.file) {\n      return res.status(400).json({ success: false, message: 'Voice clip is required' });\n    }\n\n    const mime = req.file.mimetype || '';\n    if (!(mime.startsWith('audio/') || mime.startsWith('video/'))) {\n      return res.status(400).json({ success: false, message: 'Invalid voice file type' });\n    }\n\n    // Upload to MinIO (auto resource type handles audio/video containers like webm/ogg)\n    const upload = await uploadToStorage(req.file.buffer, 'friendflix/messages', req.file.originalname);\n\n    const durationSec = Math.round(upload?.duration || 0);\n\n    const convo = await Conversation.findOrCreate(req.user._id, receiverId);\n    const expiresAt = typeof convo.messageExpiryHours === 'number' && convo.messageExpiryHours > 0\n      ? new Date(Date.now() + convo.messageExpiryHours * 60 * 60 * 1000)\n      : undefined;\n\n    const message = await Message.create({\n      sender: req.user._id,\n      receiver: receiverId,\n      audio: upload.secure_url,\n      audioDurationSec: durationSec || undefined,\n      expiresAt,\n    });\n\n    const populatedMessage = await Message.findById(message._id)\n      .populate('sender', 'username fullName avatar')\n      .populate('receiver', 'username fullName avatar');\n\n    // Emit only to receiver; sender handles optimistic UI\n    const io = req.app.get('io');\n    io.to(receiverId).emit('newMessage', populatedMessage);\n\n    res.status(201).json({ success: true, data: populatedMessage });\n  } catch (error) {\n    console.error('âŒ Send voice message error:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// @desc    Send attachment (image/video/file)\n// @route   POST /api/messages/:receiverId/attachments\n// @access  Private\nexport const sendAttachment = async (req, res) => {\n  try {\n    const receiverId = req.params.receiverId;\n    const receiver = await User.findById(receiverId);\n    if (!receiver) {\n      return res.status(404).json({ success: false, message: 'User not found' });\n    }\n    if (!req.file) {\n      return res.status(400).json({ success: false, message: 'Attachment is required' });\n    }\n\n    const upload = await uploadToStorage(req.file.buffer, 'friendflix/messages', req.file.originalname);\n    const mime = req.file.mimetype || '';\n\n    let messagePayload = {\n      sender: req.user._id,\n      receiver: receiverId,\n    };\n\n    const convo = await Conversation.findOrCreate(req.user._id, receiverId);\n    const expiresAt = typeof convo.messageExpiryHours === 'number' && convo.messageExpiryHours > 0\n      ? new Date(Date.now() + convo.messageExpiryHours * 60 * 60 * 1000)\n      : undefined;\n\n    if (mime.startsWith('image/')) {\n      messagePayload.image = upload.secure_url;\n    } else if (mime.startsWith('video/')) {\n      messagePayload.video = upload.secure_url;\n    } else {\n      messagePayload.fileUrl = upload.secure_url;\n      messagePayload.fileName = req.file.originalname || 'file';\n    }\n\n    if (expiresAt) messagePayload.expiresAt = expiresAt;\n\n    const message = await Message.create(messagePayload);\n\n    const populatedMessage = await Message.findById(message._id)\n      .populate('sender', 'username fullName avatar')\n      .populate('receiver', 'username fullName avatar');\n\n    const io = req.app.get('io');\n    io.to(receiverId).emit('newMessage', populatedMessage);\n\n    res.status(201).json({ success: true, data: populatedMessage });\n  } catch (error) {\n    console.error('âŒ Send attachment error:', error);\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// @desc    Send message\n// @route   POST /api/messages/:receiverId\n// @access  Private\nexport const sendMessage = async (req, res) => {\n  try {\n    const { text } = req.body;\n    const receiverId = req.params.receiverId;\n\n    if (!text || text.trim() === '') {\n      return res.status(400).json({\n        success: false,\n        message: 'Message text is required',\n      });\n    }\n\n    // Check if receiver exists\n    const receiver = await User.findById(receiverId);\n    if (!receiver) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found',\n      });\n    }\n\n    // Create message\n    const convo = await Conversation.findOrCreate(req.user._id, receiverId);\n    const expiresAt = typeof convo.messageExpiryHours === 'number' && convo.messageExpiryHours > 0\n      ? new Date(Date.now() + convo.messageExpiryHours * 60 * 60 * 1000)\n      : undefined;\n\n    const message = await Message.create({\n      sender: req.user._id,\n      receiver: receiverId,\n      text,\n      expiresAt,\n    });\n\n    const populatedMessage = await Message.findById(message._id)\n      .populate('sender', 'username fullName avatar')\n      .populate('receiver', 'username fullName avatar');\n\n    // Emit socket event ONLY to receiver (sender already has optimistic update)\n    const io = req.app.get('io');\n    io.to(receiverId).emit('newMessage', populatedMessage);\n\n    console.log(`ğŸ“¨ Message sent from ${req.user._id} to ${receiverId}`);\n    console.log(`ğŸ“¤ Socket emitted to receiver: ${receiverId}`);\n\n    res.status(201).json({\n      success: true,\n      data: populatedMessage,\n    });\n  } catch (error) {\n    console.error('âŒ Send message error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get conversation with a user\n// @route   GET /api/messages/:userId\n// @access  Private\nexport const getConversation = async (req, res) => {\n  try {\n    const userId = req.params.userId;\n\n    const messages = await Message.find({\n      $and: [\n        {\n          $or: [\n            { sender: req.user._id, receiver: userId },\n            { sender: userId, receiver: req.user._id },\n          ],\n        },\n        {\n          $or: [\n            { expiresAt: { $exists: false } },\n            { expiresAt: { $gt: new Date() } },\n          ],\n        },\n      ],\n    })\n      .sort({ createdAt: 1 })\n      .populate('sender', 'username fullName avatar')\n      .populate('receiver', 'username fullName avatar');\n\n    // Mark messages as read\n    await Message.updateMany(\n      { sender: userId, receiver: req.user._id, read: false },\n      { read: true, readAt: new Date() }\n    );\n\n    res.status(200).json({\n      success: true,\n      data: messages,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get all conversations\n// @route   GET /api/messages/conversations\n// @access  Private\nexport const getConversations = async (req, res) => {\n  try {\n    // Get all users who have messages with current user\n    const messages = await Message.find({\n      $or: [{ sender: req.user._id }, { receiver: req.user._id }],\n    })\n      .sort({ createdAt: -1 })\n      .populate('sender', 'username fullName avatar')\n      .populate('receiver', 'username fullName avatar');\n\n    // Group messages by conversation partner\n    const conversationsMap = new Map();\n\n    messages.forEach((message) => {\n      const partnerId =\n        message.sender._id.toString() === req.user._id.toString()\n          ? message.receiver._id.toString()\n          : message.sender._id.toString();\n\n      if (!conversationsMap.has(partnerId)) {\n        const partner =\n          message.sender._id.toString() === req.user._id.toString()\n            ? message.receiver\n            : message.sender;\n\n        conversationsMap.set(partnerId, {\n          user: partner,\n          lastMessage: message,\n          unreadCount: 0,\n        });\n      }\n    });\n\n    // Count unread messages for each conversation\n    for (const [partnerId, conversation] of conversationsMap) {\n      const unreadCount = await Message.countDocuments({\n        sender: partnerId,\n        receiver: req.user._id,\n        read: false,\n      });\n      conversation.unreadCount = unreadCount;\n    }\n\n    const conversations = Array.from(conversationsMap.values());\n\n    // Enrich with starred/archived flags\n    for (const convo of conversations) {\n      const cdoc = await Conversation.findOne({ participants: { $all: [req.user._id, convo.user._id] } });\n      convo.isStarred = cdoc ? cdoc.starredBy.some(id => id.toString() === req.user._id.toString()) : false;\n      convo.isArchived = cdoc ? cdoc.archivedBy.some(id => id.toString() === req.user._id.toString()) : false;\n    }\n\n    res.status(200).json({\n      success: true,\n      data: conversations,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Delete message\n// @route   DELETE /api/messages/:messageId\n// @access  Private\nexport const deleteMessage = async (req, res) => {\n  try {\n    const message = await Message.findById(req.params.messageId);\n\n    if (!message) {\n      return res.status(404).json({\n        success: false,\n        message: 'Message not found',\n      });\n    }\n\n    // Check if user is the sender\n    if (message.sender.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to delete this message',\n      });\n    }\n\n    await message.deleteOne();\n\n    res.status(200).json({\n      success: true,\n      message: 'Message deleted successfully',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get unread message count\n// @route   GET /api/messages/unread/count\n// @access  Private\nexport const getUnreadCount = async (req, res) => {\n  try {\n    const count = await Message.countDocuments({\n      receiver: req.user._id,\n      read: false,\n    });\n\n    res.status(200).json({\n      success: true,\n      data: { count },\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Add reaction to message\n// @route   POST /api/messages/:messageId/reaction\n// @access  Private\nexport const addReaction = async (req, res) => {\n  try {\n    const { messageId } = req.params;\n    const { emoji } = req.body;\n\n    const message = await Message.findById(messageId);\n\n    if (!message) {\n      return res.status(404).json({\n        success: false,\n        message: 'Message not found',\n      });\n    }\n\n    // Check if user already reacted\n    const existingReaction = message.reactions.find(\n      (r) => r.user.toString() === req.user._id.toString()\n    );\n\n    if (existingReaction) {\n      // Update existing reaction\n      existingReaction.emoji = emoji;\n      existingReaction.createdAt = new Date();\n    } else {\n      // Add new reaction\n      message.reactions.push({\n        user: req.user._id,\n        emoji,\n      });\n    }\n\n    await message.save();\n\n    const populatedMessage = await Message.findById(messageId)\n      .populate('sender', 'username fullName avatar')\n      .populate('receiver', 'username fullName avatar')\n      .populate('reactions.user', 'username avatar');\n\n    // Emit socket event to both users\n    const io = req.app.get('io');\n    const receiverId = message.sender._id.toString() === req.user._id.toString() \n      ? message.receiver._id.toString() \n      : message.sender._id.toString();\n    \n    io.to(receiverId).emit('messageReaction', populatedMessage);\n    io.to(req.user._id.toString()).emit('messageReaction', populatedMessage);\n\n    res.status(200).json({\n      success: true,\n      data: populatedMessage,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Remove reaction from message\n// @route   DELETE /api/messages/:messageId/reaction\n// @access  Private\nexport const removeReaction = async (req, res) => {\n  try {\n    const { messageId } = req.params;\n\n    const message = await Message.findById(messageId);\n\n    if (!message) {\n      return res.status(404).json({\n        success: false,\n        message: 'Message not found',\n      });\n    }\n\n    // Remove user's reaction\n    message.reactions = message.reactions.filter(\n      (r) => r.user.toString() !== req.user._id.toString()\n    );\n\n    await message.save();\n\n    const populatedMessage = await Message.findById(messageId)\n      .populate('sender', 'username fullName avatar')\n      .populate('receiver', 'username fullName avatar')\n      .populate('reactions.user', 'username avatar');\n\n    // Emit socket event to both users\n    const io = req.app.get('io');\n    const receiverId = message.sender._id.toString() === req.user._id.toString() \n      ? message.receiver._id.toString() \n      : message.sender._id.toString();\n    \n    io.to(receiverId).emit('messageReaction', populatedMessage);\n    io.to(req.user._id.toString()).emit('messageReaction', populatedMessage);\n\n    res.status(200).json({\n      success: true,\n      data: populatedMessage,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n// @desc    Star/Unstar conversation\n// @route   POST /api/messages/conversations/:userId/star\n// @access  Private\nexport const toggleStarConversation = async (req, res) => {\n  try {\n    const { userId } = req.params;\n    \n    // Find or create conversation\n    const conversation = await Conversation.findOrCreate(req.user._id, userId);\n    \n    const isStarred = conversation.starredBy.includes(req.user._id);\n    \n    if (isStarred) {\n      // Remove from starred\n      conversation.starredBy = conversation.starredBy.filter(\n        id => id.toString() !== req.user._id.toString()\n      );\n    } else {\n      // Add to starred\n      conversation.starredBy.push(req.user._id);\n    }\n    \n    await conversation.save();\n    \n    res.status(200).json({\n      success: true,\n      data: {\n        isStarred: !isStarred,\n        message: isStarred ? 'Conversation unstarred' : 'Conversation starred',\n      },\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Archive/Unarchive conversation\n// @route   POST /api/messages/conversations/:userId/archive\n// @access  Private\nexport const toggleArchiveConversation = async (req, res) => {\n  try {\n    const { userId } = req.params;\n    \n    // Find or create conversation\n    const conversation = await Conversation.findOrCreate(req.user._id, userId);\n    \n    const isArchived = conversation.archivedBy.includes(req.user._id);\n    \n    if (isArchived) {\n      // Remove from archived\n      conversation.archivedBy = conversation.archivedBy.filter(\n        id => id.toString() !== req.user._id.toString()\n      );\n    } else {\n      // Add to archived\n      conversation.archivedBy.push(req.user._id);\n    }\n    \n    await conversation.save();\n    \n    res.status(200).json({\n      success: true,\n      data: {\n        isArchived: !isArchived,\n        message: isArchived ? 'Conversation unarchived' : 'Conversation archived',\n      },\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Mark conversation as read\n// @route   POST /api/messages/conversations/:userId/read\n// @access  Private\nexport const markConversationAsRead = async (req, res) => {\n  try {\n    const { userId } = req.params;\n    \n    // Mark all messages from this user as read\n    await Message.updateMany(\n      { sender: userId, receiver: req.user._id, read: false },\n      { read: true, readAt: new Date() }\n    );\n    \n    res.status(200).json({\n      success: true,\n      message: 'Conversation marked as read',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Mark all conversations as read\n// @route   POST /api/messages/mark-all-read\n// @access  Private\nexport const markAllConversationsAsRead = async (req, res) => {\n  try {\n    // Mark all unread messages as read\n    await Message.updateMany(\n      { receiver: req.user._id, read: false },\n      { read: true, readAt: new Date() }\n    );\n    \n    res.status(200).json({\n      success: true,\n      message: 'All conversations marked as read',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get conversation metadata\n// @route   GET /api/messages/conversations/:userId/metadata\n// @access  Private\n// @desc    Search messages by text\n// @route   GET /api/messages/search?q=...&userId=optional\n// @access  Private\nexport const searchMessages = async (req, res) => {\n  try {\n    const { q, userId } = req.query;\n    if (!q || !q.trim()) {\n      return res.status(400).json({ success: false, message: 'Query is required' });\n    }\n    const regex = new RegExp(q.trim(), 'i');\n    const baseFilter = {\n      $or: [\n        { sender: req.user._id },\n        { receiver: req.user._id },\n      ],\n    };\n    const partnerFilter = userId ? {\n      $or: [\n        { sender: userId },\n        { receiver: userId },\n      ],\n    } : {};\n\n    const messages = await Message.find({\n      $and: [ baseFilter, partnerFilter, { $or: [ { text: regex }, { fileName: regex } ] } ],\n    })\n      .sort({ createdAt: -1 })\n      .limit(50)\n      .populate('sender', 'username fullName avatar')\n      .populate('receiver', 'username fullName avatar');\n\n    res.status(200).json({ success: true, data: messages });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// @desc    Update conversation settings (read receipts, typing indicator)\n// @route   POST /api/messages/conversations/:userId/settings\n// @access  Private\n// @desc    Update conversation expiry (hours or null to disable)\n// @route   POST /api/messages/conversations/:userId/expiry\n// @access  Private\nexport const updateConversationExpiry = async (req, res) => {\n  try {\n    const { userId } = req.params;\n    const { hours } = req.body; // number or null\n\n    const conversation = await Conversation.findOrCreate(req.user._id, userId);\n    conversation.messageExpiryHours = typeof hours === 'number' && hours > 0 ? hours : null;\n    await conversation.save();\n\n    res.status(200).json({ success: true, message: 'Expiry updated', data: { messageExpiryHours: conversation.messageExpiryHours } });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\nexport const getConversationMetadata = async (req, res) => {\n  try {\n    const { userId } = req.params;\n    \n    const conversation = await Conversation.findOne({\n      participants: { $all: [req.user._id, userId] },\n    });\n    \n    const metadata = {\n      isStarred: conversation?.starredBy.includes(req.user._id) || false,\n      isArchived: conversation?.archivedBy.includes(req.user._id) || false,\n      readReceiptsEnabled: !(conversation?.readReceiptsDisabledBy || []).some(id => id.toString() === req.user._id.toString()),\n      typingIndicatorEnabled: !(conversation?.typingIndicatorDisabledBy || []).some(id => id.toString() === req.user._id.toString()),\n      messageExpiryHours: conversation?.messageExpiryHours ?? null,\n    };\n    \n    res.status(200).json({\n      success: true,\n      data: metadata,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\nexport const updateConversationSettings = async (req, res) => {\n  try {\n    const { userId } = req.params;\n    const { readReceiptsEnabled, typingIndicatorEnabled } = req.body;\n\n    const conversation = await Conversation.findOrCreate(req.user._id, userId);\n\n    // Update read receipts\n    if (typeof readReceiptsEnabled === 'boolean') {\n      const idx = conversation.readReceiptsDisabledBy.findIndex(\n        (id) => id.toString() === req.user._id.toString()\n      );\n      const shouldDisable = !readReceiptsEnabled;\n      if (shouldDisable && idx === -1) {\n        conversation.readReceiptsDisabledBy.push(req.user._id);\n      } else if (!shouldDisable && idx !== -1) {\n        conversation.readReceiptsDisabledBy.splice(idx, 1);\n      }\n    }\n\n    // Update typing indicator\n    if (typeof typingIndicatorEnabled === 'boolean') {\n      const idx = conversation.typingIndicatorDisabledBy.findIndex(\n        (id) => id.toString() === req.user._id.toString()\n      );\n      const shouldDisable = !typingIndicatorEnabled;\n      if (shouldDisable && idx === -1) {\n        conversation.typingIndicatorDisabledBy.push(req.user._id);\n      } else if (!shouldDisable && idx !== -1) {\n        conversation.typingIndicatorDisabledBy.splice(idx, 1);\n      }\n    }\n\n    await conversation.save();\n\n    res.status(200).json({\n      success: true,\n      message: 'Settings updated',\n      data: {\n        readReceiptsEnabled: !(conversation.readReceiptsDisabledBy || []).some(id => id.toString() === req.user._id.toString()),\n        typingIndicatorEnabled: !(conversation.typingIndicatorDisabledBy || []).some(id => id.toString() === req.user._id.toString()),\n      },\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n","size_bytes":21634},"frontend/src/pages/Reels.jsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { postAPI, exploreAPI, userAPI } from '../services/api';\nimport { useAuth } from '../context/AuthContext';\nimport VideoAd from '../components/VideoAd';\nimport { shouldShowReelAd, AD_CONFIG } from '../utils/adConfig';\nimport toast from 'react-hot-toast';\nimport {\n  AiOutlineHeart,\n  AiFillHeart,\n  AiOutlineComment,\n  AiOutlineShareAlt,\n} from 'react-icons/ai';\nimport { BsBookmark, BsBookmarkFill, BsThreeDots } from 'react-icons/bs';\n\nconst Reels = () => {\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const [reels, setReels] = useState([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const videoRefs = useRef([]);\n  const [commentPostId, setCommentPostId] = useState(null);\n  const [comments, setComments] = useState([]);\n  const [commentText, setCommentText] = useState('');\n  const [commentsLoading, setCommentsLoading] = useState(false);\n  const [subscribed, setsubscribed] = useState({});\n  const [detailsFor, setDetailsFor] = useState(null);\n  const [showAd, setShowAd] = useState(false);\n  const [adType, setAdType] = useState('pre-roll');\n  const [midRollShown, setMidRollShown] = useState({});\n  const [postRollShown, setPostRollShown] = useState({});\n\n  useEffect(() => {\n    fetchReels();\n  }, []);\n\n  useEffect(() => {\n    if (shouldShowReelAd(currentIndex)) {\n      setShowAd(true);\n      setAdType('pre-roll');\n    } else {\n      videoRefs.current.forEach((video, index) => {\n        if (video) {\n          if (index === currentIndex) {\n            video.play();\n            if (AD_CONFIG.videoAds.midRoll.enabled) {\n              video.ontimeupdate = () => handleVideoProgress(video, index);\n            }\n            video.onended = () => handleVideoEnded(index);\n          } else {\n            video.pause();\n          }\n        }\n      });\n    }\n  }, [currentIndex]);\n\n  const handleVideoProgress = (video, index) => {\n    const currentTime = video.currentTime;\n    const interval = AD_CONFIG.videoAds.midRoll.interval;\n    \n    if (currentTime >= interval && !midRollShown[index] && video.duration > interval + 10) {\n      video.pause();\n      setMidRollShown(prev => ({ ...prev, [index]: true }));\n      setAdType('mid-roll');\n      setShowAd(true);\n    }\n  };\n\n  const handleVideoEnded = (index) => {\n    if (AD_CONFIG.videoAds.postRoll.enabled && !postRollShown[index]) {\n      setPostRollShown(prev => ({ ...prev, [index]: true }));\n      setAdType('post-roll');\n      setShowAd(true);\n    }\n  };\n\n  const handleAdComplete = () => {\n    setShowAd(false);\n    const video = videoRefs.current[currentIndex];\n    if (video) {\n      if (AD_CONFIG.videoAds.midRoll.enabled && video.duration > AD_CONFIG.videoAds.midRoll.interval) {\n        video.ontimeupdate = () => handleVideoProgress(video, currentIndex);\n      }\n      video.onended = () => handleVideoEnded(currentIndex);\n      video.play();\n    }\n  };\n\n  const fetchReels = async () => {\n    try {\n      const response = await exploreAPI.getExplorePosts();\n      const data = response.data.data || [];\n      // Filter only shorts (category === 'short'); fallback to short-like videos\n      const videoReels = data.filter((post) => {\n        if (post.category) return post.category === 'short';\n        const isVideo = post.media?.[0]?.type === 'video' || post.mediaType === 'video';\n        const isShort = typeof post.durationSec === 'number' ? post.durationSec <= 60 : true;\n        return isVideo && isShort;\n      });\n      setReels(videoReels);\n    } catch (error) {\n      toast.error('Failed to load reels');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const openComments = async (postId) => {\n    setCommentPostId(postId);\n    setCommentsLoading(true);\n    try {\n      const res = await postAPI.getComments(postId);\n      setComments(res.data.data || []);\n    } catch {\n      toast.error('Failed to load comments');\n      setComments([]);\n    } finally {\n      setCommentsLoading(false);\n    }\n  };\n\n  const closeComments = () => {\n    setCommentPostId(null);\n    setComments([]);\n    setCommentText('');\n  };\n\n  const handleAddComment = async (e) => {\n    e.preventDefault();\n    if (!commentText.trim() || !commentPostId) return;\n    try {\n      const res = await postAPI.addComment(commentPostId, commentText.trim());\n      setComments((prev) => [...prev, res.data.data]);\n      setCommentText('');\n      // Update count in main list\n      setReels((prev) => prev.map(r => r._id === commentPostId ? { ...r, comments: [...r.comments, res.data.data] } : r));\n    } catch {\n      toast.error('Failed to add comment');\n    }\n  };\n\n  const handleScroll = (e) => {\n    const scrollTop = e.target.scrollTop;\n    const windowHeight = window.innerHeight;\n    const newIndex = Math.round(scrollTop / windowHeight);\n    if (newIndex !== currentIndex && newIndex < reels.length) {\n      setCurrentIndex(newIndex);\n    }\n  };\n\n  const handleShare = async (reel) => {\n    try {\n      const url = reel.media?.[0]?.url || reel.mediaUrl || `${window.location.origin}/posts/${reel._id}`;\n      if (navigator.share) {\n        await navigator.share({\n          title: reel.title || `@${reel.author.username} on friendflix`,\n          text: reel.caption || 'Check this out!',\n          url,\n        });\n      } else {\n        await navigator.clipboard.writeText(url);\n        toast.success('Link copied to clipboard');\n      }\n    } catch (e) {\n      toast.error('Unable to share');\n    }\n  };\n\n  const handleLike = async (postId, index) => {\n    try {\n      const response = await postAPI.likePost(postId);\n      const newReels = [...reels];\n      newReels[index].likes = response.data.isLiked\n        ? [...newReels[index].likes, user._id]\n        : newReels[index].likes.filter((id) => id !== user._id);\n      setReels(newReels);\n    } catch (error) {\n      toast.error('Failed to like reel');\n    }\n  };\n\n  const handleFollow = async (author) => {\n    try {\n      const res = await userAPI.followUser(author._id);\n      setsubscribed((prev) => ({ ...prev, [author._id]: res.data.issubscribed }));\n      toast.success(res.data.issubscribed ? 'subscribed' : 'Unfollowed');\n    } catch {\n      toast.error('Failed to follow user');\n    }\n  };\n\n  const openDetails = (reel) => setDetailsFor(reel);\n  const closeDetails = () => setDetailsFor(null);\n\n  if (loading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center bg-black\">\n        <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-purple-500\"></div>\n      </div>\n    );\n  }\n\n  if (reels.length === 0) {\n    return (\n      <div className=\"h-screen flex items-center justify-center bg-gradient-to-br from-purple-900 via-pink-900 to-amber-900 text-white\">\n        <div className=\"text-center\">\n          <div className=\"text-6xl mb-4\">ğŸ¬</div>\n          <h2 className=\"text-2xl font-bold mb-2\">No Reels Yet</h2>\n          <p className=\"text-purple-200\">Upload your first video reel!</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      {showAd && (\n        <VideoAd\n          type={adType}\n          duration={\n            adType === 'pre-roll' ? AD_CONFIG.videoAds.preRoll.duration :\n            adType === 'mid-roll' ? AD_CONFIG.videoAds.midRoll.duration :\n            AD_CONFIG.videoAds.postRoll.duration\n          }\n          onComplete={handleAdComplete}\n          onSkip={handleAdComplete}\n        />\n      )}\n      <div\n        className=\"h-screen overflow-y-scroll snap-y snap-mandatory bg-black\"\n        onScroll={handleScroll}\n      >\n        {reels.map((reel, index) => (\n        <div\n          key={reel._id}\n          className=\"h-screen w-full snap-start relative flex items-center justify-center\"\n        >\n          {/* Video or Duet */}\n          {reel.remixType === 'duet' && reel.derivedFrom ? (\n            <div className=\"h-full w-full flex items-center justify-center gap-2\">\n              <video\n                src={reel.derivedFrom.media?.[0]?.url || reel.derivedFrom.mediaUrl}\n                className=\"h-full w-1/2 object-contain\"\n                loop\n                playsInline\n                muted\n              />\n              <video\n                ref={(el) => (videoRefs.current[index] = el)}\n                src={reel.media?.[0]?.url || reel.mediaUrl}\n                className=\"h-full w-1/2 object-contain\"\n                loop\n                playsInline\n                onLoadedMetadata={(e)=>{ if (typeof reel.playbackRate==='number') { try { e.target.playbackRate = reel.playbackRate; } catch {} } }}\n                onClick={(e) => {\n                  if (e.target.paused) {\n                    e.target.play();\n                  } else {\n                    e.target.pause();\n                  }\n                }}\n              />\n            </div>\n          ) : (\n            <video\n              ref={(el) => (videoRefs.current[index] = el)}\n              src={reel.media?.[0]?.url || reel.mediaUrl}\n              className=\"h-full w-auto max-w-full object-contain\"\n              loop\n              playsInline\n              onLoadedMetadata={(e)=>{ if (typeof reel.playbackRate==='number') { try { e.target.playbackRate = reel.playbackRate; } catch {} } }}\n              onClick={(e) => {\n                if (e.target.paused) {\n                  e.target.play();\n                } else {\n                  e.target.pause();\n                }\n              }}\n            />\n          )}\n\n          {/* Gradient Overlays */}\n          <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-black/50 pointer-events-none\"></div>\n\n          {/* Top Bar */}\n          <div className=\"absolute top-4 left-4 right-4 flex items-center justify-between z-10\">\n            <div className=\"flex items-center space-x-3\">\n              <img\n                src={reel.author.avatar}\n                alt={reel.author.username}\n                className=\"w-12 h-12 rounded-full border-2 border-white shadow-glow cursor-pointer\"\n                onClick={() => navigate(`/profile/${reel.author.username}`)}\n              />\n              <button\n                className=\"text-white font-semibold underline-offset-2 hover:underline\"\n                onClick={() => navigate(`/profile/${reel.author.username}`)}\n              >\n                @{reel.author.username}\n              </button>\n              <button\n                className=\"px-3 py-1 bg-white/20 text-white rounded-full text-sm hover:bg-white/30\"\n                onClick={() => handleFollow(reel.author)}\n              >\n                {subscribed[reel.author._id] ? 'subscribed' : 'Follow'}\n              </button>\n            </div>\n            <button className=\"text-white\" onClick={() => navigate(`/upload?remixOf=${reel._id}&category=short`)}>\n              Duet\n            </button>\n\n          </div>\n\n          {/* Bottom Info */}\n          <div className=\"absolute bottom-20 left-4 right-20 z-10\">\n\n            <p className=\"text-white text-sm mb-3 cursor-pointer\" onClick={() => setDetailsFor(reel)}>{reel.description || reel.caption}</p>\n          </div>\n\n          {/* Right Actions - TikTok Style */}\n          <div className=\"absolute right-4 bottom-20 flex flex-col space-y-6 z-10\">\n            {/* Like */}\n            <button\n              onClick={() => handleLike(reel._id, index)}\n              className=\"flex flex-col items-center\"\n            >\n              {reel.likes.includes(user?._id) ? (\n                <AiFillHeart size={36} className=\"text-red-500 drop-shadow-glow\" />\n              ) : (\n                <AiOutlineHeart size={36} className=\"text-white drop-shadow-lg\" />\n              )}\n              <span className=\"text-white text-xs mt-1 font-semibold\">\n                {reel.likes.length}\n              </span>\n            </button>\n\n            {/* Comment */}\n            <button className=\"flex flex-col items-center\" onClick={() => openComments(reel._id)}>\n              <AiOutlineComment size={36} className=\"text-white drop-shadow-lg\" />\n              <span className=\"text-white text-xs mt-1 font-semibold\">\n                {reel.comments.length}\n              </span>\n            </button>\n\n            <button className=\"flex flex-col items-center\" onClick={() => handleShare(reel)}>\n              <AiOutlineShareAlt size={36} className=\"text-white drop-shadow-lg\" />\n              <span className=\"text-white text-xs mt-1 font-semibold\">Share</span>\n            </button>\n\n            {/* Bookmark */}\n            <button className=\"flex flex-col items-center\">\n              <BsBookmark size={32} className=\"text-white drop-shadow-lg\" />\n            </button>\n\n            {/* Author Avatar (Spinning) */}\n            <div className=\"relative\">\n              <div className=\"w-12 h-12 rounded-full bg-gradient-primary p-0.5 animate-spin-slow\">\n                <img\n                  src={reel.author.avatar}\n                  alt={reel.author.username}\n                  className=\"w-full h-full rounded-full border-2 border-black cursor-pointer\"\n                  onClick={() => navigate(`/profile/${reel.author.username}`)}\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Progress Indicator */}\n          <div className=\"absolute top-1/2 right-2 transform -translate-y-1/2 flex flex-col space-y-1\">\n            {reels.map((_, i) => (\n              <div\n                key={i}\n                className={`w-1 h-8 rounded-full transition-all ${\n                  i === currentIndex\n                    ? 'bg-white'\n                    : i < currentIndex\n                    ? 'bg-white/50'\n                    : 'bg-white/20'\n                }`}\n              ></div>\n            ))}\n          </div>\n        </div>\n      ))}\n\n      <style >{`\n        @keyframes spin-slow {\n          from {\n            transform: rotate(0deg);\n          }\n          to {\n            transform: rotate(360deg);\n          }\n        }\n        .animate-spin-slow {\n          animation: spin-slow 3s linear infinite;\n        }\n      `}</style>\n\n      {/* Comments Overlay */}\n      {commentPostId && (\n        <div className=\"fixed inset-0 bg-black/70 z-50 flex items-center justify-center\">\n          <div className=\"bg-white dark:bg-gray-900 rounded-2xl w-full max-w-md mx-4 p-4 border dark:border-gray-700\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <h3 className=\"font-semibold dark:text-white\">Comments</h3>\n              <button onClick={closeComments} className=\"text-gray-500\">âœ•</button>\n            </div>\n            <div className=\"max-h-64 overflow-y-auto space-y-3 mb-3\">\n              {commentsLoading ? (\n                <div className=\"text-sm text-gray-500\">Loading...</div>\n              ) : comments.length === 0 ? (\n                <div className=\"text-sm text-gray-500\">No comments yet.</div>\n              ) : (\n                comments.map((c) => (\n                  <div key={c._id} className=\"flex items-start gap-2\">\n                    <img src={c.author.avatar} alt={c.author.username} className=\"h-8 w-8 rounded-full\" />\n                    <div>\n                      <p className=\"text-sm\"><span className=\"font-semibold\">{c.author.username}</span> {c.text}</p>\n                      <p className=\"text-xs text-gray-400\">{new Date(c.createdAt).toLocaleString()}</p>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n            <form onSubmit={handleAddComment} className=\"flex items-center gap-2\">\n              <input\n                type=\"text\"\n                placeholder=\"Add a comment...\"\n                value={commentText}\n                onChange={(e)=>setCommentText(e.target.value)}\n                className=\"flex-1 input-field dark:bg-gray-800 dark:text-white\"\n              />\n              <button type=\"submit\" disabled={!commentText.trim()} className=\"btn-primary\">Post</button>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {detailsFor && (\n        <div className=\"fixed inset-0 bg-black/70 z-50 flex items-center justify-center\">\n          <div className=\"bg-white dark:bg-gray-900 rounded-2xl w-full max-w-sm mx-4 p-4 border dark:border-gray-700\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <h3 className=\"font-semibold dark:text-white\">Details</h3>\n              <button onClick={closeDetails} className=\"text-gray-500\">âœ•</button>\n            </div>\n            <div className=\"space-y-2 text-sm dark:text-white\">\n              <div className=\"flex justify-between\">\n                <span>Likes</span>\n                <span>{(detailsFor.likes || []).length}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Views</span>\n                <span>{detailsFor.views || 0}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Uploaded</span>\n                <span>{new Date(detailsFor.createdAt).toLocaleString()}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n    </>\n  );\n};\n\nexport default Reels;\n","size_bytes":17240},"frontend/src/pages/Settings.jsx":{"content":"import { useState } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { useTheme } from '../context/ThemeContext';\nimport { Link } from 'react-router-dom';\nimport { userAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { AiOutlineCamera } from 'react-icons/ai';\nimport { FiShield } from 'react-icons/fi';\nimport { FaCrown } from 'react-icons/fa';\n\nconst Settings = () => {\n  const { user, updateUser } = useAuth();\n  const { theme, toggleTheme } = useTheme();\n  const [formData, setFormData] = useState({\n    fullName: user?.fullName || '',\n    username: user?.username || '',\n    bio: user?.bio || '',\n    gender: user?.gender || 'prefer_not_to_say',\n  });\n  const [avatarFile, setAvatarFile] = useState(null);\n  const [avatarPreview, setAvatarPreview] = useState(user?.avatar || '');\n  const [coverFile, setCoverFile] = useState(null);\n  const [coverPreview, setCoverPreview] = useState(user?.coverImage || '');\n  const [loading, setLoading] = useState(false);\n  const [upgradeReason, setUpgradeReason] = useState('');\n  const [requesting, setRequesting] = useState(false);\n\n  const handleChange = (e) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  const handleCoverChange = (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n    if (!file.type.startsWith('image/')) {\n      toast.error('Please select an image file');\n      return;\n    }\n    if (file.size > 5 * 1024 * 1024) {\n      toast.error('Cover image should be less than 5MB');\n      return;\n    }\n    setCoverFile(file);\n    const reader = new FileReader();\n    reader.onloadend = () => setCoverPreview(reader.result);\n    reader.readAsDataURL(file);\n  };\n\n  const handleAvatarChange = (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n    if (!file.type.startsWith('image/')) {\n      toast.error('Please select an image file');\n      return;\n    }\n    if (file.size > 2 * 1024 * 1024) {\n      toast.error('Image size should be less than 2MB');\n      return;\n    }\n    setAvatarFile(file);\n    const reader = new FileReader();\n    reader.onloadend = () => setAvatarPreview(reader.result);\n    reader.readAsDataURL(file);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const formDataToSend = new FormData();\n      formDataToSend.append('fullName', formData.fullName);\n      formDataToSend.append('username', formData.username);\n      formDataToSend.append('bio', formData.bio);\n      formDataToSend.append('gender', formData.gender);\n      \n      if (avatarFile) {\n        formDataToSend.append('avatar', avatarFile);\n      }\n      if (coverFile) {\n        formDataToSend.append('cover', coverFile);\n      }\n\n      const response = await userAPI.updateProfile(formDataToSend);\n      updateUser(response.data.data);\n      toast.success('Profile updated successfully!');\n    } catch (error) {\n      toast.error(error.response?.data?.message || 'Failed to update profile');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto px-4 py-8\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-2xl font-bold\">Edit Profile</h1>\n        {user?.role === 'admin' && (\n          <Link\n            to=\"/admin\"\n            className=\"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg hover:from-red-600 hover:to-pink-600 transition shadow-lg\"\n          >\n            <FiShield className=\"w-5 h-5\" />\n            Admin Panel\n          </Link>\n        )}\n      </div>\n\n      {/* Role Upgrade Card */}\n      <div className=\"card p-6 mb-6\">\n        <div className=\"flex items-start gap-3\">\n          <FaCrown className=\"text-yellow-500 w-6 h-6 mt-1\" />\n          <div className=\"flex-1\">\n            <h2 className=\"font-semibold\">Creator Access</h2>\n            <p className=\"text-sm text-gray-600\">Current role: <strong>{user?.role}</strong></p>\n            {user?.roleUpgradeRequested && (\n              <p className=\"text-sm text-yellow-700 mt-1\">Your request is pending admin review.</p>\n            )}\n            {user?.role !== 'creator' && user?.role !== 'admin' && !user?.roleUpgradeRequested && (\n              <div className=\"mt-3 space-y-2\">\n                <textarea\n                  value={upgradeReason}\n                  onChange={(e) => setUpgradeReason(e.target.value)}\n                  rows={3}\n                  maxLength={200}\n                  placeholder=\"Tell us briefly why you want to be a creator (optional)\"\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary\"\n                />\n                <button\n                  type=\"button\"\n                  disabled={requesting}\n                  onClick={async () => {\n                    try {\n                      setRequesting(true);\n                      const res = await userAPI.requestRoleUpgrade(upgradeReason);\n                      updateUser(res.data.data);\n                      toast.success('Request submitted!');\n                    } catch (err) {\n                      const msg = err.response?.data?.message || 'Failed to request upgrade';\n                      toast.error(msg);\n                    } finally {\n                      setRequesting(false);\n                    }\n                  }}\n                  className=\"btn-primary\"\n                >\n                  {requesting ? 'Submitting...' : 'Request Creator Access'}\n                </button>\n              </div>\n            )}\n            {user?.role === 'creator' && (\n              <p className=\"text-sm text-green-700 mt-2\">You already have Creator access. Enjoy long videos and advanced features.</p>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Appearance / Theme */}\n      <div className=\"card p-6 mb-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"font-semibold\">Appearance</h2>\n            <p className=\"text-sm text-gray-600\">Current theme: <strong>{theme}</strong></p>\n          </div>\n          <button type=\"button\" onClick={toggleTheme} className=\"btn-outline\">\n            Toggle Theme\n          </button>\n        </div>\n      </div>\n\n      <div className=\"card p-6\">\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {/* Avatar Upload */}\n          <div className=\"flex items-center space-x-6\">\n            <div className=\"relative\">\n              <img\n                src={avatarPreview}\n                alt=\"Avatar\"\n                className=\"h-24 w-24 rounded-full object-cover\"\n              />\n              <label\n                htmlFor=\"avatar-upload\"\n                className=\"absolute bottom-0 right-0 bg-primary text-white p-2 rounded-full cursor-pointer hover:bg-blue-600 transition\"\n              >\n                <AiOutlineCamera size={20} />\n                <input\n                  id=\"avatar-upload\"\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleAvatarChange}\n                  className=\"hidden\"\n                />\n              </label>\n            </div>\n            <div>\n              <p className=\"font-semibold\">{user?.username}</p>\n              <p className=\"text-sm text-gray-500\">Change profile photo</p>\n            </div>\n          </div>\n\n          {/* Cover Image */}\n          <div className=\"space-y-2\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Cover Image\n            </label>\n            <div className=\"relative\">\n              <img\n                src={coverPreview}\n                alt=\"Cover\"\n                className=\"h-24 w-full object-cover rounded-md\"\n              />\n              <label\n                htmlFor=\"cover-upload\"\n                className=\"absolute bottom-2 right-2 bg-primary text-white px-3 py-1 rounded-full cursor-pointer hover:bg-blue-600 transition\"\n              >\n                Change Cover\n                <input\n                  id=\"cover-upload\"\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleCoverChange}\n                  className=\"hidden\"\n                />\n              </label>\n            </div>\n          </div>\n\n          {/* Gender */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Gender\n            </label>\n            <select\n              name=\"gender\"\n              value={formData.gender}\n              onChange={handleChange}\n              className=\"input-field\"\n            >\n              <option value=\"prefer_not_to_say\">Prefer not to say</option>\n              <option value=\"male\">Male</option>\n              <option value=\"female\">Female</option>\n              <option value=\"other\">Other</option>\n            </select>\n          </div>\n\n          {/* Full Name */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Full Name\n            </label>\n            <input\n              type=\"text\"\n              name=\"fullName\"\n              value={formData.fullName}\n              onChange={handleChange}\n              required\n              className=\"input-field\"\n            />\n          </div>\n\n          {/* Username */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Username\n            </label>\n            <input\n              type=\"text\"\n              name=\"username\"\n              value={formData.username}\n              onChange={handleChange}\n              required\n              className=\"input-field\"\n            />\n          </div>\n\n          {/* Bio */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Bio\n            </label>\n            <textarea\n              name=\"bio\"\n              value={formData.bio}\n              onChange={handleChange}\n              rows={4}\n              maxLength={150}\n              placeholder=\"Tell us about yourself...\"\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent resize-none\"\n            />\n            <p className=\"text-xs text-gray-500 mt-1\">\n              {formData.bio.length}/150 characters\n            </p>\n          </div>\n\n          {/* Submit Button */}\n          <div className=\"flex space-x-4\">\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"flex-1 btn-primary disabled:opacity-50\"\n            >\n              {loading ? 'Saving...' : 'Save Changes'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default Settings;\n","size_bytes":10923},"GROUP_MESSAGING_GUIDE.md":{"content":"# ğŸ‘¥ Group Messaging Feature Guide\n\n## âœ¨ What's New\n\nYour friendflix app now has **real-time group messaging**! Users can create groups, chat with multiple people, and receive live updates.\n\n---\n\n## ğŸ¯ Features\n\n### 1. **Create Groups**\n- Click the \"Groups\" icon in Messages page\n- Create a new group with custom name and description\n- Search and add multiple members\n- Group avatar auto-generated from group name\n\n### 2. **Real-Time Group Chat**\n- Send and receive messages instantly\n- See who sent each message\n- Emoji picker support\n- Message timestamps with \"time ago\" format\n- Optimistic UI updates (messages appear instantly)\n\n### 3. **Group Management**\n- View all your groups\n- See member avatars (overlapping style)\n- Last message preview\n- Leave group option\n- Admin can add new members\n\n### 4. **Socket.io Integration**\n- Real-time message delivery\n- No page refresh needed\n- Works across all devices\n- Instant notifications for new groups\n\n---\n\n## ğŸ“± How to Use\n\n### Creating a Group:\n\n1. Go to **Messages** page\n2. Click the **group icon** (ğŸ‘¥) in the header\n3. Click \"**Create Group**\" button\n4. Enter group name and description (optional)\n5. Search for users to add\n6. Click on users to select them\n7. Click \"**Create Group**\"\n8. Start chatting!\n\n### Sending Messages:\n\n1. Open any group from the Groups list\n2. Type your message\n3. Click emoji icon to add emojis (ğŸ˜Š)\n4. Press Send or hit Enter\n5. Messages appear instantly for all members\n\n### Leaving a Group:\n\n1. Open the group\n2. Click the **three dots** (â‹®) menu\n3. Click \"**Leave Group**\"\n4. Confirm\n\n---\n\n## ğŸ”§ Technical Details\n\n### Backend Models:\n\n**Group Model:**\n- name, description, avatar\n- admin (user who created)\n- members (array with role: admin/member)\n- lastMessage, lastMessageAt\n\n**GroupMessage Model:**\n- group, sender, text\n- readBy (array of users who read)\n- timestamps\n\n### API Endpoints:\n\n```\nPOST   /api/groups                      - Create group\nGET    /api/groups                      - Get user's groups\nGET    /api/groups/:groupId             - Get group info\nPOST   /api/groups/:groupId/messages    - Send message\nGET    /api/groups/:groupId/messages    - Get messages\nPOST   /api/groups/:groupId/members     - Add member (admin only)\nDELETE /api/groups/:groupId/leave       - Leave group\n```\n\n### Socket Events:\n\n**Emitted:**\n- `newGroup` - When group is created\n- `newGroupMessage` - When message is sent\n- `addedToGroup` - When user is added to group\n- `groupMemberAdded` - When new member joins\n- `memberLeftGroup` - When member leaves\n\n---\n\n## ğŸ¨ UI Components\n\n### Groups Page (`/groups`):\n- List of all user's groups\n- Create group button\n- Group creation modal\n- Member search\n\n### GroupChat Page (`/group/:groupId`):\n- Group header with member avatars\n- Real-time message list\n- Message input with emoji picker\n- Group menu (settings, leave)\n\n---\n\n## ğŸ”„ How It Works\n\n### Message Flow:\n\n1. **User types message** â†’ Frontend captures input\n2. **Optimistic Update** â†’ Message appears instantly (temp ID)\n3. **API Call** â†’ POST to `/api/groups/:groupId/messages`\n4. **Backend saves** â†’ MongoDB stores message\n5. **Socket.io broadcasts** â†’ All members receive via `newGroupMessage` event\n6. **Frontend updates** â†’ Replace temp message with real message\n7. **All users see** â†’ Real-time sync across devices\n\n### Group Creation Flow:\n\n1. User fills form â†’ name, members\n2. POST to `/api/groups`\n3. Backend creates group\n4. Socket.io notifies all members\n5. Members receive `newGroup` event\n6. Group appears in their list\n\n---\n\n## ğŸš€ Testing Instructions\n\n### Test 1: Create a Group\n```\n1. Login as User A\n2. Go to Messages â†’ Groups\n3. Click \"Create Group\"\n4. Name: \"Test Group\"\n5. Add User B and User C\n6. Click Create\nâœ… Group should appear in list\n```\n\n### Test 2: Send Messages\n```\n1. Open the group\n2. Type \"Hello everyone!\"\n3. Press Send\nâœ… Message should appear instantly\nâœ… Other members should receive it\n```\n\n### Test 3: Real-Time Updates\n```\n1. Open group in 2 different browsers (different users)\n2. Send message from Browser 1\nâœ… Browser 2 should show message instantly\n```\n\n### Test 4: Leave Group\n```\n1. Open group\n2. Click three dots menu\n3. Click \"Leave Group\"\n4. Confirm\nâœ… Group should disappear from list\nâœ… Other members get notification\n```\n\n---\n\n## ğŸ› Troubleshooting\n\n### Messages not appearing?\n- Check console for errors\n- Verify backend is running on port 5000\n- Check Socket.io connection (green âœ… in backend logs)\n\n### Can't create group?\n- Ensure at least one member is selected\n- Check if group name is provided\n- Verify you're logged in\n\n### Not receiving real-time updates?\n- Check Socket.io connection\n- Refresh the page\n- Check browser console for errors\n\n---\n\n## ğŸ“Š Database Schema\n\n### Groups Collection:\n```json\n{\n  \"_id\": \"ObjectId\",\n  \"name\": \"My Group\",\n  \"description\": \"Group description\",\n  \"avatar\": \"https://...\",\n  \"admin\": \"userId\",\n  \"members\": [\n    {\n      \"user\": \"userId\",\n      \"role\": \"admin|member\",\n      \"joinedAt\": \"Date\"\n    }\n  ],\n  \"lastMessage\": \"messageId\",\n  \"lastMessageAt\": \"Date\",\n  \"createdAt\": \"Date\",\n  \"updatedAt\": \"Date\"\n}\n```\n\n### GroupMessages Collection:\n```json\n{\n  \"_id\": \"ObjectId\",\n  \"group\": \"groupId\",\n  \"sender\": \"userId\",\n  \"text\": \"Hello!\",\n  \"readBy\": [\n    {\n      \"user\": \"userId\",\n      \"readAt\": \"Date\"\n    }\n  ],\n  \"createdAt\": \"Date\",\n  \"updatedAt\": \"Date\"\n}\n```\n\n---\n\n## ğŸ”® Future Enhancements\n\nPossible improvements:\n- [ ] Group avatars (custom upload)\n- [ ] File/image sharing in groups\n- [ ] Message reactions\n- [ ] Reply to specific messages\n- [ ] Typing indicators\n- [ ] Read receipts\n- [ ] Push notifications\n- [ ] Group voice/video calls\n- [ ] Message search\n- [ ] Pin important messages\n- [ ] Group permissions\n- [ ] Mute specific groups\n- [ ] Admin controls (kick, ban)\n\n---\n\n## âœ… Checklist\n\nMake sure everything works:\n\n- [x] Backend models created\n- [x] Backend controllers implemented\n- [x] API routes configured\n- [x] Socket.io events set up\n- [x] Frontend API service added\n- [x] Groups page created\n- [x] GroupChat page updated\n- [x] Routes added to App.jsx\n- [x] Messages page links to Groups\n- [x] Emoji picker working\n- [x] Real-time updates working\n\n---\n\n**Congratulations! ğŸ‰ Your group messaging feature is complete!**\n\nUsers can now create groups, chat with multiple people, and enjoy real-time communication.\n\nHappy chatting! ğŸ’¬\n","size_bytes":6406},"backend/routes/watchLaterRoutes.js":{"content":"import express from 'express';\nimport {\n  addToWatchLater,\n  removeFromWatchLater,\n  getWatchLater,\n  clearWatchLater,\n} from '../controllers/watchLaterController.js';\nimport { protect } from '../middleware/authMiddleware.js';\n\nconst router = express.Router();\n\nrouter.get('/', protect, getWatchLater);\nrouter.post('/:postId', protect, addToWatchLater);\nrouter.delete('/:postId', protect, removeFromWatchLater);\nrouter.delete('/', protect, clearWatchLater);\n\nexport default router;\n","size_bytes":482},"MOBILE_RESPONSIVE_UPDATES.md":{"content":"# ğŸ“± Mobile Responsive Updates - Admin Panel\n\n## âœ… Changes Made\n\n### 1. **AdminDashboard.jsx**\n- **Header**: Made responsive with flexible layout\n  - Text sizes: `text-2xl sm:text-3xl`\n  - Padding: `py-4 sm:py-6`\n  - Button: Full width on mobile\n  \n- **Stats Grid**: Improved mobile layout\n  - Grid: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3`\n  - Gaps: `gap-4 sm:gap-6`\n  - Icon sizes: `w-5 h-5 sm:w-6 sm:h-6`\n  - Font sizes adjusted for mobile\n  \n- **Quick Actions**: Better mobile cards\n  - Grid: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3`\n  - Icons: `w-6 h-6 sm:w-8 sm:h-8`\n  - Text: `text-sm sm:text-base`\n\n### 2. **AdminUsers.jsx**\n- **Header**: Mobile-optimized\n  - Truncated title on small screens\n  - Smaller back button\n  - Responsive text sizes\n  \n- **Search Bar**: Mobile-friendly\n  - Placeholder: Shortened on mobile\n  - Button: `px-4 sm:px-6`\n  - Flex-shrink-0 for button\n  \n- **Desktop Table View**: `hidden lg:block`\n  \n- **Mobile Card View**: NEW! `lg:hidden`\n  - Card-based layout for mobile\n  - User avatar: 12x12 (48px)\n  - Info in vertical layout\n  - Stats in 2x2 grid\n  - Action buttons in flexbox\n  - Responsive button sizes\n  - Truncated text with ellipsis\n\n### 3. **AdminPosts.jsx**\n- **Header**: Similar to AdminUsers\n  - Mobile-responsive text\n  - Flexible layout\n  \n- **Posts Grid**: Better mobile columns\n  - Grid: `grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5`\n  - Gaps: `gap-3 sm:gap-4 lg:gap-6`\n  - Compact card design\n  \n- **Post Cards**: Mobile-optimized\n  - Smaller avatars on mobile\n  - Hidden caption on mobile\n  - Smaller icons\n  - Compact spacing\n  \n- **Modal**: Bottom sheet on mobile!\n  - Position: `items-end sm:items-center`\n  - Rounded: `rounded-t-2xl sm:rounded-lg`\n  - Sticky header\n  - Responsive grid: `grid-cols-1 md:grid-cols-2`\n  - All text sizes adjusted\n  - Better spacing on mobile\n\n## ğŸ¨ Design Features\n\n### Mobile-First Approach\n- All layouts start from mobile and scale up\n- Breakpoints: `sm:`, `md:`, `lg:`, `xl:`\n- Touch-friendly buttons (min 44x44px)\n- Readable text sizes on mobile\n\n### Responsive Utilities Used\n```css\n/* Text Sizes */\ntext-xs sm:text-sm\ntext-sm sm:text-base\ntext-xl sm:text-2xl lg:text-3xl\n\n/* Spacing */\np-2 sm:p-3 lg:p-4\ngap-3 sm:gap-4 lg:gap-6\npy-4 sm:py-6\n\n/* Layout */\ngrid-cols-1 sm:grid-cols-2 lg:grid-cols-3\nflex-col sm:flex-row\nhidden sm:block\nlg:hidden\n\n/* Sizing */\nw-5 h-5 sm:w-6 sm:h-6\nw-full sm:w-auto\nmin-w-[80px]\n```\n\n### Text Truncation\n- `truncate` - Single line ellipsis\n- `line-clamp-2` - Two lines with ellipsis\n- `min-w-0` - Allow text to shrink\n- `flex-1` - Take available space\n\n### Flexbox Tricks\n- `flex-shrink-0` - Prevent shrinking\n- `flex-1 min-w-0` - Flexible with truncation\n- `gap-2 sm:gap-4` - Responsive gaps\n\n## ğŸ“Š Breakpoint Strategy\n\n### Mobile (Default)\n- 320px - 640px\n- Single column layouts\n- Compact spacing\n- Hidden non-essential info\n- Bottom sheet modals\n\n### Tablet (sm:)\n- 640px+\n- 2-column grids\n- Increased spacing\n- More information visible\n- Standard modals\n\n### Desktop (lg:)\n- 1024px+\n- 3-4 column grids\n- Table views\n- Full information\n- Side-by-side layouts\n\n### Large Desktop (xl:)\n- 1280px+\n- 4-5 column grids\n- Maximum content density\n\n## âœ… Testing Checklist\n\n### Mobile Devices (320px - 640px)\n- [x] Dashboard stats display correctly\n- [x] User cards are readable\n- [x] Post grid shows 2 columns\n- [x] Action buttons are touchable\n- [x] Modal slides from bottom\n- [x] Search bar is full width\n- [x] Text doesn't overflow\n\n### Tablet (640px - 1024px)\n- [x] Dashboard shows 2-3 columns\n- [x] User cards in better layout\n- [x] Post grid shows 3-4 columns\n- [x] Modal is centered\n- [x] Search bar with button\n\n### Desktop (1024px+)\n- [x] Dashboard shows 3-4 columns\n- [x] User table visible\n- [x] Post grid shows 4-5 columns\n- [x] All features visible\n- [x] Optimal spacing\n\n## ğŸ¯ Key Improvements\n\n### Before\n- âŒ Table overflow on mobile\n- âŒ Small touch targets\n- âŒ Text overflow issues\n- âŒ Fixed modal on mobile\n- âŒ Too many columns on mobile\n\n### After\n- âœ… Card layout on mobile\n- âœ… Touch-friendly (44px min)\n- âœ… Truncated text properly\n- âœ… Bottom sheet modal\n- âœ… 2-column grid on mobile\n- âœ… Readable text sizes\n- âœ… Smooth transitions\n- âœ… No horizontal scroll\n\n## ğŸš€ Performance\n\n### Optimizations\n- Conditional rendering (desktop/mobile)\n- Efficient grid layouts\n- CSS-only animations\n- No JS for layout changes\n- Tailwind's JIT mode\n\n## ğŸ“± Mobile UX Enhancements\n\n### Touch Interactions\n- Large tap targets (min 44x44px)\n- Proper spacing between buttons\n- No accidental taps\n- Smooth scrolling\n\n### Visual Hierarchy\n- Clear headings\n- Color-coded badges\n- Icon indicators\n- Status visibility\n\n### Information Architecture\n- Most important info first\n- Collapsible details\n- Progressive disclosure\n- Prioritized content\n\n## ğŸ¨ Theme Consistency\n\n### Maintained Design System\n- Same color palette\n- Consistent border radius\n- Unified shadows\n- Matching gradients\n- Dark mode support\n\n### Responsive Images\n- Aspect ratio maintained\n- Object-fit: cover\n- Lazy loading ready\n- Optimized sizes\n\n## ğŸ“ Code Quality\n\n### Best Practices\n- DRY (Don't Repeat Yourself)\n- Semantic HTML\n- Accessible markup\n- Clean class names\n- Logical component structure\n\n### Tailwind Best Practices\n- Mobile-first utilities\n- Consistent spacing scale\n- Reusable patterns\n- No arbitrary values\n- Semantic color names\n\n## ğŸ”„ Future Enhancements\n\n### Possible Improvements\n- [ ] Swipe gestures on mobile\n- [ ] Pull to refresh\n- [ ] Infinite scroll\n- [ ] Skeleton loaders\n- [ ] Image lazy loading\n- [ ] Virtual scrolling for large lists\n- [ ] Offline support\n- [ ] PWA features\n\n## ğŸ“Š Browser Support\n\n### Tested On\n- âœ… Chrome Mobile\n- âœ… Safari iOS\n- âœ… Firefox Mobile\n- âœ… Edge Mobile\n- âœ… Samsung Internet\n\n### CSS Features Used\n- Flexbox (full support)\n- Grid (full support)\n- Custom properties (full support)\n- Backdrop filter (partial support)\n- Aspect ratio (modern browsers)\n\n## ğŸ‰ Summary\n\nYour admin panel is now **fully mobile responsive**!\n\n### What Works Great\nâœ… Dashboard - Beautiful stats cards  \nâœ… User Management - Card view on mobile  \nâœ… Post Management - 2-column grid  \nâœ… Modals - Bottom sheet style  \nâœ… Navigation - Touch-friendly  \nâœ… Search - Full-width on mobile  \nâœ… Actions - Large tap targets  \n\n### Test It\n1. Open DevTools\n2. Toggle device toolbar (Ctrl+Shift+M)\n3. Test different screen sizes:\n   - iPhone SE (375px)\n   - iPhone 12 Pro (390px)\n   - iPad (768px)\n   - Desktop (1024px+)\n\nEnjoy your responsive admin panel! ğŸ¨ğŸ“±âœ¨\n","size_bytes":6558},"backend/routes/aiRoutes.js":{"content":"import express from 'express';\nimport { DeepSeekService } from '../services/deepseekService.js';\nimport { protect } from '../middleware/authMiddleware.js';\n\nconst router = express.Router();\n\n// Get AI caption suggestions\nrouter.post('/captions', protect, async (req, res) => {\n  try {\n    const { imageDescription } = req.body;\n    const captions = await DeepSeekService.generateCaptionSuggestions(imageDescription);\n    res.json({ success: true, captions });\n  } catch (error) {\n    res.status(500).json({ success: false, error: error.message });\n  }\n});\n\n// Get AI hashtag suggestions\nrouter.post('/hashtags', protect, async (req, res) => {\n  try {\n    const { content } = req.body;\n    const hashtags = await DeepSeekService.generateHashtags(content);\n    res.json({ success: true, hashtags });\n  } catch (error) {\n    res.status(500).json({ success: false, error: error.message });\n  }\n});\n\n// AI content moderation (admin only)\nrouter.post('/moderate', protect, async (req, res) => {\n  try {\n    const { text } = req.body;\n    const moderation = await DeepSeekService.moderateContent(text);\n    res.json({ success: true, moderation });\n  } catch (error) {\n    res.status(500).json({ success: false, error: error.message });\n  }\n});\n\n// Bio suggestions\nrouter.post('/bio-suggestions', protect, async (req, res) => {\n  try {\n    const { interests } = req.body;\n    const bios = await DeepSeekService.generateBioSuggestions(interests);\n    res.json({ success: true, bios });\n  } catch (error) {\n    res.status(500).json({ success: false, error: error.message });\n  }\n});\n\nexport default router;","size_bytes":1596},"backend/models/VideoCall.js":{"content":"import mongoose from 'mongoose';\n\nconst videoCallSchema = new mongoose.Schema(\n  {\n    caller: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    receiver: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    roomId: {\n      type: String,\n      required: true,\n      unique: true,\n    },\n    status: {\n      type: String,\n      enum: ['calling', 'ongoing', 'ended', 'missed', 'rejected'],\n      default: 'calling',\n    },\n    startedAt: {\n      type: Date,\n    },\n    endedAt: {\n      type: Date,\n    },\n    duration: {\n      type: Number, // in seconds\n      default: 0,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\nconst VideoCall = mongoose.model('VideoCall', videoCallSchema);\n\nexport default VideoCall;\n","size_bytes":801},"backend/config/cloudinary.js":{"content":"import { v2 as cloudinary } from 'cloudinary';\nimport multer from 'multer';\nimport dotenv from 'dotenv';\n\n// Load environment variables first\ndotenv.config();\n\n// Check if Cloudinary is configured\nconst isCloudinaryConfigured = \n  process.env.CLOUDINARY_CLOUD_NAME &&\n  process.env.CLOUDINARY_API_KEY &&\n  process.env.CLOUDINARY_API_SECRET;\n\nif (isCloudinaryConfigured) {\n  // Configure Cloudinary\n  cloudinary.config({\n    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n    api_key: process.env.CLOUDINARY_API_KEY,\n    api_secret: process.env.CLOUDINARY_API_SECRET,\n  });\n  console.log('âœ… Cloudinary configured successfully!');\n} else {\n  console.warn('âš ï¸  Cloudinary not configured - file uploads will be disabled');\n  console.warn('Get free credentials at: https://cloudinary.com/users/register_free');\n}\n\nexport { isCloudinaryConfigured };\n\n// Multer memory storage\nconst storage = multer.memoryStorage();\n\nexport const upload = multer({\n  storage,\n  limits: {\n    fileSize: 200 * 1024 * 1024, // 200MB limit\n  },\n  fileFilter: (req, file, cb) => {\n    if (\n      file.mimetype.startsWith('image/') ||\n      file.mimetype.startsWith('video/') ||\n      file.mimetype.startsWith('audio/') ||\n      file.mimetype.startsWith('application/')\n    ) {\n      cb(null, true);\n    } else {\n      cb(new Error('Only image, video, audio and document files are allowed!'), false);\n    }\n  },\n});\n\n// Multiple file upload (max 10 files)\nexport const uploadMultiple = multer({\n  storage,\n  limits: {\n    fileSize: 200 * 1024 * 1024,\n  },\n  fileFilter: (req, file, cb) => {\n    if (file.mimetype.startsWith('image/') || file.mimetype.startsWith('video/')) {\n      cb(null, true);\n    } else {\n      cb(new Error('Only image and video files are allowed!'), false);\n    }\n  },\n}).array('media', 10); // Max 10 files\n\n// Upload to Cloudinary\nexport const uploadToCloudinary = (fileBuffer, folder = 'friendflix') => {\n  if (!isCloudinaryConfigured) {\n    return Promise.reject(new Error('Cloudinary is not configured. Please set up your credentials.'));\n  }\n  \n  return new Promise((resolve, reject) => {\n    const uploadStream = cloudinary.uploader.upload_stream(\n      {\n        folder,\n        resource_type: 'auto',\n        transformation: [\n          { width: 1080, height: 1080, crop: 'limit' },\n          { quality: 'auto' },\n        ],\n      },\n      (error, result) => {\n        if (error) reject(error);\n        else resolve(result);\n      }\n    );\n    uploadStream.end(fileBuffer);\n  });\n};\n\nexport default cloudinary;\n","size_bytes":2519},"frontend/src/pages/LiveStream.jsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\nimport {\n  AiOutlineHeart,\n  AiFillHeart,\n  AiOutlineClose,\n  AiOutlineSend,\n  AiOutlineShareAlt,\n} from 'react-icons/ai';\nimport { BsPeople, BsThreeDots } from 'react-icons/bs';\n\nconst LiveStream = () => {\n  const { streamId } = useParams();\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  \n  const [stream, setStream] = useState(null);\n  const [comments, setComments] = useState([]);\n  const [newComment, setNewComment] = useState('');\n  const [viewerCount, setViewerCount] = useState(0);\n  const [isLiked, setIsLiked] = useState(false);\n  const [showShareMenu, setShowShareMenu] = useState(false);\n  \n  const videoRef = useRef(null);\n  const commentsEndRef = useRef(null);\n\n  useEffect(() => {\n    fetchStreamData();\n    joinStream();\n\n    // Socket listeners\n    socketService.on('streamComment', handleNewComment);\n    socketService.on('streamLike', handleNewLike);\n    socketService.on('viewerCountUpdate', handleViewerUpdate);\n    socketService.on('streamEnded', handleStreamEnded);\n\n    return () => {\n      leaveStream();\n      socketService.off('streamComment');\n      socketService.off('streamLike');\n      socketService.off('viewerCountUpdate');\n      socketService.off('streamEnded');\n    };\n  }, [streamId]);\n\n  const fetchStreamData = async () => {\n    // Simulated stream data\n    setStream({\n      id: streamId,\n      host: {\n        id: '123',\n        username: 'creator_username',\n        avatar: 'https://ui-avatars.com/api/?name=Creator',\n        isVerified: true,\n      },\n      title: 'Amazing Live Stream! ğŸ”¥',\n      viewerCount: 1234,\n      likes: 567,\n      isLive: true,\n      startedAt: new Date(),\n    });\n    setViewerCount(1234);\n  };\n\n  const joinStream = () => {\n    socketService.emit('joinLiveStream', { streamId, userId: user._id });\n    toast.success('Joined live stream!');\n  };\n\n  const leaveStream = () => {\n    socketService.emit('leaveLiveStream', { streamId, userId: user._id });\n  };\n\n  const handleNewComment = (comment) => {\n    setComments((prev) => [...prev, comment]);\n    scrollToBottom();\n  };\n\n  const handleNewLike = () => {\n    // Animation for new like\n    const heart = document.createElement('div');\n    heart.innerHTML = 'â¤ï¸';\n    heart.className = 'floating-heart';\n    heart.style.left = `${Math.random() * 80 + 10}%`;\n    document.getElementById('hearts-container')?.appendChild(heart);\n    \n    setTimeout(() => heart.remove(), 3000);\n  };\n\n  const handleViewerUpdate = (count) => {\n    setViewerCount(count);\n  };\n\n  const handleStreamEnded = () => {\n    toast.error('Stream has ended');\n    setTimeout(() => navigate('/'), 2000);\n  };\n\n  const scrollToBottom = () => {\n    commentsEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const sendComment = (e) => {\n    e.preventDefault();\n    if (!newComment.trim()) return;\n\n    const comment = {\n      user: {\n        username: user.username,\n        avatar: user.avatar,\n      },\n      text: newComment,\n      timestamp: new Date(),\n    };\n\n    socketService.emit('sendStreamComment', { streamId, comment });\n    setComments([...comments, comment]);\n    setNewComment('');\n    scrollToBottom();\n  };\n\n  const sendLike = () => {\n    socketService.emit('sendStreamLike', { streamId, userId: user._id });\n    setIsLiked(true);\n    handleNewLike();\n    \n    setTimeout(() => setIsLiked(false), 1000);\n  };\n\n  return (\n    <div className=\"h-screen bg-black flex flex-col md:flex-row\">\n      {/* Video Section */}\n      <div className=\"flex-1 relative\">\n        {/* Live Video Stream (Placeholder) */}\n        <div className=\"w-full h-full bg-gradient-to-br from-purple-900 via-pink-900 to-black flex items-center justify-center\">\n          <div className=\"text-center text-white\">\n            <div className=\"text-6xl mb-4\">ğŸ“¡</div>\n            <p className=\"text-2xl font-bold mb-2\">LIVE STREAM</p>\n            <p className=\"text-purple-200\">Video stream would appear here</p>\n          </div>\n        </div>\n\n        {/* Floating Hearts Container */}\n        <div id=\"hearts-container\" className=\"absolute inset-0 pointer-events-none overflow-hidden\"></div>\n\n        {/* Live Badge */}\n        <div className=\"absolute top-4 left-4 flex items-center space-x-2\">\n          <div className=\"bg-red-500 px-4 py-2 rounded-full flex items-center space-x-2 animate-pulse shadow-glow\">\n            <div className=\"w-3 h-3 bg-white rounded-full animate-ping\"></div>\n            <span className=\"text-white font-bold\">LIVE</span>\n          </div>\n          \n          <div className=\"bg-black/70 backdrop-blur-lg px-4 py-2 rounded-full flex items-center space-x-2\">\n            <BsPeople className=\"text-white\" />\n            <span className=\"text-white font-bold\">{viewerCount.toLocaleString()}</span>\n          </div>\n        </div>\n\n        {/* Host Info */}\n        <div className=\"absolute top-4 right-4 left-4 md:left-auto flex items-center justify-between md:justify-end space-x-3\">\n          <div className=\"flex items-center space-x-3 bg-black/70 backdrop-blur-lg rounded-full px-4 py-2\">\n            <img\n              src={stream?.host.avatar}\n              alt={stream?.host.username}\n              className=\"w-8 h-8 rounded-full border-2 border-white\"\n            />\n            <div>\n              <p className=\"text-white font-bold text-sm\">@{stream?.host.username}</p>\n            </div>\n          </div>\n          \n          <button\n            onClick={() => navigate('/')}\n            className=\"bg-black/70 backdrop-blur-lg p-2 rounded-full hover:bg-black/90 transition\"\n          >\n            <AiOutlineClose className=\"text-white\" size={24} />\n          </button>\n        </div>\n\n        {/* Title */}\n        <div className=\"absolute bottom-20 left-4 right-4\">\n          <p className=\"text-white text-lg font-semibold bg-black/50 backdrop-blur-lg rounded-2xl px-4 py-2\">\n            {stream?.title}\n          </p>\n        </div>\n\n        {/* Like Button */}\n        <button\n          onClick={sendLike}\n          className={`absolute bottom-32 right-4 w-16 h-16 rounded-full flex items-center justify-center transition-all ${\n            isLiked\n              ? 'bg-red-500 scale-125'\n              : 'bg-white/20 backdrop-blur-lg hover:scale-110'\n          }`}\n        >\n          {isLiked ? (\n            <AiFillHeart className=\"text-white\" size={32} />\n          ) : (\n            <AiOutlineHeart className=\"text-white\" size={32} />\n          )}\n        </button>\n\n        {/* Share Button (Mobile) */}\n        <button\n          onClick={() => setShowShareMenu(!showShareMenu)}\n          className=\"md:hidden absolute bottom-32 left-4 w-12 h-12 bg-white/20 backdrop-blur-lg rounded-full flex items-center justify-center hover:scale-110 transition\"\n        >\n          <AiOutlineShareAlt className=\"text-white\" size={24} />\n        </button>\n      </div>\n\n      {/* Comments Section (Desktop Sidebar / Mobile Bottom) */}\n      <div className=\"md:w-96 bg-black/90 backdrop-blur-lg border-t md:border-l border-white/10 flex flex-col max-h-64 md:max-h-screen\">\n        {/* Comments Header */}\n        <div className=\"p-4 border-b border-white/10\">\n          <h3 className=\"text-white font-bold text-lg\">Live Chat</h3>\n          <p className=\"text-gray-400 text-sm\">{comments.length} messages</p>\n        </div>\n\n        {/* Comments List */}\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-3 scrollbar-hide\">\n          {comments.map((comment, index) => (\n            <div key={index} className=\"flex items-start space-x-2 animate-fadeIn\">\n              <img\n                src={comment.user.avatar}\n                alt={comment.user.username}\n                className=\"w-8 h-8 rounded-full flex-shrink-0\"\n              />\n              <div className=\"flex-1\">\n                <p className=\"text-sm\">\n                  <span className=\"text-purple-400 font-semibold\">\n                    @{comment.user.username}\n                  </span>\n                  <span className=\"text-white ml-2\">{comment.text}</span>\n                </p>\n              </div>\n            </div>\n          ))}\n          <div ref={commentsEndRef} />\n        </div>\n\n        {/* Comment Input */}\n        <form onSubmit={sendComment} className=\"p-4 border-t border-white/10\">\n          <div className=\"flex items-center space-x-2\">\n            <input\n              type=\"text\"\n              value={newComment}\n              onChange={(e) => setNewComment(e.target.value)}\n              placeholder=\"Say something...\"\n              className=\"flex-1 bg-white/10 text-white placeholder-gray-400 px-4 py-3 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500\"\n              maxLength={200}\n            />\n            <button\n              type=\"submit\"\n              disabled={!newComment.trim()}\n              className={`p-3 rounded-full transition-all ${\n                newComment.trim()\n                  ? 'bg-gradient-primary shadow-glow hover:scale-110'\n                  : 'bg-gray-700 cursor-not-allowed'\n              }`}\n            >\n              <AiOutlineSend className=\"text-white\" size={20} />\n            </button>\n          </div>\n        </form>\n      </div>\n\n      {/* Floating Hearts Animation CSS */}\n      <style jsx>{`\n        .floating-heart {\n          position: absolute;\n          bottom: 0;\n          font-size: 2rem;\n          animation: floatUp 3s ease-out forwards;\n          pointer-events: none;\n        }\n        \n        @keyframes floatUp {\n          0% {\n            bottom: 0;\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n          100% {\n            bottom: 100%;\n            opacity: 0;\n            transform: translateY(-100px) scale(1.5);\n          }\n        }\n      `}</style>\n    </div>\n  );\n};\n\nexport default LiveStream;\n","size_bytes":10018},"backend/socket/socket.js":{"content":"import { Server } from 'socket.io';\nimport jwt from 'jsonwebtoken';\n\nconst initializeSocket = (server) => {\n  const io = new Server(server, {\n    cors: {\n      origin: process.env.FRONTEND_URL || 'http://localhost:5173',\n      credentials: true,\n    },\n  });\n\n  // Store online users\n  const onlineUsers = new Map();\n\n  // Authentication middleware\n  io.use((socket, next) => {\n    const token = socket.handshake.auth.token;\n    \n    if (!token) {\n      return next(new Error('Authentication error'));\n    }\n\n    try {\n      const decoded = jwt.verify(token, process.env.JWT_SECRET);\n      socket.userId = decoded.id;\n      next();\n    } catch (error) {\n      next(new Error('Authentication error'));\n    }\n  });\n\n  io.on('connection', (socket) => {\n    console.log(`âœ… User connected: ${socket.userId}`);\n\n    // Join user to their own room\n    socket.join(socket.userId);\n    onlineUsers.set(socket.userId, socket.id);\n\n    // Emit online users count\n    io.emit('onlineUsers', onlineUsers.size);\n    \n    // Notify all users that this user is online\n    io.emit('userOnline', socket.userId);\n\n    // Handle user typing in chat\n    socket.on('typing', (data) => {\n      const { receiverId } = data;\n      if (receiverId) {\n        io.to(receiverId).emit('typing', socket.userId);\n      }\n    });\n\n    // Handle call signaling\n    socket.on('call:join', ({ roomId }) => {\n      if (roomId) {\n        socket.join(roomId);\n        io.to(roomId).emit('call:participant', { userId: socket.userId });\n      }\n    });\n\n    socket.on('call:offer', ({ roomId, offer, from }) => {\n      if (roomId && offer) {\n        io.to(roomId).emit('call:offer', { offer, from });\n      }\n    });\n\n    socket.on('call:answer', ({ roomId, answer, from }) => {\n      if (roomId && answer) {\n        io.to(roomId).emit('call:answer', { answer, from });\n      }\n    });\n\n    socket.on('call:ice-candidate', ({ roomId, candidate }) => {\n      if (roomId && candidate) {\n        io.to(roomId).emit('call:ice-candidate', { candidate });\n      }\n    });\n\n    socket.on('endCall', ({ roomId }) => {\n      if (roomId) {\n        io.to(roomId).emit('endCall');\n      }\n    });\n\n    // Call invite/decline forwarding\n    socket.on('call:invite', ({ to, roomId, type, from }) => {\n      if (to && roomId) {\n        io.to(to).emit('call:invite', { roomId, type, from });\n      }\n    });\n\n    socket.on('call:decline', ({ to, roomId, from }) => {\n      if (to && roomId) {\n        io.to(to).emit('call:decline', { roomId, from });\n      }\n    });\n    socket.on('disconnect', () => {\n      console.log(`âŒ User disconnected: ${socket.userId}`);\n      onlineUsers.delete(socket.userId);\n      io.emit('onlineUsers', onlineUsers.size);\n      \n      // Notify all users that this user is offline\n      io.emit('userOffline', socket.userId);\n    });\n  });\n\n  return io;\n};\n\nexport default initializeSocket;\n","size_bytes":2868},"frontend/src/components/VerifiedBadge.jsx":{"content":"import { BsPatchCheckFill } from 'react-icons/bs';\n\nconst VerifiedBadge = ({ size = 'md', className = '' }) => {\n  const sizes = {\n    sm: 'w-4 h-4',\n    md: 'w-5 h-5',\n    lg: 'w-6 h-6',\n    xl: 'w-8 h-8',\n  };\n\n  return (\n    <BsPatchCheckFill\n      className={`text-blue-500 inline-block ${sizes[size]} ${className}`}\n      title=\"Verified Account\"\n    />\n  );\n};\n\nexport default VerifiedBadge;\n","size_bytes":398},"backend/routes/trendingRoutes.js":{"content":"import express from 'express';\nimport {\n  getTrendingVideos,\n  getTrendingReels,\n  getTrendingHashtags,\n  getTrendingCreators,\n} from '../controllers/trendingController.js';\n\nconst router = express.Router();\n\nrouter.get('/videos', getTrendingVideos);\nrouter.get('/reels', getTrendingReels);\nrouter.get('/hashtags', getTrendingHashtags);\nrouter.get('/creators', getTrendingCreators);\n\nexport default router;\n","size_bytes":407},"backend/routes/adminRoutes.js":{"content":"import express from 'express';\nimport {\n  getDashboardStats,\n  getAllUsers,\n  getAllPosts,\n  deleteUser,\n  deletePost,\n  toggleBanUser,\n  toggleVerifyUser,\n  changeUserRole,\n  getReports,\n  adminSearch,\n  getRoleRequests,\n  approveRoleRequest,\n  declineRoleRequest,\n} from '../controllers/adminController.js';\nimport { protect } from '../middleware/authMiddleware.js';\nimport { adminOnly } from '../middleware/adminMiddleware.js';\n\nconst router = express.Router();\n\n// Apply auth and admin middleware to all routes\nrouter.use(protect);\nrouter.use(adminOnly);\n\n// Dashboard\nrouter.get('/stats', getDashboardStats);\n\n// Users Management\nrouter.get('/users', getAllUsers);\nrouter.delete('/users/:userId', deleteUser);\nrouter.put('/users/:userId/ban', toggleBanUser);\nrouter.put('/users/:userId/verify', toggleVerifyUser);\nrouter.put('/users/:userId/role', changeUserRole);\n\n// Posts Management\nrouter.get('/posts', getAllPosts);\nrouter.delete('/posts/:postId', deletePost);\n\n// Reports\nrouter.get('/reports', getReports);\n\n// Role upgrade requests\nrouter.get('/role-requests', getRoleRequests);\nrouter.post('/role-requests/:userId/approve', approveRoleRequest);\nrouter.post('/role-requests/:userId/decline', declineRoleRequest);\n\n// Search\nrouter.get('/search', adminSearch);\n\nexport default router;\n","size_bytes":1297},"backend/controllers/watchLaterController.js":{"content":"import WatchLater from '../models/WatchLater.js';\nimport Post from '../models/Post.js';\n\n// @desc    Add video to Watch Later\n// @route   POST /api/watchlater/:postId\n// @access  Private\nexport const addToWatchLater = async (req, res) => {\n  try {\n    const post = await Post.findById(req.params.postId);\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Video not found' });\n    }\n\n    let watchLater = await WatchLater.findOne({ user: req.user._id });\n\n    if (!watchLater) {\n      watchLater = await WatchLater.create({\n        user: req.user._id,\n        videos: [{ post: req.params.postId }],\n      });\n    } else {\n      const alreadyExists = watchLater.videos.some(\n        (v) => v.post.toString() === req.params.postId\n      );\n\n      if (alreadyExists) {\n        return res.status(400).json({ success: false, message: 'Video already in Watch Later' });\n      }\n\n      watchLater.videos.unshift({ post: req.params.postId });\n      await watchLater.save();\n    }\n\n    res.json({ success: true, watchLater });\n  } catch (error) {\n    console.error('Error adding to Watch Later:', error);\n    res.status(500).json({ success: false, message: 'Failed to add video' });\n  }\n};\n\n// @desc    Remove video from Watch Later\n// @route   DELETE /api/watchlater/:postId\n// @access  Private\nexport const removeFromWatchLater = async (req, res) => {\n  try {\n    const watchLater = await WatchLater.findOne({ user: req.user._id });\n\n    if (!watchLater) {\n      return res.status(404).json({ success: false, message: 'Watch Later list not found' });\n    }\n\n    watchLater.videos = watchLater.videos.filter(\n      (v) => v.post.toString() !== req.params.postId\n    );\n\n    await watchLater.save();\n\n    res.json({ success: true, watchLater });\n  } catch (error) {\n    console.error('Error removing from Watch Later:', error);\n    res.status(500).json({ success: false, message: 'Failed to remove video' });\n  }\n};\n\n// @desc    Get Watch Later videos\n// @route   GET /api/watchlater\n// @access  Private\nexport const getWatchLater = async (req, res) => {\n  try {\n    const watchLater = await WatchLater.findOne({ user: req.user._id })\n      .populate({\n        path: 'videos.post',\n        populate: { path: 'author', select: 'username profilePicture verified' },\n      });\n\n    if (!watchLater) {\n      return res.json({ success: true, videos: [] });\n    }\n\n    res.json({ success: true, videos: watchLater.videos });\n  } catch (error) {\n    console.error('Error fetching Watch Later:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch Watch Later' });\n  }\n};\n\n// @desc    Clear Watch Later\n// @route   DELETE /api/watchlater\n// @access  Private\nexport const clearWatchLater = async (req, res) => {\n  try {\n    const watchLater = await WatchLater.findOne({ user: req.user._id });\n\n    if (!watchLater) {\n      return res.status(404).json({ success: false, message: 'Watch Later list not found' });\n    }\n\n    watchLater.videos = [];\n    await watchLater.save();\n\n    res.json({ success: true, message: 'Watch Later cleared' });\n  } catch (error) {\n    console.error('Error clearing Watch Later:', error);\n    res.status(500).json({ success: false, message: 'Failed to clear Watch Later' });\n  }\n};\n","size_bytes":3246},"frontend/src/components/ErrorBoundary.jsx":{"content":"import { Component } from 'react';\n\nclass ErrorBoundary extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.error('Error caught by boundary:', error, errorInfo);\n    // You can log to an error reporting service here\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50 px-4\">\n          <div className=\"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center\">\n            <div className=\"text-6xl mb-4\">ğŸ˜”</div>\n            <h1 className=\"text-2xl font-bold text-gray-800 mb-2\">\n              Oops! Something went wrong\n            </h1>\n            <p className=\"text-gray-600 mb-6\">\n              We're sorry for the inconvenience. Please try refreshing the page.\n            </p>\n            <button\n              onClick={() => window.location.reload()}\n              className=\"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition\"\n            >\n              Refresh Page\n            </button>\n            {process.env.NODE_ENV === 'development' && (\n              <details className=\"mt-4 text-left\">\n                <summary className=\"cursor-pointer text-sm text-gray-500\">\n                  Error Details\n                </summary>\n                <pre className=\"mt-2 text-xs bg-gray-100 p-2 rounded overflow-auto\">\n                  {this.state.error?.toString()}\n                </pre>\n              </details>\n            )}\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n","size_bytes":1783},"backend/models/Notification.js":{"content":"import mongoose from 'mongoose';\n\nconst notificationSchema = new mongoose.Schema(\n  {\n    recipient: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    sender: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    type: {\n      type: String,\n      enum: ['like', 'comment', 'follow', 'mention', 'group_message'],\n      required: true,\n    },\n    post: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Post',\n    },\n    group: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Group',\n    },\n    comment: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Comment',\n    },\n    message: {\n      type: String,\n      required: true,\n    },\n    read: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\nnotificationSchema.index({ recipient: 1, createdAt: -1 });\nnotificationSchema.index({ read: 1 });\n\nconst Notification = mongoose.model('Notification', notificationSchema);\n\nexport default Notification;\n","size_bytes":1082},"frontend/src/components/AICaptionHelper.jsx":{"content":"import { useState } from 'react';\nimport { aiService } from '../services/aiService';\nimport { Sparkles, Copy, Check } from 'lucide-react';\n\nconst AICaptionHelper = ({ onCaptionSelect, imageDescription }) => {\n  const [suggestions, setSuggestions] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [copiedIndex, setCopiedIndex] = useState(null);\n\n  const generateSuggestions = async () => {\n    setLoading(true);\n    try {\n      const response = await aiService.getCaptionSuggestions(imageDescription);\n      setSuggestions(response.captions || []);\n    } catch (error) {\n      console.error('Failed to generate suggestions:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const copyToClipboard = (text, index) => {\n    navigator.clipboard.writeText(text);\n    setCopiedIndex(index);\n    setTimeout(() => setCopiedIndex(null), 2000);\n  };\n\n  return (\n    <div className=\"bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border border-purple-200\">\n      <div className=\"flex items-center gap-2 mb-3\">\n        <Sparkles className=\"w-5 h-5 text-purple-600\" />\n        <h3 className=\"font-semibold text-purple-900\">AI Caption Assistant</h3>\n      </div>\n      \n      <button\n        onClick={generateSuggestions}\n        disabled={loading}\n        className=\"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-2 px-4 rounded-lg font-medium hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50\"\n      >\n        {loading ? 'Generating...' : 'âœ¨ Generate Caption Ideas'}\n      </button>\n\n      {suggestions.length > 0 && (\n        <div className=\"mt-4 space-y-3\">\n          <p className=\"text-sm text-gray-600\">Suggestions:</p>\n          {suggestions.map((caption, index) => (\n            <div key={index} className=\"flex items-center justify-between bg-white p-3 rounded-lg border\">\n              <p className=\"text-sm flex-1\">{caption}</p>\n              <div className=\"flex gap-2 ml-3\">\n                <button\n                  onClick={() => onCaptionSelect(caption)}\n                  className=\"text-purple-600 hover:text-purple-800 text-sm font-medium\"\n                >\n                  Use\n                </button>\n                <button\n                  onClick={() => copyToClipboard(caption, index)}\n                  className=\"text-gray-500 hover:text-gray-700\"\n                >\n                  {copiedIndex === index ? <Check className=\"w-4 h-4\" /> : <Copy className=\"w-4 h-4\" />}\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AICaptionHelper;","size_bytes":2638},"backend/models/Playlist.js":{"content":"import mongoose from 'mongoose';\n\nconst playlistSchema = new mongoose.Schema(\n  {\n    title: {\n      type: String,\n      required: [true, 'Playlist title is required'],\n      trim: true,\n      maxlength: [100, 'Title cannot exceed 100 characters'],\n    },\n    description: {\n      type: String,\n      trim: true,\n      maxlength: [500, 'Description cannot exceed 500 characters'],\n      default: '',\n    },\n    creator: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    videos: [\n      {\n        post: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'Post',\n          required: true,\n        },\n        addedAt: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n    thumbnail: {\n      type: String,\n      default: '',\n    },\n    visibility: {\n      type: String,\n      enum: ['public', 'private', 'unlisted'],\n      default: 'public',\n    },\n    videoCount: {\n      type: Number,\n      default: 0,\n    },\n    views: {\n      type: Number,\n      default: 0,\n    },\n    lastUpdated: {\n      type: Date,\n      default: Date.now,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\nplaylistSchema.pre('save', function (next) {\n  this.videoCount = this.videos.length;\n  this.lastUpdated = Date.now();\n  next();\n});\n\nconst Playlist = mongoose.model('Playlist', playlistSchema);\n\nexport default Playlist;\n","size_bytes":1386},"frontend/src/components/PullToRefresh.jsx":{"content":"import { useState, useRef } from 'react';\nimport { AiOutlineLoading3Quarters } from 'react-icons/ai';\n\nconst PullToRefresh = ({ onRefresh, children }) => {\n  const [pulling, setPulling] = useState(false);\n  const [refreshing, setRefreshing] = useState(false);\n  const [pullDistance, setPullDistance] = useState(0);\n  const startY = useRef(0);\n  const currentY = useRef(0);\n\n  const handleTouchStart = (e) => {\n    if (window.scrollY === 0) {\n      startY.current = e.touches[0].clientY;\n    }\n  };\n\n  const handleTouchMove = (e) => {\n    if (startY.current === 0 || refreshing) return;\n\n    currentY.current = e.touches[0].clientY;\n    const distance = currentY.current - startY.current;\n\n    if (distance > 0 && window.scrollY === 0) {\n      setPulling(true);\n      setPullDistance(Math.min(distance, 100));\n    }\n  };\n\n  const handleTouchEnd = async () => {\n    if (pullDistance > 60 && !refreshing) {\n      setRefreshing(true);\n      try {\n        await onRefresh();\n      } catch (error) {\n        console.error('Refresh failed:', error);\n      } finally {\n        setRefreshing(false);\n      }\n    }\n    \n    setPulling(false);\n    setPullDistance(0);\n    startY.current = 0;\n  };\n\n  return (\n    <div\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n      className=\"relative\"\n    >\n      {/* Pull Indicator */}\n      {(pulling || refreshing) && (\n        <div\n          className=\"absolute top-0 left-0 right-0 flex items-center justify-center transition-all\"\n          style={{\n            transform: `translateY(${pulling ? pullDistance - 60 : 0}px)`,\n            opacity: pulling ? pullDistance / 60 : 1,\n          }}\n        >\n          <div className=\"bg-white dark:bg-gray-800 rounded-full p-3 shadow-lg\">\n            <AiOutlineLoading3Quarters\n              size={24}\n              className={`text-primary ${refreshing ? 'animate-spin' : ''}`}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Content */}\n      <div\n        style={{\n          transform: `translateY(${pulling ? pullDistance : 0}px)`,\n          transition: pulling ? 'none' : 'transform 0.3s ease',\n        }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n};\n\nexport default PullToRefresh;\n","size_bytes":2258},"frontend/dev-dist/sw.js":{"content":"/**\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *     http://www.apache.org/licenses/LICENSE-2.0\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// If the loader is already loaded, just stop.\nif (!self.define) {\n  let registry = {};\n\n  // Used for `eval` and `importScripts` where we can't get script URL by other means.\n  // In both cases, it's safe to use a global var because those functions are synchronous.\n  let nextDefineUri;\n\n  const singleRequire = (uri, parentUri) => {\n    uri = new URL(uri + \".js\", parentUri).href;\n    return registry[uri] || (\n      \n        new Promise(resolve => {\n          if (\"document\" in self) {\n            const script = document.createElement(\"script\");\n            script.src = uri;\n            script.onload = resolve;\n            document.head.appendChild(script);\n          } else {\n            nextDefineUri = uri;\n            importScripts(uri);\n            resolve();\n          }\n        })\n      \n      .then(() => {\n        let promise = registry[uri];\n        if (!promise) {\n          throw new Error(`Module ${uri} didnâ€™t register its module`);\n        }\n        return promise;\n      })\n    );\n  };\n\n  self.define = (depsNames, factory) => {\n    const uri = nextDefineUri || (\"document\" in self ? document.currentScript.src : \"\") || location.href;\n    if (registry[uri]) {\n      // Module is already loading or loaded.\n      return;\n    }\n    let exports = {};\n    const require = depUri => singleRequire(depUri, uri);\n    const specialDeps = {\n      module: { uri },\n      exports,\n      require\n    };\n    registry[uri] = Promise.all(depsNames.map(\n      depName => specialDeps[depName] || require(depName)\n    )).then(deps => {\n      factory(...deps);\n      return exports;\n    });\n  };\n}\ndefine(['./workbox-54d0af47'], (function (workbox) { 'use strict';\n\n  self.skipWaiting();\n  workbox.clientsClaim();\n\n  /**\n   * The precacheAndRoute() method efficiently caches and responds to\n   * requests for URLs in the manifest.\n   * See https://goo.gl/S9QRab\n   */\n  workbox.precacheAndRoute([{\n    \"url\": \"registerSW.js\",\n    \"revision\": \"3ca0b8505b4bec776b69afdba2768812\"\n  }, {\n    \"url\": \"index.html\",\n    \"revision\": \"0.foeqk3br2vo\"\n  }], {});\n  workbox.cleanupOutdatedCaches();\n  workbox.registerRoute(new workbox.NavigationRoute(workbox.createHandlerBoundToURL(\"index.html\"), {\n    allowlist: [/^\\/$/]\n  }));\n\n}));\n","size_bytes":2839},"backend/middleware/authMiddleware.js":{"content":"import jwt from 'jsonwebtoken';\nimport User from '../models/User.js';\n\nexport const protect = async (req, res, next) => {\n  try {\n    let token;\n\n    // Check if token exists in headers\n    if (\n      req.headers.authorization &&\n      req.headers.authorization.startsWith('Bearer')\n    ) {\n      token = req.headers.authorization.split(' ')[1];\n    }\n\n    if (!token) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized, no token provided',\n      });\n    }\n\n    try {\n      // Verify token\n      const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n      // Get user from token\n      req.user = await User.findById(decoded.id).select('-password');\n\n      if (!req.user) {\n        return res.status(401).json({\n          success: false,\n          message: 'User not found',\n        });\n      }\n\n      next();\n    } catch (error) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized, token failed',\n      });\n    }\n  } catch (error) {\n    return res.status(500).json({\n      success: false,\n      message: 'Server error in auth middleware',\n    });\n  }\n};\n\n// Generate JWT Token\nexport const generateToken = (id) => {\n  return jwt.sign({ id }, process.env.JWT_SECRET, {\n    expiresIn: '30d',\n  });\n};\n","size_bytes":1292},"backend/middleware/adminMiddleware.js":{"content":"// Admin authorization middleware\nexport const adminOnly = (req, res, next) => {\n  if (req.user && req.user.role === 'admin') {\n    next();\n  } else {\n    res.status(403).json({\n      success: false,\n      message: 'Access denied. Admin only.',\n    });\n  }\n};\n\n// Creator or Admin\nexport const creatorOrAdmin = (req, res, next) => {\n  if (req.user && (req.user.role === 'admin' || req.user.role === 'creator')) {\n    next();\n  } else {\n    res.status(403).json({\n      success: false,\n      message: 'Access denied. Creator or Admin only.',\n    });\n  }\n};\n","size_bytes":556},"backend/routes/noteRoutes.js":{"content":"import express from 'express';\nimport {\n  createNote,\n  getUserNotes,\n  getsubscribedNotes,\n  deleteNote,\n  likeNote,\n  replyToNote,\n} from '../controllers/noteController.js';\nimport { protect } from '../middleware/authMiddleware.js';\n\nconst router = express.Router();\n\nrouter.post('/', protect, createNote);\nrouter.get('/user/:userId', getUserNotes);\nrouter.get('/subscribed', protect, getsubscribedNotes);\nrouter.delete('/:id', protect, deleteNote);\nrouter.post('/:id/like', protect, likeNote);\nrouter.post('/:id/reply', protect, replyToNote);\n\nexport default router;\n","size_bytes":567},"frontend/src/pages/AdminUsers.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { Navigate, Link } from 'react-router-dom';\nimport { adminAPI } from '../services/adminAPI';\nimport toast from 'react-hot-toast';\nimport {\n  FiUsers,\n  FiSearch,\n  FiTrash2,\n  FiShield,\n  FiCheckCircle,\n  FiXCircle,\n  FiArrowLeft,\n  FiChevronLeft,\n  FiChevronRight,\n} from 'react-icons/fi';\n\nconst AdminUsers = () => {\n  const { user } = useAuth();\n  const [users, setUsers] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [total, setTotal] = useState(0);\n  const [roleRequests, setRoleRequests] = useState([]);\n\n  useEffect(() => {\n    if (user?.role === 'admin') {\n      fetchUsers();\n      fetchRoleRequests();\n    }\n  }, [user, currentPage]);\n\n  const fetchUsers = async () => {\n    try {\n      setLoading(true);\n      const response = await adminAPI.getAllUsers(currentPage, 20);\n      setUsers(response.data.data.users);\n      setTotalPages(response.data.data.totalPages);\n      setTotal(response.data.data.total);\n    } catch (error) {\n      toast.error('Failed to fetch users');\n      console.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchRoleRequests = async () => {\n    try {\n      const response = await adminAPI.getRoleRequests(1, 20);\n      setRoleRequests(response.data.data.users || []);\n    } catch (error) {\n      console.error('Failed to load role requests:', error);\n    }\n  };\n\n  const handleSearch = async () => {\n    if (!searchQuery.trim()) {\n      fetchUsers();\n      return;\n    }\n\n    try {\n      setLoading(true);\n      const response = await adminAPI.adminSearch(searchQuery, 'users');\n      setUsers(response.data.data);\n    } catch (error) {\n      toast.error('Search failed');\n      console.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleApproveRequest = async (userId) => {\n    try {\n      await adminAPI.approveRoleRequest(userId);\n      toast.success('User upgraded to creator');\n      fetchRoleRequests();\n      fetchUsers();\n    } catch (error) {\n      toast.error('Failed to approve request');\n    }\n  };\n\n  const handleDeclineRequest = async (userId) => {\n    try {\n      await adminAPI.declineRoleRequest(userId);\n      toast.success('Request declined');\n      fetchRoleRequests();\n    } catch (error) {\n      toast.error('Failed to decline request');\n    }\n  };\n\n  const handleDeleteUser = async (userId, username) => {\n    if (!confirm(`Are you sure you want to delete user @${username}? This action cannot be undone.`)) {\n      return;\n    }\n\n    try {\n      await adminAPI.deleteUser(userId);\n      toast.success('User deleted successfully');\n      fetchUsers();\n    } catch (error) {\n      toast.error('Failed to delete user');\n      console.error(error);\n    }\n  };\n\n  const handleToggleBan = async (userId, isBanned, username) => {\n    try {\n      await adminAPI.toggleBanUser(userId);\n      toast.success(`User @${username} ${isBanned ? 'unbanned' : 'banned'} successfully`);\n      fetchUsers();\n    } catch (error) {\n      toast.error('Failed to update user status');\n      console.error(error);\n    }\n  };\n\n  const handleToggleVerify = async (userId, isVerified, username) => {\n    try {\n      await adminAPI.toggleVerifyUser(userId);\n      toast.success(`User @${username} ${isVerified ? 'unverified' : 'verified'} successfully`);\n      fetchUsers();\n    } catch (error) {\n      toast.error('Failed to update verification status');\n      console.error(error);\n    }\n  };\n\n  const handleChangeRole = async (userId, currentRole, username) => {\n    const roles = ['user', 'creator', 'business', 'admin'];\n    const newRole = prompt(\n      `Change role for @${username}\\nCurrent role: ${currentRole}\\nEnter new role (user/creator/business/admin):`,\n      currentRole\n    );\n\n    if (!newRole || !roles.includes(newRole.toLowerCase()) || newRole === currentRole) {\n      return;\n    }\n\n    try {\n      await adminAPI.changeUserRole(userId, newRole.toLowerCase());\n      toast.success(`Role updated to ${newRole} for @${username}`);\n      fetchUsers();\n    } catch (error) {\n      toast.error('Failed to change user role');\n      console.error(error);\n    }\n  };\n\n  // Check if user is admin\n  if (!user || user.role !== 'admin') {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center flex-1 min-w-0\">\n              <Link\n                to=\"/admin\"\n                className=\"mr-2 sm:mr-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition flex-shrink-0\"\n              >\n                <FiArrowLeft className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-600 dark:text-gray-300\" />\n              </Link>\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white flex items-center\">\n                  <FiUsers className=\"mr-1 sm:mr-2 flex-shrink-0\" />\n                  <span className=\"truncate\">User Management</span>\n                </h1>\n                <p className=\"mt-1 text-xs sm:text-sm text-gray-500 dark:text-gray-400\">\n                  Total {total} users\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Search Bar */}\n          <div className=\"mt-4 sm:mt-6\">\n            <div className=\"flex gap-2\">\n              <div className=\"flex-1 relative\">\n                <FiSearch className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  onKeyPress={(e) => e.key === 'Enter' && handleSearch()}\n                  placeholder=\"Search users...\"\n                  className=\"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n              </div>\n              <button\n                onClick={handleSearch}\n                className=\"px-4 sm:px-6 py-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition flex-shrink-0\"\n              >\n                Search\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Role Requests Panel */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-4\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <h3 className=\"font-semibold\">Role Upgrade Requests</h3>\n            <span className=\"text-sm text-gray-500\">{roleRequests.length} pending</span>\n          </div>\n          {roleRequests.length === 0 ? (\n            <p className=\"text-sm text-gray-500\">No pending requests</p>\n          ) : (\n            <div className=\"space-y-3\">\n              {roleRequests.map((u) => (\n                <div key={u._id} className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <img src={u.avatar} alt={u.username} className=\"w-8 h-8 rounded-full\" />\n                    <div>\n                      <p className=\"text-sm font-semibold\">@{u.username}</p>\n                      {u.roleUpgradeReason && (\n                        <p className=\"text-xs text-gray-500\">Reason: {u.roleUpgradeReason}</p>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button onClick={() => handleApproveRequest(u._id)} className=\"px-3 py-1 bg-green-100 text-green-700 rounded\">Approve</button>\n                    <button onClick={() => handleDeclineRequest(u._id)} className=\"px-3 py-1 bg-red-100 text-red-700 rounded\">Decline</button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Users List */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8\">\n        {loading ? (\n          <div className=\"flex justify-center py-12\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n          </div>\n        ) : users.length === 0 ? (\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-12 text-center\">\n            <FiUsers className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">\n              No users found\n            </h3>\n            <p className=\"text-gray-500 dark:text-gray-400\">\n              Try adjusting your search criteria\n            </p>\n          </div>\n        ) : (\n          <>\n            {/* Desktop Table View */}\n            <div className=\"hidden lg:block bg-white dark:bg-gray-800 shadow overflow-hidden rounded-lg\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                  <thead className=\"bg-gray-50 dark:bg-gray-700\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                        User\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                        Email\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                        Role\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                        Stats\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                        Status\n                      </th>\n                      <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                        Actions\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\n                    {users.map((userData) => (\n                      <tr key={userData._id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"flex items-center\">\n                            <img\n                              src={userData.avatar}\n                              alt={userData.username}\n                              className=\"w-10 h-10 rounded-full object-cover\"\n                            />\n                            <div className=\"ml-4\">\n                              <div className=\"flex items-center\">\n                                <Link\n                                  to={`/profile/${userData.username}`}\n                                  className=\"text-sm font-medium text-gray-900 dark:text-white hover:text-blue-500\"\n                                >\n                                  {userData.fullName}\n                                </Link>\n                                {userData.isVerified && (\n                                  <FiCheckCircle className=\"w-4 h-4 text-blue-500 ml-1\" />\n                                )}\n                              </div>\n                              <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                                @{userData.username}\n                              </div>\n                            </div>\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"text-sm text-gray-900 dark:text-white\">\n                            {userData.email}\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <span\n                            className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${\n                              userData.role === 'admin'\n                                ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\n                                : userData.role === 'creator'\n                                ? 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200'\n                                : userData.role === 'business'\n                                ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'\n                                : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200'\n                            }`}\n                          >\n                            {userData.role}\n                          </span>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"text-sm text-gray-900 dark:text-white\">\n                            <div>Posts: {userData.posts?.length || 0}</div>\n                            <div>subscriber: {userData.subscriber?.length || 0}</div>\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          {userData.isBanned ? (\n                            <span className=\"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\">\n                              Banned\n                            </span>\n                          ) : (\n                            <span className=\"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">\n                              Active\n                            </span>\n                          )}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                          <div className=\"flex items-center justify-end gap-2\">\n                            <button\n                              onClick={() =>\n                                handleToggleVerify(userData._id, userData.isVerified, userData.username)\n                              }\n                              className={`p-2 rounded-lg transition ${\n                                userData.isVerified\n                                  ? 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600'\n                                  : 'bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800'\n                              }`}\n                              title={userData.isVerified ? 'Remove verification' : 'Verify user'}\n                            >\n                              <FiCheckCircle className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => handleChangeRole(userData._id, userData.role, userData.username)}\n                              className=\"p-2 bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-400 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-800 transition\"\n                              title=\"Change role\"\n                            >\n                              <FiShield className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() =>\n                                handleToggleBan(userData._id, userData.isBanned, userData.username)\n                              }\n                              className={`p-2 rounded-lg transition ${\n                                userData.isBanned\n                                  ? 'bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400 hover:bg-green-200 dark:hover:bg-green-800'\n                                  : 'bg-yellow-100 dark:bg-yellow-900 text-yellow-600 dark:text-yellow-400 hover:bg-yellow-200 dark:hover:bg-yellow-800'\n                              }`}\n                              title={userData.isBanned ? 'Unban user' : 'Ban user'}\n                            >\n                              <FiXCircle className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={() => handleDeleteUser(userData._id, userData.username)}\n                              className=\"p-2 bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-800 transition\"\n                              title=\"Delete user\"\n                            >\n                              <FiTrash2 className=\"w-4 h-4\" />\n                            </button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n\n            {/* Mobile Card View */}\n            <div className=\"lg:hidden space-y-4\">\n              {users.map((userData) => (\n                <div\n                  key={userData._id}\n                  className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-4\"\n                >\n                  {/* User Info */}\n                  <div className=\"flex items-start space-x-3 mb-4\">\n                    <img\n                      src={userData.avatar}\n                      alt={userData.username}\n                      className=\"w-12 h-12 rounded-full object-cover flex-shrink-0\"\n                    />\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center space-x-1\">\n                        <Link\n                          to={`/profile/${userData.username}`}\n                          className=\"text-sm font-semibold text-gray-900 dark:text-white hover:text-blue-500 truncate\"\n                        >\n                          {userData.fullName}\n                        </Link>\n                        {userData.isVerified && (\n                          <FiCheckCircle className=\"w-4 h-4 text-blue-500 flex-shrink-0\" />\n                        )}\n                      </div>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate\">\n                        @{userData.username}\n                      </p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate mt-1\">\n                        {userData.email}\n                      </p>\n                    </div>\n                  </div>\n\n                  {/* Stats and Status */}\n                  <div className=\"grid grid-cols-2 gap-3 mb-4\">\n                    <div className=\"bg-gray-50 dark:bg-gray-700 rounded p-2\">\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Role</p>\n                      <span\n                        className={`inline-block mt-1 px-2 py-0.5 text-xs font-semibold rounded-full ${\n                          userData.role === 'admin'\n                            ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\n                            : userData.role === 'creator'\n                            ? 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200'\n                            : userData.role === 'business'\n                            ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'\n                            : 'bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200'\n                        }`}\n                      >\n                        {userData.role}\n                      </span>\n                    </div>\n                    <div className=\"bg-gray-50 dark:bg-gray-700 rounded p-2\">\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Status</p>\n                      <span\n                        className={`inline-block mt-1 px-2 py-0.5 text-xs font-semibold rounded-full ${\n                          userData.isBanned\n                            ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\n                            : 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'\n                        }`}\n                      >\n                        {userData.isBanned ? 'Banned' : 'Active'}\n                      </span>\n                    </div>\n                    <div className=\"bg-gray-50 dark:bg-gray-700 rounded p-2\">\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Posts</p>\n                      <p className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n                        {userData.posts?.length || 0}\n                      </p>\n                    </div>\n                    <div className=\"bg-gray-50 dark:bg-gray-700 rounded p-2\">\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">subscriber</p>\n                      <p className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n                        {userData.subscriber?.length || 0}\n                      </p>\n                    </div>\n                  </div>\n\n                  {/* Action Buttons */}\n                  <div className=\"flex flex-wrap gap-2\">\n                    <button\n                      onClick={() =>\n                        handleToggleVerify(userData._id, userData.isVerified, userData.username)\n                      }\n                      className={`flex-1 min-w-[80px] px-3 py-2 rounded-lg transition text-xs font-medium flex items-center justify-center gap-1 ${\n                        userData.isVerified\n                          ? 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400'\n                          : 'bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400'\n                      }`}\n                    >\n                      <FiCheckCircle className=\"w-3 h-3\" />\n                      {userData.isVerified ? 'Verified' : 'Verify'}\n                    </button>\n                    <button\n                      onClick={() => handleChangeRole(userData._id, userData.role, userData.username)}\n                      className=\"flex-1 min-w-[80px] px-3 py-2 bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-400 rounded-lg transition text-xs font-medium flex items-center justify-center gap-1\"\n                    >\n                      <FiShield className=\"w-3 h-3\" />\n                      Role\n                    </button>\n                    <button\n                      onClick={() =>\n                        handleToggleBan(userData._id, userData.isBanned, userData.username)\n                      }\n                      className={`flex-1 min-w-[80px] px-3 py-2 rounded-lg transition text-xs font-medium flex items-center justify-center gap-1 ${\n                        userData.isBanned\n                          ? 'bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400'\n                          : 'bg-yellow-100 dark:bg-yellow-900 text-yellow-600 dark:text-yellow-400'\n                      }`}\n                    >\n                      <FiXCircle className=\"w-3 h-3\" />\n                      {userData.isBanned ? 'Unban' : 'Ban'}\n                    </button>\n                    <button\n                      onClick={() => handleDeleteUser(userData._id, userData.username)}\n                      className=\"flex-1 min-w-[80px] px-3 py-2 bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 rounded-lg transition text-xs font-medium flex items-center justify-center gap-1\"\n                    >\n                      <FiTrash2 className=\"w-3 h-3\" />\n                      Delete\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Pagination */}\n            {totalPages > 1 && (\n              <div className=\"mt-6 flex items-center justify-between\">\n                <div className=\"text-sm text-gray-700 dark:text-gray-300\">\n                  Page {currentPage} of {totalPages}\n                </div>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={() => setCurrentPage((prev) => Math.max(1, prev - 1))}\n                    disabled={currentPage === 1}\n                    className=\"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition\"\n                  >\n                    <FiChevronLeft className=\"w-5 h-5\" />\n                  </button>\n                  <button\n                    onClick={() => setCurrentPage((prev) => Math.min(totalPages, prev + 1))}\n                    disabled={currentPage === totalPages}\n                    className=\"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition\"\n                  >\n                    <FiChevronRight className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AdminUsers;\n","size_bytes":26213},"frontend/src/pages/StoryViewer.jsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { storyAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { AiOutlineClose, AiOutlineHeart, AiOutlineSend } from 'react-icons/ai';\nimport { BsThreeDots } from 'react-icons/bs';\nimport { timeAgo } from '../utils/timeAgo';\n\nconst StoryViewer = () => {\n  const { userId } = useParams();\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  const [stories, setStories] = useState([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [progress, setProgress] = useState(0);\n  const [replyText, setReplyText] = useState('');\n  const [showMenu, setShowMenu] = useState(false);\n  const progressInterval = useRef(null);\n\n  useEffect(() => {\n    fetchStories();\n  }, [userId]);\n\n  useEffect(() => {\n    if (stories.length > 0) {\n      viewCurrentStory();\n      startProgress();\n    }\n    return () => clearProgress();\n  }, [currentIndex, stories]);\n\n  const fetchStories = async () => {\n    try {\n      const response = await storyAPI.getUserStories(userId);\n      setStories(response.data.data);\n      setLoading(false);\n    } catch (error) {\n      toast.error('Failed to load stories');\n      navigate('/');\n    }\n  };\n\n  const viewCurrentStory = async () => {\n    if (stories[currentIndex]) {\n      try {\n        await storyAPI.viewStory(stories[currentIndex]._id);\n      } catch (error) {\n        console.error('Failed to mark story as viewed');\n      }\n    }\n  };\n\n  const startProgress = () => {\n    clearProgress();\n    setProgress(0);\n    \n    const duration = stories[currentIndex]?.mediaType === 'video' ? 15000 : 5000;\n    const interval = 50;\n    const increment = (interval / duration) * 100;\n\n    progressInterval.current = setInterval(() => {\n      setProgress((prev) => {\n        if (prev >= 100) {\n          nextStory();\n          return 0;\n        }\n        return prev + increment;\n      });\n    }, interval);\n  };\n\n  const clearProgress = () => {\n    if (progressInterval.current) {\n      clearInterval(progressInterval.current);\n    }\n  };\n\n  const nextStory = () => {\n    if (currentIndex < stories.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n    } else {\n      navigate('/');\n    }\n  };\n\n  const previousStory = () => {\n    if (currentIndex > 0) {\n      setCurrentIndex(currentIndex - 1);\n    }\n  };\n\n  const handleReply = async (e) => {\n    e.preventDefault();\n    \n    if (!replyText.trim()) return;\n\n    try {\n      await storyAPI.replyToStory(stories[currentIndex]._id, replyText);\n      toast.success('Reply sent');\n      setReplyText('');\n    } catch (error) {\n      toast.error('Failed to send reply');\n    }\n  };\n\n  const handleDelete = async () => {\n    if (window.confirm('Delete this story?')) {\n      try {\n        await storyAPI.deleteStory(stories[currentIndex]._id);\n        toast.success('Story deleted');\n        const newStories = stories.filter((_, i) => i !== currentIndex);\n        if (newStories.length === 0) {\n          navigate('/');\n        } else {\n          setStories(newStories);\n          if (currentIndex >= newStories.length) {\n            setCurrentIndex(newStories.length - 1);\n          }\n        }\n      } catch (error) {\n        toast.error('Failed to delete story');\n      }\n    }\n  };\n\n  if (loading || stories.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-black flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white\"></div>\n      </div>\n    );\n  }\n\n  const currentStory = stories[currentIndex];\n  const isOwnStory = currentStory.author._id === user?._id;\n\n  return (\n    <div className=\"min-h-screen bg-black flex items-center justify-center\">\n      {/* Story Container */}\n      <div className=\"relative w-full max-w-md h-screen\">\n        {/* Progress Bars */}\n        <div className=\"absolute top-0 left-0 right-0 flex space-x-1 p-2 z-20\">\n          {stories.map((_, index) => (\n            <div\n              key={index}\n              className=\"flex-1 h-0.5 bg-gray-600 rounded-full overflow-hidden\"\n            >\n              <div\n                className=\"h-full bg-white transition-all\"\n                style={{\n                  width:\n                    index < currentIndex\n                      ? '100%'\n                      : index === currentIndex\n                      ? `${progress}%`\n                      : '0%',\n                }}\n              ></div>\n            </div>\n          ))}\n        </div>\n\n        {/* Header */}\n        <div className=\"absolute top-4 left-0 right-0 flex items-center justify-between px-4 z-20\">\n          <div className=\"flex items-center space-x-2\">\n            <img\n              src={currentStory.author.avatar}\n              alt={currentStory.author.username}\n              className=\"h-10 w-10 rounded-full object-cover ring-2 ring-white\"\n            />\n            <div>\n              <p className=\"text-white font-semibold\">\n                {currentStory.author.username}\n              </p>\n              <p className=\"text-white text-xs\">{timeAgo(currentStory.createdAt)}</p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-2\">\n            {isOwnStory && (\n              <button\n                onClick={() => setShowMenu(!showMenu)}\n                className=\"text-white hover:bg-gray-800/50 p-2 rounded-full\"\n              >\n                <BsThreeDots size={20} />\n              </button>\n            )}\n            <button\n              onClick={() => navigate('/')}\n              className=\"text-white hover:bg-gray-800/50 p-2 rounded-full\"\n            >\n              <AiOutlineClose size={24} />\n            </button>\n          </div>\n\n          {/* Menu */}\n          {showMenu && isOwnStory && (\n            <div className=\"absolute top-12 right-4 bg-gray-900 rounded-lg shadow-lg py-2 w-40\">\n              <button\n                onClick={handleDelete}\n                className=\"block w-full text-left px-4 py-2 text-red-500 hover:bg-gray-800\"\n              >\n                Delete Story\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Story Media */}\n        <div\n          className=\"absolute inset-0 flex items-center justify-center\"\n          onClick={(e) => {\n            const rect = e.currentTarget.getBoundingClientRect();\n            const x = e.clientX - rect.left;\n            if (x < rect.width / 2) {\n              previousStory();\n            } else {\n              nextStory();\n            }\n          }}\n        >\n          {currentStory.mediaType === 'video' ? (\n            <video\n              src={currentStory.mediaUrl}\n              className=\"w-full h-full object-contain\"\n              autoPlay\n              onEnded={nextStory}\n            />\n          ) : (\n            <img\n              src={currentStory.mediaUrl}\n              alt=\"Story\"\n              className=\"w-full h-full object-contain\"\n            />\n          )}\n\n          {/* Caption */}\n          {currentStory.caption && (\n            <div className=\"absolute bottom-20 left-0 right-0 px-4\">\n              <p className=\"text-white text-center bg-black/50 py-2 px-4 rounded-lg\">\n                {currentStory.caption}\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* Reply Input */}\n        {!isOwnStory && (\n          <form\n            onSubmit={handleReply}\n            className=\"absolute bottom-0 left-0 right-0 p-4 z-20\"\n          >\n            <div className=\"flex items-center space-x-2\">\n              <input\n                type=\"text\"\n                value={replyText}\n                onChange={(e) => setReplyText(e.target.value)}\n                placeholder={`Reply to ${currentStory.author.username}...`}\n                className=\"flex-1 px-4 py-3 bg-transparent border-2 border-white text-white rounded-full focus:outline-none\"\n              />\n              <button\n                type=\"submit\"\n                disabled={!replyText.trim()}\n                className={`p-3 rounded-full ${\n                  replyText.trim()\n                    ? 'text-primary'\n                    : 'text-gray-500 cursor-not-allowed'\n                }`}\n              >\n                <AiOutlineSend size={24} />\n              </button>\n            </div>\n          </form>\n        )}\n\n        {/* Story Views (for own stories) */}\n        {isOwnStory && (\n          <div className=\"absolute bottom-4 left-4 z-20\">\n            <div className=\"flex items-center space-x-1 text-white\">\n              <AiOutlineHeart size={20} />\n              <span>{currentStory.views.length} views</span>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default StoryViewer;\n","size_bytes":8898},"frontend/src/components/CommentBox.jsx":{"content":"import { useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { postAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { AiOutlineDelete } from 'react-icons/ai';\nimport { timeAgo } from '../utils/timeAgo';\n\nconst CommentBox = ({ post, setPost }) => {\n  const { user } = useAuth();\n  const [commentText, setCommentText] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const [replyText, setReplyText] = useState('');\n  const [replyTo, setReplyTo] = useState(null);\n\n  const handleReplySubmit = async (commentId) => {\n    if (!replyText.trim()) return;\n    try {\n      const response = await postAPI.replyToComment(post._id, commentId, replyText.trim());\n      setPost((prev) => ({\n        ...prev,\n        comments: [...prev.comments, response.data.data],\n      }));\n      setReplyText('');\n      setReplyTo(null);\n      toast.success('Reply added');\n    } catch (error) {\n      toast.error('Failed to add reply');\n    }\n  };\n\n  const handlePinComment = async (commentId) => {\n    try {\n      const response = await postAPI.pinComment(post._id, commentId);\n      setPost((prev) => ({ ...prev, pinnedComment: response.data.data }));\n      toast.success('Comment pinned');\n    } catch (error) {\n      toast.error('Failed to pin comment');\n    }\n  };\n\n  const handleUnpinComment = async () => {\n    try {\n      await postAPI.unpinComment(post._id);\n      setPost((prev) => ({ ...prev, pinnedComment: null }));\n      toast.success('Comment unpinned');\n    } catch (error) {\n      toast.error('Failed to unpin comment');\n    }\n  };\n\n  const handleAddComment = async (e) => {\n    e.preventDefault();\n    \n    if (!commentText.trim()) {\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await postAPI.addComment(post._id, commentText);\n      setPost((prev) => ({\n        ...prev,\n        comments: [...prev.comments, response.data.data],\n      }));\n      setCommentText('');\n      toast.success('Comment added');\n    } catch (error) {\n      toast.error('Failed to add comment');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDeleteComment = async (commentId) => {\n    try {\n      await postAPI.deleteComment(post._id, commentId);\n      setPost((prev) => ({\n        ...prev,\n        comments: prev.comments.filter((c) => c._id !== commentId),\n      }));\n      toast.success('Comment deleted');\n    } catch (error) {\n      toast.error('Failed to delete comment');\n    }\n  };\n\n  return (\n    <div className=\"border-t border-gray-200 pt-3\">\n      {/* Comments List */}\n      <div className=\"max-h-60 overflow-y-auto mb-3\">\n        {(() => {\n          const byParent = {};\n          const roots = [];\n          for (const c of post.comments) {\n            const pid = c.parentComment || null;\n            if (pid) {\n              byParent[pid] = byParent[pid] || [];\n              byParent[pid].push(c);\n            } else {\n              roots.push(c);\n            }\n          }\n\n          const renderItem = (comment, isPinned = false) => (\n            <div key={comment._id} className={`flex items-start justify-between mb-3 ${isPinned ? 'bg-yellow-50 dark:bg-yellow-900/20 rounded-md p-2' : ''}`}>\n              <div className=\"flex items-start space-x-2 flex-1\">\n                <Link to={`/profile/${comment.author.username}`}>\n                  <img\n                    src={comment.author.avatar}\n                    alt={comment.author.username}\n                    className=\"h-8 w-8 rounded-full object-cover\"\n                  />\n                </Link>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm\">\n                    <Link\n                      to={`/profile/${comment.author.username}`}\n                      className=\"font-semibold mr-2\"\n                    >\n                      {comment.author.username}\n                    </Link>\n                    {comment.text}\n                  </p>\n                  <div className=\"flex items-center gap-3 mt-1\">\n                    <p className=\"text-xs text-gray-500\">{timeAgo(comment.createdAt)}</p>\n                    <button onClick={() => setReplyTo(comment._id)} className=\"text-xs text-gray-500 hover:underline\">Reply</button>\n                    {user?._id === post.author._id && (\n                      <div className=\"text-xs text-gray-500\">\n                        {(post.pinnedComment && post.pinnedComment._id === comment._id) ? (\n                          <button onClick={handleUnpinComment} className=\"hover:underline\">Unpin</button>\n                        ) : (\n                          <button onClick={() => handlePinComment(comment._id)} className=\"hover:underline\">Pin</button>\n                        )}\n                      </div>\n                    )}\n                  </div>\n\n                  {replyTo === comment._id && (\n                    <form onSubmit={(e) => { e.preventDefault(); handleReplySubmit(comment._id); }} className=\"flex items-center gap-2 mt-2\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Write a reply...\"\n                        value={replyText}\n                        onChange={(e) => setReplyText(e.target.value)}\n                        className=\"flex-1 py-1 px-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary\"\n                      />\n                      <button type=\"submit\" disabled={!replyText.trim()} className={`text-xs font-semibold ${replyText.trim() ? 'text-primary' : 'text-gray-400 cursor-not-allowed'}`}>Reply</button>\n                    </form>\n                  )}\n                </div>\n              </div>\n\n              {user?._id === comment.author._id && (\n                <button\n                  onClick={() => handleDeleteComment(comment._id)}\n                  className=\"text-red-500 hover:text-red-700 ml-2\"\n                >\n                  <AiOutlineDelete size={16} />\n                </button>\n              )}\n            </div>\n          );\n\n          return (\n            <>\n              {post.pinnedComment && renderItem(post.pinnedComment, true)}\n              {roots.map((comment) => (\n                <div key={comment._id}>\n                  {renderItem(comment)}\n                  {(byParent[comment._id] || []).map((child) => (\n                    <div key={child._id} className=\"ml-10\">\n                      {renderItem(child)}\n                    </div>\n                  ))}\n                </div>\n              ))}\n            </>\n          );\n        })()}\n      </div>\n\n      {/* Add Comment Form */}\n      <form onSubmit={handleAddComment} className=\"flex items-center space-x-2\">\n        <input\n          type=\"text\"\n          placeholder=\"Add a comment...\"\n          value={commentText}\n          onChange={(e) => setCommentText(e.target.value)}\n          className=\"flex-1 py-2 px-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary\"\n        />\n        <button\n          type=\"submit\"\n          disabled={loading || !commentText.trim()}\n          className={`font-semibold ${\n            commentText.trim()\n              ? 'text-primary hover:text-blue-700'\n              : 'text-gray-400 cursor-not-allowed'\n          }`}\n        >\n          Post\n        </button>\n      </form>\n    </div>\n  );\n};\n\nexport default CommentBox;\n","size_bytes":7430},"backend/scripts/updateDefaultImages.js":{"content":"import mongoose from 'mongoose';\nimport User from '../models/User.js';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nconst updateDefaultImages = async () => {\n  try {\n    await mongoose.connect(process.env.MONGO_URI);\n    console.log('âœ… MongoDB Connected');\n\n    const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:5173';\n    \n    // Update users with missing or placeholder avatars\n    const result = await User.updateMany(\n      {\n        $or: [\n          { avatar: { $exists: false } },\n          { avatar: '' },\n          { avatar: /^\\/default-avatar/ },\n          { avatar: /ui-avatars\\.com/ }\n        ]\n      },\n      {\n        $set: {\n          avatar: `${frontendUrl}/default-avatar.png`,\n          coverImage: `${frontendUrl}/default-bg.jpg`\n        }\n      }\n    );\n\n    console.log(`âœ… Updated ${result.modifiedCount} users with default images`);\n    \n    process.exit(0);\n  } catch (error) {\n    console.error('âŒ Error:', error);\n    process.exit(1);\n  }\n};\n\nupdateDefaultImages();\n","size_bytes":1015},"replit.md":{"content":"# friendflix - Social Media Platform on Replit\n\n## Overview\nfriendflix is a full-stack MERN (MongoDB, Express, React, Node.js) social media platform inspired by Instagram and friendflix. It features a hybrid of social media functionalities including real-time messaging, posts, stories, notifications, playlists, video chapters, a community tab, notes, collab posts, and a trending page. The platform also incorporates advanced monetization features such as friendflix Premium-style subscriptions, a creator monetization system with a dashboard, Super Chat for live streaming, and a Shorts Fund. It is designed to be a Progressive Web App (PWA) with integrated ad monetization.\n\n## User Preferences\n### Development Workflow\n- Uses existing project structure and conventions\n- Backend and frontend run as separate workflows\n- MongoDB Atlas for database (not local MongoDB)\n- Cloudinary for media storage\n\n## System Architecture\n\n### Tech Stack\n- **Frontend:** React 18 + Vite + Tailwind CSS\n- **Backend:** Node.js + Express.js\n- **Database:** MongoDB Atlas\n- **Real-time:** Socket.io\n- **File Storage:** Cloudinary (images/videos)\n- **Authentication:** JWT + bcrypt\n\n### Port Configuration\n- **Frontend (Vite):** Port 5000 (public-facing)\n- **Backend (Express):** Port 3000 (internal)\n- Frontend proxies API requests to backend at `localhost:3000`\n\n### Workflows\n1. **backend** - Runs backend server on port 3000\n2. **frontend** - Runs Vite dev server on port 5000\n\n### UI/UX Decisions\n- Dedicated `/videos` route for long-form content with grid view, player, comments, and related videos.\n- \"Long Videos\" shelf on the home feed with horizontal scrolling.\n- Bottom navigation with a purple-themed Videos tab.\n- PWA icons (192x192, 512x512, maskable) for native app experience.\n- Creator Dashboard at `/creator` with comprehensive analytics.\n- Admin panel at `/admin` for user management, post moderation, and platform statistics.\n\n### Technical Implementations\n- **Hybrid Features:**\n    - Playlists system with a `Playlist` model.\n    - \"Watch Later\" queue with a `WatchLater` model.\n    - Video chapters and timestamps integrated into the `Post` model.\n    - Community tab with `CommunityPost` model.\n    - Notes feature with an auto-expiring `Note` model.\n    - Collab Posts with a `collaborators` array in the `Post` model.\n    - Trending page with `/api/trending` endpoint and custom algorithm.\n- **Monetization & Premium Features:**\n    - `Subscription` model for premium plans.\n    - `Revenue` model for creator earnings tracking.\n    - Super Chat integration for live streams.\n    - Shorts Fund for viral content rewards.\n    - Middleware for premium access control.\n- **PWA:** Fully installable with offline support and push notification readiness via `vite-plugin-pwa`.\n- **Ad Monetization:** Google AdSense integration for feed ads, pre-roll, mid-roll (for videos >5 mins), and Reels ads. Configurable ad frequency.\n- **Vite Configuration:** Bound to `0.0.0.0:5000` with HMR configured for Replit. Proxies `/api` and `/socket.io` to backend.\n- **Backend CORS:** Allowed Replit domains (`*.replit.dev`, `*.repl.co`).\n- **Database Schema:** Models for User, Post, Comment, Story, Message, Notification, Conversation, Group, Playlist, WatchLater, CommunityPost, Note, Subscription, Revenue.\n- **Socket.io Events:** Real-time notifications, messages, typing indicators, and online status.\n\n### Feature Specifications\n- **Core:** User authentication, profiles, posts (image/video), likes, comments, real-time notifications, DM, 24-hour stories, Reels, Long Videos, Explore page, save posts, analytics, groups.\n- **Monetization:** Ad-free viewing, background play, offline downloads for premium users. Creator eligibility based on subscriber and watch time. 70/30 revenue split for Super Chat.\n- **Admin:** User verification/banning/deletion, post moderation, role-based access control, platform statistics.\n\n## External Dependencies\n\n- **MongoDB Atlas:** Cloud-hosted NoSQL database.\n- **Cloudinary:** Cloud-based media management for images and videos.\n- **Socket.io:** Library for real-time, bidirectional, event-based communication.\n- **Google AdSense:** Advertising placement service for monetization.\n- **JWT (JSON Web Tokens):** For secure authentication.\n- **bcrypt:** For password hashing.","size_bytes":4293},"backend/controllers/noteController.js":{"content":"import Note from '../models/Note.js';\nimport User from '../models/User.js';\nimport Notification from '../models/Notification.js';\n\n// @desc    Create note\n// @route   POST /api/notes\n// @access  Private\nexport const createNote = async (req, res) => {\n  try {\n    const { content, emoji, visibility } = req.body;\n\n    if (!content || !content.trim()) {\n      return res.status(400).json({ success: false, message: 'Note content is required' });\n    }\n\n    if (content.length > 60) {\n      return res.status(400).json({ success: false, message: 'Note cannot exceed 60 characters' });\n    }\n\n    await Note.deleteMany({ user: req.user._id });\n\n    const note = await Note.create({\n      user: req.user._id,\n      content,\n      emoji: emoji || '',\n      visibility: visibility || 'subscriber',\n    });\n\n    const populatedNote = await Note.findById(note._id)\n      .populate('user', 'username profilePicture fullName verified');\n\n    res.status(201).json({ success: true, note: populatedNote });\n  } catch (error) {\n    console.error('Error creating note:', error);\n    res.status(500).json({ success: false, message: 'Failed to create note' });\n  }\n};\n\n// @desc    Get user's note\n// @route   GET /api/notes/user/:userId\n// @access  Public\nexport const getUserNotes = async (req, res) => {\n  try {\n    const note = await Note.findOne({\n      user: req.params.userId,\n      expiresAt: { $gt: new Date() },\n    }).populate('user', 'username profilePicture fullName verified');\n\n    if (!note) {\n      return res.json({ success: true, note: null });\n    }\n\n    res.json({ success: true, note });\n  } catch (error) {\n    console.error('Error fetching note:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch note' });\n  }\n};\n\n// @desc    Get notes from subscribed\n// @route   GET /api/notes/subscribed\n// @access  Private\nexport const getsubscribedNotes = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n\n    const notes = await Note.find({\n      user: { $in: user.subscribed },\n      expiresAt: { $gt: new Date() },\n    })\n      .populate('user', 'username profilePicture fullName verified')\n      .sort({ createdAt: -1 });\n\n    res.json({ success: true, notes });\n  } catch (error) {\n    console.error('Error fetching subscribed notes:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch notes' });\n  }\n};\n\n// @desc    Delete note\n// @route   DELETE /api/notes/:id\n// @access  Private\nexport const deleteNote = async (req, res) => {\n  try {\n    const note = await Note.findById(req.params.id);\n\n    if (!note) {\n      return res.status(404).json({ success: false, message: 'Note not found' });\n    }\n\n    if (note.user.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized' });\n    }\n\n    await note.deleteOne();\n\n    res.json({ success: true, message: 'Note deleted' });\n  } catch (error) {\n    console.error('Error deleting note:', error);\n    res.status(500).json({ success: false, message: 'Failed to delete note' });\n  }\n};\n\n// @desc    Like note\n// @route   POST /api/notes/:id/like\n// @access  Private\nexport const likeNote = async (req, res) => {\n  try {\n    const note = await Note.findById(req.params.id);\n\n    if (!note) {\n      return res.status(404).json({ success: false, message: 'Note not found' });\n    }\n\n    const alreadyLiked = note.likes.includes(req.user._id);\n\n    if (alreadyLiked) {\n      note.likes = note.likes.filter((id) => id.toString() !== req.user._id.toString());\n    } else {\n      note.likes.push(req.user._id);\n\n      if (note.user.toString() !== req.user._id.toString()) {\n        await Notification.create({\n          recipient: note.user,\n          sender: req.user._id,\n          type: 'like',\n          message: `${req.user.username} liked your note`,\n          link: `/notes/${note._id}`,\n        });\n\n        const io = req.app.get('io');\n        if (io) {\n          io.to(note.user.toString()).emit('newNotification', {\n            message: `${req.user.username} liked your note`,\n            link: `/notes/${note._id}`,\n          });\n        }\n      }\n    }\n\n    await note.save();\n\n    res.json({ success: true, likes: note.likes.length, liked: !alreadyLiked });\n  } catch (error) {\n    console.error('Error liking note:', error);\n    res.status(500).json({ success: false, message: 'Failed to like note' });\n  }\n};\n\n// @desc    Reply to note\n// @route   POST /api/notes/:id/reply\n// @access  Private\nexport const replyToNote = async (req, res) => {\n  try {\n    const { content } = req.body;\n\n    if (!content || !content.trim()) {\n      return res.status(400).json({ success: false, message: 'Reply content is required' });\n    }\n\n    const note = await Note.findById(req.params.id);\n\n    if (!note) {\n      return res.status(404).json({ success: false, message: 'Note not found' });\n    }\n\n    note.replies.push({\n      user: req.user._id,\n      content,\n    });\n\n    await note.save();\n\n    if (note.user.toString() !== req.user._id.toString()) {\n      await Notification.create({\n        recipient: note.user,\n        sender: req.user._id,\n        type: 'comment',\n        message: `${req.user.username} replied to your note`,\n        link: `/notes/${note._id}`,\n      });\n    }\n\n    const populatedNote = await Note.findById(note._id)\n      .populate('user', 'username profilePicture verified')\n      .populate('replies.user', 'username profilePicture verified');\n\n    res.json({ success: true, note: populatedNote });\n  } catch (error) {\n    console.error('Error replying to note:', error);\n    res.status(500).json({ success: false, message: 'Failed to reply' });\n  }\n};\n","size_bytes":5668},"frontend/src/pages/Feed.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { postAPI, userAPI } from '../services/api';\nimport { Link } from 'react-router-dom';\nimport PostCard from '../components/PostCard';\nimport StoriesBar from '../components/StoriesBar';\nimport PullToRefresh from '../components/PullToRefresh';\nimport { PostSkeleton } from '../components/SkeletonLoader';\nimport Loader from '../components/Loader';\nimport FeedAdCard from '../components/FeedAdCard';\nimport { shouldShowFeedAd, AD_CONFIG } from '../utils/adConfig';\nimport toast from 'react-hot-toast';\n\nconst Feed = () => {\n  const [posts, setPosts] = useState([]);\n  const [suggestions, setSuggestions] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [page, setPage] = useState(1);\n  const [hasMore, setHasMore] = useState(true);\n  const [loadingMore, setLoadingMore] = useState(false);\n  const [filter, setFilter] = useState('all'); // all, images, shorts, long\n\n  useEffect(() => {\n    fetchFeed();\n    fetchSuggestions();\n  }, []);\n\n  const fetchFeed = async (showLoader = true) => {\n    try {\n      if (showLoader) setLoading(true);\n      const response = await postAPI.getFeed(page);\n      setPosts(response.data.data);\n      setHasMore(response.data.pagination.page < response.data.pagination.pages);\n    } catch (error) {\n      toast.error('Failed to load feed');\n    } finally {\n      if (showLoader) setLoading(false);\n    }\n  };\n\n  const handleRefresh = async () => {\n    setPage(1);\n    await fetchFeed(false);\n    toast.success('Feed refreshed!');\n  };\n\n  const fetchSuggestions = async () => {\n    try {\n      const response = await userAPI.getSuggestions();\n      setSuggestions(response.data.data);\n    } catch (error) {\n      console.error('Failed to load suggestions:', error);\n    }\n  };\n\n  const loadMorePosts = async () => {\n    if (loadingMore || !hasMore) return;\n\n    setLoadingMore(true);\n    try {\n      const response = await postAPI.getFeed(page + 1);\n      setPosts([...posts, ...response.data.data]);\n      setPage(page + 1);\n      setHasMore(response.data.pagination.page < response.data.pagination.pages);\n    } catch (error) {\n      toast.error('Failed to load more posts');\n    } finally {\n      setLoadingMore(false);\n    }\n  };\n\n  const handlePostDelete = (postId) => {\n    setPosts(posts.filter((post) => post._id !== postId));\n  };\n\n  const handleFollow = async (userId) => {\n    try {\n      await userAPI.followUser(userId);\n      setSuggestions(suggestions.filter((user) => user._id !== userId));\n      toast.success('User followed');\n    } catch (error) {\n      toast.error('Failed to follow user');\n    }\n  };\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  return (\n    <PullToRefresh onRefresh={handleRefresh}>\n      <div className=\"max-w-5xl mx-auto px-4 py-8\">\n        {/* Stories Bar */}\n        <div className=\"lg:col-span-2 mb-6\">\n          <StoriesBar />\n        </div>\n\n        {/* Reels Shelf */}\n        <div className=\"lg:col-span-2 mb-6\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <h3 className=\"font-semibold\">Reels</h3>\n            <Link to=\"/reels\" className=\"text-primary text-sm\">View all</Link>\n          </div>\n          <div className=\"flex gap-3 overflow-x-auto pb-2\">\n            {posts.filter(p => p.category==='short').slice(0,12).map((p) => (\n              <div key={p._id} className=\"relative min-w-[140px] h-72 rounded-xl overflow-hidden bg-black cursor-pointer\" onClick={() => window.location.href='/reels'}>\n                <video src={p.media?.[0]?.url || p.mediaUrl} className=\"w-full h-full object-cover\" muted playsInline />\n                <div className=\"absolute bottom-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded-full\">\n                  {typeof p.durationSec==='number' ? `${Math.floor(p.durationSec/60)}:${String(p.durationSec%60).padStart(2,'0')}` : 'Short'}\n                </div>\n              </div>\n            ))}\n            {posts.filter(p => p.category==='short').length === 0 && (\n              <div className=\"text-sm text-gray-500\">No reels from people you follow.</div>\n            )}\n          </div>\n        </div>\n\n        {/* Long Videos Shelf */}\n        <div className=\"lg:col-span-2 mb-6\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <h3 className=\"font-semibold\">Long Videos</h3>\n            <Link to=\"/videos\" className=\"text-primary text-sm\">View all</Link>\n          </div>\n          <div className=\"flex gap-3 overflow-x-auto pb-2\">\n            {posts.filter(p => p.category==='long').slice(0,8).map((p) => (\n              <div key={p._id} className=\"relative min-w-[200px] cursor-pointer group\" onClick={() => window.location.href=`/videos?watch=${p._id}`}>\n                <div className=\"relative w-full aspect-video bg-black rounded-lg overflow-hidden mb-2\">\n                  <video src={p.media?.[0]?.url || p.mediaUrl} className=\"w-full h-full object-cover group-hover:scale-105 transition-transform\" muted playsInline />\n                  <div className=\"absolute bottom-2 right-2 bg-black/80 text-white text-xs px-2 py-1 rounded\">\n                    {typeof p.durationSec==='number' ? (\n                      p.durationSec >= 3600 ? \n                        `${Math.floor(p.durationSec/3600)}:${String(Math.floor((p.durationSec%3600)/60)).padStart(2,'0')}:${String(p.durationSec%60).padStart(2,'0')}` :\n                        `${Math.floor(p.durationSec/60)}:${String(p.durationSec%60).padStart(2,'0')}`\n                    ) : 'Long'}\n                  </div>\n                </div>\n                <h4 className=\"font-semibold text-sm line-clamp-2 dark:text-white mb-1\">{p.title || 'Untitled Video'}</h4>\n                <p className=\"text-xs text-gray-600 dark:text-gray-400\">{p.author.username}</p>\n                <p className=\"text-xs text-gray-500\">\n                  {p.views || 0} views â€¢ {new Date(p.createdAt).toLocaleDateString()}\n                </p>\n              </div>\n            ))}\n            {posts.filter(p => p.category==='long').length === 0 && (\n              <div className=\"text-sm text-gray-500\">No long videos from people you follow.</div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Feed Section */}\n          <div className=\"lg:col-span-2\">\n            {/* Category Filter */}\n            <div className=\"flex gap-2 mb-4\">\n              <button className={`btn-outline ${filter==='all'?'ring-2 ring-primary':''}`} onClick={() => setFilter('all')}>All</button>\n              <button className={`btn-outline ${filter==='images'?'ring-2 ring-primary':''}`} onClick={() => setFilter('images')}>Images</button>\n              <button className={`btn-outline ${filter==='shorts'?'ring-2 ring-primary':''}`} onClick={() => setFilter('shorts')}>Shorts</button>\n              <button className={`btn-outline ${filter==='long'?'ring-2 ring-primary':''}`} onClick={() => setFilter('long')}>Long</button>\n            </div>\n            {loading && posts.length === 0 ? (\n              <>\n                <PostSkeleton />\n                <PostSkeleton />\n              </>\n            ) : posts.length === 0 ? (\n            <div className=\"card p-8 text-center\">\n              <p className=\"text-gray-600 mb-4\">\n                No posts yet. Start subscribed people to see their posts!\n              </p>\n              <Link to=\"/search\" className=\"btn-primary\">\n                Find People\n              </Link>\n            </div>\n          ) : (\n            <>\n              {posts.filter(p => {\n                if (filter==='all') return true;\n                const cat = p.category;\n                const primaryType = (p.media?.[0]?.type) || p.mediaType;\n                if (filter==='images') return cat ? cat==='image' : primaryType==='image';\n                if (filter==='shorts') return cat==='short';\n                if (filter==='long') return cat==='long';\n                return true;\n              }).map((post, index) => (\n                <>\n                  <PostCard key={post._id} post={post} onDelete={handlePostDelete} />\n                  {shouldShowFeedAd(index) && (\n                    <FeedAdCard key={`ad-${index}`} adSlot={AD_CONFIG.adsense.slots.feedAd} />\n                  )}\n                </>\n              ))}\n\n              {hasMore && (\n                <div className=\"text-center mt-4\">\n                  <button\n                    onClick={loadMorePosts}\n                    disabled={loadingMore}\n                    className=\"btn-secondary\"\n                  >\n                    {loadingMore ? 'Loading...' : 'Load More'}\n                  </button>\n                </div>\n              )}\n            </>\n          )}\n        </div>\n\n        {/* Sidebar - Suggestions */}\n        <div className=\"hidden lg:block\">\n          <div className=\"sticky top-20\">\n            <h3 className=\"font-semibold text-gray-600 mb-4\">\n              Suggestions For You\n            </h3>\n\n            {suggestions.length === 0 ? (\n              <p className=\"text-sm text-gray-500\">No suggestions available</p>\n            ) : (\n              <div className=\"space-y-4\">\n                {suggestions.map((user) => (\n                  <div key={user._id} className=\"flex items-center justify-between\">\n                    <Link\n                      to={`/profile/${user.username}`}\n                      className=\"flex items-center space-x-3 flex-1\"\n                    >\n                      <img\n                        src={user.avatar}\n                        alt={user.username}\n                        className=\"h-10 w-10 rounded-full object-cover\"\n                      />\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-semibold text-sm truncate\">\n                          {user.username}\n                        </p>\n                        <p className=\"text-xs text-gray-500 truncate\">\n                          {user.fullName}\n                        </p>\n                      </div>\n                    </Link>\n                    <button\n                      onClick={() => handleFollow(user._id)}\n                      className=\"text-primary text-sm font-semibold hover:text-blue-700\"\n                    >\n                      Follow\n                    </button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n        </div>\n      </div>\n    </PullToRefresh>\n  );\n};\n\nexport default Feed;\n","size_bytes":10535},"frontend/src/pages/Hashtag.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\n\nconst Hashtag = () => {\n  const { tag } = useParams();\n  const navigate = useNavigate();\n  const [posts, setPosts] = useState([]);\n  const [trend, setTrend] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n        const [postsRes, trendingRes] = await Promise.all([\n          axios.get(`${API_URL}/explore/tags/${tag}`),\n          axios.get(`${API_URL}/explore/hashtags`),\n        ]);\n        setPosts(postsRes.data.data || []);\n        const currentTrend = (trendingRes.data.data || []).find(t => t.tag === tag);\n        setTrend(currentTrend || null);\n      } catch (e) {\n        // ignore\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchData();\n  }, [tag]);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-amber-50 dark:from-dark-bg dark:via-dark-bg dark:to-dark-bg pb-20 md:pb-8\">\n      <div className=\"max-w-6xl mx-auto px-4 py-8\">\n        <div className=\"mb-6 flex items-center justify-between\">\n          <h1 className=\"text-3xl font-bold dark:text-white\">#{tag}</h1>\n          {trend && (\n            <div className={`inline-flex items-center px-3 py-1 rounded-full text-xs ${trend.growthPct > 0 ? 'bg-green-100 text-green-700' : trend.growthPct < 0 ? 'bg-red-100 text-red-700' : 'bg-gray-100 text-gray-700'}`}>\n              <span className=\"mr-1\">{trend.growthPct > 0 ? 'â–²' : trend.growthPct < 0 ? 'â–¼' : 'â– '}</span>\n              {Math.abs(trend.growthPct)}%\n              <span className=\"ml-2 text-gray-500\">vs prev 24h</span>\n            </div>\n          )}\n        </div>\n\n        {loading ? (\n          <div className=\"flex justify-center items-center py-20\">\n            <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-purple-500\"></div>\n          </div>\n        ) : posts.length === 0 ? (\n          <div className=\"text-sm text-gray-500\">No posts for #{tag} yet.</div>\n        ) : (\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n            {posts.map((post) => (\n              <div\n                key={post._id}\n                onClick={() => navigate(`/post/${post._id}`)}\n                className=\"group relative aspect-square cursor-pointer rounded-3xl overflow-hidden shadow-lg hover:shadow-glow transition-all duration-300 hover:scale-105\"\n              >\n                <img\n                  src={post.media?.[0]?.url || post.mediaUrl}\n                  alt=\"Post\"\n                  className=\"w-full h-full object-cover\"\n                />\n                <div className=\"absolute bottom-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded-full\">\n                  #{tag}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Hashtag;\n","size_bytes":3095},"frontend/src/components/SkeletonLoader.jsx":{"content":"const PostSkeleton = () => (\n  <div className=\"card mb-6 animate-pulse\">\n    {/* Header */}\n    <div className=\"flex items-center space-x-3 p-4\">\n      <div className=\"h-10 w-10 rounded-full bg-gray-300 dark:bg-gray-700\"></div>\n      <div className=\"flex-1\">\n        <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-24 mb-2\"></div>\n        <div className=\"h-3 bg-gray-300 dark:bg-gray-700 rounded w-16\"></div>\n      </div>\n    </div>\n\n    {/* Image */}\n    <div className=\"w-full h-96 bg-gray-300 dark:bg-gray-700\"></div>\n\n    {/* Actions */}\n    <div className=\"p-4\">\n      <div className=\"flex space-x-4 mb-3\">\n        <div className=\"h-7 w-7 rounded bg-gray-300 dark:bg-gray-700\"></div>\n        <div className=\"h-7 w-7 rounded bg-gray-300 dark:bg-gray-700\"></div>\n      </div>\n\n      <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-20 mb-2\"></div>\n      <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-full mb-1\"></div>\n      <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4\"></div>\n    </div>\n  </div>\n);\n\nconst StorySkeleton = () => (\n  <div className=\"flex-shrink-0 animate-pulse\">\n    <div className=\"h-16 w-16 rounded-full bg-gray-300 dark:bg-gray-700\"></div>\n    <div className=\"h-3 w-16 bg-gray-300 dark:bg-gray-700 rounded mt-1\"></div>\n  </div>\n);\n\nconst ProfileSkeleton = () => (\n  <div className=\"animate-pulse\">\n    <div className=\"flex items-center space-x-8 mb-8\">\n      <div className=\"h-32 w-32 rounded-full bg-gray-300 dark:bg-gray-700\"></div>\n      <div className=\"flex-1\">\n        <div className=\"h-6 bg-gray-300 dark:bg-gray-700 rounded w-32 mb-4\"></div>\n        <div className=\"flex space-x-8 mb-4\">\n          <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-20\"></div>\n          <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-20\"></div>\n          <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-20\"></div>\n        </div>\n        <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-full mb-2\"></div>\n        <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-2/3\"></div>\n      </div>\n    </div>\n  </div>\n);\n\nconst MessageSkeleton = () => (\n  <div className=\"flex items-center space-x-4 p-4 animate-pulse\">\n    <div className=\"h-14 w-14 rounded-full bg-gray-300 dark:bg-gray-700\"></div>\n    <div className=\"flex-1\">\n      <div className=\"h-4 bg-gray-300 dark:bg-gray-700 rounded w-24 mb-2\"></div>\n      <div className=\"h-3 bg-gray-300 dark:bg-gray-700 rounded w-full\"></div>\n    </div>\n  </div>\n);\n\nexport { PostSkeleton, StorySkeleton, ProfileSkeleton, MessageSkeleton };\n","size_bytes":2589},"frontend/src/components/Loader.jsx":{"content":"const Loader = () => {\n  return (\n    <div className=\"flex items-center justify-center min-h-screen\">\n      <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary\"></div>\n    </div>\n  );\n};\n\nexport default Loader;\n","size_bytes":248},"frontend/src/pages/Premium.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport premiumAPI from '../services/premiumAPI';\nimport toast from 'react-hot-toast';\nimport { AiOutlineCheck, AiOutlineCrown, AiOutlinePlayCircle, AiOutlineDownload, AiOutlineThunderbolt } from 'react-icons/ai';\n\nconst Premium = () => {\n  const { user, refreshUser } = useAuth();\n  const [plans, setPlans] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [subscribing, setSubscribing] = useState(false);\n  const [subscriptionStatus, setSubscriptionStatus] = useState(null);\n\n  useEffect(() => {\n    fetchPlans();\n    fetchSubscriptionStatus();\n  }, []);\n\n  const fetchPlans = async () => {\n    try {\n      const response = await premiumAPI.getPlans();\n      setPlans(response.data.data);\n    } catch (error) {\n      toast.error('Failed to load plans');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchSubscriptionStatus = async () => {\n    try {\n      const response = await premiumAPI.getSubscriptionStatus();\n      setSubscriptionStatus(response.data.data);\n    } catch (error) {\n      console.error('Failed to load subscription status');\n    }\n  };\n\n  const handleSubscribe = async (planId) => {\n    setSubscribing(true);\n    try {\n      await premiumAPI.subscribe(planId);\n      toast.success('ğŸ‰ Welcome to Premium! Enjoy ad-free experience.');\n      await refreshUser();\n      await fetchSubscriptionStatus();\n    } catch (error) {\n      toast.error(error.response?.data?.message || 'Failed to subscribe');\n    } finally {\n      setSubscribing(false);\n    }\n  };\n\n  const handleCancelSubscription = async () => {\n    if (!window.confirm('Are you sure you want to cancel your premium subscription?')) return;\n    \n    try {\n      const response = await premiumAPI.cancelSubscription();\n      toast.success(response.data.message);\n      await fetchSubscriptionStatus();\n    } catch (error) {\n      toast.error(error.response?.data?.message || 'Failed to cancel subscription');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-amber-50 dark:from-gray-900 dark:via-purple-900 dark:to-gray-900 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"text-center mb-12\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <AiOutlineCrown size={64} className=\"text-yellow-500\" />\n          </div>\n          <h1 className=\"text-4xl sm:text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4\">\n            friendflix Premium\n          </h1>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300\">\n            Unlock the best experience with Premium features\n          </p>\n        </div>\n\n        {/* Current Status */}\n        {user?.isPremium && subscriptionStatus && (\n          <div className=\"max-w-2xl mx-auto mb-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-6 text-white shadow-xl\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm opacity-90\">You are Premium</p>\n                <p className=\"text-2xl font-bold capitalize\">{subscriptionStatus.plan} Plan</p>\n                <p className=\"text-sm mt-2\">\n                  {subscriptionStatus.expiresAt \n                    ? `Valid until ${new Date(subscriptionStatus.expiresAt).toLocaleDateString()}`\n                    : 'Active'}\n                </p>\n              </div>\n              <AiOutlineCrown size={48} className=\"opacity-75\" />\n            </div>\n            <button\n              onClick={handleCancelSubscription}\n              className=\"mt-4 w-full bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition\"\n            >\n              Cancel Subscription\n            </button>\n          </div>\n        )}\n\n        {/* Features Grid */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12\">\n          {[\n            {\n              icon: <AiOutlineThunderbolt size={32} />,\n              title: 'Ad-Free',\n              description: 'Watch without interruptions',\n              color: 'text-yellow-500',\n            },\n            {\n              icon: <AiOutlinePlayCircle size={32} />,\n              title: 'Background Play',\n              description: 'Listen while using other apps',\n              color: 'text-blue-500',\n            },\n            {\n              icon: <AiOutlineDownload size={32} />,\n              title: 'Offline Downloads',\n              description: 'Save videos for offline viewing',\n              color: 'text-green-500',\n            },\n            {\n              icon: <AiOutlineCrown size={32} />,\n              title: 'Premium Badge',\n              description: 'Stand out with exclusive badge',\n              color: 'text-purple-500',\n            },\n          ].map((feature, index) => (\n            <div\n              key={index}\n              className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg hover:shadow-xl transition transform hover:-translate-y-1\"\n            >\n              <div className={`${feature.color} mb-3`}>{feature.icon}</div>\n              <h3 className=\"text-lg font-bold mb-2 dark:text-white\">{feature.title}</h3>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">{feature.description}</p>\n            </div>\n          ))}\n        </div>\n\n        {/* Pricing Plans */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto\">\n          {plans.map((plan) => (\n            <div\n              key={plan.id}\n              className={`bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-xl ${\n                plan.id === 'yearly' \n                  ? 'ring-4 ring-purple-500 transform scale-105' \n                  : ''\n              } relative`}\n            >\n              {plan.id === 'yearly' && (\n                <div className=\"absolute -top-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-1 rounded-full text-sm font-semibold\">\n                  Best Value\n                </div>\n              )}\n\n              <div className=\"text-center mb-6\">\n                <h3 className=\"text-2xl font-bold dark:text-white mb-2\">{plan.name}</h3>\n                <div className=\"flex items-baseline justify-center\">\n                  <span className=\"text-4xl font-bold dark:text-white\">${plan.price}</span>\n                  <span className=\"text-gray-500 ml-2\">/{plan.id === 'monthly' ? 'month' : 'year'}</span>\n                </div>\n                {plan.savings && (\n                  <p className=\"text-green-600 font-semibold mt-2\">Save {plan.savings}%</p>\n                )}\n              </div>\n\n              <ul className=\"space-y-3 mb-8\">\n                {plan.features.map((feature, index) => (\n                  <li key={index} className=\"flex items-start\">\n                    <AiOutlineCheck className=\"text-green-500 mr-2 mt-1 flex-shrink-0\" size={20} />\n                    <span className=\"text-gray-700 dark:text-gray-300\">{feature}</span>\n                  </li>\n                ))}\n              </ul>\n\n              <button\n                onClick={() => handleSubscribe(plan.id)}\n                disabled={subscribing || user?.isPremium}\n                className={`w-full py-3 rounded-xl font-semibold transition ${\n                  plan.id === 'yearly'\n                    ? 'bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white'\n                    : 'bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 dark:text-white'\n                } disabled:opacity-50 disabled:cursor-not-allowed`}\n              >\n                {user?.isPremium \n                  ? subscriptionStatus?.plan === plan.id \n                    ? 'Current Plan' \n                    : 'Switch Plan'\n                  : subscribing \n                    ? 'Processing...' \n                    : 'Get Premium'\n                }\n              </button>\n            </div>\n          ))}\n        </div>\n\n        {/* Demo Note */}\n        <div className=\"mt-12 max-w-2xl mx-auto bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-xl p-6\">\n          <p className=\"text-sm text-blue-800 dark:text-blue-200\">\n            <strong>Demo Mode:</strong> This is a demonstration of the premium subscription system. \n            No actual payment is processed. In production, integrate with Stripe, PayPal, or Razorpay for real payments.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Premium;\n","size_bytes":8917},"frontend/src/utils/adConfig.js":{"content":"export const AD_CONFIG = {\n  enabled: true,\n  \n  adsense: {\n    client: 'ca-pub-XXXXXXXXXX',\n    slots: {\n      feedAd: '1234567890',\n      sidebarAd: '0987654321',\n      footerAd: '1122334455',\n    }\n  },\n  \n  feedAds: {\n    frequency: 5,\n    position: 'after',\n  },\n  \n  videoAds: {\n    preRoll: {\n      enabled: true,\n      duration: 5,\n      skipAfter: 3,\n    },\n    midRoll: {\n      enabled: true,\n      interval: 300,\n      duration: 5,\n      skipAfter: 3,\n    },\n    postRoll: {\n      enabled: false,\n      duration: 5,\n      skipAfter: 2,\n    }\n  },\n  \n  reelsAds: {\n    enabled: true,\n    frequency: 4,\n  }\n};\n\nexport const shouldShowFeedAd = (index) => {\n  if (!AD_CONFIG.enabled || !AD_CONFIG.feedAds) return false;\n  return (index + 1) % AD_CONFIG.feedAds.frequency === 0;\n};\n\nexport const shouldShowReelAd = (index) => {\n  if (!AD_CONFIG.enabled || !AD_CONFIG.reelsAds.enabled) return false;\n  return (index + 1) % AD_CONFIG.reelsAds.frequency === 0;\n};\n","size_bytes":967},"backend/models/Highlight.js":{"content":"import mongoose from 'mongoose';\n\nconst highlightSchema = new mongoose.Schema(\n  {\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    title: {\n      type: String,\n      required: [true, 'Highlight title is required'],\n      maxlength: [50, 'Title cannot exceed 50 characters'],\n    },\n    coverImage: {\n      type: String,\n      required: true,\n    },\n    stories: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Story',\n      },\n    ],\n    order: {\n      type: Number,\n      default: 0,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\nhighlightSchema.index({ user: 1, order: 1 });\n\nconst Highlight = mongoose.model('Highlight', highlightSchema);\n\nexport default Highlight;\n","size_bytes":779},"backend/controllers/exploreController.js":{"content":"import Post from '../models/Post.js';\nimport User from '../models/User.js';\n\n// @desc    Get explore posts (trending/popular)\n// @route   GET /api/explore/posts\n// @access  Public\nexport const getExplorePosts = async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 20;\n    const skip = (page - 1) * limit;\n\n    // Get posts sorted by engagement (likes + comments)\n    const posts = await Post.find({ isArchived: { $ne: true } })\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit)\n      .populate('author', 'username fullName avatar')\n      .populate({\n        path: 'derivedFrom',\n        select: 'author media mediaUrl mediaType',\n        populate: { path: 'author', select: 'username avatar' },\n      })\n      .lean();\n\n    // Calculate engagement score\n    const postsWithScore = posts.map((post) => ({\n      ...post,\n      engagementScore: (post.likes?.length || 0) * 2 + (post.comments?.length || 0),\n    }));\n\n    // Sort by engagement\n    postsWithScore.sort((a, b) => b.engagementScore - a.engagementScore);\n\n    res.status(200).json({\n      success: true,\n      data: postsWithScore,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get trending hashtags\n// @route   GET /api/explore/hashtags\n// @access  Public\nexport const getTrendingHashtags = async (req, res) => {\n  try {\n    const now = Date.now();\n    const last7Days = new Date(now - 7 * 24 * 60 * 60 * 1000);\n    const last24h = new Date(now - 24 * 60 * 60 * 1000);\n    const prev24hStart = new Date(now - 48 * 60 * 60 * 1000);\n    const prev24hEnd = last24h;\n\n    const recentPosts = await Post.find({\n      hashtags: { $exists: true, $ne: [] },\n      createdAt: { $gte: last7Days },\n    }).lean();\n\n    // Count hashtag frequency over last 7 days\n    const hashtagCount = {};\n    recentPosts.forEach((post) => {\n      (post.hashtags || []).forEach((tag) => {\n        hashtagCount[tag] = (hashtagCount[tag] || 0) + 1;\n      });\n    });\n\n    // Count last 24h and previous 24h for growth indicators\n    const last24Posts = await Post.find({\n      hashtags: { $exists: true, $ne: [] },\n      createdAt: { $gte: last24h },\n    }).lean();\n    const prev24Posts = await Post.find({\n      hashtags: { $exists: true, $ne: [] },\n      createdAt: { $gte: prev24hStart, $lt: prev24hEnd },\n    }).lean();\n\n    const last24Count = {};\n    last24Posts.forEach((post) => {\n      (post.hashtags || []).forEach((tag) => {\n        last24Count[tag] = (last24Count[tag] || 0) + 1;\n      });\n    });\n    const prev24Count = {};\n    prev24Posts.forEach((post) => {\n      (post.hashtags || []).forEach((tag) => {\n        prev24Count[tag] = (prev24Count[tag] || 0) + 1;\n      });\n    });\n\n    // Build array with growth metrics\n    const trending = Object.entries(hashtagCount)\n      .map(([tag, count]) => {\n        const last = last24Count[tag] || 0;\n        const prev = prev24Count[tag] || 0;\n        const growthPct = prev === 0 ? (last > 0 ? 100 : 0) : Math.round(((last - prev) / prev) * 100);\n        return { tag, count, last24h: last, prev24h: prev, growthPct };\n      })\n      .sort((a, b) => b.count - a.count)\n      .slice(0, 30);\n\n    res.status(200).json({ success: true, data: trending });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// @desc    Search by hashtag\n// @route   GET /api/explore/tags/:tag\n// @access  Public\nexport const getPostsByHashtag = async (req, res) => {\n  try {\n    const { tag } = req.params;\n    const posts = await Post.find({\n      hashtags: tag.toLowerCase(),\n      isArchived: { $ne: true },\n    })\n      .sort({ createdAt: -1 })\n      .populate('author', 'username fullName avatar')\n      .limit(50);\n\n    res.status(200).json({\n      success: true,\n      data: posts,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get suggested users\n// @route   GET /api/explore/users\n// @access  Private\nexport const getSuggestedUsers = async (req, res) => {\n  try {\n    const currentUser = await User.findById(req.user._id);\n\n    // Get users with most subscriber that current user doesn't follow\n    const users = await User.find({\n      _id: { $nin: [...currentUser.subscribed, currentUser._id] },\n    })\n      .select('username fullName avatar bio subscriber')\n      .sort({ subscriber: -1 })\n      .limit(10);\n\n    res.status(200).json({\n      success: true,\n      data: users,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// Trending posts with decay-based scoring\nexport const getTrendingPosts = async (req, res) => {\n  try {\n    const hours = parseInt(req.query.hours) || 72; // lookback window\n    const since = new Date(Date.now() - hours * 60 * 60 * 1000);\n    const limit = parseInt(req.query.limit) || 50;\n\n    const posts = await Post.find({\n      isArchived: { $ne: true },\n      createdAt: { $gte: since },\n    })\n      .populate('author', 'username fullName avatar')\n      .lean();\n\n    const now = Date.now();\n    const halfLifeMs = 24 * 60 * 60 * 1000; // 24h decay\n    const scored = posts\n      .map((p) => {\n        const likesCount = (p.likes || []).length;\n        const commentsCount = (p.comments || []).length;\n        const ageMs = Math.max(1, now - new Date(p.createdAt).getTime());\n        const recencyBoost = Math.exp(-ageMs / halfLifeMs);\n        const engagementScore = likesCount * 2 + commentsCount * 3;\n        const score = engagementScore * 0.7 + recencyBoost * 100; // tune as needed\n        return { ...p, score };\n      })\n      .sort((a, b) => b.score - a.score)\n      .slice(0, limit);\n\n    res.status(200).json({ success: true, data: scored });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n","size_bytes":5957},"frontend/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  background: linear-gradient(135deg, #FFF5F8 0%, #FFF1FA 25%, #F5F3FF 50%, #EDF5FF 75%, #F0FFFE 100%);\n  background-attachment: fixed;\n  transition: background 0.3s ease;\n}\n\n.dark body {\n  background: linear-gradient(135deg, #0A0E1A 0%, #121825 50%, #0A0E1A 100%);\n  background-attachment: fixed;\n}\n\n/* ğŸ¨ Custom Modern Scrollbar */\n::-webkit-scrollbar {\n  width: 10px;\n  height: 10px;\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 10px;\n}\n\n::-webkit-scrollbar-thumb {\n  background: linear-gradient(135deg, #FF3D7F 0%, #9839FF 100%);\n  border-radius: 10px;\n  border: 2px solid transparent;\n  background-clip: padding-box;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: linear-gradient(135deg, #FF1B5E 0%, #8514FF 100%);\n  border-radius: 10px;\n  border: 2px solid transparent;\n  background-clip: padding-box;\n}\n\n/* Dark theme scrollbar */\n.dark ::-webkit-scrollbar-track {\n  background: rgba(26, 31, 53, 0.5);\n}\n\n.dark ::-webkit-scrollbar-thumb {\n  background: linear-gradient(135deg, #FF3D7F 0%, #9839FF 100%);\n}\n\n.dark ::-webkit-scrollbar-thumb:hover {\n  background: linear-gradient(135deg, #FF1B5E 0%, #8514FF 100%);\n}\n\n/* âœ¨ Modern Button Styles */\n.btn-primary {\n  background: linear-gradient(135deg, #FF3D7F 0%, #FF5716 50%, #FFB300 100%);\n  background-size: 200% 200%;\n  @apply text-white font-bold py-3.5 px-8 rounded-2xl shadow-glow hover:shadow-glow-lg transition-all duration-300 hover:scale-105 active:scale-95;\n  animation: shimmer 3s ease infinite;\n}\n\n.btn-gradient {\n  background: linear-gradient(135deg, #FF6B9D 0%, #FF8E53 50%, #C77DFF 100%);\n  background-size: 200% 200%;\n  @apply text-white font-bold py-4 px-10 rounded-3xl shadow-glow-lg hover:shadow-glow transition-all duration-300 hover:scale-105 active:scale-95;\n  animation: shimmer 3s ease infinite;\n}\n\n.btn-secondary {\n  @apply bg-gradient-to-r from-accent-400 to-accent-600 text-white font-bold py-3 px-6 rounded-xl hover:from-accent-500 hover:to-accent-700 transition-all duration-300 hover:scale-105 active:scale-95;\n}\n\n.btn-outline {\n  @apply border-2 border-primary-400 text-primary-500 dark:text-primary-400 font-bold py-3 px-6 rounded-xl hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all duration-300 hover:scale-105 active:scale-95;\n}\n\n.btn-ghost {\n  @apply text-gray-700 dark:text-gray-300 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-card transition-all duration-200;\n}\n\n.btn-icon {\n  @apply w-12 h-12 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-dark-card transition-all duration-200 hover:scale-110 active:scale-95;\n}\n\n/* ğŸ´ Modern Card Styles */\n.card {\n  @apply bg-white/90 dark:bg-dark-card/90 backdrop-blur-xl rounded-3xl shadow-card border border-gray-200/50 dark:border-dark-border/50 transition-all duration-300 hover:shadow-card-hover hover:scale-[1.02];\n}\n\n.card-flat {\n  @apply bg-white/95 dark:bg-dark-card/95 backdrop-blur-sm rounded-2xl border border-gray-200/50 dark:border-dark-border/50 transition-all duration-200;\n}\n\n.card-gradient {\n  background: linear-gradient(135deg, #FF6B9D 0%, #FF8E53 50%, #C77DFF 100%);\n  @apply text-white rounded-3xl shadow-glow-lg p-6 transition-all duration-300 hover:scale-105 hover:shadow-glow;\n}\n\n.card-glass {\n  @apply bg-white/10 dark:bg-dark-card/20 backdrop-blur-2xl rounded-3xl border border-white/20 dark:border-white/10 shadow-xl transition-all duration-300;\n}\n\n.card-hover {\n  @apply hover:shadow-card-hover hover:-translate-y-1 transition-all duration-300;\n}\n\n/* ğŸ“ Modern Input Styles */\n.input-field {\n  @apply w-full px-5 py-3.5 bg-white/80 dark:bg-dark-card/80 backdrop-blur-sm border-2 border-gray-200 dark:border-dark-border rounded-xl focus:outline-none focus:border-primary-400 focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 placeholder:text-gray-400;\n}\n\n.input-field:focus {\n  @apply shadow-glow-primary;\n}\n\n.input-search {\n  @apply w-full pl-12 pr-4 py-3 bg-gray-100 dark:bg-dark-card rounded-full border-2 border-transparent focus:border-primary-400 focus:bg-white dark:focus:bg-dark-card-hover focus:outline-none transition-all duration-200;\n}\n\n.textarea-field {\n  @apply w-full px-5 py-3.5 bg-white/80 dark:bg-dark-card/80 backdrop-blur-sm border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:outline-none focus:border-primary-400 focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 resize-none;\n}\n\n/* ğŸ”— Link Styles */\n.link {\n  @apply bg-gradient-primary bg-clip-text text-transparent font-semibold hover:opacity-80 cursor-pointer transition-opacity duration-200;\n}\n\n.link-primary {\n  @apply text-primary-500 hover:text-primary-600 font-medium transition-colors duration-200;\n}\n\n/* ğŸ­ Glass Morphism Effects */\n.glass {\n  @apply bg-white/10 dark:bg-white/5 backdrop-blur-2xl border border-white/20 dark:border-white/10;\n}\n\n.glass-card {\n  @apply bg-white/20 dark:bg-dark-card/30 backdrop-blur-3xl rounded-3xl border border-white/30 dark:border-white/10 shadow-2xl;\n}\n\n/* ğŸ¬ Animations */\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.animate-fadeIn {\n  animation: fadeIn 0.4s ease-out;\n}\n\n@keyframes likeBurst {\n  0% {\n    opacity: 0;\n    transform: scale(0) rotate(-45deg);\n  }\n  50% {\n    opacity: 1;\n    transform: scale(1.3) rotate(0deg);\n  }\n  100% {\n    opacity: 0;\n    transform: scale(1.5) rotate(45deg);\n  }\n}\n\n.animate-like-burst {\n  animation: likeBurst 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;\n}\n\n@keyframes shimmer {\n  0% {\n    background-position: 200% 0;\n  }\n  100% {\n    background-position: -200% 0;\n  }\n}\n\n@keyframes float {\n  0%, 100% {\n    transform: translateY(0px) rotate(0deg);\n  }\n  50% {\n    transform: translateY(-20px) rotate(2deg);\n  }\n}\n\n.animate-float {\n  animation: float 6s ease-in-out infinite;\n}\n\n@keyframes glow-pulse {\n  0%, 100% {\n    box-shadow: 0 0 20px rgba(255, 61, 127, 0.4), 0 0 40px rgba(255, 61, 127, 0.2);\n  }\n  50% {\n    box-shadow: 0 0 40px rgba(152, 57, 255, 0.6), 0 0 60px rgba(152, 57, 255, 0.3);\n  }\n}\n\n.animate-glow-pulse {\n  animation: glow-pulse 3s ease-in-out infinite;\n}\n\n@keyframes slide-in-right {\n  from {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n\n.animate-slide-in-right {\n  animation: slide-in-right 0.3s ease-out;\n}\n\n@keyframes bounce-in {\n  0% {\n    transform: scale(0.3);\n    opacity: 0;\n  }\n  50% {\n    transform: scale(1.05);\n  }\n  70% {\n    transform: scale(0.9);\n  }\n  100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n\n.animate-bounce-in {\n  animation: bounce-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n}\n\n/* ğŸ’« Badge Styles */\n.badge {\n  @apply inline-flex items-center px-3 py-1 rounded-full text-xs font-bold;\n}\n\n.badge-primary {\n  @apply bg-gradient-primary text-white shadow-glow-primary;\n}\n\n.badge-success {\n  @apply bg-success-500 text-white;\n}\n\n.badge-warning {\n  @apply bg-warning-500 text-white;\n}\n\n.badge-danger {\n  @apply bg-danger-500 text-white;\n}\n\n/* ğŸ”” Notification Dot */\n.notification-dot {\n  @apply w-2.5 h-2.5 bg-danger-500 rounded-full animate-pulse-slow;\n}\n\n/* ğŸ“± Safe Area for iOS */\n.safe-bottom {\n  padding-bottom: env(safe-area-inset-bottom);\n}\n\n/* ğŸš« Hide Scrollbar but Keep Functionality */\n.scrollbar-hide::-webkit-scrollbar {\n  display: none;\n}\n.scrollbar-hide {\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n}\n\n/* ğŸ¯ Smooth Transitions */\n* {\n  transition-property: background-color, border-color, color, transform, opacity;\n  transition-duration: 200ms;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n/* ğŸŒˆ Gradient Text */\n.gradient-text {\n  @apply bg-gradient-primary bg-clip-text text-transparent font-bold;\n}\n\n.gradient-text-secondary {\n  @apply bg-gradient-secondary bg-clip-text text-transparent font-bold;\n}\n\n/* ğŸ’ Skeleton Loader */\n@keyframes skeleton-loading {\n  0% {\n    background-position: 200% 0;\n  }\n  100% {\n    background-position: -200% 0;\n  }\n}\n\n.skeleton {\n  @apply bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 dark:from-dark-card dark:via-dark-card-hover dark:to-dark-card rounded-2xl;\n  background-size: 200% 100%;\n  animation: skeleton-loading 1.5s ease-in-out infinite;\n}\n\n/* ğŸ¨ Backdrop Effects */\n.backdrop-gradient {\n  background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.7) 100%);\n}\n\n/* ğŸ“Š Progress Bar */\n.progress-bar {\n  @apply h-2 bg-gradient-primary rounded-full shadow-glow-primary;\n  animation: shimmer 2s ease infinite;\n}\n\n/* â­ Rating Stars */\n.star-rating {\n  @apply text-warning-400;\n}\n\n/* ğŸª Modal Overlay */\n.modal-overlay {\n  @apply fixed inset-0 bg-black/60 backdrop-blur-sm z-50;\n  animation: fade-in 0.2s ease-out;\n}\n\n/* ğŸ Tooltip */\n.tooltip {\n  @apply absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1.5 bg-gray-900 text-white text-xs rounded-lg opacity-0 pointer-events-none transition-opacity duration-200;\n}\n\n.tooltip-visible {\n  @apply opacity-100;\n}\n\n/* ğŸ® Interactive States */\n.interactive {\n  @apply cursor-pointer transition-all duration-200 hover:scale-105 active:scale-95;\n}\n\n.interactive-card {\n  @apply cursor-pointer transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1 active:translate-y-0;\n}\n\n/* ğŸŒŠ Wave Animation for Loading */\n@keyframes wave {\n  0%, 60%, 100% {\n    transform: initial;\n  }\n  30% {\n    transform: translateY(-15px);\n  }\n}\n\n.wave {\n  animation: wave 1.3s linear infinite;\n}\n\n.wave:nth-child(2) {\n  animation-delay: -1.1s;\n}\n\n.wave:nth-child(3) {\n  animation-delay: -0.9s;\n}\n","size_bytes":10035},"frontend/src/components/BottomNav.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { notificationAPI, messageAPI } from '../services/api';\nimport socketService from '../services/socket';\nimport {\n  AiOutlineHome,\n  AiFillHome,\n  AiOutlinePlusSquare,\n  AiOutlineHeart,\n  AiFillHeart,\n  AiOutlineMessage,\n  AiFillMessage,\n} from 'react-icons/ai';\nimport { BsCompass, BsCompassFill, BsFilm } from 'react-icons/bs';\n\nconst BottomNav = () => {\n  const { user } = useAuth();\n  const location = useLocation();\n  const [unreadNotifications, setUnreadNotifications] = useState(0);\n  const [unreadMessages, setUnreadMessages] = useState(0);\n\n  const isActive = (path) => location.pathname === path;\n\n  useEffect(() => {\n    fetchCounts();\n\n    const handleNotification = () => {\n      setUnreadNotifications(prev => prev + 1);\n    };\n\n    const handleNewMessage = (message) => {\n      const currentPath = window.location.pathname;\n      if (!currentPath.startsWith('/messages')) {\n        setUnreadMessages(prev => prev + 1);\n      }\n    };\n\n    const handleMessagesViewed = () => {\n      setUnreadMessages(0);\n    };\n\n    const handleNotificationsViewed = () => {\n      setUnreadNotifications(0);\n    };\n\n    socketService.on('notification', handleNotification);\n    socketService.on('newMessage', handleNewMessage);\n    window.addEventListener('messagesViewed', handleMessagesViewed);\n    window.addEventListener('notificationsViewed', handleNotificationsViewed);\n\n    return () => {\n      socketService.off('notification', handleNotification);\n      socketService.off('newMessage', handleNewMessage);\n      window.removeEventListener('messagesViewed', handleMessagesViewed);\n      window.removeEventListener('notificationsViewed', handleNotificationsViewed);\n    };\n  }, []);\n\n  const fetchCounts = async () => {\n    try {\n      const [notifResponse, messageResponse] = await Promise.all([\n        notificationAPI.getNotifications(),\n        messageAPI.getUnreadCount()\n      ]);\n      setUnreadNotifications(notifResponse.data.unreadCount || 0);\n      setUnreadMessages(messageResponse.data.data.count || 0);\n    } catch (error) {\n      console.error('Failed to fetch counts:', error);\n    }\n  };\n\n  return (\n    <div className=\"md:hidden fixed bottom-0 left-0 right-0 z-50 px-4 pb-6 safe-bottom pointer-events-none\">\n      <div className=\"card-glass backdrop-blur-3xl border-2 border-white/30 dark:border-white/10 rounded-[2rem] shadow-2xl pointer-events-auto overflow-hidden\">\n        {/* Gradient Background Effect */}\n        <div className=\"absolute inset-0 bg-gradient-mesh opacity-50\"></div>\n        \n        <div className=\"relative flex items-center justify-around h-16 px-2\">\n          {/* Home */}\n          <Link\n            to=\"/\"\n            className={`flex flex-col items-center justify-center flex-1 h-full transition-all duration-300 relative ${\n              isActive('/') ? 'scale-110' : 'scale-100'\n            }`}\n          >\n            {isActive('/') ? (\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 bg-primary-400 blur-xl opacity-60 rounded-full\"></div>\n                <div className=\"relative bg-gradient-primary p-2.5 rounded-2xl shadow-glow-primary\">\n                  <AiFillHome size={22} className=\"text-white\" />\n                </div>\n              </div>\n            ) : (\n              <AiOutlineHome size={26} className=\"text-gray-600 dark:text-gray-400\" />\n            )}\n          </Link>\n\n          {/* Explore */}\n          <Link\n            to=\"/explore\"\n            className={`flex flex-col items-center justify-center flex-1 h-full transition-all duration-300 relative ${\n              isActive('/explore') ? 'scale-110' : 'scale-100'\n            }`}\n          >\n            {isActive('/explore') ? (\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 bg-accent-400 blur-xl opacity-60 rounded-full\"></div>\n                <div className=\"relative bg-gradient-secondary p-2.5 rounded-2xl shadow-glow-secondary\">\n                  <BsCompassFill size={20} className=\"text-white\" />\n                </div>\n              </div>\n            ) : (\n              <BsCompass size={24} className=\"text-gray-600 dark:text-gray-400\" />\n            )}\n          </Link>\n\n          {/* Upload - Center Button */}\n          <Link\n            to=\"/upload\"\n            className=\"flex flex-col items-center justify-center flex-1 h-full transition-all duration-300 -mt-4\"\n          >\n            <div className=\"relative group\">\n              <div className=\"absolute inset-0 bg-gradient-sunset blur-xl opacity-80 rounded-full animate-pulse-slow\"></div>\n              <div className=\"relative bg-gradient-sunset p-4 rounded-[1.5rem] shadow-glow-lg group-hover:scale-110 transition-transform duration-300\">\n                <AiOutlinePlusSquare size={26} className=\"text-white\" />\n              </div>\n            </div>\n          </Link>\n\n          {/* Notifications */}\n          <Link\n            to=\"/notifications\"\n            className={`flex flex-col items-center justify-center flex-1 h-full transition-all duration-300 relative ${\n              isActive('/notifications') ? 'scale-110' : 'scale-100'\n            }`}\n          >\n            {isActive('/notifications') ? (\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 bg-danger-400 blur-xl opacity-60 rounded-full\"></div>\n                <div className=\"relative bg-gradient-to-r from-danger-400 to-danger-600 p-2.5 rounded-2xl shadow-glow\">\n                  <AiFillHeart size={22} className=\"text-white\" />\n                </div>\n              </div>\n            ) : (\n              <AiOutlineHeart size={26} className=\"text-gray-600 dark:text-gray-400\" />\n            )}\n            {unreadNotifications > 0 && (\n              <span className=\"absolute top-0 right-2 bg-danger-500 text-white text-[10px] rounded-full min-w-[18px] h-[18px] flex items-center justify-center font-bold shadow-lg border-2 border-white dark:border-dark-bg animate-pulse-slow\">\n                {unreadNotifications > 9 ? '9+' : unreadNotifications}\n              </span>\n            )}\n          </Link>\n\n          {/* Messages */}\n          <Link\n            to=\"/messages\"\n            className={`flex flex-col items-center justify-center flex-1 h-full transition-all duration-300 relative ${\n              isActive('/messages') ? 'scale-110' : 'scale-100'\n            }`}\n          >\n            {isActive('/messages') ? (\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 bg-info-400 blur-xl opacity-60 rounded-full\"></div>\n                <div className=\"relative bg-gradient-ocean p-2.5 rounded-2xl shadow-glow-accent\">\n                  <AiFillMessage size={22} className=\"text-white\" />\n                </div>\n              </div>\n            ) : (\n              <AiOutlineMessage size={26} className=\"text-gray-600 dark:text-gray-400\" />\n            )}\n            {unreadMessages > 0 && (\n              <span className=\"absolute top-0 right-2 bg-info-500 text-white text-[10px] rounded-full min-w-[18px] h-[18px] flex items-center justify-center font-bold shadow-lg border-2 border-white dark:border-dark-bg animate-pulse-slow\">\n                {unreadMessages > 9 ? '9+' : unreadMessages}\n              </span>\n            )}\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default BottomNav;\n","size_bytes":7529},"MONETIZATION_SETUP.md":{"content":"# friendflix Monetization Setup Guide\n\n## Overview\nfriendflix à¤…à¤¬ ads à¤•à¥‡ à¤¸à¤¾à¤¥ monetize à¤•à¤¿à¤¯à¤¾ à¤œà¤¾ à¤¸à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤¯à¤¹ guide à¤†à¤ªà¤•à¥‹ Google AdSense integration à¤”à¤° PWA installation à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤¬à¤¤à¤¾à¤à¤—à¥€à¥¤\n\n## ğŸ“± Progressive Web App (PWA) Installation\n\n### PC/Desktop à¤ªà¤° Install à¤•à¤°à¥‡à¤‚\n1. Chrome, Edge, à¤¯à¤¾ Safari à¤®à¥‡à¤‚ à¤…à¤ªà¤¨à¥€ friendflix website à¤–à¥‹à¤²à¥‡à¤‚\n2. Address bar à¤®à¥‡à¤‚ install icon (âŠ•) à¤¦à¤¿à¤–à¥‡à¤—à¤¾\n3. \"Install\" à¤ªà¤° click à¤•à¤°à¥‡à¤‚\n4. App à¤…à¤¬ à¤†à¤ªà¤•à¥‡ desktop à¤ªà¤° à¤à¤• native app à¤•à¥€ à¤¤à¤°à¤¹ à¤šà¤²à¥‡à¤—à¥€\n\n### Mobile (Android/iOS) à¤ªà¤° Install à¤•à¤°à¥‡à¤‚\n\n**Android:**\n1. Chrome browser à¤®à¥‡à¤‚ website à¤–à¥‹à¤²à¥‡à¤‚\n2. Menu (â‹®) â†’ \"Add to Home screen\" à¤ªà¤° tap à¤•à¤°à¥‡à¤‚\n3. App icon à¤†à¤ªà¤•à¥€ home screen à¤ªà¤° add à¤¹à¥‹ à¤œà¤¾à¤à¤—à¤¾\n\n**iOS:**\n1. Safari à¤®à¥‡à¤‚ website à¤–à¥‹à¤²à¥‡à¤‚\n2. Share button (â–¡â†‘) tap à¤•à¤°à¥‡à¤‚\n3. \"Add to Home Screen\" select à¤•à¤°à¥‡à¤‚\n4. Home screen à¤ªà¤° app icon à¤¦à¤¿à¤–à¥‡à¤—à¤¾\n\n### PWA Features\n- âœ… Offline access (à¤¬à¤¿à¤¨à¤¾ internet à¤•à¥‡ à¤­à¥€ à¤•à¤¾à¤® à¤•à¤°à¥‡à¤—à¤¾)\n- âœ… Push notifications\n- âœ… Native app à¤œà¥ˆà¤¸à¤¾ experience\n- âœ… Fast loading\n- âœ… App-like navigation\n\n## ğŸ’° Monetization Features\n\n### 1. Feed Ads (Posts à¤•à¥‡ à¤¬à¥€à¤š à¤®à¥‡à¤‚ Ads)\n\n**à¤•à¥ˆà¤¸à¥‡ à¤•à¤¾à¤® à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ:**\n- à¤¹à¤° 5th post à¤•à¥‡ à¤¬à¤¾à¤¦ à¤à¤• ad à¤¦à¤¿à¤–à¤¾à¤ˆ à¤¦à¥‡à¤—à¤¾\n- Users ad à¤•à¥‹ close à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚\n- Development mode à¤®à¥‡à¤‚ placeholder ads à¤¦à¤¿à¤–à¥‡à¤‚à¤—à¥‡\n\n**Configuration:**\nFile: `frontend/src/utils/adConfig.js`\n```javascript\nfeedAds: {\n  frequency: 5,  // à¤¹à¤° 5th post à¤•à¥‡ à¤¬à¤¾à¤¦ ad\n  position: 'after',\n}\n```\n\n### 2. Video Ads (Reels/Stories à¤®à¥‡à¤‚)\n\n**Ad Types:**\n- **Pre-roll**: Video start à¤¹à¥‹à¤¨à¥‡ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ (5 seconds) - **Reels à¤•à¥‡ à¤²à¤¿à¤ recommended**\n- **Mid-roll**: Long videos (>5 minutes) à¤•à¥‡ à¤¬à¥€à¤š à¤®à¥‡à¤‚ - **Shorts à¤®à¥‡à¤‚ à¤¨à¤¹à¥€à¤‚**\n- **Post-roll**: Video à¤–à¤¤à¥à¤® à¤¹à¥‹à¤¨à¥‡ à¤•à¥‡ à¤¬à¤¾à¤¦ - **Optional**\n\n**Important Note:**\n- Reels/Shorts (â‰¤60 seconds) à¤®à¥‡à¤‚ à¤¸à¤¿à¤°à¥à¤« **pre-roll ads** show à¤¹à¥‹à¤‚à¤—à¥‡\n- Mid-roll ads à¤¸à¤¿à¤°à¥à¤« long-form videos (>5 minutes) à¤•à¥‡ à¤²à¤¿à¤ à¤¹à¥ˆà¤‚\n  - âš ï¸ **Current Status**: Reels page à¤•à¥‡à¤µà¤² shorts (â‰¤60s) show à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ, à¤‡à¤¸à¤²à¤¿à¤ mid-roll ads currently inactive à¤¹à¥ˆà¤‚\n  - ğŸ’¡ **Future**: à¤…à¤—à¤° à¤†à¤ª long-form video page add à¤•à¤°à¥‡à¤‚ (à¤œà¥ˆà¤¸à¥‡ friendflix regular videos à¤¯à¤¾ IGTV), à¤¤à¥‹ mid-roll ads automatically à¤•à¤¾à¤® à¤•à¤°à¤¨à¥‡ à¤²à¤—à¥‡à¤‚à¤—à¥‡\n- Post-roll ads looping content à¤•à¥‡ à¤¸à¤¾à¤¥ intrusive à¤¹à¥‹ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚ (à¤‡à¤¸à¤²à¤¿à¤ disabled by default)\n\n**Features:**\n- 3 seconds à¤•à¥‡ à¤¬à¤¾à¤¦ \"Skip Ad\" button à¤¦à¤¿à¤–à¤¤à¤¾ à¤¹à¥ˆ\n- Automatic countdown timer\n- User-friendly interface\n- Smart detection: Mid-roll à¤•à¥‡à¤µà¤² eligible videos à¤ªà¤° à¤¹à¥€ trigger à¤¹à¥‹à¤—à¤¾\n\n**Configuration:**\n```javascript\nvideoAds: {\n  preRoll: {\n    enabled: true,\n    duration: 5,      // Ad à¤•à¥€ length (seconds)\n    skipAfter: 3,     // Skip button à¤•à¤¬ à¤¦à¤¿à¤–à¥‡\n  },\n  midRoll: {\n    enabled: true,\n    interval: 300,    // 5 minutes à¤•à¥‡ à¤¬à¤¾à¤¦ (à¤•à¥‡à¤µà¤² long videos à¤•à¥‡ à¤²à¤¿à¤)\n    duration: 5,\n    skipAfter: 3,\n  },\n  postRoll: {\n    enabled: false,   // Shorts à¤•à¥‡ à¤²à¤¿à¤ disabled à¤°à¤–à¥‡à¤‚\n    duration: 5,\n    skipAfter: 2,\n  }\n}\n```\n\n### 3. Reels Ads\n\nà¤¹à¤° 4th reel à¤•à¥‡ à¤¬à¤¾à¤¦ à¤à¤• pre-roll video ad à¤¦à¤¿à¤–à¤¾à¤ˆ à¤¦à¥‡à¤—à¥€à¥¤\n\n```javascript\nreelsAds: {\n  enabled: true,\n  frequency: 4,  // à¤¹à¤° 4th reel à¤•à¥‡ à¤¬à¤¾à¤¦\n}\n```\n\n## ğŸ”§ Google AdSense Setup\n\n### Step 1: AdSense Account à¤¬à¤¨à¤¾à¤à¤‚\n1. https://www.google.com/adsense à¤ªà¤° à¤œà¤¾à¤à¤‚\n2. \"Get Started\" à¤ªà¤° click à¤•à¤°à¥‡à¤‚\n3. à¤…à¤ªà¤¨à¥€ website URL submit à¤•à¤°à¥‡à¤‚\n4. Account verification complete à¤•à¤°à¥‡à¤‚\n\n### Step 2: Ad Units Create à¤•à¤°à¥‡à¤‚\n\nAdSense Dashboard à¤®à¥‡à¤‚:\n1. **Ads** â†’ **By ad unit** â†’ **Display ads** à¤ªà¤° à¤œà¤¾à¤à¤‚\n2. à¤¤à¥€à¤¨ ad units create à¤•à¤°à¥‡à¤‚:\n   - `Feed Ad` (Responsive)\n   - `Sidebar Ad` (Responsive)\n   - `Footer Ad` (Responsive)\n3. à¤ªà¥à¤°à¤¤à¥à¤¯à¥‡à¤• ad unit à¤•à¤¾ **Ad Slot ID** copy à¤•à¤°à¥‡à¤‚\n\n### Step 3: Configuration Update à¤•à¤°à¥‡à¤‚\n\nFile: `frontend/src/utils/adConfig.js`\n\n```javascript\nexport const AD_CONFIG = {\n  enabled: true,\n  \n  adsense: {\n    client: 'ca-pub-YOUR_PUBLISHER_ID',  // â¬…ï¸ à¤…à¤ªà¤¨à¤¾ Client ID à¤¯à¤¹à¤¾à¤ à¤¡à¤¾à¤²à¥‡à¤‚\n    slots: {\n      feedAd: 'YOUR_FEED_AD_SLOT_ID',    // â¬…ï¸ Feed ad à¤•à¤¾ slot ID\n      sidebarAd: 'YOUR_SIDEBAR_SLOT_ID', // â¬…ï¸ Sidebar ad à¤•à¤¾ slot ID\n      footerAd: 'YOUR_FOOTER_SLOT_ID',   // â¬…ï¸ Footer ad à¤•à¤¾ slot ID\n    }\n  },\n  \n  // ... rest of config\n};\n```\n\n### Step 4: Website Verify à¤•à¤°à¥‡à¤‚\n\n1. AdSense dashboard à¤®à¥‡à¤‚ à¤…à¤ªà¤¨à¥€ website add à¤•à¤°à¥‡à¤‚\n2. Verification code à¤†à¤ªà¤•à¥‡ `frontend/index.html` à¤®à¥‡à¤‚ already à¤¹à¥ˆ\n3. AdSense review process complete à¤¹à¥‹à¤¨à¥‡ à¤¤à¤• wait à¤•à¤°à¥‡à¤‚ (1-7 days)\n\n### Step 5: Ads Enable à¤•à¤°à¥‡à¤‚\n\nProduction deploy à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤¬à¤¾à¤¦:\n1. Ads automatically show à¤¹à¥‹à¤¨à¥‡ à¤²à¤—à¥‡à¤‚à¤—à¥‡\n2. Development mode à¤®à¥‡à¤‚ placeholder ads à¤¦à¤¿à¤–à¥‡à¤‚à¤—à¥‡\n\n## ğŸ“Š Revenue Optimization Tips\n\n### Ad Placement\n- âœ… Feed à¤®à¥‡à¤‚ natural placement (à¤¹à¤° 5th post)\n- âœ… Video ads à¤•à¥‹ skip-able à¤¬à¤¨à¤¾à¤à¤‚ (better UX)\n- âœ… Mobile-friendly ad sizes use à¤•à¤°à¥‡à¤‚\n\n### Ad Frequency\n- à¤•à¤® ads = Better user experience\n- à¤œà¥à¤¯à¤¾à¤¦à¤¾ ads = à¤œà¥à¤¯à¤¾à¤¦à¤¾ revenue but users unhappy\n- **Recommended**: 5-7 posts à¤•à¥‡ à¤¬à¤¾à¤¦ à¤à¤• ad\n\n### Testing\n```javascript\n// Ads disable à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤:\nexport const AD_CONFIG = {\n  enabled: false,  // à¤¸à¤­à¥€ ads temporarily disable\n  // ...\n}\n```\n\n## ğŸ’¡ Advanced Features\n\n### Custom Ad Networks\n\nAdSense à¤•à¥‡ à¤…à¤²à¤¾à¤µà¤¾ à¤†à¤ª à¤¯à¥‡ à¤­à¥€ use à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚:\n- **Media.net** (contextual ads)\n- **PropellerAds** (pop-unders, native ads)\n- **AdThrive** (premium content creators à¤•à¥‡ à¤²à¤¿à¤)\n- **Ezoic** (AI-powered ad optimization)\n\n### Affiliate Marketing\n\nProducts promote à¤•à¤°à¥‡à¤‚ à¤”à¤° commission earn à¤•à¤°à¥‡à¤‚:\n```jsx\n// Example: Amazon affiliate link in post\n<a href=\"https://amzn.to/PRODUCT_ID\" target=\"_blank\">\n  Buy Now\n</a>\n```\n\n### Sponsored Posts\n\nBrands à¤•à¥‡ à¤¸à¤¾à¤¥ partnership à¤•à¤°à¥‡à¤‚:\n- â‚¹5,000 - â‚¹50,000 per sponsored post\n- Dedicated post à¤¯à¤¾ story\n- Analytics share à¤•à¤°à¥‡à¤‚ (views, engagement)\n\n## ğŸ¯ Next Steps\n\n1. âœ… **AdSense Account Setup** à¤•à¤°à¥‡à¤‚\n2. âœ… **Ad Configuration** update à¤•à¤°à¥‡à¤‚\n3. âœ… **Test à¤•à¤°à¥‡à¤‚** development à¤®à¥‡à¤‚\n4. âœ… **Deploy à¤•à¤°à¥‡à¤‚** production à¤ªà¤°\n5. âœ… **Monitor à¤•à¤°à¥‡à¤‚** ad performance\n\n## ğŸ“ Support\n\nQuestions? Check:\n- Google AdSense Help Center\n- friendflix GitHub Issues\n- Developer Documentation\n\n---\n\n**Remember**: \n- Ads à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤…à¤šà¥à¤›à¤¾ content à¤¬à¤¨à¤¾à¤à¤‚\n- User experience à¤•à¥‹ priority à¤¦à¥‡à¤‚\n- AdSense policies follow à¤•à¤°à¥‡à¤‚ (no invalid clicks!)\n\nHappy Monetizing! ğŸ’°\n","size_bytes":7328},"frontend/src/pages/Messages.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { messageAPI } from '../services/api';\nimport socketService from '../services/socket';\nimport Loader from '../components/Loader';\nimport { timeAgo } from '../utils/timeAgo';\nimport toast from 'react-hot-toast';\nimport { \n  AiOutlineMessage, \n  AiOutlineSearch, \n  AiOutlineFilter,\n  AiOutlinePlus,\n  AiOutlineCheck,\n  AiOutlineStar,\n  AiOutlineMore\n} from 'react-icons/ai';\nimport { FiUsers, FiArchive } from 'react-icons/fi';\n\nconst Messages = () => {\n  const navigate = useNavigate();\n  const [conversations, setConversations] = useState([]);\n  const [filteredConversations, setFilteredConversations] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [onlineUsers, setOnlineUsers] = useState(new Set());\n  const [typingUsers, setTypingUsers] = useState(new Set());\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchResults, setSearchResults] = useState([]);\n  const [activeFilter, setActiveFilter] = useState('all'); // all, unread, online, starred\n  const [showFilters, setShowFilters] = useState(false);\n\n  // Filter conversations based on search query and active filter\n  useEffect(() => {\n    let filtered = [...conversations];\n\n    // Apply search filter\n    if (searchQuery.trim()) {\n      filtered = filtered.filter(conversation =>\n        conversation.user.username.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        conversation.user.fullName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        conversation.lastMessage.text.toLowerCase().includes(searchQuery.toLowerCase())\n      );\n    }\n\n    // Apply category filter\n    switch (activeFilter) {\n      case 'unread':\n        filtered = filtered.filter(conversation => conversation.unreadCount > 0);\n        break;\n      case 'online':\n        filtered = filtered.filter(conversation => onlineUsers.has(conversation.user._id));\n        break;\n      case 'starred':\n        filtered = filtered.filter(conversation => conversation.isStarred);\n        break;\n      default:\n        // 'all' - no additional filtering\n        break;\n    }\n\n    setFilteredConversations(filtered);\n  }, [conversations, searchQuery, activeFilter, onlineUsers]);\n\n  useEffect(() => {\n    fetchConversations();\n\n    const handleNewMessage = (message) => {\n      console.log('ğŸ“¨ New message in conversation list:', message);\n      fetchConversations();\n    };\n\n    const handleUserOnline = (userId) => {\n      console.log('âœ… User online:', userId);\n      setOnlineUsers((prev) => new Set([...prev, userId]));\n    };\n\n    const handleUserOffline = (userId) => {\n      console.log('âŒ User offline:', userId);\n      setOnlineUsers((prev) => {\n        const newSet = new Set(prev);\n        newSet.delete(userId);\n        return newSet;\n      });\n    };\n\n    // Listen for events\n    socketService.on('newMessage', handleNewMessage);\n    socketService.on('userOnline', handleUserOnline);\n    socketService.on('userOffline', handleUserOffline);\n    \n    // Listen for typing\n    socketService.on('typing', (userId) => {\n      setTypingUsers(prev => new Set([...prev, userId]));\n    });\n    \n    socketService.on('stopTyping', (userId) => {\n      setTypingUsers(prev => {\n        const newSet = new Set(prev);\n        newSet.delete(userId);\n        return newSet;\n      });\n    });\n\n    // Live message search debounce\n    const id = setTimeout(async () => {\n      if (searchQuery.trim().length > 2) {\n        try {\n          const res = await messageAPI.searchMessages(searchQuery);\n          setSearchResults(res.data.data);\n        } catch {}\n      } else {\n        setSearchResults([]);\n      }\n    }, 300);\n\n    return () => {\n      socketService.off('newMessage', handleNewMessage);\n      socketService.off('userOnline', handleUserOnline);\n      socketService.off('userOffline', handleUserOffline);\n      socketService.off('typing');\n      socketService.off('stopTyping');\n      clearTimeout(id);\n    };\n  }, []);\n\n  const fetchConversations = async () => {\n    try {\n      const response = await messageAPI.getConversations();\n      setConversations(response.data.data);\n      \n      // Emit event to reset message count in navbar/bottomnav\n      window.dispatchEvent(new CustomEvent('messagesViewed'));\n    } catch (error) {\n      console.error('Failed to load conversations:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleMarkAsRead = async (conversationId) => {\n    try {\n      await messageAPI.markConversationAsRead(conversationId);\n      fetchConversations();\n      toast.success('Conversation marked as read');\n    } catch (error) {\n      console.error('Failed to mark as read:', error);\n      toast.error('Failed to mark as read');\n    }\n  };\n\n  const handleToggleStar = async (conversationId) => {\n    try {\n      const response = await messageAPI.toggleStarConversation(conversationId);\n      fetchConversations();\n      toast.success(response.data.data.message);\n    } catch (error) {\n      console.error('Failed to toggle star:', error);\n      toast.error('Failed to toggle star');\n    }\n  };\n\n  const handleArchiveConversation = async (conversationId) => {\n    try {\n      const response = await messageAPI.toggleArchiveConversation(conversationId);\n      fetchConversations();\n      toast.success(response.data.data.message);\n    } catch (error) {\n      console.error('Failed to archive conversation:', error);\n      toast.error('Failed to archive conversation');\n    }\n  };\n\n  const handleMarkAllAsRead = async () => {\n    try {\n      await messageAPI.markAllConversationsAsRead();\n      fetchConversations();\n      toast.success('All conversations marked as read');\n    } catch (error) {\n      console.error('Failed to mark all as read:', error);\n      toast.error('Failed to mark all as read');\n    }\n  };\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto px-4 py-8 pb-20 md:pb-8\">\n      {/* Header with Title and Actions */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-2xl font-bold dark:text-white\">Messages</h1>\n        <div className=\"flex items-center space-x-2\">\n          <button\n            onClick={handleMarkAllAsRead}\n            className=\"p-2 text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition\"\n            title=\"Mark all as read\"\n          >\n            <AiOutlineCheck size={20} />\n          </button>\n          <button\n            onClick={() => navigate('/groups')}\n            className=\"p-2 text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition\"\n            title=\"View groups\"\n          >\n            <FiUsers size={20} />\n          </button>\n          {/* Removed New Message shortcut to avoid duplicate search controls */}\n\n        </div>\n      </div>\n\n      {/* Search Conversations - Keep this one since it searches within messages */}\n      <div className=\"mb-4\">\n        <div className=\"relative\">\n          <AiOutlineSearch className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" size={20} />\n          <input\n            type=\"text\"\n            placeholder=\"Search conversations...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"w-full pl-10 pr-4 py-3 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white\"\n          />\n        </div>\n      </div>\n\n      {/* Filter Tabs */}\n      <div className=\"mb-4\">\n        <div className=\"flex items-center space-x-1 bg-gray-100 dark:bg-gray-800 rounded-lg p-1\">\n          {[\n            { key: 'all', label: 'All', icon: AiOutlineMessage },\n            { key: 'unread', label: 'Unread', icon: AiOutlineCheck },\n            { key: 'online', label: 'Online', icon: FiUsers },\n            { key: 'starred', label: 'Starred', icon: AiOutlineStar }\n          ].map(({ key, label, icon: Icon }) => (\n            <button\n              key={key}\n              onClick={() => setActiveFilter(key)}\n              className={`flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition ${\n                activeFilter === key\n                  ? 'bg-white dark:bg-gray-700 text-primary shadow-sm'\n                  : 'text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary'\n              }`}\n            >\n              <Icon size={16} />\n              <span>{label}</span>\n              {key === 'unread' && conversations.filter(c => c.unreadCount > 0).length > 0 && (\n                <span className=\"bg-red-500 text-white text-xs rounded-full px-2 py-0.5\">\n                  {conversations.filter(c => c.unreadCount > 0).length}\n                </span>\n              )}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Search Results */}\n      {searchQuery.trim().length > 2 && (\n        <div className=\"card dark:bg-gray-800 dark:border-gray-700 mb-6\">\n          <div className=\"p-4 border-b dark:border-gray-700 flex items-center justify-between\">\n            <h2 className=\"font-semibold dark:text-white\">Messages matching \"{searchQuery}\"</h2>\n            <span className=\"text-xs text-gray-500 dark:text-gray-400\">{searchResults.length} found</span>\n          </div>\n          {searchResults.length === 0 ? (\n            <div className=\"p-4 text-sm text-gray-500 dark:text-gray-400\">No matches</div>\n          ) : (\n            <div className=\"divide-y dark:divide-gray-700\">\n              {searchResults.map((msg) => (\n                <div key={msg._id} className=\"p-4 flex items-center gap-3\">\n                  <img src={msg.sender._id === msg.receiver._id ? msg.sender.avatar : msg.sender.avatar} alt={msg.sender.username} className=\"h-8 w-8 rounded-full\" />\n                  <div className=\"flex-1\">\n                    <div className=\"text-sm dark:text-white\">\n                      <span className=\"font-semibold\">{msg.sender.username}</span>\n                      <span className=\"text-gray-500 dark:text-gray-400\"> â†’ </span>\n                      <span className=\"font-semibold\">{msg.receiver.username}</span>\n                      <span className=\"text-xs text-gray-500 dark:text-gray-400 ml-2\">{timeAgo(msg.createdAt)}</span>\n                    </div>\n                    <div className=\"text-sm text-gray-700 dark:text-gray-300 break-words\">\n                      {msg.text || msg.fileName || '[attachment]'}\n                    </div>\n                  </div>\n                  <button\n                    onClick={() => navigate(`/messages/${msg.sender.username}`)}\n                    className=\"px-3 py-1 text-xs bg-primary text-white rounded\"\n                  >\n                    Open\n                  </button>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n        {filteredConversations.length === 0 ? (\n          <div className=\"p-12 text-center\">\n            <AiOutlineMessage size={64} className=\"mx-auto text-gray-400 mb-4\" />\n            <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n              {searchQuery || activeFilter !== 'all' \n                ? 'No conversations match your search' \n                : 'No messages yet'\n              }\n            </p>\n            {!searchQuery && activeFilter === 'all' && (\n              <Link to=\"/search\" className=\"btn-primary\">\n                Find People to Message\n              </Link>\n            )}\n          </div>\n        ) : (\n          <div className=\"divide-y divide-gray-200 dark:divide-gray-700\">\n            {filteredConversations.map((conversation) => (\n              <div\n                key={conversation.user._id}\n                className=\"flex items-center space-x-4 p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition relative group\"\n              >\n                {/* Main conversation link */}\n                <Link\n                  to={`/messages/${conversation.user.username}`}\n                  className=\"flex items-center space-x-4 flex-1 min-w-0\"\n                >\n                  <div className=\"relative flex-shrink-0\">\n                    <img\n                      src={conversation.user.avatar}\n                      alt={conversation.user.username}\n                      className=\"h-14 w-14 rounded-full object-cover border-2 border-gray-200 dark:border-gray-600\"\n                    />\n                    {/* Online Status */}\n                    {onlineUsers.has(conversation.user._id) && (\n                      <span className=\"absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full z-10\"></span>\n                    )}\n                    {/* Unread Badge */}\n                    {conversation.unreadCount > 0 && (\n                      <div className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-semibold z-10\">\n                        {conversation.unreadCount > 9 ? '9+' : conversation.unreadCount}\n                      </div>\n                    )}\n                    {/* Starred indicator */}\n                    {conversation.isStarred && (\n                      <div className=\"absolute -top-1 -left-1 bg-yellow-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center z-10\">\n                        <AiOutlineStar size={12} />\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <p className=\"font-semibold dark:text-white truncate\">\n                        {conversation.user.username}\n                      </p>\n                      <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                        {timeAgo(conversation.lastMessage.createdAt)}\n                      </span>\n                    </div>\n                    <p\n                      className={`text-sm truncate ${\n                        conversation.unreadCount > 0\n                          ? 'font-semibold text-black dark:text-white'\n                          : 'text-gray-600 dark:text-gray-400'\n                      }`}\n                    >\n                      {typingUsers.has(conversation.user._id) ? (\n                        <span className=\"text-primary italic animate-pulse\">typing...</span>\n                      ) : (\n                        conversation.lastMessage.text\n                      )}\n                    </p>\n                  </div>\n                </Link>\n\n                {/* Action buttons */}\n                <div className=\"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                  {conversation.unreadCount > 0 && (\n                    <button\n                      onClick={(e) => {\n                        e.preventDefault();\n                        handleMarkAsRead(conversation.user._id);\n                      }}\n                      className=\"p-2 text-gray-400 hover:text-green-500 transition\"\n                      title=\"Mark as read\"\n                    >\n                      <AiOutlineCheck size={16} />\n                    </button>\n                  )}\n                  <button\n                    onClick={(e) => {\n                      e.preventDefault();\n                      handleToggleStar(conversation.user._id);\n                    }}\n                    className={`p-2 transition ${\n                      conversation.isStarred \n                        ? 'text-yellow-500' \n                        : 'text-gray-400 hover:text-yellow-500'\n                    }`}\n                    title={conversation.isStarred ? \"Remove from starred\" : \"Add to starred\"}\n                  >\n                    <AiOutlineStar size={16} />\n                  </button>\n                  <button\n                    onClick={(e) => {\n                      e.preventDefault();\n                      handleArchiveConversation(conversation.user._id);\n                    }}\n                    className=\"p-2 text-gray-400 hover:text-orange-500 transition\"\n                    title=\"Archive conversation\"\n                  >\n                    <FiArchive size={16} />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n    </div>\n  );\n};\n\nexport default Messages;\n","size_bytes":16560},"frontend/src/pages/WatchLater.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { watchLaterAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { FiClock, FiTrash2, FiX } from 'react-icons/fi';\nimport Navbar from '../components/Navbar';\nimport BottomNav from '../components/BottomNav';\nimport Loader from '../components/Loader';\n\nfunction WatchLater() {\n  const [videos, setVideos] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    fetchWatchLater();\n  }, []);\n\n  const fetchWatchLater = async () => {\n    try {\n      setLoading(true);\n      const response = await watchLaterAPI.getWatchLater();\n      setVideos(response.data.videos || []);\n    } catch (error) {\n      console.error('Error fetching Watch Later:', error);\n      toast.error('Failed to load Watch Later');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRemove = async (postId) => {\n    try {\n      await watchLaterAPI.removeFromWatchLater(postId);\n      setVideos(videos.filter((v) => v.post._id !== postId));\n      toast.success('Removed from Watch Later');\n    } catch (error) {\n      console.error('Error removing video:', error);\n      toast.error('Failed to remove video');\n    }\n  };\n\n  const handleClearAll = async () => {\n    if (!confirm('Are you sure you want to clear all videos from Watch Later?')) return;\n\n    try {\n      await watchLaterAPI.clearWatchLater();\n      setVideos([]);\n      toast.success('Watch Later cleared');\n    } catch (error) {\n      console.error('Error clearing Watch Later:', error);\n      toast.error('Failed to clear Watch Later');\n    }\n  };\n\n  if (loading) return <Loader />;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <Navbar />\n      \n      <div className=\"max-w-7xl mx-auto px-4 py-6 pb-20\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <div className=\"flex items-center gap-3\">\n            <FiClock className=\"w-8 h-8 text-purple-500\" />\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Watch Later</h1>\n          </div>\n          {videos.length > 0 && (\n            <button\n              onClick={handleClearAll}\n              className=\"flex items-center gap-2 px-4 py-2 text-red-500 border border-red-500 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20\"\n            >\n              <FiTrash2 /> Clear All\n            </button>\n          )}\n        </div>\n\n        {videos.length === 0 ? (\n          <div className=\"text-center py-20\">\n            <FiClock className=\"w-20 h-20 mx-auto text-gray-300 dark:text-gray-700 mb-4\" />\n            <p className=\"text-gray-500 dark:text-gray-400 text-lg\">No videos in Watch Later</p>\n            <p className=\"text-gray-400 dark:text-gray-500 text-sm mt-2\">\n              Save videos to watch them later\n            </p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n            {videos.map(({ post, addedAt }) => (\n              <div\n                key={post._id}\n                className=\"bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition group relative\"\n              >\n                <div\n                  className=\"cursor-pointer\"\n                  onClick={() => navigate(post.category === 'short' ? `/reels/${post._id}` : `/videos/${post._id}`)}\n                >\n                  <div className=\"aspect-video bg-gray-200 dark:bg-gray-700 rounded-t-lg overflow-hidden\">\n                    {post.media && post.media[0] && (\n                      <img\n                        src={post.thumbnailUrl || post.media[0].url}\n                        alt={post.title}\n                        className=\"w-full h-full object-cover\"\n                      />\n                    )}\n                  </div>\n                  <div className=\"p-3\">\n                    <h3 className=\"font-semibold text-gray-900 dark:text-white line-clamp-2 mb-1\">\n                      {post.title || 'Untitled'}\n                    </h3>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {post.author?.username}\n                    </p>\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Added {new Date(addedAt).toLocaleDateString()}\n                    </p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => handleRemove(post._id)}\n                  className=\"absolute top-2 right-2 bg-black bg-opacity-70 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition\"\n                >\n                  <FiX />\n                </button>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <BottomNav />\n    </div>\n  );\n}\n\nexport default WatchLater;\n","size_bytes":4912},"frontend/src/pages/VideoCall.jsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\nimport {\n  AiOutlineVideoCamera,\n  AiOutlineAudio,\n  AiOutlinePhone,\n  AiOutlineVideoCameraAdd,\n} from 'react-icons/ai';\nimport { BsMicMute, BsMic, BsCameraVideo, BsCameraVideoOff } from 'react-icons/bs';\n\nconst VideoCall = () => {\n  const { roomId } = useParams();\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  \n  const [localStream, setLocalStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isVideoOff, setIsVideoOff] = useState(false);\n  const [isInitiator, setIsInitiator] = useState(false);\n  const [callStatus, setCallStatus] = useState('connecting'); // connecting, connected, ended\n  const [callDuration, setCallDuration] = useState(0);\n\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const peerConnection = useRef(null);\n  const durationInterval = useRef(null);\n\n  useEffect(() => {\n    initializeCall();\n    socketService.emit('call:join', { roomId });\n\n    // Socket signaling handlers\n    socketService.on('call:offer', async ({ offer }) => {\n      if (!peerConnection.current) return;\n      await peerConnection.current.setRemoteDescription(offer);\n      const answer = await peerConnection.current.createAnswer();\n      await peerConnection.current.setLocalDescription(answer);\n      socketService.emit('call:answer', { roomId, answer, from: user._id });\n    });\n\n    socketService.on('call:answer', async ({ answer }) => {\n      if (!peerConnection.current) return;\n      await peerConnection.current.setRemoteDescription(answer);\n      setCallStatus('connected');\n      startCallDuration();\n    });\n\n    socketService.on('call:ice-candidate', async ({ candidate }) => {\n      try {\n        await peerConnection.current?.addIceCandidate(candidate);\n      } catch (e) {\n        console.error('Failed to add ICE candidate', e);\n      }\n    });\n\n    socketService.on('endCall', () => {\n      endCall();\n    });\n\n    return () => {\n      endCall();\n      socketService.off('call:offer');\n      socketService.off('call:answer');\n      socketService.off('call:ice-candidate');\n      socketService.off('endCall');\n    };\n  }, []);\n\n  const initializeCall = async () => {\n    try {\n      // Get user media\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: true,\n        audio: true,\n      });\n      \n      setLocalStream(stream);\n      if (localVideoRef.current) {\n        localVideoRef.current.srcObject = stream;\n      }\n\n      // Setup WebRTC (simplified version)\n      setupPeerConnection(stream);\n      \n      toast.success('Camera and microphone ready');\n    } catch (error) {\n      console.error('Failed to get user media:', error);\n      toast.error('Failed to access camera/microphone');\n    }\n  };\n\n  const setupPeerConnection = async (stream) => {\n    const configuration = {\n      iceServers: [\n        { urls: 'stun:stun.l.google.com:19302' },\n        ...(function(){\n          try {\n            const env = import.meta.env.VITE_TURN_SERVERS;\n            if (!env) return [];\n            const servers = JSON.parse(env);\n            return servers;\n          } catch {\n            return [];\n          }\n        })(),\n      ],\n    };\n    const pc = new RTCPeerConnection(configuration);\n    peerConnection.current = pc;\n\n    // Add local tracks\n    stream.getTracks().forEach((track) => pc.addTrack(track, stream));\n\n    // Remote stream\n    const remote = new MediaStream();\n    setRemoteStream(remote);\n    if (remoteVideoRef.current) {\n      remoteVideoRef.current.srcObject = remote;\n    }\n    pc.ontrack = (event) => {\n      event.streams[0].getTracks().forEach((track) => remote.addTrack(track));\n    };\n\n    // ICE candidates\n    pc.onicecandidate = (event) => {\n      if (event.candidate) {\n        socketService.emit('call:ice-candidate', { roomId, candidate: event.candidate });\n      }\n    };\n\n    setCallStatus('connecting');\n  };\n\n  const startCallDuration = () => {\n    durationInterval.current = setInterval(() => {\n      setCallDuration((prev) => prev + 1);\n    }, 1000);\n  };\n\n  const startCall = async () => {\n    try {\n      setIsInitiator(true);\n      if (!peerConnection.current) return toast.error('Call not ready');\n      const offer = await peerConnection.current.createOffer();\n      await peerConnection.current.setLocalDescription(offer);\n      socketService.emit('call:offer', { roomId, offer, from: user._id });\n    } catch (e) {\n      console.error('Failed to start call', e);\n      toast.error('Failed to start call');\n    }\n  };\n\n  const toggleMute = () => {\n    if (localStream) {\n      localStream.getAudioTracks().forEach((track) => {\n        track.enabled = !track.enabled;\n      });\n      setIsMuted(!isMuted);\n    }\n  };\n\n  const toggleVideo = () => {\n    if (localStream) {\n      localStream.getVideoTracks().forEach((track) => {\n        track.enabled = !track.enabled;\n      });\n      setIsVideoOff(!isVideoOff);\n    }\n  };\n\n  const endCall = () => {\n    if (localStream) {\n      localStream.getTracks().forEach((track) => track.stop());\n    }\n    if (remoteStream) {\n      remoteStream.getTracks().forEach((track) => track.stop());\n    }\n    if (durationInterval.current) {\n      clearInterval(durationInterval.current);\n    }\n    setCallStatus('ended');\n    \n    // Emit socket event\n    socketService.emit('endCall', { roomId });\n    \n    setTimeout(() => {\n      navigate('/messages');\n    }, 2000);\n  };\n\n  const formatDuration = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"h-screen bg-gradient-to-br from-purple-900 via-pink-900 to-black flex flex-col\">\n      {/* Remote Video (Full Screen) */}\n      <div className=\"flex-1 relative\">\n        {remoteStream ? (\n          <video\n            ref={remoteVideoRef}\n            autoPlay\n            playsInline\n            className=\"w-full h-full object-cover\"\n          />\n        ) : (\n          <div className=\"w-full h-full flex flex-col items-center justify-center text-white\">\n            <div className=\"w-32 h-32 bg-gradient-primary rounded-full flex items-center justify-center mb-4 animate-pulse\">\n              <AiOutlineVideoCamera size={64} />\n            </div>\n            <p className=\"text-2xl font-bold mb-2\">Calling...</p>\n            <p className=\"text-purple-200\">Waiting for response</p>\n          </div>\n        )}\n\n        {/* Local Video (Picture-in-Picture) */}\n        <div className=\"absolute top-4 right-4 w-32 h-48 md:w-48 md:h-64 rounded-3xl overflow-hidden shadow-glow border-2 border-white/30\">\n          <video\n            ref={localVideoRef}\n            autoPlay\n            playsInline\n            muted\n            className=\"w-full h-full object-cover\"\n          />\n          {isVideoOff && (\n            <div className=\"absolute inset-0 bg-gray-900 flex items-center justify-center\">\n              <BsCameraVideoOff className=\"text-white\" size={32} />\n            </div>\n          )}\n        </div>\n\n        {/* Call Info */}\n        <div className=\"absolute top-4 left-4 bg-black/50 backdrop-blur-lg rounded-2xl px-6 py-3 text-white\">\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-3 h-3 bg-red-500 rounded-full animate-pulse\"></div>\n            <span className=\"font-semibold\">{formatDuration(callDuration)}</span>\n          </div>\n        </div>\n\n        {/* Call Status */}\n        {callStatus === 'connecting' && (\n          <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center\">\n            <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-white mb-4\"></div>\n            <p className=\"text-white text-xl font-semibold\">Connecting...</p>\n          </div>\n        )}\n      </div>\n\n      {/* Controls */}\n      <div className=\"p-8 bg-black/50 backdrop-blur-lg\">\n        <div className=\"flex items-center justify-center space-x-6\">\n          {/* Mute */}\n          <button\n            onClick={toggleMute}\n            className={`w-16 h-16 rounded-full flex items-center justify-center transition-all ${\n              isMuted\n                ? 'bg-red-500 hover:bg-red-600'\n                : 'bg-white/20 hover:bg-white/30'\n            }`}\n          >\n            {isMuted ? (\n              <BsMicMute className=\"text-white\" size={24} />\n            ) : (\n              <BsMic className=\"text-white\" size={24} />\n            )}\n          </button>\n\n          {/* Video Toggle */}\n          <button\n            onClick={toggleVideo}\n            className={`w-16 h-16 rounded-full flex items-center justify-center transition-all ${\n              isVideoOff\n                ? 'bg-red-500 hover:bg-red-600'\n                : 'bg-white/20 hover:bg-white/30'\n            }`}\n          >\n            {isVideoOff ? (\n              <BsCameraVideoOff className=\"text-white\" size={24} />\n            ) : (\n              <BsCameraVideo className=\"text-white\" size={24} />\n            )}\n          </button>\n\n          {/* End Call */}\n          <button\n            onClick={endCall}\n            className=\"w-20 h-20 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center transition-all hover:scale-110 shadow-glow\"\n          >\n            <AiOutlinePhone className=\"text-white rotate-135\" size={32} />\n          </button>\n\n          {/* Start Call */}\n          <button\n            onClick={startCall}\n            className=\"w-16 h-16 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-all\"\n            title=\"Start Call\"\n          >\n            <AiOutlineVideoCamera className=\"text-white\" size={24} />\n          </button>\n        </div>\n      </div>\n\n      {/* Call Ended Overlay */}\n      {callStatus === 'ended' && (\n        <div className=\"absolute inset-0 bg-black/90 flex items-center justify-center z-50\">\n          <div className=\"text-center text-white\">\n            <div className=\"text-6xl mb-4\">ğŸ“</div>\n            <h2 className=\"text-3xl font-bold mb-2\">Call Ended</h2>\n            <p className=\"text-xl text-purple-200 mb-2\">\n              Duration: {formatDuration(callDuration)}\n            </p>\n            <p className=\"text-gray-400\">Redirecting...</p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default VideoCall;\n","size_bytes":10653},"frontend/tailwind.config.js":{"content":"/** @type {import('tailwindcss').Config} */\nexport default {\n  darkMode: 'class',\n  content: [\n    \"./index.html\",\n    \"./src/**/*.{js,ts,jsx,tsx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        // ğŸŒ… Sunset Dream Color Scheme - Fresh & Modern\n        primary: {\n          50: '#FFF1F7',\n          100: '#FFE4F0',\n          200: '#FFC9E0',\n          300: '#FF9EC9',\n          400: '#FF6BA3',\n          500: '#FF3D7F',\n          600: '#FF1B5E',\n          700: '#E0004D',\n          800: '#B80040',\n          900: '#940034',\n        },\n        secondary: {\n          50: '#FFF4ED',\n          100: '#FFE7D6',\n          200: '#FFCAA8',\n          300: '#FFA470',\n          400: '#FF7A3D',\n          500: '#FF5716',\n          600: '#F03A00',\n          700: '#C72800',\n          800: '#9E2100',\n          900: '#7F1D05',\n        },\n        accent: {\n          50: '#F7F1FF',\n          100: '#EFE3FF',\n          200: '#DFC7FF',\n          300: '#C89DFF',\n          400: '#B06BFF',\n          500: '#9839FF',\n          600: '#8514FF',\n          700: '#7200ED',\n          800: '#5F00C7',\n          900: '#4D00A1',\n        },\n        info: {\n          50: '#E6FBFF',\n          100: '#CCF7FF',\n          200: '#99EEFF',\n          300: '#66E5FF',\n          400: '#33DCFF',\n          500: '#00D4FF',\n          600: '#00A8CC',\n          700: '#007D99',\n          800: '#005366',\n          900: '#002833',\n        },\n        success: {\n          50: '#E6FFF8',\n          100: '#CCFFF1',\n          200: '#99FFE3',\n          300: '#66FFD5',\n          400: '#33FFC7',\n          500: '#00F5A0',\n          600: '#00C480',\n          700: '#009360',\n          800: '#006240',\n          900: '#003120',\n        },\n        warning: {\n          50: '#FFF8E6',\n          100: '#FFF0CC',\n          200: '#FFE199',\n          300: '#FFD166',\n          400: '#FFC233',\n          500: '#FFB300',\n          600: '#CC8F00',\n          700: '#996B00',\n          800: '#664700',\n          900: '#332400',\n        },\n        danger: {\n          50: '#FFE8E8',\n          100: '#FFD1D1',\n          200: '#FFA3A3',\n          300: '#FF7575',\n          400: '#FF4747',\n          500: '#FF1919',\n          600: '#CC1414',\n          700: '#990F0F',\n          800: '#660A0A',\n          900: '#330505',\n        },\n        \n        // Modern Dark Mode Colors\n        dark: {\n          bg: '#0A0E1A',\n          'bg-secondary': '#121825',\n          card: '#1A1F35',\n          'card-hover': '#232A45',\n          border: '#2D3548',\n          'border-light': '#3D4558',\n        },\n      },\n      backgroundImage: {\n        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',\n        'gradient-primary': 'linear-gradient(135deg, #FF3D7F 0%, #FF5716 50%, #FFB300 100%)',\n        'gradient-secondary': 'linear-gradient(135deg, #9839FF 0%, #00D4FF 100%)',\n        'gradient-sunset': 'linear-gradient(135deg, #FF6B9D 0%, #FF8E53 50%, #C77DFF 100%)',\n        'gradient-ocean': 'linear-gradient(135deg, #00D4FF 0%, #9839FF 100%)',\n        'gradient-success': 'linear-gradient(135deg, #00F5A0 0%, #00D4FF 100%)',\n        'gradient-dark': 'linear-gradient(135deg, #1A1F35 0%, #0A0E1A 100%)',\n        'gradient-mesh': 'linear-gradient(135deg, rgba(255, 61, 127, 0.1) 0%, rgba(152, 57, 255, 0.1) 100%)',\n      },\n      boxShadow: {\n        'glow': '0 0 30px rgba(255, 61, 127, 0.4)',\n        'glow-lg': '0 0 50px rgba(255, 61, 127, 0.5)',\n        'glow-primary': '0 0 30px rgba(255, 61, 127, 0.4)',\n        'glow-secondary': '0 0 30px rgba(152, 57, 255, 0.4)',\n        'glow-accent': '0 0 30px rgba(0, 212, 255, 0.4)',\n        'glow-success': '0 0 30px rgba(0, 245, 160, 0.4)',\n        'card': '0 8px 32px 0 rgba(31, 38, 135, 0.15)',\n        'card-hover': '0 12px 48px 0 rgba(255, 61, 127, 0.25)',\n      },\n      backdropBlur: {\n        xs: '2px',\n      },\n      animation: {\n        'float': 'float 6s ease-in-out infinite',\n        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',\n        'glow': 'glow 3s ease-in-out infinite',\n        'shimmer': 'shimmer 2s linear infinite',\n        'slide-up': 'slide-up 0.5s ease-out',\n        'slide-down': 'slide-down 0.5s ease-out',\n        'fade-in': 'fade-in 0.4s ease-out',\n        'scale-in': 'scale-in 0.3s ease-out',\n      },\n      keyframes: {\n        float: {\n          '0%, 100%': { transform: 'translateY(0px)' },\n          '50%': { transform: 'translateY(-20px)' },\n        },\n        glow: {\n          '0%, 100%': { boxShadow: '0 0 30px rgba(255, 61, 127, 0.4)' },\n          '50%': { boxShadow: '0 0 50px rgba(152, 57, 255, 0.6)' },\n        },\n        shimmer: {\n          '0%': { backgroundPosition: '-200% 0' },\n          '100%': { backgroundPosition: '200% 0' },\n        },\n        'slide-up': {\n          '0%': { transform: 'translateY(20px)', opacity: '0' },\n          '100%': { transform: 'translateY(0)', opacity: '1' },\n        },\n        'slide-down': {\n          '0%': { transform: 'translateY(-20px)', opacity: '0' },\n          '100%': { transform: 'translateY(0)', opacity: '1' },\n        },\n        'fade-in': {\n          '0%': { opacity: '0' },\n          '100%': { opacity: '1' },\n        },\n        'scale-in': {\n          '0%': { transform: 'scale(0.9)', opacity: '0' },\n          '100%': { transform: 'scale(1)', opacity: '1' },\n        },\n      },\n    },\n  },\n  plugins: [],\n}\n","size_bytes":5320},"backend/controllers/communityController.js":{"content":"import CommunityPost from '../models/CommunityPost.js';\nimport Comment from '../models/Comment.js';\nimport User from '../models/User.js';\nimport Notification from '../models/Notification.js';\nimport { uploadToStorage } from '../config/minio.js';\n\n// @desc    Create community post\n// @route   POST /api/community\n// @access  Private\nexport const createCommunityPost = async (req, res) => {\n  try {\n    const { content, type, pollQuestion, pollOptions, visibility } = req.body;\n\n    if (!content || !content.trim()) {\n      return res.status(400).json({ success: false, message: 'Content is required' });\n    }\n\n    const postData = {\n      creator: req.user._id,\n      content,\n      type: type || 'text',\n      visibility: visibility || 'public',\n    };\n\n    if (req.file) {\n      const uploadResult = await uploadToStorage(req.file.buffer, 'friendflix/community', req.file.originalname);\n      postData.media = {\n        url: uploadResult.secure_url,\n        type: req.file.mimetype.startsWith('image/') ? 'image' : 'video',\n      };\n      postData.type = postData.media.type;\n    }\n\n    if (type === 'poll' && pollQuestion && pollOptions) {\n      const options = JSON.parse(pollOptions);\n      postData.type = 'poll';\n      postData.poll = {\n        question: pollQuestion,\n        options: options.map((opt) => ({ text: opt, votes: [] })),\n        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),\n      };\n    }\n\n    const communityPost = await CommunityPost.create(postData);\n\n    const populatedPost = await CommunityPost.findById(communityPost._id)\n      .populate('creator', 'username profilePicture fullName verified');\n\n    const user = await User.findById(req.user._id);\n    if (user.subscriber && user.subscriber.length > 0) {\n      const notifications = user.subscriber.map((followerId) => ({\n        recipient: followerId,\n        sender: req.user._id,\n        type: 'community_post',\n        message: `${req.user.username} posted in Community`,\n        link: `/community/${communityPost._id}`,\n      }));\n\n      await Notification.insertMany(notifications);\n\n      const io = req.app.get('io');\n      if (io) {\n        user.subscriber.forEach((followerId) => {\n          io.to(followerId.toString()).emit('newNotification', {\n            message: `${req.user.username} posted in Community`,\n            link: `/community/${communityPost._id}`,\n          });\n        });\n      }\n    }\n\n    res.status(201).json({ success: true, communityPost: populatedPost });\n  } catch (error) {\n    console.error('Error creating community post:', error);\n    res.status(500).json({ success: false, message: 'Failed to create community post' });\n  }\n};\n\n// @desc    Get user's community posts\n// @route   GET /api/community/user/:userId\n// @access  Public\nexport const getUserCommunityPosts = async (req, res) => {\n  try {\n    const posts = await CommunityPost.find({ creator: req.params.userId })\n      .populate('creator', 'username profilePicture fullName verified')\n      .sort({ pinned: -1, createdAt: -1 });\n\n    res.json({ success: true, posts });\n  } catch (error) {\n    console.error('Error fetching community posts:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch posts' });\n  }\n};\n\n// @desc    Get community post\n// @route   GET /api/community/:id\n// @access  Public\nexport const getCommunityPost = async (req, res) => {\n  try {\n    const post = await CommunityPost.findById(req.params.id)\n      .populate('creator', 'username profilePicture fullName verified')\n      .populate({\n        path: 'comments',\n        populate: { path: 'author', select: 'username profilePicture verified' },\n      });\n\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    res.json({ success: true, post });\n  } catch (error) {\n    console.error('Error fetching community post:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch post' });\n  }\n};\n\n// @desc    Update community post\n// @route   PUT /api/community/:id\n// @access  Private\nexport const updateCommunityPost = async (req, res) => {\n  try {\n    const post = await CommunityPost.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    if (post.creator.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized' });\n    }\n\n    const { content } = req.body;\n    if (content) post.content = content;\n\n    await post.save();\n\n    res.json({ success: true, post });\n  } catch (error) {\n    console.error('Error updating community post:', error);\n    res.status(500).json({ success: false, message: 'Failed to update post' });\n  }\n};\n\n// @desc    Delete community post\n// @route   DELETE /api/community/:id\n// @access  Private\nexport const deleteCommunityPost = async (req, res) => {\n  try {\n    const post = await CommunityPost.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    if (post.creator.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized' });\n    }\n\n    await post.deleteOne();\n\n    res.json({ success: true, message: 'Post deleted' });\n  } catch (error) {\n    console.error('Error deleting community post:', error);\n    res.status(500).json({ success: false, message: 'Failed to delete post' });\n  }\n};\n\n// @desc    Like community post\n// @route   POST /api/community/:id/like\n// @access  Private\nexport const likeCommunityPost = async (req, res) => {\n  try {\n    const post = await CommunityPost.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    const alreadyLiked = post.likes.includes(req.user._id);\n\n    if (alreadyLiked) {\n      post.likes = post.likes.filter((id) => id.toString() !== req.user._id.toString());\n    } else {\n      post.likes.push(req.user._id);\n\n      if (post.creator.toString() !== req.user._id.toString()) {\n        await Notification.create({\n          recipient: post.creator,\n          sender: req.user._id,\n          type: 'like',\n          message: `${req.user.username} liked your community post`,\n          link: `/community/${post._id}`,\n        });\n\n        const io = req.app.get('io');\n        if (io) {\n          io.to(post.creator.toString()).emit('newNotification', {\n            message: `${req.user.username} liked your community post`,\n            link: `/community/${post._id}`,\n          });\n        }\n      }\n    }\n\n    await post.save();\n\n    res.json({ success: true, likes: post.likes.length, liked: !alreadyLiked });\n  } catch (error) {\n    console.error('Error liking community post:', error);\n    res.status(500).json({ success: false, message: 'Failed to like post' });\n  }\n};\n\n// @desc    Add comment to community post\n// @route   POST /api/community/:id/comment\n// @access  Private\nexport const addCommunityComment = async (req, res) => {\n  try {\n    const { text } = req.body;\n\n    if (!text || !text.trim()) {\n      return res.status(400).json({ success: false, message: 'Comment text is required' });\n    }\n\n    const post = await CommunityPost.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    const comment = await Comment.create({\n      author: req.user._id,\n      post: post._id,\n      text,\n    });\n\n    post.comments.push(comment._id);\n    await post.save();\n\n    if (post.creator.toString() !== req.user._id.toString()) {\n      await Notification.create({\n        recipient: post.creator,\n        sender: req.user._id,\n        type: 'comment',\n        message: `${req.user.username} commented on your community post`,\n        link: `/community/${post._id}`,\n      });\n    }\n\n    const populatedComment = await Comment.findById(comment._id)\n      .populate('author', 'username profilePicture verified');\n\n    res.status(201).json({ success: true, comment: populatedComment });\n  } catch (error) {\n    console.error('Error adding comment:', error);\n    res.status(500).json({ success: false, message: 'Failed to add comment' });\n  }\n};\n\n// @desc    Vote on poll\n// @route   POST /api/community/:id/vote\n// @access  Private\nexport const votePoll = async (req, res) => {\n  try {\n    const { optionIndex } = req.body;\n    const post = await CommunityPost.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    if (post.type !== 'poll') {\n      return res.status(400).json({ success: false, message: 'This is not a poll' });\n    }\n\n    if (new Date() > post.poll.expiresAt) {\n      return res.status(400).json({ success: false, message: 'Poll has expired' });\n    }\n\n    const alreadyVoted = post.poll.options.some((opt) =>\n      opt.votes.includes(req.user._id)\n    );\n\n    if (alreadyVoted) {\n      post.poll.options.forEach((opt) => {\n        opt.votes = opt.votes.filter((id) => id.toString() !== req.user._id.toString());\n      });\n    }\n\n    post.poll.options[optionIndex].votes.push(req.user._id);\n    await post.save();\n\n    res.json({ success: true, poll: post.poll });\n  } catch (error) {\n    console.error('Error voting on poll:', error);\n    res.status(500).json({ success: false, message: 'Failed to vote' });\n  }\n};\n\n// @desc    Pin community post\n// @route   POST /api/community/:id/pin\n// @access  Private\nexport const pinCommunityPost = async (req, res) => {\n  try {\n    const post = await CommunityPost.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    if (post.creator.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized' });\n    }\n\n    post.pinned = !post.pinned;\n    await post.save();\n\n    res.json({ success: true, pinned: post.pinned });\n  } catch (error) {\n    console.error('Error pinning post:', error);\n    res.status(500).json({ success: false, message: 'Failed to pin post' });\n  }\n};\n","size_bytes":10147},"backend/routes/communityRoutes.js":{"content":"import express from 'express';\nimport {\n  createCommunityPost,\n  getUserCommunityPosts,\n  getCommunityPost,\n  updateCommunityPost,\n  deleteCommunityPost,\n  likeCommunityPost,\n  addCommunityComment,\n  votePoll,\n  pinCommunityPost,\n} from '../controllers/communityController.js';\nimport { protect } from '../middleware/authMiddleware.js';\nimport { upload } from '../config/minio.js';\n\nconst router = express.Router();\n\nrouter.post('/', protect, upload.single('media'), createCommunityPost);\nrouter.get('/user/:userId', getUserCommunityPosts);\nrouter.get('/:id', getCommunityPost);\nrouter.put('/:id', protect, updateCommunityPost);\nrouter.delete('/:id', protect, deleteCommunityPost);\nrouter.post('/:id/like', protect, likeCommunityPost);\nrouter.post('/:id/comment', protect, addCommunityComment);\nrouter.post('/:id/vote', protect, votePoll);\nrouter.post('/:id/pin', protect, pinCommunityPost);\n\nexport default router;\n","size_bytes":916},"frontend/src/components/FeedAdCard.jsx":{"content":"import { useState } from 'react';\nimport { AiOutlineClose } from 'react-icons/ai';\nimport AdSense from './AdSense';\nimport { AD_CONFIG } from '../utils/adConfig';\n\nconst FeedAdCard = ({ adSlot }) => {\n  const [isVisible, setIsVisible] = useState(true);\n\n  if (!isVisible) return null;\n\n  return (\n    <div className=\"bg-white dark:bg-gray-900 rounded-lg shadow-md mb-4 overflow-hidden border border-gray-200 dark:border-gray-700\">\n      <div className=\"flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-xs font-semibold text-gray-500 dark:text-gray-400\">Sponsored</span>\n        </div>\n        <button\n          onClick={() => setIsVisible(false)}\n          className=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n          aria-label=\"Close ad\"\n        >\n          <AiOutlineClose size={16} />\n        </button>\n      </div>\n      \n      <div className=\"p-4\">\n        <AdSense \n          adClient={AD_CONFIG.adsense.client}\n          adSlot={adSlot}\n          adFormat=\"fluid\"\n          style={{ minHeight: '250px' }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default FeedAdCard;\n","size_bytes":1276},"frontend/src/pages/Login.jsx":{"content":"import { useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { FiMail, FiLock, FiEye, FiEyeOff } from 'react-icons/fi';\n\nconst Login = () => {\n  const navigate = useNavigate();\n  const { login } = useAuth();\n  const [formData, setFormData] = useState({\n    email: '',\n    password: '',\n  });\n  const [loading, setLoading] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n\n  const handleChange = (e) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      await login(formData.email, formData.password);\n      navigate('/');\n    } catch (error) {\n      console.error('Login error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 relative overflow-hidden\">\n      {/* Animated Background Gradient Orbs */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-20 -left-20 w-96 h-96 bg-primary-300/30 rounded-full blur-3xl animate-float\"></div>\n        <div className=\"absolute bottom-20 -right-20 w-96 h-96 bg-accent-300/30 rounded-full blur-3xl animate-float\" style={{animationDelay: '2s'}}></div>\n        <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-secondary-300/20 rounded-full blur-3xl animate-float\" style={{animationDelay: '4s'}}></div>\n      </div>\n\n      <div className=\"max-w-md w-full space-y-6 relative z-10 animate-scale-in\">\n        {/* Logo & Header */}\n        <div className=\"text-center space-y-3\">\n          <div className=\"inline-block p-4 bg-gradient-primary rounded-3xl shadow-glow-lg animate-glow-pulse\">\n            <h1 className=\"text-5xl font-black text-white\">friendflix</h1>\n          </div>\n          <p className=\"text-lg text-gray-600 dark:text-gray-400 font-medium\">\n            Welcome back! Sign in to continue\n          </p>\n        </div>\n\n        {/* Login Card */}\n        <div className=\"card p-8 space-y-6 animate-slide-up\">\n          <form className=\"space-y-5\" onSubmit={handleSubmit}>\n            {/* Email Input */}\n            <div className=\"relative\">\n              <div className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400\">\n                <FiMail className=\"w-5 h-5\" />\n              </div>\n              <input\n                type=\"email\"\n                name=\"email\"\n                placeholder=\"Enter your email\"\n                required\n                autoComplete=\"email\"\n                value={formData.email}\n                onChange={handleChange}\n                className=\"w-full pl-12 pr-4 py-4 bg-gray-50 dark:bg-dark-card-hover border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:outline-none focus:border-primary-400 focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 text-gray-900 dark:text-white placeholder:text-gray-400\"\n              />\n            </div>\n\n            {/* Password Input */}\n            <div className=\"relative\">\n              <div className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400\">\n                <FiLock className=\"w-5 h-5\" />\n              </div>\n              <input\n                type={showPassword ? 'text' : 'password'}\n                name=\"password\"\n                placeholder=\"Enter your password\"\n                required\n                autoComplete=\"current-password\"\n                value={formData.password}\n                onChange={handleChange}\n                className=\"w-full pl-12 pr-12 py-4 bg-gray-50 dark:bg-dark-card-hover border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:outline-none focus:border-primary-400 focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 text-gray-900 dark:text-white placeholder:text-gray-400\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowPassword(!showPassword)}\n                className=\"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\n              >\n                {showPassword ? <FiEyeOff className=\"w-5 h-5\" /> : <FiEye className=\"w-5 h-5\" />}\n              </button>\n            </div>\n\n            {/* Forgot Password Link */}\n            <div className=\"text-right\">\n              <Link to=\"/forgot-password\" className=\"text-sm font-semibold text-primary-500 hover:text-primary-600 dark:text-primary-400 transition-colors\">\n                Forgot password?\n              </Link>\n            </div>\n\n            {/* Submit Button */}\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden group\"\n            >\n              {loading ? (\n                <div className=\"flex items-center justify-center gap-2\">\n                  <div className=\"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin\"></div>\n                  <span>Signing in...</span>\n                </div>\n              ) : (\n                <span className=\"font-bold text-lg\">Sign In</span>\n              )}\n            </button>\n          </form>\n\n          {/* Divider */}\n          <div className=\"relative\">\n            <div className=\"absolute inset-0 flex items-center\">\n              <div className=\"w-full border-t border-gray-200 dark:border-dark-border\"></div>\n            </div>\n            <div className=\"relative flex justify-center text-sm\">\n              <span className=\"px-4 bg-white dark:bg-dark-card text-gray-500\">or</span>\n            </div>\n          </div>\n\n          {/* Guest Login Info */}\n          <div className=\"text-center p-4 bg-gradient-to-r from-info-50 to-accent-50 dark:from-info-900/20 dark:to-accent-900/20 rounded-2xl border border-info-200/50 dark:border-info-800/50\">\n            <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n              <span className=\"font-semibold\">Demo Mode:</span> Use any email & password to explore\n            </p>\n          </div>\n        </div>\n\n        {/* Sign Up Link Card */}\n        <div className=\"card p-5 text-center animate-slide-up\" style={{animationDelay: '0.1s'}}>\n          <p className=\"text-gray-700 dark:text-gray-300\">\n            Don't have an account?{' '}\n            <Link to=\"/register\" className=\"font-bold bg-gradient-primary bg-clip-text text-transparent hover:opacity-80 transition-opacity\">\n              Sign up now\n            </Link>\n          </p>\n        </div>\n\n        {/* Footer Text */}\n        <p className=\"text-center text-xs text-gray-500 dark:text-gray-400 animate-fade-in\" style={{animationDelay: '0.3s'}}>\n          By continuing, you agree to our Terms of Service and Privacy Policy\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default Login;\n","size_bytes":7139},"frontend/src/pages/Saved.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { postAPI } from '../services/api';\nimport { useNavigate } from 'react-router-dom';\nimport Loader from '../components/Loader';\nimport { BsBookmark } from 'react-icons/bs';\n\nconst Saved = () => {\n  const navigate = useNavigate();\n  const [savedPosts, setSavedPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchSavedPosts();\n  }, []);\n\n  const fetchSavedPosts = async () => {\n    try {\n      const response = await postAPI.getSavedPosts();\n      setSavedPosts(response.data.data);\n    } catch (error) {\n      console.error('Failed to load saved posts:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto px-4 py-8 pb-20 md:pb-8\">\n      <h1 className=\"text-2xl font-bold mb-6 dark:text-white flex items-center\">\n        <BsBookmark className=\"mr-2\" />\n        Saved Posts\n      </h1>\n\n      {savedPosts.length === 0 ? (\n        <div className=\"card p-12 text-center\">\n          <BsBookmark size={64} className=\"mx-auto text-gray-400 mb-4\" />\n          <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n            No saved posts yet\n          </p>\n          <p className=\"text-sm text-gray-500 dark:text-gray-500\">\n            Save posts by tapping the bookmark icon\n          </p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-3 gap-1 md:gap-4\">\n          {savedPosts.map((post) => (\n            <div\n              key={post._id}\n              onClick={() => navigate(`/post/${post._id}`)}\n              className=\"aspect-square cursor-pointer hover:opacity-75 transition relative group\"\n            >\n              <img\n                src={post.media?.[0]?.url || post.mediaUrl}\n                alt=\"Saved post\"\n                className=\"w-full h-full object-cover rounded\"\n              />\n              \n              {/* Multiple images indicator */}\n              {post.media && post.media.length > 1 && (\n                <div className=\"absolute top-2 right-2 bg-black/70 text-white px-2 py-1 rounded text-xs\">\n                  ğŸ“· {post.media.length}\n                </div>\n              )}\n\n              {/* Hover overlay */}\n              <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition flex items-center justify-center space-x-4 text-white\">\n                <div className=\"flex items-center\">\n                  â¤ï¸ {post.likes.length}\n                </div>\n                <div className=\"flex items-center\">\n                  ğŸ’¬ {post.comments.length}\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Saved;\n","size_bytes":2789},"backend/routes/groupRoutes.js":{"content":"import express from 'express';\nimport {\n  createGroup,\n  getUserGroups,\n  getGroupById,\n  sendGroupMessage,\n  getGroupMessages,\n  addGroupMember,\n  leaveGroup,\n} from '../controllers/groupController.js';\nimport { protect } from '../middleware/authMiddleware.js';\n\nconst router = express.Router();\n\n// Group routes\nrouter.post('/', protect, createGroup);\nrouter.get('/', protect, getUserGroups);\nrouter.get('/:groupId', protect, getGroupById);\n\n// Message routes\nrouter.post('/:groupId/messages', protect, sendGroupMessage);\nrouter.get('/:groupId/messages', protect, getGroupMessages);\n\n// Member management\nrouter.post('/:groupId/members', protect, addGroupMember);\nrouter.delete('/:groupId/leave', protect, leaveGroup);\n\nexport default router;\n","size_bytes":745},"frontend/src/pages/Search.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { Link, useSearchParams, useNavigate } from 'react-router-dom';\nimport { userAPI } from '../services/api';\nimport { AiOutlineSearch, AiOutlineMessage } from 'react-icons/ai';\nimport toast from 'react-hot-toast';\n\nconst Search = () => {\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [query, setQuery] = useState(searchParams.get('q') || '');\n  const [results, setResults] = useState([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    const q = searchParams.get('q');\n    if (q) {\n      setQuery(q);\n      handleSearch(q);\n    }\n  }, [searchParams]);\n\n  const handleSearch = async (searchQuery) => {\n    if (!searchQuery.trim()) {\n      setResults([]);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await userAPI.searchUsers(searchQuery);\n      setResults(response.data.data);\n    } catch (error) {\n      toast.error('Search failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (query.trim()) {\n      setSearchParams({ q: query });\n    }\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto px-4 py-8\">\n      <h1 className=\"text-2xl font-bold mb-6 dark:text-white\">Search Results</h1>\n\n      {/* Results */}\n      <div className=\"card dark:bg-dark-card\">\n        {loading ? (\n          <div className=\"p-8 text-center\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mx-auto\"></div>\n          </div>\n        ) : results.length === 0 ? (\n          <div className=\"p-12 text-center\">\n            <AiOutlineSearch size={64} className=\"mx-auto text-gray-300 dark:text-gray-600 mb-4\" />\n            <p className=\"text-gray-500 dark:text-gray-400 text-lg\">\n              {query ? 'No users found' : 'Use the search bar above to find users'}\n            </p>\n            {query && (\n              <p className=\"text-sm text-gray-400 dark:text-gray-500 mt-2\">\n                Try searching with a different username or name\n              </p>\n            )}\n          </div>\n        ) : (\n          <div className=\"divide-y divide-gray-200 dark:divide-dark-border\">\n            {results.map((user) => (\n              <div\n                key={user._id}\n                className=\"flex items-center space-x-4 p-4 hover:bg-gray-50 dark:hover:bg-dark-border/30 transition\"\n              >\n                <Link to={`/profile/${user.username}`}>\n                  <img\n                    src={user.avatar}\n                    alt={user.username}\n                    className=\"h-12 w-12 rounded-full object-cover\"\n                  />\n                </Link>\n                <Link to={`/profile/${user.username}`} className=\"flex-1\">\n                  <p className=\"font-semibold dark:text-white\">{user.username}</p>\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">{user.fullName}</p>\n                  {user.bio && (\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1 truncate\">\n                      {user.bio}\n                    </p>\n                  )}\n                </Link>\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"text-sm text-gray-500 dark:text-gray-400 text-center\">\n                    <span className=\"font-semibold block\">{user.subscriber.length}</span>\n                    <span className=\"text-xs\">subscriber</span>\n                  </div>\n                  <button\n                    onClick={(e) => {\n                      e.preventDefault();\n                      navigate(`/messages/${user.username}`);\n                    }}\n                    className=\"px-4 py-2 bg-gradient-primary text-white rounded-lg font-semibold hover:shadow-glow transition flex items-center space-x-2\"\n                  >\n                    <AiOutlineMessage size={16} />\n                    <span>Message</span>\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Search;\n","size_bytes":4177},"frontend/src/services/premiumAPI.js":{"content":"import axios from 'axios';\n\nconst API_URL = '/api';\n\nconst premiumAPI = {\n  // Subscription APIs\n  getPlans: () => axios.get(`${API_URL}/subscription/plans`),\n  subscribe: (plan) => axios.post(`${API_URL}/subscription/subscribe`, { plan }),\n  cancelSubscription: () => axios.post(`${API_URL}/subscription/cancel`),\n  getSubscriptionStatus: () => axios.get(`${API_URL}/subscription/status`),\n\n  // Creator APIs\n  enableMonetization: () => axios.post(`${API_URL}/creator/enable-monetization`),\n  getAnalytics: () => axios.get(`${API_URL}/creator/analytics`),\n  trackView: (postId, watchTime) => axios.post(`${API_URL}/creator/track-view`, { postId, watchTime }),\n  getEarnings: () => axios.get(`${API_URL}/creator/earnings`),\n\n  // Super Chat APIs\n  sendSuperChat: (streamId, amount, message) => \n    axios.post(`${API_URL}/superchat/send`, { streamId, amount, message }),\n  getSuperChats: (streamId) => axios.get(`${API_URL}/superchat/${streamId}`),\n};\n\nexport default premiumAPI;\n","size_bytes":980},"frontend/src/components/DoubleTapLike.jsx":{"content":"import { useState } from 'react';\nimport { AiFillHeart } from 'react-icons/ai';\n\nconst DoubleTapLike = ({ children, onLike, isLiked }) => {\n  const [showHeart, setShowHeart] = useState(false);\n  const [lastTap, setLastTap] = useState(0);\n\n  const handleDoubleTap = () => {\n    const now = Date.now();\n    const timeSinceLastTap = now - lastTap;\n\n    if (timeSinceLastTap < 300 && timeSinceLastTap > 0) {\n      // Double tap detected\n      if (!isLiked) {\n        onLike();\n      }\n      \n      // Show animation\n      setShowHeart(true);\n      setTimeout(() => setShowHeart(false), 1000);\n    }\n\n    setLastTap(now);\n  };\n\n  return (\n    <div className=\"relative\" onClick={handleDoubleTap}>\n      {children}\n      \n      {/* Heart Animation */}\n      {showHeart && (\n        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none z-10\">\n          <AiFillHeart\n            size={100}\n            className=\"text-white animate-like-burst opacity-0\"\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default DoubleTapLike;\n","size_bytes":1065},"frontend/src/pages/GroupChat.jsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { groupAPI } from '../services/api';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\nimport Loader from '../components/Loader';\nimport { timeAgo } from '../utils/timeAgo';\nimport {\n  AiOutlineSend,\n  AiOutlineUserAdd,\n  AiOutlineArrowLeft,\n  AiOutlineSetting,\n} from 'react-icons/ai';\nimport { BsThreeDotsVertical } from 'react-icons/bs';\n\nconst GroupChat = () => {\n  const { groupId } = useParams();\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  \n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [groupInfo, setGroupInfo] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const [showAddMember, setShowAddMember] = useState(false);\n  const [memberQuery, setMemberQuery] = useState('');\n  const [memberResults, setMemberResults] = useState([]);\n  const [showMenu, setShowMenu] = useState(false);\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\n  const messagesEndRef = useRef(null);\n  const fileInputRef = useRef(null);\n\n  useEffect(() => {\n    fetchGroupData();\n    \n    return () => {\n      socketService.off('newGroupMessage');\n    };\n  }, [groupId]);\n\n  useEffect(() => {\n    if (!groupInfo) return;\n\n    // Socket listeners\n    socketService.on('newGroupMessage', handleNewMessage);\n\n    return () => {\n      socketService.off('newGroupMessage');\n    };\n  }, [groupInfo]);\n\n  const fetchGroupData = async () => {\n    try {\n      const [groupResponse, messagesResponse] = await Promise.all([\n        groupAPI.getGroupById(groupId),\n        groupAPI.getGroupMessages(groupId),\n      ]);\n\n      setGroupInfo(groupResponse.data.data);\n      setMessages(messagesResponse.data.data);\n    } catch (error) {\n      console.error('Failed to load group:', error);\n      toast.error('Failed to load group');\n      navigate('/groups');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleNewMessage = ({ groupId: msgGroupId, message }) => {\n    if (msgGroupId === groupId) {\n      // Don't add if it's from current user (already added optimistically)\n      if (message.sender._id === user._id) {\n        return;\n      }\n      \n      setMessages((prev) => {\n        // Avoid duplicates\n        const exists = prev.some(msg => msg._id === message._id);\n        if (exists) return prev;\n        return [...prev, message];\n      });\n      scrollToBottom();\n    }\n  };\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const handleSend = async (e) => {\n    e.preventDefault();\n    \n    if (!newMessage.trim() || sending) return;\n\n    const messageText = newMessage;\n    const tempId = `temp-${Date.now()}`;\n\n    // Optimistic UI update\n    const tempMessage = {\n      _id: tempId,\n      text: messageText,\n      sender: {\n        _id: user._id,\n        username: user.username,\n        fullName: user.fullName,\n        avatar: user.avatar,\n      },\n      createdAt: new Date().toISOString(),\n    };\n\n    setMessages((prev) => [...prev, tempMessage]);\n    setNewMessage('');\n    scrollToBottom();\n    setSending(true);\n\n    try {\n      const response = await groupAPI.sendGroupMessage(groupId, messageText);\n      const sentMessage = response.data.data;\n\n      // Replace temp message with real message\n      setMessages((prev) =>\n        prev.map((msg) => (msg._id === tempId ? sentMessage : msg))\n      );\n    } catch (error) {\n      // Remove temp message on error\n      setMessages((prev) => prev.filter((msg) => msg._id !== tempId));\n      toast.error('Failed to send message');\n      setNewMessage(messageText);\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const handleLeaveGroup = async () => {\n    if (!confirm(`Leave ${groupInfo.name}?`)) return;\n\n    try {\n      await groupAPI.leaveGroup(groupId);\n      toast.success('Left group successfully');\n      navigate('/groups');\n    } catch (error) {\n      toast.error('Failed to leave group');\n    }\n  };\n\n  const searchMembers = async (query) => {\n    if (!query.trim()) { setMemberResults([]); return; }\n    try {\n      const res = await fetch(`${import.meta.env.VITE_API_URL || 'http://localhost:5000/api'}/users/search?q=${encodeURIComponent(query)}`);\n      const data = await res.json();\n      setMemberResults(data.data || []);\n    } catch (e) {\n      console.error('Member search failed', e);\n    }\n  };\n\n  const addMember = async (userId) => {\n    try {\n      const res = await groupAPI.addMember(groupId, userId);\n      setGroupInfo(res.data.data);\n      toast.success('Member added');\n      setShowAddMember(false);\n      setMemberQuery('');\n      setMemberResults([]);\n    } catch (err) {\n      const msg = err.response?.data?.message || 'Failed to add member';\n      toast.error(msg);\n    }\n  };\n\n  // Add back media selection handler to avoid runtime errors\n  const handleFileSelect = (e) => {\n    const file = e.target.files[0];\n    if (file) {\n      toast.success('Media upload feature coming soon!');\n      console.log('Selected file:', file);\n    }\n  };\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  if (!groupInfo) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex flex-col h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-amber-50 dark:from-dark-bg dark:via-dark-bg dark:to-dark-bg\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-dark-card border-b border-gray-200 dark:border-dark-border p-4 shadow-lg\">\n        <div className=\"flex items-center justify-between max-w-4xl mx-auto\">\n          <div className=\"flex items-center space-x-3\">\n            <button\n              onClick={() => navigate('/messages')}\n              className=\"md:hidden hover:bg-gray-100 dark:hover:bg-dark-border p-2 rounded-full\"\n            >\n              <AiOutlineArrowLeft size={24} className=\"dark:text-white\" />\n            </button>\n\n            {/* Group Avatar (Overlapping) */}\n            <div className=\"flex -space-x-2\">\n              {groupInfo.members.slice(0, 3).map((member, index) => (\n                <img\n                  key={member.user._id}\n                  src={member.user.avatar}\n                  alt={member.user.username}\n                  className=\"w-10 h-10 rounded-full border-2 border-white dark:border-dark-bg\"\n                  style={{ zIndex: 3 - index }}\n                />\n              ))}\n            </div>\n\n            <div>\n              <h2 className=\"font-bold text-gray-800 dark:text-white\">\n                {groupInfo.name}\n              </h2>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                {groupInfo.members.length} members\n              </p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setShowMenu(!showMenu)}\n              className=\"p-2 hover:bg-gray-100 dark:hover:bg-dark-border rounded-full relative\"\n            >\n              <BsThreeDotsVertical size={20} className=\"text-gray-600 dark:text-gray-400\" />\n              \n              {showMenu && (\n                <div className=\"absolute right-0 top-12 bg-white dark:bg-dark-card rounded-2xl shadow-glow py-2 w-48 z-50\">\n                  <button className=\"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-dark-border dark:text-white\">\n                    Group Info\n                  </button>\n                  <button className=\"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-dark-border dark:text-white\">\n                    Mute Notifications\n                  </button>\n                  <button \n                    onClick={handleLeaveGroup}\n                    className=\"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-dark-border text-red-500\"\n                  >\n                    Leave Group\n                  </button>\n                </div>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto p-4 max-w-4xl w-full mx-auto\">\n        {messages.map((message) => {\n          const isOwnMessage = message.sender._id === user._id;\n          \n          return (\n            <div\n              key={message.id}\n              className={`flex mb-4 ${isOwnMessage ? 'justify-end' : 'justify-start'}`}\n            >\n              {!isOwnMessage && (\n                <img\n                  src={message.sender.avatar}\n                  alt={message.sender.username}\n                  className=\"w-8 h-8 rounded-full mr-2\"\n                />\n              )}\n              \n              <div className={`max-w-xs md:max-w-md ${isOwnMessage ? 'order-1' : ''}`}>\n                {!isOwnMessage && (\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-1 ml-2\">\n                    {message.sender.username}\n                  </p>\n                )}\n                <div\n                  className={`px-4 py-2 rounded-3xl ${\n                    isOwnMessage\n                      ? 'bg-gradient-primary text-white shadow-glow'\n                      : 'bg-white dark:bg-dark-card text-gray-800 dark:text-white shadow-lg'\n                  }`}\n                >\n                  <p className=\"break-words\">{message.text}</p>\n                  <p\n                    className={`text-xs mt-1 ${\n                      isOwnMessage ? 'text-purple-100' : 'text-gray-500 dark:text-gray-400'\n                    }`}\n                  >\n                    {timeAgo(message.createdAt)}\n                  </p>\n                </div>\n              </div>\n            </div>\n          );\n        })}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Add Member Modal */}\n      {showAddMember && (\n        <div className=\"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-dark-card rounded-2xl max-w-md w-full p-6\">\n            <h3 className=\"text-lg font-semibold mb-3 dark:text-white\">Add Member</h3>\n            {groupInfo.admin._id !== user._id ? (\n              <p className=\"text-sm text-gray-500\">Only group admin can add members.</p>\n            ) : (\n              <>\n                <input\n                  type=\"text\"\n                  value={memberQuery}\n                  onChange={(e)=>{ setMemberQuery(e.target.value); searchMembers(e.target.value); }}\n                  placeholder=\"Search users...\"\n                  className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg mb-3 dark:bg-dark-bg dark:text-white\"\n                />\n                <div className=\"max-h-48 overflow-y-auto\">\n                  {memberResults.map(u => (\n                    <div key={u._id} className=\"flex items-center justify-between p-2 hover:bg-gray-100 dark:hover:bg-dark-border rounded\">\n                      <div className=\"flex items-center gap-2\">\n                        <img src={u.avatar} alt={u.username} className=\"w-8 h-8 rounded-full\" />\n                        <div>\n                          <p className=\"text-sm dark:text-white\">@{u.username}</p>\n                          <p className=\"text-xs text-gray-500\">{u.fullName}</p>\n                        </div>\n                      </div>\n                      <button onClick={() => addMember(u._id)} className=\"px-3 py-1 bg-primary text-white rounded\">Add</button>\n                    </div>\n                  ))}\n                  {memberResults.length === 0 && (\n                    <p className=\"text-sm text-gray-500\">No results</p>\n                  )}\n                </div>\n              </>\n            )}\n            <div className=\"mt-4 flex justify-end gap-2\">\n              <button onClick={()=>setShowAddMember(false)} className=\"px-4 py-2 border rounded\">Close</button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Input */}\n      <div className=\"bg-white dark:bg-dark-card border-t border-gray-200 dark:border-dark-border p-4 shadow-lg\">\n        {/* Emoji Picker */}\n        {showEmojiPicker && (\n          <div className=\"p-4 border-b dark:border-gray-700 max-w-4xl mx-auto\">\n            <div className=\"grid grid-cols-8 gap-2\">\n              {['ğŸ˜€','ğŸ˜‚','ğŸ˜','ğŸ¥°','ğŸ˜','ğŸ¤”','ğŸ˜¢','ğŸ˜­','ğŸ˜¡','ğŸ¤¯','ğŸ¥³','ğŸ˜‡','ğŸ¤—','ğŸ™','ğŸ‘','ğŸ‘','ğŸ‘','ğŸ™Œ','ğŸ’ª','â¤ï¸','ğŸ’”','ğŸ”¥','âœ¨','ğŸ’¯','ğŸ‰','ğŸŠ','ğŸˆ','ğŸ','ğŸ†','â­','ğŸ’«','âœ…'].map((emoji, idx) => (\n                <button key={idx} type=\"button\" onClick={() => { setNewMessage(prev => prev + emoji); setShowEmojiPicker(false); }} className=\"text-2xl hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded transition\">\n                  {emoji}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        <form onSubmit={handleSend} className=\"flex items-center space-x-2 max-w-4xl mx-auto\">\n          {/* Emoji Picker Button */}\n          <button type=\"button\" onClick={() => setShowEmojiPicker(!showEmojiPicker)} className=\"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition\" title=\"Add emoji\">\n            <svg className=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z\" clipRule=\"evenodd\"/></svg>\n          </button>\n\n          {/* Media Picker Button */}\n          <button type=\"button\" onClick={() => fileInputRef.current?.click()} className=\"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition\" title=\"Attach media\">\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\"/></svg>\n          </button>\n          <input ref={fileInputRef} type=\"file\" accept=\"image/*,video/*\" onChange={handleFileSelect} className=\"hidden\" />\n\n          {/* Camera Button */}\n          <button type=\"button\" onClick={() => toast('Camera feature coming soon!')} className=\"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition\" title=\"Take photo\">\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/></svg>\n          </button>\n\n          <input type=\"text\" value={newMessage} onChange={(e) => setNewMessage(e.target.value)} placeholder=\"Type a message...\" className=\"flex-1 px-6 py-3 bg-gray-100 dark:bg-dark-bg border-none rounded-full focus:outline-none focus:ring-2 focus:ring-primary dark:text-white\" />\n          <button type=\"submit\" disabled={!newMessage.trim() || sending} className={`p-4 rounded-full transition-all ${newMessage.trim() && !sending ? 'bg-gradient-primary text-white shadow-glow hover:scale-110' : 'bg-gray-200 dark:bg-dark-border text-gray-400 cursor-not-allowed'}`}>\n            <AiOutlineSend size={22} />\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default GroupChat;\n","size_bytes":15717},"backend/server.js":{"content":"import express from 'express';\nimport dotenv from 'dotenv';\nimport cors from 'cors';\nimport helmet from 'helmet';\nimport morgan from 'morgan';\nimport { createServer } from 'http';\nimport connectDB from './config/db.js';\nimport initializeSocket from './socket/socket.js';\nimport { errorHandler, notFound } from './middleware/errorMiddleware.js';\n\n// Import Routes\nimport authRoutes from './routes/authRoutes.js';\nimport userRoutes from './routes/userRoutes.js';\nimport postRoutes from './routes/postRoutes.js';\nimport notificationRoutes from './routes/notificationRoutes.js';\nimport messageRoutes from './routes/messageRoutes.js';\nimport storyRoutes from './routes/storyRoutes.js';\nimport exploreRoutes from './routes/exploreRoutes.js';\nimport adminRoutes from './routes/adminRoutes.js';\nimport aiRoutes from './routes/aiRoutes.js';\nimport groupRoutes from './routes/groupRoutes.js';\nimport subscriptionRoutes from './routes/subscriptionRoutes.js';\nimport creatorRoutes from './routes/creatorRoutes.js';\nimport superChatRoutes from './routes/superChatRoutes.js';\nimport playlistRoutes from './routes/playlistRoutes.js';\nimport watchLaterRoutes from './routes/watchLaterRoutes.js';\nimport communityRoutes from './routes/communityRoutes.js';\nimport noteRoutes from './routes/noteRoutes.js';\nimport trendingRoutes from './routes/trendingRoutes.js';\n\n// Load environment variables\ndotenv.config();\n\n// âœ… Validate environment variables\nconst criticalEnvVars = ['MONGO_URI', 'JWT_SECRET'];\nconst optionalEnvVars = [\n  'CLOUDINARY_CLOUD_NAME',\n  'CLOUDINARY_API_KEY',\n  'CLOUDINARY_API_SECRET',\n];\n\nconst missingCritical = [];\ncriticalEnvVars.forEach((varName) => {\n  if (!process.env[varName]) missingCritical.push(varName);\n});\n\nif (missingCritical.length > 0) {\n  console.error(`âŒ Missing CRITICAL env variables: ${missingCritical.join(', ')}`);\n  process.exit(1);\n}\n\n// âœ… Connect to DB\nconnectDB();\n\n// âœ… Initialize Express\nconst app = express();\nconst server = createServer(app);\n\n// âœ… Security & Logging\napp.use(helmet());\napp.use(morgan(process.env.NODE_ENV === 'production' ? 'combined' : 'dev'));\n\n// âœ… Body parsing\napp.use(express.json({ limit: '10mb' }));\napp.use(express.urlencoded({ extended: true, limit: '10mb' }));\n\n// âœ… CORS for Replit, Netlify & localhost\nconst allowedOrigins = [\n  'http://localhost:5173',\n  'http://localhost:3000',\n  'http://localhost:5000',\n];\n\napp.use(\n  cors({\n    origin: function (origin, callback) {\n      if (!origin) return callback(null, true); // Postman or mobile\n      if (\n        allowedOrigins.includes(origin) ||\n        /\\.replit\\.dev$/.test(origin) ||    // Allow Replit domains\n        /\\.repl\\.co$/.test(origin) ||       // Allow Repl.co domains\n        /\\.netlify\\.app$/.test(origin) ||   // Allow any Netlify frontend\n        /\\.vercel\\.app$/.test(origin)       // Optional: allow Vercel frontend\n      ) {\n        callback(null, true);\n      } else {\n        console.warn(`âŒ CORS blocked: ${origin}`);\n        callback(new Error('Not allowed by CORS'));\n      }\n    },\n    credentials: true,\n    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\n    allowedHeaders: ['Content-Type', 'Authorization'],\n  })\n);\n\n// âœ… Handle preflight requests\napp.options('*', cors());\n\n// âœ… Initialize Socket.io\nconst io = initializeSocket(server);\napp.set('io', io);\n\n// âœ… Routes\napp.get('/', (req, res) => {\n  res.json({\n    success: true,\n    message: 'ğŸš€ friendflix API running!',\n    version: '1.0.0',\n    endpoints: {\n      auth: '/api/auth',\n      users: '/api/users',\n      posts: '/api/posts',\n      notifications: '/api/notifications',\n      messages: '/api/messages',\n      stories: '/api/stories',\n      explore: '/api/explore',\n      admin: '/api/admin',\n      groups: '/api/groups',\n      ai: '/api/ai',\n      subscription: '/api/subscription',\n      creator: '/api/creator',\n      superchat: '/api/superchat',\n      playlists: '/api/playlists',\n      watchlater: '/api/watchlater',\n      community: '/api/community',\n      notes: '/api/notes',\n      trending: '/api/trending',\n    },\n  });\n});\n\napp.use('/api/auth', authRoutes);\napp.use('/api/users', userRoutes);\napp.use('/api/posts', postRoutes);\napp.use('/api/notifications', notificationRoutes);\napp.use('/api/messages', messageRoutes);\napp.use('/api/stories', storyRoutes);\napp.use('/api/explore', exploreRoutes);\napp.use('/api/admin', adminRoutes);\napp.use('/api/groups', groupRoutes);\napp.use('/api/ai', aiRoutes);\napp.use('/api/subscription', subscriptionRoutes);\napp.use('/api/creator', creatorRoutes);\napp.use('/api/superchat', superChatRoutes);\napp.use('/api/playlists', playlistRoutes);\napp.use('/api/watchlater', watchLaterRoutes);\napp.use('/api/community', communityRoutes);\napp.use('/api/notes', noteRoutes);\napp.use('/api/trending', trendingRoutes);\n\n// âœ… Error handling\napp.use(notFound);\napp.use(errorHandler);\n\n// âœ… Start server\nconst PORT = process.env.PORT || 3000;\nserver.listen(PORT, '0.0.0.0', () => {\n  console.log(`ğŸš€ Server running on port ${PORT}`);\n  console.log(`ğŸŒ Allowed Origins: ${allowedOrigins.join(', ')} + *.replit.dev + *.netlify.app`);\n  console.log(`ğŸ“¡ Socket.io initialized`);\n});\n","size_bytes":5160},"backend/test-db.js":{"content":"import mongoose from 'mongoose';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nconsole.log('Testing MongoDB Connection...');\nconsole.log('MONGO_URI:', process.env.MONGO_URI ? 'âœ… Found' : 'âŒ Not found');\n\nmongoose.connect(process.env.MONGO_URI)\n  .then(() => {\n    console.log('âœ… MongoDB Connected Successfully!');\n    process.exit(0);\n  })\n  .catch((err) => {\n    console.error('âŒ MongoDB Connection Failed:', err.message);\n    process.exit(1);\n  });\n","size_bytes":461},"backend/routes/playlistRoutes.js":{"content":"import express from 'express';\nimport {\n  createPlaylist,\n  getUserPlaylists,\n  getPlaylist,\n  updatePlaylist,\n  deletePlaylist,\n  addVideoToPlaylist,\n  removeVideoFromPlaylist,\n  getPublicPlaylists,\n} from '../controllers/playlistController.js';\nimport { protect } from '../middleware/authMiddleware.js';\n\nconst router = express.Router();\n\nrouter.post('/', protect, createPlaylist);\nrouter.get('/user/:userId', getUserPlaylists);\nrouter.get('/public', getPublicPlaylists);\nrouter.get('/:id', getPlaylist);\nrouter.put('/:id', protect, updatePlaylist);\nrouter.delete('/:id', protect, deletePlaylist);\nrouter.post('/:id/videos/:postId', protect, addVideoToPlaylist);\nrouter.delete('/:id/videos/:postId', protect, removeVideoFromPlaylist);\n\nexport default router;\n","size_bytes":761},"backend/models/Post.js":{"content":"import mongoose from 'mongoose';\n\nconst postSchema = new mongoose.Schema(\n  {\n    author: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    caption: {\n      type: String,\n      maxlength: [2200, 'Caption cannot exceed 2200 characters'],\n      trim: true,\n      default: '',\n    },\n    media: [\n      {\n        url: {\n          type: String,\n          required: true,\n        },\n        type: {\n          type: String,\n          enum: ['image', 'video'],\n          default: 'image',\n        },\n      },\n    ],\n    // Keep for backward compatibility\n    mediaUrl: {\n      type: String,\n    },\n    mediaType: {\n      type: String,\n      enum: ['image', 'video'],\n      default: 'image',\n    },\n    likes: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    comments: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Comment',\n      },\n    ],\n    pinnedComment: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Comment',\n      default: null,\n    },\n    tags: [\n      {\n        type: String,\n        trim: true,\n      },\n    ],\n    hashtags: [\n      {\n        type: String,\n        trim: true,\n      },\n    ],\n    mentions: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    isArchived: {\n      type: Boolean,\n      default: false,\n    },\n    location: {\n      type: String,\n      trim: true,\n    },\n    title: {\n      type: String,\n      trim: true,\n      maxlength: [100, 'Title cannot exceed 100 characters'],\n      default: '',\n    },\n    description: {\n      type: String,\n      trim: true,\n      maxlength: [5000, 'Description cannot exceed 5000 characters'],\n      default: '',\n    },\n    visibility: {\n      type: String,\n      enum: ['public', 'private', 'unlisted'],\n      default: 'public',\n    },\n    madeForKids: {\n      type: Boolean,\n      default: false,\n    },\n    allowComments: {\n      type: Boolean,\n      default: true,\n    },\n    thumbnailUrl: {\n      type: String,\n      trim: true,\n    },\n    scheduledAt: {\n      type: Date,\n    },\n    videoLanguage: {\n      type: String,\n      trim: true,\n      default: 'en',\n    },\n    license: {\n      type: String,\n      enum: ['standard', 'creative_commons'],\n      default: 'standard',\n    },\n    topicCategory: {\n      type: String,\n      trim: true,\n    },\n    playlistName: {\n      type: String,\n      trim: true,\n    },\n    paidPromotion: {\n      type: Boolean,\n      default: false,\n    },\n    ageRestricted: {\n      type: Boolean,\n      default: false,\n    },\n    allowEmbedding: {\n      type: Boolean,\n      default: true,\n    },\n    locationLat: { type: Number },\n    locationLng: { type: Number },\n    category: {\n      type: String,\n      enum: ['image', 'short', 'long'],\n      default: 'image',\n    },\n    durationSec: {\n      type: Number,\n    },\n    derivedFrom: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Post',\n    },\n    remixType: {\n      type: String,\n      enum: ['duet', 'remix'],\n    },\n    keywords: [\n      {\n        type: String,\n        trim: true,\n      },\n    ],\n    videoStartSec: { type: Number },\n    videoEndSec: { type: Number },\n    playbackRate: { type: Number },\n    chapters: [\n      {\n        timestamp: {\n          type: Number,\n          required: true,\n        },\n        title: {\n          type: String,\n          required: true,\n          trim: true,\n          maxlength: [100, 'Chapter title cannot exceed 100 characters'],\n        },\n      },\n    ],\n    collaborators: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\npostSchema.index({ author: 1, createdAt: -1 });\npostSchema.index({ createdAt: -1 });\n\nconst Post = mongoose.model('Post', postSchema);\n\nexport default Post;\n","size_bytes":3876},"frontend/src/main.jsx":{"content":"import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App.jsx';\nimport ErrorBoundary from './components/ErrorBoundary.jsx';\nimport './index.css';\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <ErrorBoundary>\n      <App />\n    </ErrorBoundary>\n  </React.StrictMode>\n);\n","size_bytes":342},"FIXES_APPLIED.md":{"content":"# ğŸ”§ Fixes Applied - Group Messaging\n\n## Issues Fixed\n\n### 1. âœ… Duplicate Messages in Group Chat\n**Problem:** When a user sent a message, it appeared twice (until page refresh)\n\n**Root Cause:** Socket.io was broadcasting the message to ALL members including the sender. The sender already had the message from the optimistic update, so it was being added twice.\n\n**Solution:** Added a check in `handleNewMessage` to ignore messages from the current user:\n\n```javascript\nconst handleNewMessage = ({ groupId: msgGroupId, message }) => {\n  if (msgGroupId === groupId) {\n    // Don't add if it's from current user (already added optimistically)\n    if (message.sender._id === user._id) {\n      return;\n    }\n    \n    setMessages((prev) => {\n      const exists = prev.some(msg => msg._id === message._id);\n      if (exists) return prev;\n      return [...prev, message];\n    });\n    scrollToBottom();\n  }\n};\n```\n\n**Result:** Messages now appear only once, immediately, without duplicates.\n\n---\n\n### 2. âœ… Added Media Picker to Group Chat\n**Problem:** Group chat had no way to attach images/videos\n\n**Solution:** Added three buttons to the chat input:\n1. **Emoji Picker** ğŸ˜€ (already working)\n2. **Media Picker** ğŸ“ (attach images/videos)\n3. **Camera** ğŸ“· (take photos)\n\n**Features Added:**\n```javascript\n// Media picker button\n<button onClick={() => fileInputRef.current?.click()}>\n  <AttachIcon />\n</button>\n<input\n  ref={fileInputRef}\n  type=\"file\"\n  accept=\"image/*,video/*\"\n  className=\"hidden\"\n  onChange={handleFileSelect}\n/>\n\n// Camera button\n<button onClick={() => toast('Camera feature coming soon!')}>\n  <CameraIcon />\n</button>\n```\n\n**Current Status:**\n- âœ… UI buttons visible and functional\n- âœ… File picker opens when clicked\n- â³ Upload to Cloudinary (requires Cloudinary setup)\n- â³ Send media as message (requires backend extension)\n\n---\n\n### 3. âœ… Added Media Picker to Regular Chat\n**Problem:** Direct messages also needed media picker\n\n**Solution:** Applied the same media picker buttons to `Chat.jsx`\n\n**Consistency:** Both group chat and direct chat now have identical input controls:\n- Emoji picker\n- Media picker\n- Camera button\n- Text input\n- Send button\n\n---\n\n## Files Modified\n\n### Frontend:\n1. **`frontend/src/pages/GroupChat.jsx`**\n   - Fixed duplicate message issue\n   - Added media picker button\n   - Added camera button\n   - Added file input with ref\n\n2. **`frontend/src/pages/Chat.jsx`**\n   - Added media picker button\n   - Added camera button\n   - Changed from `getElementById` to `useRef`\n\n---\n\n## How to Test\n\n### Test 1: No More Duplicate Messages\n1. Open group chat in Browser 1\n2. Send a message\n3. âœ… Message should appear only ONCE\n4. Open same group in Browser 2 (different user)\n5. Send a message from Browser 2\n6. âœ… Both browsers should show message only once\n\n### Test 2: Media Picker\n1. Open any chat (direct or group)\n2. Look at the input area\n3. âœ… You should see 3 icons before the text input:\n   - ğŸ˜€ Emoji picker\n   - ğŸ“ Media picker (attach)\n   - ğŸ“· Camera\n4. Click the ğŸ“ icon\n5. âœ… File picker should open\n6. Select an image/video\n7. âœ… Toast message: \"Media upload feature coming soon!\"\n\n### Test 3: Camera Button\n1. Click the ğŸ“· camera icon\n2. âœ… Toast message: \"Camera feature coming soon!\"\n\n---\n\n## Next Steps for Full Media Support\n\nTo enable actual media uploads, you need to:\n\n### 1. Set Up Cloudinary\nFollow `CLOUDINARY_SETUP.md` to get credentials\n\n### 2. Extend Backend Models\nAdd media field to GroupMessage and Message models:\n```javascript\nmedia: {\n  url: String,\n  type: { type: String, enum: ['image', 'video'] },\n  thumbnail: String,\n}\n```\n\n### 3. Implement Upload Logic\n```javascript\nconst handleFileSelect = async (file) => {\n  if (!file) return;\n  \n  // Upload to Cloudinary\n  const formData = new FormData();\n  formData.append('file', file);\n  \n  const response = await axios.post('/api/upload', formData);\n  const mediaUrl = response.data.url;\n  \n  // Send as message\n  await groupAPI.sendGroupMessage(groupId, {\n    text: '',\n    media: {\n      url: mediaUrl,\n      type: file.type.startsWith('image') ? 'image' : 'video',\n    },\n  });\n};\n```\n\n### 4. Update Message Display\nAdd media rendering in message bubbles:\n```javascript\n{message.media && (\n  <img src={message.media.url} alt=\"Attachment\" />\n)}\n```\n\n---\n\n## Benefits\n\nâœ… **Better UX:** No confusing duplicate messages  \nâœ… **Consistent UI:** Same controls in all chats  \nâœ… **Future-Ready:** Media picker infrastructure in place  \nâœ… **Professional:** Matches modern chat app standards  \n\n---\n\n## Known Limitations\n\nâš ï¸ **Media uploads require Cloudinary setup**  \nâš ï¸ **Camera access requires HTTPS in production**  \nâš ï¸ **Large files may need compression**  \n\nSee `CLOUDINARY_SETUP.md` for setup instructions.\n\n---\n\n**All fixes tested and working! ğŸ‰**\n","size_bytes":4829},"backend/controllers/playlistController.js":{"content":"import Playlist from '../models/Playlist.js';\nimport Post from '../models/Post.js';\nimport User from '../models/User.js';\n\n// @desc    Create new playlist\n// @route   POST /api/playlists\n// @access  Private\nexport const createPlaylist = async (req, res) => {\n  try {\n    const { title, description, visibility } = req.body;\n\n    if (!title || !title.trim()) {\n      return res.status(400).json({ success: false, message: 'Playlist title is required' });\n    }\n\n    const playlist = await Playlist.create({\n      title,\n      description: description || '',\n      creator: req.user._id,\n      visibility: visibility || 'public',\n      videos: [],\n    });\n\n    res.status(201).json({ success: true, playlist });\n  } catch (error) {\n    console.error('Error creating playlist:', error);\n    res.status(500).json({ success: false, message: 'Failed to create playlist' });\n  }\n};\n\n// @desc    Get user's playlists\n// @route   GET /api/playlists/user/:userId\n// @access  Public\nexport const getUserPlaylists = async (req, res) => {\n  try {\n    const { userId } = req.params;\n\n    const query = { creator: userId };\n    if (!req.user || req.user._id.toString() !== userId) {\n      query.visibility = 'public';\n    }\n\n    const playlists = await Playlist.find(query)\n      .populate('creator', 'username profilePicture fullName')\n      .sort({ lastUpdated: -1 });\n\n    res.json({ success: true, playlists });\n  } catch (error) {\n    console.error('Error fetching playlists:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch playlists' });\n  }\n};\n\n// @desc    Get public playlists\n// @route   GET /api/playlists/public\n// @access  Public\nexport const getPublicPlaylists = async (req, res) => {\n  try {\n    const playlists = await Playlist.find({ visibility: 'public', videoCount: { $gt: 0 } })\n      .populate('creator', 'username profilePicture fullName verified')\n      .sort({ views: -1, lastUpdated: -1 })\n      .limit(50);\n\n    res.json({ success: true, playlists });\n  } catch (error) {\n    console.error('Error fetching public playlists:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch playlists' });\n  }\n};\n\n// @desc    Get playlist by ID\n// @route   GET /api/playlists/:id\n// @access  Public\nexport const getPlaylist = async (req, res) => {\n  try {\n    const playlist = await Playlist.findById(req.params.id)\n      .populate('creator', 'username profilePicture fullName verified')\n      .populate({\n        path: 'videos.post',\n        populate: { path: 'author', select: 'username profilePicture verified' },\n      });\n\n    if (!playlist) {\n      return res.status(404).json({ success: false, message: 'Playlist not found' });\n    }\n\n    if (playlist.visibility === 'private' && (!req.user || req.user._id.toString() !== playlist.creator._id.toString())) {\n      return res.status(403).json({ success: false, message: 'This playlist is private' });\n    }\n\n    playlist.views += 1;\n    await playlist.save();\n\n    res.json({ success: true, playlist });\n  } catch (error) {\n    console.error('Error fetching playlist:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch playlist' });\n  }\n};\n\n// @desc    Update playlist\n// @route   PUT /api/playlists/:id\n// @access  Private\nexport const updatePlaylist = async (req, res) => {\n  try {\n    const playlist = await Playlist.findById(req.params.id);\n\n    if (!playlist) {\n      return res.status(404).json({ success: false, message: 'Playlist not found' });\n    }\n\n    if (playlist.creator.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized' });\n    }\n\n    const { title, description, visibility } = req.body;\n\n    if (title) playlist.title = title;\n    if (description !== undefined) playlist.description = description;\n    if (visibility) playlist.visibility = visibility;\n\n    await playlist.save();\n\n    res.json({ success: true, playlist });\n  } catch (error) {\n    console.error('Error updating playlist:', error);\n    res.status(500).json({ success: false, message: 'Failed to update playlist' });\n  }\n};\n\n// @desc    Delete playlist\n// @route   DELETE /api/playlists/:id\n// @access  Private\nexport const deletePlaylist = async (req, res) => {\n  try {\n    const playlist = await Playlist.findById(req.params.id);\n\n    if (!playlist) {\n      return res.status(404).json({ success: false, message: 'Playlist not found' });\n    }\n\n    if (playlist.creator.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized' });\n    }\n\n    await playlist.deleteOne();\n\n    res.json({ success: true, message: 'Playlist deleted' });\n  } catch (error) {\n    console.error('Error deleting playlist:', error);\n    res.status(500).json({ success: false, message: 'Failed to delete playlist' });\n  }\n};\n\n// @desc    Add video to playlist\n// @route   POST /api/playlists/:id/videos/:postId\n// @access  Private\nexport const addVideoToPlaylist = async (req, res) => {\n  try {\n    const playlist = await Playlist.findById(req.params.id);\n\n    if (!playlist) {\n      return res.status(404).json({ success: false, message: 'Playlist not found' });\n    }\n\n    if (playlist.creator.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized' });\n    }\n\n    const post = await Post.findById(req.params.postId);\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Video not found' });\n    }\n\n    const alreadyExists = playlist.videos.some(\n      (v) => v.post.toString() === req.params.postId\n    );\n\n    if (alreadyExists) {\n      return res.status(400).json({ success: false, message: 'Video already in playlist' });\n    }\n\n    playlist.videos.push({ post: req.params.postId });\n    await playlist.save();\n\n    res.json({ success: true, playlist });\n  } catch (error) {\n    console.error('Error adding video to playlist:', error);\n    res.status(500).json({ success: false, message: 'Failed to add video' });\n  }\n};\n\n// @desc    Remove video from playlist\n// @route   DELETE /api/playlists/:id/videos/:postId\n// @access  Private\nexport const removeVideoFromPlaylist = async (req, res) => {\n  try {\n    const playlist = await Playlist.findById(req.params.id);\n\n    if (!playlist) {\n      return res.status(404).json({ success: false, message: 'Playlist not found' });\n    }\n\n    if (playlist.creator.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized' });\n    }\n\n    playlist.videos = playlist.videos.filter(\n      (v) => v.post.toString() !== req.params.postId\n    );\n\n    await playlist.save();\n\n    res.json({ success: true, playlist });\n  } catch (error) {\n    console.error('Error removing video from playlist:', error);\n    res.status(500).json({ success: false, message: 'Failed to remove video' });\n  }\n};\n","size_bytes":6908},"backend/middleware/rateLimitMiddleware.js":{"content":"// Simple in-memory rate limiter\n// For production, use Redis-based rate limiting (e.g., express-rate-limit with Redis)\n\nconst rateLimitStore = new Map();\n\n// Clean up old entries every hour\nsetInterval(() => {\n  const now = Date.now();\n  for (const [key, value] of rateLimitStore.entries()) {\n    if (now - value.resetTime > 3600000) { // 1 hour\n      rateLimitStore.delete(key);\n    }\n  }\n}, 3600000); // Run every hour\n\n/**\n * Rate limiting middleware\n * @param {number} maxRequests - Maximum requests allowed in the time window\n * @param {number} windowMs - Time window in milliseconds\n */\nexport const createRateLimiter = (maxRequests = 100, windowMs = 15 * 60 * 1000) => {\n  return (req, res, next) => {\n    const identifier = req.user?._id?.toString() || req.ip;\n    const now = Date.now();\n    \n    if (!rateLimitStore.has(identifier)) {\n      rateLimitStore.set(identifier, {\n        count: 1,\n        resetTime: now + windowMs,\n      });\n      return next();\n    }\n    \n    const userData = rateLimitStore.get(identifier);\n    \n    // Reset if window has passed\n    if (now > userData.resetTime) {\n      userData.count = 1;\n      userData.resetTime = now + windowMs;\n      return next();\n    }\n    \n    // Check if limit exceeded\n    if (userData.count >= maxRequests) {\n      const retryAfter = Math.ceil((userData.resetTime - now) / 1000);\n      return res.status(429).json({\n        success: false,\n        message: 'Too many requests, please try again later.',\n        retryAfter,\n      });\n    }\n    \n    userData.count++;\n    next();\n  };\n};\n\n// Common rate limiters\nexport const authLimiter = createRateLimiter(5, 15 * 60 * 1000); // 5 requests per 15 minutes\nexport const apiLimiter = createRateLimiter(100, 15 * 60 * 1000); // 100 requests per 15 minutes\nexport const uploadLimiter = createRateLimiter(10, 60 * 60 * 1000); // 10 uploads per hour\n","size_bytes":1865},"frontend/postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"frontend/src/pages/AdminDashboard.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { Navigate, Link } from 'react-router-dom';\nimport { adminAPI } from '../services/adminAPI';\nimport toast from 'react-hot-toast';\nimport {\n  FiUsers,\n  FiImage,\n  FiMessageSquare,\n  FiActivity,\n  FiUserPlus,\n  FiTrendingUp,\n  FiFileText,\n} from 'react-icons/fi';\n\nconst AdminDashboard = () => {\n  const { user } = useAuth();\n  const [stats, setStats] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (user?.role === 'admin') {\n      fetchDashboardStats();\n    }\n  }, [user]);\n\n  const fetchDashboardStats = async () => {\n    try {\n      setLoading(true);\n      const response = await adminAPI.getDashboardStats();\n      setStats(response.data.data);\n    } catch (error) {\n      toast.error('Failed to fetch dashboard stats');\n      console.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Check if user is admin\n  if (!user || user.role !== 'admin') {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n      </div>\n    );\n  }\n\n  const statCards = [\n    {\n      title: 'Total Users',\n      value: stats?.totalUsers || 0,\n      icon: FiUsers,\n      color: 'blue',\n      link: '/admin/users',\n    },\n    {\n      title: 'Total Posts',\n      value: stats?.totalPosts || 0,\n      icon: FiImage,\n      color: 'purple',\n      link: '/admin/posts',\n    },\n    {\n      title: 'Total Messages',\n      value: stats?.totalMessages || 0,\n      icon: FiMessageSquare,\n      color: 'green',\n      link: null,\n    },\n    {\n      title: 'Total Stories',\n      value: stats?.totalStories || 0,\n      icon: FiFileText,\n      color: 'orange',\n      link: null,\n    },\n    {\n      title: 'Active Users (24h)',\n      value: stats?.activeUsers || 0,\n      icon: FiActivity,\n      color: 'teal',\n      link: null,\n    },\n    {\n      title: 'New Users Today',\n      value: stats?.newUsersToday || 0,\n      icon: FiUserPlus,\n      color: 'indigo',\n      link: null,\n    },\n    {\n      title: 'New Posts Today',\n      value: stats?.newPostsToday || 0,\n      icon: FiTrendingUp,\n      color: 'pink',\n      link: null,\n    },\n  ];\n\n  const colorClasses = {\n    blue: 'bg-blue-500',\n    purple: 'bg-purple-500',\n    green: 'bg-green-500',\n    orange: 'bg-orange-500',\n    teal: 'bg-teal-500',\n    indigo: 'bg-indigo-500',\n    pink: 'bg-pink-500',\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6\">\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3\">\n            <div>\n              <h1 className=\"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white\">\n                Admin Dashboard\n              </h1>\n              <p className=\"mt-1 text-xs sm:text-sm text-gray-500 dark:text-gray-400\">\n                Manage your application from here\n              </p>\n            </div>\n            <Link\n              to=\"/\"\n              className=\"w-full sm:w-auto text-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition text-sm\"\n            >\n              Back to App\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* Stats Grid */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8\">\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6\">\n          {statCards.map((stat, index) => {\n            const Icon = stat.icon;\n            const CardWrapper = stat.link ? Link : 'div';\n            const cardProps = stat.link ? { to: stat.link } : {};\n\n            return (\n              <CardWrapper\n                key={index}\n                {...cardProps}\n                className={`bg-white dark:bg-gray-800 rounded-lg shadow p-6 ${\n                  stat.link ? 'hover:shadow-lg transition cursor-pointer' : ''\n                }`}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400 truncate\">\n                      {stat.title}\n                    </p>\n                    <p className=\"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mt-1 sm:mt-2\">\n                      {stat.value.toLocaleString()}\n                    </p>\n                  </div>\n                  <div\n                    className={`${\n                      colorClasses[stat.color]\n                    } p-2 sm:p-3 rounded-full text-white flex-shrink-0 ml-2`}\n                  >\n                    <Icon className=\"w-5 h-5 sm:w-6 sm:h-6\" />\n                  </div>\n                </div>\n              </CardWrapper>\n            );\n          })}\n        </div>\n\n        {/* Quick Actions */}\n        <div className=\"mt-6 sm:mt-8 bg-white dark:bg-gray-800 rounded-lg shadow p-4 sm:p-6\">\n          <h2 className=\"text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-3 sm:mb-4\">\n            Quick Actions\n          </h2>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4\">\n            <Link\n              to=\"/admin/users\"\n              className=\"flex items-center p-3 sm:p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-blue-500 dark:hover:border-blue-500 transition\"\n            >\n              <FiUsers className=\"w-6 h-6 sm:w-8 sm:h-8 text-blue-500 mr-2 sm:mr-3 flex-shrink-0\" />\n              <div className=\"min-w-0 flex-1\">\n                <h3 className=\"text-sm sm:text-base font-semibold text-gray-900 dark:text-white\">\n                  Manage Users\n                </h3>\n                <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400\">\n                  View and manage all users\n                </p>\n              </div>\n            </Link>\n\n            <Link\n              to=\"/admin/posts\"\n              className=\"flex items-center p-3 sm:p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-purple-500 dark:hover:border-purple-500 transition\"\n            >\n              <FiImage className=\"w-6 h-6 sm:w-8 sm:h-8 text-purple-500 mr-2 sm:mr-3 flex-shrink-0\" />\n              <div className=\"min-w-0 flex-1\">\n                <h3 className=\"text-sm sm:text-base font-semibold text-gray-900 dark:text-white\">\n                  Manage Posts\n                </h3>\n                <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400\">\n                  View and moderate posts\n                </p>\n              </div>\n            </Link>\n\n            <Link\n              to=\"/admin/reports\"\n              className=\"flex items-center p-3 sm:p-4 border-2 border-gray-200 dark:border-gray-700 rounded-lg hover:border-red-500 dark:hover:border-red-500 transition\"\n            >\n              <FiActivity className=\"w-6 h-6 sm:w-8 sm:h-8 text-red-500 mr-2 sm:mr-3 flex-shrink-0\" />\n              <div className=\"min-w-0 flex-1\">\n                <h3 className=\"text-sm sm:text-base font-semibold text-gray-900 dark:text-white\">\n                  View Reports\n                </h3>\n                <p className=\"text-xs sm:text-sm text-gray-500 dark:text-gray-400\">\n                  Check reported content\n                </p>\n              </div>\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AdminDashboard;\n","size_bytes":7852},"frontend/src/components/AdSense.jsx":{"content":"import { useEffect } from 'react';\n\nconst AdSense = ({ \n  adClient,\n  adSlot,\n  adFormat = 'auto',\n  fullWidthResponsive = true,\n  style = {}\n}) => {\n  useEffect(() => {\n    try {\n      if (window.adsbygoogle && process.env.NODE_ENV === 'production') {\n        window.adsbygoogle.push({});\n      }\n    } catch (error) {\n      console.error('AdSense error:', error);\n    }\n  }, []);\n\n  if (process.env.NODE_ENV !== 'production') {\n    return (\n      <div style={{\n        padding: '20px',\n        background: '#f0f0f0',\n        border: '2px dashed #ccc',\n        textAlign: 'center',\n        ...style\n      }}>\n        <p style={{ color: '#666', margin: 0 }}>Ad Placeholder (Development Mode)</p>\n      </div>\n    );\n  }\n\n  return (\n    <ins\n      className=\"adsbygoogle\"\n      style={{ display: 'block', ...style }}\n      data-ad-client={adClient}\n      data-ad-slot={adSlot}\n      data-ad-format={adFormat}\n      data-full-width-responsive={fullWidthResponsive}\n    />\n  );\n};\n\nexport default AdSense;\n","size_bytes":1003},"FUTURE_FEATURES.md":{"content":"# Future Feature Ideas for friendflix\n\n## Long-Form Video Support (Like friendflix/IGTV)\n\n### Overview\nCurrently, friendflix Reels only supports short-form videos (â‰¤60 seconds). Adding long-form video support would enable:\n- Videos longer than 60 seconds\n- Mid-roll ads for better monetization\n- Different content consumption patterns\n- friendflix-like watch experience\n\n### Implementation Checklist\n\n#### 1. Update Upload Component\n- [ ] Add \"Long Video\" category option\n- [ ] Remove duration limits for long videos\n- [ ] Add video length indicator in upload UI\n\n#### 2. Create Videos/Watch Page\n```javascript\n// frontend/src/pages/Videos.jsx\n// Similar to Reels.jsx but for long-form content\n// Filter: post.category === 'long'\n```\n\n#### 3. Update Feed\n- [ ] Add \"Videos\" section in feed\n- [ ] Differentiate short vs long videos\n- [ ] Add thumbnails with duration badges\n\n#### 4. Mid-Roll Ads Ready!\n- âœ… Mid-roll ad code already implemented in Reels.jsx\n- âœ… Will automatically work when videos >5 minutes are added\n- âœ… Configuration already in adConfig.js\n\n### Monetization Benefits\n- **Current**: Only pre-roll ads on Reels (every 4th short)\n- **With Long Videos**: Pre-roll + Mid-roll ads\n- **Revenue Increase**: 2-3x more ad impressions\n\n### Example Flow\n1. User uploads 10-minute cooking tutorial\n2. Pre-roll ad shows when video starts\n3. Mid-roll ad shows at 5-minute mark\n4. User continues watching\n5. More engagement, more revenue!\n\n## Other Future Features\n\n### 1. friendflix Premium-style Subscription\n- Ad-free experience\n- Exclusive content\n- Downloads for offline viewing\n\n### 2. Creator Monetization\n- Revenue sharing with creators\n- Minimum watch time requirements\n- Analytics dashboard for creators\n\n### 3. Live Streaming\n- Real-time video streaming\n- Live chat\n- Super chat donations\n- Live stream ads\n\n### 4. Shorts Fund (Like friendflix Shorts Fund)\n- Reward popular short creators\n- Monthly bonuses based on views\n- Incentivize content creation\n\n---\n\n**Note**: Mid-roll ad infrastructure is already built and ready. Just need to add long-form video content pages to activate it!\n","size_bytes":2094},"backend/models/Comment.js":{"content":"import mongoose from 'mongoose';\n\nconst commentSchema = new mongoose.Schema(\n  {\n    post: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Post',\n      required: true,\n    },\n    author: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    parentComment: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Comment',\n      default: null,\n    },\n    text: {\n      type: String,\n      required: [true, 'Comment text is required'],\n      maxlength: [500, 'Comment cannot exceed 500 characters'],\n      trim: true,\n    },\n    likes: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\ncommentSchema.index({ post: 1, createdAt: -1 });\n\nconst Comment = mongoose.model('Comment', commentSchema);\n\nexport default Comment;\n","size_bytes":883},"frontend/src/pages/Community.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { communityAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { FiHeart, FiMessageCircle, FiMoreVertical, FiImage, FiBarChart } from 'react-icons/fi';\nimport Navbar from '../components/Navbar';\nimport BottomNav from '../components/BottomNav';\nimport Loader from '../components/Loader';\n\nfunction Community() {\n  const [posts, setPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [newPost, setNewPost] = useState({ content: '', type: 'text' });\n  const { userId } = useParams();\n  const currentUser = JSON.parse(localStorage.getItem('user') || '{}');\n\n  useEffect(() => {\n    fetchCommunityPosts();\n  }, [userId]);\n\n  const fetchCommunityPosts = async () => {\n    try {\n      setLoading(true);\n      const response = await communityAPI.getUserCommunityPosts(userId || currentUser._id);\n      setPosts(response.data.posts || []);\n    } catch (error) {\n      console.error('Error fetching community posts:', error);\n      toast.error('Failed to load community posts');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreatePost = async (e) => {\n    e.preventDefault();\n    if (!newPost.content.trim()) {\n      toast.error('Content is required');\n      return;\n    }\n\n    try {\n      const formData = new FormData();\n      formData.append('content', newPost.content);\n      formData.append('type', newPost.type);\n\n      await communityAPI.createCommunityPost(formData);\n      toast.success('Community post created!');\n      setShowCreateModal(false);\n      setNewPost({ content: '', type: 'text' });\n      fetchCommunityPosts();\n    } catch (error) {\n      console.error('Error creating post:', error);\n      toast.error('Failed to create post');\n    }\n  };\n\n  const handleLike = async (postId) => {\n    try {\n      await communityAPI.likeCommunityPost(postId);\n      setPosts(posts.map(p => \n        p._id === postId \n          ? { ...p, likes: p.likes.includes(currentUser._id) \n              ? p.likes.filter(id => id !== currentUser._id)\n              : [...p.likes, currentUser._id]\n            }\n          : p\n      ));\n    } catch (error) {\n      console.error('Error liking post:', error);\n      toast.error('Failed to like post');\n    }\n  };\n\n  const handleDeletePost = async (postId) => {\n    if (!confirm('Are you sure you want to delete this post?')) return;\n\n    try {\n      await communityAPI.deleteCommunityPost(postId);\n      setPosts(posts.filter(p => p._id !== postId));\n      toast.success('Post deleted');\n    } catch (error) {\n      console.error('Error deleting post:', error);\n      toast.error('Failed to delete post');\n    }\n  };\n\n  if (loading) return <Loader />;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <Navbar />\n      \n      <div className=\"max-w-4xl mx-auto px-4 py-6 pb-20\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Community</h1>\n          {(!userId || userId === currentUser._id) && (\n            <button\n              onClick={() => setShowCreateModal(true)}\n              className=\"bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg hover:opacity-90\"\n            >\n              Create Post\n            </button>\n          )}\n        </div>\n\n        <div className=\"space-y-4\">\n          {posts.length === 0 ? (\n            <div className=\"text-center py-20 bg-white dark:bg-gray-800 rounded-lg\">\n              <p className=\"text-gray-500 dark:text-gray-400 text-lg\">No community posts yet</p>\n            </div>\n          ) : (\n            posts.map((post) => (\n              <div key={post._id} className=\"bg-white dark:bg-gray-800 rounded-lg shadow p-6\">\n                <div className=\"flex justify-between items-start mb-4\">\n                  <div className=\"flex items-center gap-3\">\n                    <img\n                      src={post.creator.profilePicture || '/default-avatar.png'}\n                      alt={post.creator.username}\n                      className=\"w-12 h-12 rounded-full object-cover\"\n                    />\n                    <div>\n                      <p className=\"font-semibold text-gray-900 dark:text-white\">\n                        {post.creator.fullName || post.creator.username}\n                      </p>\n                      <p className=\"text-sm text-gray-500\">\n                        {new Date(post.createdAt).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </div>\n                  {post.creator._id === currentUser._id && (\n                    <button\n                      onClick={() => handleDeletePost(post._id)}\n                      className=\"text-gray-500 hover:text-red-500\"\n                    >\n                      <FiMoreVertical />\n                    </button>\n                  )}\n                </div>\n\n                <p className=\"text-gray-900 dark:text-white whitespace-pre-wrap mb-4\">\n                  {post.content}\n                </p>\n\n                {post.media && (\n                  <div className=\"mb-4\">\n                    {post.media.type === 'image' ? (\n                      <img\n                        src={post.media.url}\n                        alt=\"Post media\"\n                        className=\"w-full rounded-lg max-h-96 object-cover\"\n                      />\n                    ) : (\n                      <video\n                        src={post.media.url}\n                        controls\n                        className=\"w-full rounded-lg max-h-96\"\n                      />\n                    )}\n                  </div>\n                )}\n\n                {post.type === 'poll' && post.poll && (\n                  <div className=\"mb-4 space-y-2\">\n                    <p className=\"font-semibold text-gray-900 dark:text-white\">{post.poll.question}</p>\n                    {post.poll.options.map((option, index) => {\n                      const totalVotes = post.poll.options.reduce((sum, opt) => sum + opt.votes.length, 0);\n                      const percentage = totalVotes > 0 ? (option.votes.length / totalVotes) * 100 : 0;\n                      return (\n                        <div key={index} className=\"relative\">\n                          <div\n                            className=\"absolute inset-0 bg-purple-100 dark:bg-purple-900/20 rounded\"\n                            style={{ width: `${percentage}%` }}\n                          />\n                          <div className=\"relative px-4 py-2 flex justify-between\">\n                            <span className=\"text-gray-900 dark:text-white\">{option.text}</span>\n                            <span className=\"text-gray-600 dark:text-gray-400\">{Math.round(percentage)}%</span>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n\n                <div className=\"flex items-center gap-6 text-gray-500\">\n                  <button\n                    onClick={() => handleLike(post._id)}\n                    className={`flex items-center gap-2 ${\n                      post.likes.includes(currentUser._id) ? 'text-red-500' : 'hover:text-red-500'\n                    }`}\n                  >\n                    <FiHeart className={post.likes.includes(currentUser._id) ? 'fill-current' : ''} />\n                    <span>{post.likes.length}</span>\n                  </button>\n                  <div className=\"flex items-center gap-2\">\n                    <FiMessageCircle />\n                    <span>{post.comments.length}</span>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full p-6\">\n            <h2 className=\"text-2xl font-bold mb-4 text-gray-900 dark:text-white\">Create Community Post</h2>\n            <form onSubmit={handleCreatePost}>\n              <textarea\n                placeholder=\"What's on your mind?\"\n                className=\"w-full p-3 border rounded-lg mb-3 dark:bg-gray-700 dark:text-white\"\n                rows=\"5\"\n                value={newPost.content}\n                onChange={(e) => setNewPost({ ...newPost, content: e.target.value })}\n              />\n              <div className=\"flex gap-3 mb-4\">\n                <button\n                  type=\"button\"\n                  onClick={() => setNewPost({ ...newPost, type: 'text' })}\n                  className={`flex items-center gap-2 px-4 py-2 rounded-lg ${\n                    newPost.type === 'text' ? 'bg-purple-500 text-white' : 'bg-gray-200 dark:bg-gray-700'\n                  }`}\n                >\n                  Text\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => setNewPost({ ...newPost, type: 'poll' })}\n                  className={`flex items-center gap-2 px-4 py-2 rounded-lg ${\n                    newPost.type === 'poll' ? 'bg-purple-500 text-white' : 'bg-gray-200 dark:bg-gray-700'\n                  }`}\n                >\n                  <FiBarChart /> Poll\n                </button>\n              </div>\n              <div className=\"flex gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg\"\n                >\n                  Post\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      <BottomNav />\n    </div>\n  );\n}\n\nexport default Community;\n","size_bytes":10225},"frontend/src/context/ThemeContext.jsx":{"content":"import { createContext, useContext, useState, useEffect } from 'react';\n\nconst ThemeContext = createContext();\n\nexport const useTheme = () => {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error('useTheme must be used within ThemeProvider');\n  }\n  return context;\n};\n\nexport const ThemeProvider = ({ children }) => {\n  const [theme, setTheme] = useState(() => {\n    // Check localStorage first\n    const savedTheme = localStorage.getItem('theme');\n    if (savedTheme) {\n      return savedTheme;\n    }\n    // Check system preference\n    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {\n      return 'dark';\n    }\n    return 'light';\n  });\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n    \n    if (theme === 'dark') {\n      root.classList.add('dark');\n    } else {\n      root.classList.remove('dark');\n    }\n    \n    localStorage.setItem('theme', theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prevTheme) => (prevTheme === 'light' ? 'dark' : 'light'));\n  };\n\n  const value = {\n    theme,\n    toggleTheme,\n    isDark: theme === 'dark',\n  };\n\n  return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>;\n};\n","size_bytes":1218},"frontend/src/pages/Groups.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { groupAPI, userAPI } from '../services/api';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\nimport Loader from '../components/Loader';\nimport { timeAgo } from '../utils/timeAgo';\nimport { AiOutlinePlus, AiOutlineUsergroupAdd } from 'react-icons/ai';\nimport { FiUsers } from 'react-icons/fi';\n\nconst Groups = () => {\n  const navigate = useNavigate();\n  const [groups, setGroups] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [groupName, setGroupName] = useState('');\n  const [groupDescription, setGroupDescription] = useState('');\n  const [selectedMembers, setSelectedMembers] = useState([]);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchResults, setSearchResults] = useState([]);\n  const [creating, setCreating] = useState(false);\n\n  useEffect(() => {\n    fetchGroups();\n\n    // Listen for new groups and messages\n    socketService.on('newGroup', handleNewGroup);\n    socketService.on('newGroupMessage', handleNewGroupMessage);\n    socketService.on('addedToGroup', handleAddedToGroup);\n\n    return () => {\n      socketService.off('newGroup');\n      socketService.off('newGroupMessage');\n      socketService.off('addedToGroup');\n    };\n  }, []);\n\n  const fetchGroups = async () => {\n    try {\n      const response = await groupAPI.getUserGroups();\n      setGroups(response.data.data);\n    } catch (error) {\n      console.error('Failed to load groups:', error);\n      toast.error('Failed to load groups');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleNewGroup = (group) => {\n    setGroups((prev) => [group, ...prev]);\n  };\n\n  const handleNewGroupMessage = ({ groupId, message }) => {\n    setGroups((prev) =>\n      prev.map((group) =>\n        group._id === groupId\n          ? { ...group, lastMessage: message, lastMessageAt: new Date() }\n          : group\n      )\n    );\n  };\n\n  const handleAddedToGroup = (group) => {\n    setGroups((prev) => [group, ...prev]);\n    toast.success(`You were added to ${group.name}`);\n  };\n\n  const searchUsers = async (query) => {\n    if (!query.trim()) {\n      setSearchResults([]);\n      return;\n    }\n\n    try {\n      const response = await userAPI.searchUsers(query);\n      setSearchResults(response.data.data);\n    } catch (error) {\n      console.error('Search failed:', error);\n    }\n  };\n\n  const toggleMember = (user) => {\n    setSelectedMembers((prev) => {\n      const exists = prev.find((m) => m._id === user._id);\n      if (exists) {\n        return prev.filter((m) => m._id !== user._id);\n      }\n      return [...prev, user];\n    });\n  };\n\n  const handleCreateGroup = async (e) => {\n    e.preventDefault();\n\n    if (!groupName.trim()) {\n      toast.error('Group name is required');\n      return;\n    }\n\n    if (selectedMembers.length === 0) {\n      toast.error('Please select at least one member');\n      return;\n    }\n\n    setCreating(true);\n\n    try {\n      const response = await groupAPI.createGroup({\n        name: groupName,\n        description: groupDescription,\n        memberIds: selectedMembers.map((m) => m._id),\n      });\n\n      toast.success('Group created successfully!');\n      setShowCreateModal(false);\n      setGroupName('');\n      setGroupDescription('');\n      setSelectedMembers([]);\n      navigate(`/group/${response.data.data._id}`);\n    } catch (error) {\n      toast.error(error.response?.data?.message || 'Failed to create group');\n    } finally {\n      setCreating(false);\n    }\n  };\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto px-4 py-8 pb-20 md:pb-8\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-2xl font-bold dark:text-white\">Groups</h1>\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex items-center space-x-2 bg-primary text-white px-4 py-2 rounded-full hover:bg-primary/90 transition\"\n        >\n          <AiOutlinePlus size={20} />\n          <span>Create Group</span>\n        </button>\n      </div>\n\n      {/* Groups List */}\n      <div className=\"card dark:bg-gray-800 dark:border-gray-700\">\n        {groups.length === 0 ? (\n          <div className=\"p-12 text-center\">\n            <FiUsers size={64} className=\"mx-auto text-gray-400 mb-4\" />\n            <p className=\"text-gray-600 dark:text-gray-400 mb-4\">No groups yet</p>\n            <button\n              onClick={() => setShowCreateModal(true)}\n              className=\"btn-primary\"\n            >\n              Create Your First Group\n            </button>\n          </div>\n        ) : (\n          <div className=\"divide-y divide-gray-200 dark:divide-gray-700\">\n            {groups.map((group) => (\n              <Link\n                key={group._id}\n                to={`/group/${group._id}`}\n                className=\"flex items-center space-x-4 p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition\"\n              >\n                {/* Group Avatar (Overlapping members) */}\n                <div className=\"relative flex-shrink-0\">\n                  <div className=\"flex -space-x-2\">\n                    {group.members.slice(0, 3).map((member, index) => (\n                      <img\n                        key={member.user._id}\n                        src={member.user.avatar}\n                        alt={member.user.username}\n                        className=\"h-12 w-12 rounded-full object-cover border-2 border-white dark:border-gray-800\"\n                        style={{ zIndex: 3 - index }}\n                      />\n                    ))}\n                  </div>\n                  {group.members.length > 3 && (\n                    <div className=\"absolute -bottom-1 -right-1 bg-primary text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-semibold border-2 border-white dark:border-gray-800\">\n                      +{group.members.length - 3}\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center justify-between mb-1\">\n                    <p className=\"font-semibold dark:text-white truncate\">\n                      {group.name}\n                    </p>\n                    {group.lastMessageAt && (\n                      <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                        {timeAgo(group.lastMessageAt)}\n                      </span>\n                    )}\n                  </div>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">\n                    {group.lastMessage?.text || group.description || `${group.members.length} members`}\n                  </p>\n                </div>\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Create Group Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6\">\n              <h2 className=\"text-2xl font-bold mb-4 dark:text-white\">Create Group</h2>\n\n              <form onSubmit={handleCreateGroup}>\n                {/* Group Name */}\n                <div className=\"mb-4\">\n                  <label className=\"block text-sm font-medium mb-2 dark:text-white\">\n                    Group Name *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={groupName}\n                    onChange={(e) => setGroupName(e.target.value)}\n                    placeholder=\"Enter group name\"\n                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-primary\"\n                    required\n                  />\n                </div>\n\n                {/* Group Description */}\n                <div className=\"mb-4\">\n                  <label className=\"block text-sm font-medium mb-2 dark:text-white\">\n                    Description (Optional)\n                  </label>\n                  <textarea\n                    value={groupDescription}\n                    onChange={(e) => setGroupDescription(e.target.value)}\n                    placeholder=\"What's this group about?\"\n                    rows={3}\n                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-primary\"\n                  />\n                </div>\n\n                {/* Search Members */}\n                <div className=\"mb-4\">\n                  <label className=\"block text-sm font-medium mb-2 dark:text-white\">\n                    Add Members *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={searchQuery}\n                    onChange={(e) => {\n                      setSearchQuery(e.target.value);\n                      searchUsers(e.target.value);\n                    }}\n                    placeholder=\"Search users...\"\n                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-primary\"\n                  />\n\n                  {/* Search Results */}\n                  {searchResults.length > 0 && (\n                    <div className=\"mt-2 max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-lg\">\n                      {searchResults.map((user) => (\n                        <div\n                          key={user._id}\n                          onClick={() => toggleMember(user)}\n                          className=\"flex items-center space-x-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer\"\n                        >\n                          <img\n                            src={user.avatar}\n                            alt={user.username}\n                            className=\"h-8 w-8 rounded-full object-cover\"\n                          />\n                          <div className=\"flex-1\">\n                            <p className=\"font-medium dark:text-white\">{user.username}</p>\n                            <p className=\"text-xs text-gray-500\">{user.fullName}</p>\n                          </div>\n                          {selectedMembers.find((m) => m._id === user._id) && (\n                            <span className=\"text-primary\">âœ“</span>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n\n                {/* Selected Members */}\n                {selectedMembers.length > 0 && (\n                  <div className=\"mb-4\">\n                    <p className=\"text-sm font-medium mb-2 dark:text-white\">\n                      Selected Members ({selectedMembers.length})\n                    </p>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {selectedMembers.map((member) => (\n                        <div\n                          key={member._id}\n                          className=\"flex items-center space-x-2 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full\"\n                        >\n                          <img\n                            src={member.avatar}\n                            alt={member.username}\n                            className=\"h-6 w-6 rounded-full object-cover\"\n                          />\n                          <span className=\"text-sm dark:text-white\">{member.username}</span>\n                          <button\n                            type=\"button\"\n                            onClick={() => toggleMember(member)}\n                            className=\"text-red-500 hover:text-red-700\"\n                          >\n                            Ã—\n                          </button>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Buttons */}\n                <div className=\"flex space-x-3\">\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      setShowCreateModal(false);\n                      setGroupName('');\n                      setGroupDescription('');\n                      setSelectedMembers([]);\n                      setSearchQuery('');\n                      setSearchResults([]);\n                    }}\n                    className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:text-white rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition\"\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    type=\"submit\"\n                    disabled={creating || !groupName.trim() || selectedMembers.length === 0}\n                    className=\"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    {creating ? 'Creating...' : 'Create Group'}\n                  </button>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Groups;\n","size_bytes":13521},"backend/routes/messageRoutes.js":{"content":"import express from 'express';\nimport {\n  sendMessage,\n  getConversation,\n  getConversations,\n  deleteMessage,\n  getUnreadCount,\n  addReaction,\n  removeReaction,\n  toggleStarConversation,\n  toggleArchiveConversation,\n  markConversationAsRead,\n  markAllConversationsAsRead,\n  getConversationMetadata,\n  sendVoiceMessage,\n  sendAttachment,\n  updateConversationSettings,\n  updateConversationExpiry,\n  searchMessages,\n} from '../controllers/messageController.js';\nimport { protect } from '../middleware/authMiddleware.js';\nimport { upload } from '../config/minio.js';\n\nconst router = express.Router();\n\nrouter.get('/conversations', protect, getConversations);\nrouter.get('/unread/count', protect, getUnreadCount);\nrouter.get('/conversations/:userId/metadata', protect, getConversationMetadata);\nrouter.post('/conversations/:userId/expiry', protect, updateConversationExpiry);\nrouter.get('/search', protect, searchMessages);\n\n// Place specific routes before parameterized ones to avoid conflicts\nrouter.post('/mark-all-read', protect, markAllConversationsAsRead);\nrouter.post('/conversations/:userId/star', protect, toggleStarConversation);\nrouter.post('/conversations/:userId/archive', protect, toggleArchiveConversation);\nrouter.post('/conversations/:userId/read', protect, markConversationAsRead);\n\nrouter.post('/:receiverId/attachments', protect, upload.single('attachment'), sendAttachment);\nrouter.post('/:receiverId/voice', protect, upload.single('voice'), sendVoiceMessage);\nrouter.post('/:receiverId', protect, sendMessage);\nrouter.post('/:messageId/reaction', protect, addReaction);\nrouter.delete('/:messageId/reaction', protect, removeReaction);\nrouter.get('/:userId', protect, getConversation);\nrouter.delete('/:messageId', protect, deleteMessage);\n\nexport default router;\n","size_bytes":1780},"ADMIN_PANEL_GUIDE.md":{"content":"\n# ğŸ” Admin Panel Guide\n\n## Overview\nComplete Admin Panel for friendflix with dashboard, user management, and post moderation capabilities.\n\n## Features\n\n### âœ… Implemented Features\n\n#### 1. **Admin Dashboard** (`/admin`)\n- **Statistics Overview**\n  - Total Users\n  - Total Posts\n  - Total Messages\n  - Total Stories\n  - Active Users (24h)\n  - New Users Today\n  - New Posts Today\n\n- **Quick Actions**\n  - Navigate to User Management\n  - Navigate to Post Management\n  - Navigate to Reports\n\n#### 2. **User Management** (`/admin/users`)\n- **View All Users**\n  - Paginated list (20 users per page)\n  - Display user info: avatar, name, username, email\n  - Show user role and status\n  - Display stats: posts count, subscriber count\n\n- **Search Users**\n  - Search by username, name, or email\n  - Real-time search functionality\n\n- **User Actions**\n  - âœ… **Verify/Unverify User** - Add or remove blue checkmark\n  - ğŸ”’ **Ban/Unban User** - Restrict user access\n  - ğŸ›¡ï¸ **Change User Role** - Change between user/creator/business/admin\n  - ğŸ—‘ï¸ **Delete User** - Permanently delete user and all their content\n  - ğŸ‘¤ **View Profile** - Direct link to user profile\n\n- **User Roles**\n  - `user` - Regular user (default)\n  - `creator` - Content creator with extra features\n  - `business` - Business account\n  - `admin` - Full admin access\n\n#### 3. **Post Management** (`/admin/posts`)\n- **View All Posts**\n  - Grid view with thumbnails\n  - Paginated list (20 posts per page)\n  - Display post info: media, caption, user\n  - Show statistics: likes, comments\n\n- **Search Posts**\n  - Search by caption\n  - Filter functionality\n\n- **Post Actions**\n  - ğŸ‘ï¸ **View Post Details** - Click to see full post information\n  - ğŸ—‘ï¸ **Delete Post** - Remove inappropriate content\n  - ğŸ“Š **View Statistics** - See likes and comments count\n  - ğŸ‘¤ **View Author** - Link to post creator\n\n- **Post Details Modal**\n  - Full media display (images/videos)\n  - Complete caption\n  - User information\n  - Post statistics\n  - Post ID and timestamp\n  - Delete action\n\n#### 4. **Reports Management** (`/admin/reports`)\n- Coming soon feature\n- Will handle user-reported content\n- Review and take action on reports\n\n## Access Control\n\n### Admin Access\nOnly users with `role: 'admin'` can access the admin panel.\n\n### Security Features\n- Protected routes with authentication\n- Role-based access control (RBAC)\n- JWT token validation\n- Admin-only middleware on backend\n\n## Backend API Endpoints\n\nAll admin endpoints require authentication and admin role:\n\n```\nGET    /api/admin/stats                    - Dashboard statistics\nGET    /api/admin/users?page=1&limit=20    - Get all users\nDELETE /api/admin/users/:userId            - Delete user\nPUT    /api/admin/users/:userId/ban        - Toggle ban status\nPUT    /api/admin/users/:userId/verify     - Toggle verification\nPUT    /api/admin/users/:userId/role       - Change user role\nGET    /api/admin/posts?page=1&limit=20    - Get all posts\nDELETE /api/admin/posts/:postId            - Delete post\nGET    /api/admin/reports                  - Get reported content\nGET    /api/admin/search?query=x&type=y    - Search users/posts\n```\n\n## How to Access Admin Panel\n\n### 1. Make Your Account Admin\nConnect to MongoDB and update your user role:\n\n```javascript\n// Using MongoDB Compass or mongosh\ndb.users.updateOne(\n  { email: \"your-email@example.com\" },\n  { $set: { role: \"admin\" } }\n)\n```\n\nOr use the MongoDB Node.js script:\n\n```bash\ncd backend\nnode scripts/makeUserAdmin.js your-email@example.com\n```\n\n### 2. Access the Admin Panel\nAfter logging in with an admin account:\n\n1. **Via Settings Page**\n   - Go to Settings (`/settings`)\n   - Click on \"Admin Panel\" button (visible only to admins)\n\n2. **Direct URL**\n   - Navigate to `/admin` in your browser\n\n## UI/UX Features\n\n### Design\n- Modern, clean interface\n- Dark mode support\n- Responsive design (mobile-friendly)\n- Consistent with main app design\n\n### Navigation\n- Back to main app button\n- Breadcrumb navigation\n- Quick action cards\n- Easy access to all sections\n\n### User Experience\n- Loading states\n- Empty states with helpful messages\n- Confirmation dialogs for destructive actions\n- Toast notifications for all actions\n- Pagination for large datasets\n- Search functionality\n\n## Color Coding\n\n### User Roles\n- ğŸ”´ **Admin** - Red badge\n- ğŸŸ£ **Creator** - Purple badge\n- ğŸ”µ **Business** - Blue badge\n- âšª **User** - Gray badge\n\n### User Status\n- ğŸŸ¢ **Active** - Green badge\n- ğŸ”´ **Banned** - Red badge\n\n### Action Buttons\n- ğŸ”µ **Verify** - Blue icon\n- ğŸŸ£ **Role** - Purple icon\n- ğŸŸ¡ **Ban** - Yellow icon\n- ğŸŸ¢ **Unban** - Green icon\n- ğŸ”´ **Delete** - Red icon\n\n## Statistics Explained\n\n### Dashboard Metrics\n\n1. **Total Users** - All registered users\n2. **Total Posts** - All posts created\n3. **Total Messages** - All messages sent\n4. **Total Stories** - All stories posted\n5. **Active Users (24h)** - Users active in last 24 hours\n6. **New Users Today** - Users registered today\n7. **New Posts Today** - Posts created today\n\n## User Management Operations\n\n### Verify User\n- Adds blue checkmark to user profile\n- Sets `isVerified: true`\n- Records `verifiedAt` timestamp\n- Visible to all users\n\n### Ban User\n- Prevents user from accessing the platform\n- Sets `isBanned: true`\n- Records `bannedAt` timestamp\n- Can be reversed (unban)\n\n### Change Role\n- Upgrades or downgrades user permissions\n- Available roles: user, creator, business, admin\n- **Warning:** Be careful when assigning admin role!\n\n### Delete User\n- **Permanent action** - Cannot be undone\n- Deletes user account\n- Deletes all user's posts\n- Deletes all user's messages\n- Confirmation required\n\n## Post Management Operations\n\n### View Post Details\n- Click on any post card to see full details\n- View all media files\n- See complete caption\n- Check statistics\n- View author information\n\n### Delete Post\n- Removes post from database\n- Removes from user's posts array\n- Deletes associated media from storage\n- **Permanent action** - Cannot be undone\n- Confirmation required\n\n## Security Best Practices\n\n### Admin Account Security\n1. Use strong passwords for admin accounts\n2. Never share admin credentials\n3. Regularly review admin activity logs\n4. Limit number of admin accounts\n5. Use two-factor authentication (when implemented)\n\n### Content Moderation\n1. Review reported content regularly\n2. Document reasons for user bans\n3. Keep records of deleted content\n4. Follow community guidelines\n5. Be fair and consistent\n\n## Troubleshooting\n\n### Can't Access Admin Panel?\n1. Check if your user has `role: 'admin'`\n2. Clear browser cache and cookies\n3. Logout and login again\n4. Check browser console for errors\n\n### Admin Routes Not Working?\n1. Verify backend server is running\n2. Check if admin routes are registered\n3. Verify JWT token is valid\n4. Check adminMiddleware is working\n\n### API Errors?\n1. Check backend logs\n2. Verify MongoDB connection\n3. Check if user is authenticated\n4. Verify admin permissions\n\n## Future Enhancements\n\n### Planned Features\n- [ ] Reports management system\n- [ ] Analytics and charts\n- [ ] Bulk actions (ban multiple users)\n- [ ] Export data functionality\n- [ ] Admin activity logs\n- [ ] Advanced search filters\n- [ ] Content moderation AI\n- [ ] Email notifications\n- [ ] Scheduled actions\n- [ ] Custom admin roles\n- [ ] Two-factor authentication\n- [ ] IP blocking\n- [ ] Content review queue\n\n## Tech Stack\n\n### Frontend\n- React 18\n- React Router v6\n- Tailwind CSS\n- React Icons\n- React Hot Toast\n- Axios\n\n### Backend\n- Node.js\n- Express.js\n- MongoDB\n- JWT Authentication\n- Middleware-based authorization\n\n## File Structure\n\n```\nfrontend/src/\nâ”œâ”€â”€ pages/\nâ”‚   â”œâ”€â”€ AdminDashboard.jsx    # Main admin dashboard\nâ”‚   â”œâ”€â”€ AdminUsers.jsx         # User management\nâ”‚   â”œâ”€â”€ AdminPosts.jsx         # Post management\nâ”‚   â””â”€â”€ AdminReports.jsx       # Reports (coming soon)\nâ”œâ”€â”€ services/\nâ”‚   â””â”€â”€ adminAPI.js            # Admin API service\nâ””â”€â”€ App.jsx                    # Routes configuration\n\nbackend/\nâ”œâ”€â”€ controllers/\nâ”‚   â””â”€â”€ adminController.js     # Admin controllers\nâ”œâ”€â”€ routes/\nâ”‚   â””â”€â”€ adminRoutes.js         # Admin routes\nâ””â”€â”€ middleware/\n    â””â”€â”€ adminMiddleware.js     # Admin authorization\n```\n\n## Support\n\nFor issues or questions:\n1. Check this documentation\n2. Review backend logs\n3. Check browser console\n4. Contact system administrator\n\n## License\n\nThis admin panel is part of friendflix application.\n\n---\n\n**Last Updated:** December 2024\n**Version:** 1.0.0\n","size_bytes":8550},"backend/models/GroupMessage.js":{"content":"import mongoose from 'mongoose';\n\nconst groupMessageSchema = new mongoose.Schema(\n  {\n    group: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Group',\n      required: true,\n    },\n    sender: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    text: {\n      type: String,\n      required: [true, 'Message text is required'],\n      maxlength: [1000, 'Message cannot exceed 1000 characters'],\n    },\n    readBy: [\n      {\n        user: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'User',\n        },\n        readAt: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\ngroupMessageSchema.index({ group: 1, createdAt: -1 });\ngroupMessageSchema.index({ sender: 1 });\n\nconst GroupMessage = mongoose.model('GroupMessage', groupMessageSchema);\n\nexport default GroupMessage;\n","size_bytes":938},"backend/test-cloudinary.js":{"content":"import { v2 as cloudinary } from 'cloudinary';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nconsole.log('Testing Cloudinary Configuration...\\n');\n\nconsole.log('Environment Variables:');\nconsole.log('CLOUDINARY_CLOUD_NAME:', process.env.CLOUDINARY_CLOUD_NAME || 'âŒ Missing');\nconsole.log('CLOUDINARY_API_KEY:', process.env.CLOUDINARY_API_KEY || 'âŒ Missing');\nconsole.log('CLOUDINARY_API_SECRET:', process.env.CLOUDINARY_API_SECRET ? 'âœ… Present' : 'âŒ Missing');\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\nconsole.log('\\nâœ… Cloudinary configured successfully!');\nconsole.log('Cloud Name:', cloudinary.config().cloud_name);\nconsole.log('API Key:', cloudinary.config().api_key);\n\n// Test API connection\nconsole.log('\\nTesting API connection...');\n\ncloudinary.api.ping()\n  .then((result) => {\n    console.log('âœ… Cloudinary API Connection Successful!');\n    console.log('Response:', result);\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('âŒ Cloudinary API Connection Failed!');\n    console.error('Error:', error.message);\n    console.error('Details:', error.error);\n    process.exit(1);\n  });\n","size_bytes":1270},"backend/models/WatchLater.js":{"content":"import mongoose from 'mongoose';\n\nconst watchLaterSchema = new mongoose.Schema(\n  {\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n      unique: true,\n    },\n    videos: [\n      {\n        post: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'Post',\n          required: true,\n        },\n        addedAt: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n  },\n  {\n    timestamps: true,\n  }\n);\n\nwatchLaterSchema.index({ user: 1 });\nwatchLaterSchema.index({ 'videos.post': 1 });\n\nconst WatchLater = mongoose.model('WatchLater', watchLaterSchema);\n\nexport default WatchLater;\n","size_bytes":669},"frontend/src/services/socket.js":{"content":"import { io } from 'socket.io-client';\n\nconst SOCKET_URL = import.meta.env.VITE_SOCKET_URL || 'http://localhost:5000';\n\nclass SocketService {\n  constructor() {\n    this.socket = null;\n  }\n\n  connect(token) {\n    if (!token) return;\n\n    this.socket = io(SOCKET_URL, {\n      auth: {\n        token,\n      },\n    });\n\n    this.socket.on('connect', () => {\n      console.log('âœ… Socket connected');\n    });\n\n    this.socket.on('disconnect', () => {\n      console.log('âŒ Socket disconnected');\n    });\n\n    this.socket.on('connect_error', (error) => {\n      console.error('Socket connection error:', error);\n    });\n  }\n\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n    }\n  }\n\n  on(event, callback) {\n    if (this.socket) {\n      this.socket.on(event, callback);\n    }\n  }\n\n  off(event, callback) {\n    if (this.socket) {\n      this.socket.off(event, callback);\n    }\n  }\n\n  emit(event, data) {\n    if (this.socket) {\n      this.socket.emit(event, data);\n    }\n  }\n}\n\nconst socketService = new SocketService();\nexport default socketService;\n","size_bytes":1092},"backend/models/LiveStream.js":{"content":"import mongoose from 'mongoose';\n\nconst liveStreamSchema = new mongoose.Schema(\n  {\n    host: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    title: {\n      type: String,\n      required: [true, 'Stream title is required'],\n      maxlength: [100, 'Title cannot exceed 100 characters'],\n    },\n    description: {\n      type: String,\n      maxlength: [500, 'Description cannot exceed 500 characters'],\n    },\n    streamKey: {\n      type: String,\n      required: true,\n      unique: true,\n    },\n    status: {\n      type: String,\n      enum: ['live', 'ended', 'scheduled'],\n      default: 'live',\n    },\n    viewers: [\n      {\n        user: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'User',\n        },\n        joinedAt: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n    currentViewers: {\n      type: Number,\n      default: 0,\n    },\n    peakViewers: {\n      type: Number,\n      default: 0,\n    },\n    likes: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    comments: [\n      {\n        user: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'User',\n        },\n        text: {\n          type: String,\n          required: true,\n        },\n        timestamp: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n    scheduledFor: {\n      type: Date,\n    },\n    startedAt: {\n      type: Date,\n    },\n    endedAt: {\n      type: Date,\n    },\n    duration: {\n      type: Number, // in seconds\n      default: 0,\n    },\n    recording: {\n      available: {\n        type: Boolean,\n        default: false,\n      },\n      url: {\n        type: String,\n      },\n    },\n    // Super Chat / Monetization\n    superChats: [\n      {\n        user: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'User',\n        },\n        amount: {\n          type: Number,\n          required: true,\n        },\n        message: {\n          type: String,\n          maxlength: 200,\n        },\n        timestamp: {\n          type: Date,\n          default: Date.now,\n        },\n        highlighted: {\n          type: Boolean,\n          default: true,\n        },\n      },\n    ],\n    totalEarnings: {\n      type: Number,\n      default: 0,\n    },\n    category: {\n      type: String,\n      enum: ['gaming', 'music', 'sports', 'education', 'entertainment', 'news', 'tech', 'other'],\n      default: 'other',\n    },\n    visibility: {\n      type: String,\n      enum: ['public', 'unlisted', 'private'],\n      default: 'public',\n    },\n    tags: [String],\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\nliveStreamSchema.index({ host: 1, status: 1 });\nliveStreamSchema.index({ status: 1, createdAt: -1 });\n\nconst LiveStream = mongoose.model('LiveStream', liveStreamSchema);\n\nexport default LiveStream;\n","size_bytes":2879},"backend/controllers/userController.js":{"content":"import User from '../models/User.js';\nimport Post from '../models/Post.js';\nimport Notification from '../models/Notification.js';\nimport { uploadToStorage } from '../config/minio.js';\n\n// @desc    Get user profile by username\n// @route   GET /api/users/:username\n// @access  Public\nexport const getUserProfile = async (req, res) => {\n  try {\n    const user = await User.findOne({ username: req.params.username })\n      .populate('subscriber', 'username fullName avatar')\n      .populate('subscribed', 'username fullName avatar')\n      .populate({\n        path: 'posts',\n        options: { sort: { createdAt: -1 } },\n      });\n\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found',\n      });\n    }\n\n    res.status(200).json({\n      success: true,\n      data: user,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Update user profile\n// @route   PUT /api/users/profile\n// @access  Private\nexport const updateProfile = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found',\n      });\n    }\n\n    // Update fields\n    user.fullName = req.body.fullName || user.fullName;\n    user.username = req.body.username || user.username;\n    user.bio = req.body.bio !== undefined ? req.body.bio : user.bio;\n    user.gender = req.body.gender || user.gender;\n\n    // Handle avatar upload\n    if (req.files && req.files.avatar && req.files.avatar[0]) {\n      const file = req.files.avatar[0];\n      console.log('ğŸ“¤ Uploading avatar to MinIO...');\n      console.log('File size:', file.size, 'bytes');\n      console.log('File type:', file.mimetype);\n      const result = await uploadToStorage(file.buffer, 'friendflix/avatars', file.originalname);\n      console.log('âœ… Avatar upload successful:', result.secure_url);\n      user.avatar = result.secure_url;\n    }\n\n    // Handle cover image upload\n    if (req.files && req.files.cover && req.files.cover[0]) {\n      const file = req.files.cover[0];\n      console.log('ğŸ“¤ Uploading cover image to MinIO...');\n      console.log('File size:', file.size, 'bytes');\n      console.log('File type:', file.mimetype);\n      const result = await uploadToStorage(file.buffer, 'friendflix/covers', file.originalname);\n      console.log('âœ… Cover upload successful:', result.secure_url);\n      user.coverImage = result.secure_url;\n    }\n\n    const updatedUser = await user.save();\n\n    res.status(200).json({\n      success: true,\n      message: 'Profile updated successfully',\n      data: updatedUser,\n    });\n  } catch (error) {\n    console.error('âŒ Profile update error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message,\n      error: process.env.NODE_ENV === 'development' ? error.stack : undefined,\n    });\n  }\n};\n\n// @desc    Follow/Unfollow user\n// @route   POST /api/users/:id/follow\n// @access  Private\nexport const followUser = async (req, res) => {\n  try {\n    const userToFollow = await User.findById(req.params.id);\n    const currentUser = await User.findById(req.user._id);\n\n    if (!userToFollow) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found',\n      });\n    }\n\n    if (req.params.id === req.user._id.toString()) {\n      return res.status(400).json({\n        success: false,\n        message: 'You cannot follow yourself',\n      });\n    }\n\n    const issubscribed = currentUser.subscribed.includes(req.params.id);\n\n    if (issubscribed) {\n      // Unfollow\n      currentUser.subscribed = currentUser.subscribed.filter(\n        (id) => id.toString() !== req.params.id\n      );\n      userToFollow.subscriber = userToFollow.subscriber.filter(\n        (id) => id.toString() !== req.user._id.toString()\n      );\n\n      await currentUser.save();\n      await userToFollow.save();\n\n      res.status(200).json({\n        success: true,\n        message: 'User unfollowed successfully',\n        issubscribed: false,\n      });\n    } else {\n      // Follow\n      currentUser.subscribed.push(req.params.id);\n      userToFollow.subscriber.push(req.user._id);\n\n      await currentUser.save();\n      await userToFollow.save();\n\n      // Create notification\n      const notification = await Notification.create({\n        recipient: userToFollow._id,\n        sender: currentUser._id,\n        type: 'follow',\n        message: `${currentUser.username} started subscribed you`,\n      });\n\n      // Emit socket event (handled in socket.js)\n      const io = req.app.get('io');\n      io.to(userToFollow._id.toString()).emit('notification', notification);\n\n      res.status(200).json({\n        success: true,\n        message: 'User followed successfully',\n        issubscribed: true,\n      });\n    }\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Search users\n// @route   GET /api/users/search?q=query\n// @access  Public\nexport const searchUsers = async (req, res) => {\n  try {\n    const query = req.query.q;\n\n    if (!query) {\n      return res.status(400).json({\n        success: false,\n        message: 'Search query is required',\n      });\n    }\n\n    const users = await User.find({\n      $or: [\n        { username: { $regex: query, $options: 'i' } },\n        { fullName: { $regex: query, $options: 'i' } },\n      ],\n    })\n      .select('username fullName avatar bio subscriber subscribed')\n      .limit(20);\n\n    res.status(200).json({\n      success: true,\n      data: users,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get user suggestions (users not followed)\n// @route   GET /api/users/suggestions\n// @access  Private\nexport const getUserSuggestions = async (req, res) => {\n  try {\n    const currentUser = await User.findById(req.user._id);\n\n    const suggestions = await User.find({\n      _id: { $nin: [...currentUser.subscribed, currentUser._id] },\n    })\n      .select('username fullName avatar bio subscriber')\n      .limit(5);\n\n    res.status(200).json({\n      success: true,\n      data: suggestions,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Request role upgrade to creator\n// @route   POST /api/users/role/request\n// @access  Private\nexport const requestRoleUpgrade = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n\n    if (!user) {\n      return res.status(404).json({ success: false, message: 'User not found' });\n    }\n\n    if (user.role === 'creator' || user.role === 'admin') {\n      return res.status(400).json({ success: false, message: 'You already have creator/admin privileges' });\n    }\n\n    user.roleUpgradeRequested = true;\n    user.roleUpgradeReason = (req.body?.reason || '').slice(0, 200);\n    await user.save();\n\n    res.status(200).json({ success: true, message: 'Role upgrade requested. Admin will review soon.', data: user });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n","size_bytes":7216},"frontend/src/components/Navbar.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { useTheme } from '../context/ThemeContext';\nimport {\n  AiOutlineHome,\n  AiFillHome,\n  AiOutlineSearch,\n  AiOutlinePlusSquare,\n  AiOutlineHeart,\n  AiFillHeart,\n  AiOutlineMessage,\n  AiFillMessage,\n} from 'react-icons/ai';\nimport { BsSun, BsMoon, BsCompass, BsFilm } from 'react-icons/bs';\nimport { FiShield, FiLogOut, FiSettings, FiBookmark, FiUser } from 'react-icons/fi';\nimport { notificationAPI, messageAPI } from '../services/api';\nimport socketService from '../services/socket';\n\nconst Navbar = () => {\n  const { user, logout } = useAuth();\n  const { theme, toggleTheme, isDark } = useTheme();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const showSearch = !location.pathname.startsWith('/messages');\n  const [showUserMenu, setShowUserMenu] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [messageCount, setMessageCount] = useState(0);\n  const [incomingCall, setIncomingCall] = useState(null);\n\n  useEffect(() => {\n    fetchUnreadCount();\n    fetchMessageCount();\n\n    const handleNotification = () => {\n      setUnreadCount((prev) => prev + 1);\n    };\n\n    const handleNewMessage = (message) => {\n      const currentPath = window.location.pathname;\n      if (!currentPath.startsWith('/messages')) {\n        setMessageCount((prev) => prev + 1);\n      }\n    };\n\n    const handleMessagesViewed = () => {\n      setMessageCount(0);\n    };\n\n    socketService.on('notification', handleNotification);\n    socketService.on('newMessage', handleNewMessage);\n    window.addEventListener('messagesViewed', handleMessagesViewed);\n\n    const handleCallInvite = (payload) => {\n      setIncomingCall(payload);\n    };\n    const handleCallDecline = () => {\n      setIncomingCall(null);\n    };\n    socketService.on('call:invite', handleCallInvite);\n    socketService.on('call:decline', handleCallDecline);\n\n    return () => {\n      socketService.off('notification', handleNotification);\n      socketService.off('newMessage', handleNewMessage);\n      window.removeEventListener('messagesViewed', handleMessagesViewed);\n      socketService.off('call:invite', handleCallInvite);\n      socketService.off('call:decline', handleCallDecline);\n    };\n  }, []);\n\n  const fetchUnreadCount = async () => {\n    try {\n      const response = await notificationAPI.getNotifications();\n      setUnreadCount(response.data.unreadCount);\n    } catch (error) {\n      console.error('Error fetching notifications:', error);\n    }\n  };\n\n  const fetchMessageCount = async () => {\n    try {\n      const response = await messageAPI.getUnreadCount();\n      setMessageCount(response.data.data.count);\n    } catch (error) {\n      console.error('Error fetching message count:', error);\n    }\n  };\n\n  const handleSearch = (e) => {\n    e.preventDefault();\n    if (searchQuery.trim()) {\n      navigate(`/search?q=${searchQuery}`);\n      setSearchQuery('');\n    }\n  };\n\n  const handleLogout = () => {\n    logout();\n    navigate('/login');\n  };\n\n  const isActive = (path) => location.pathname === path;\n\n  return (\n    <nav className=\"bg-white/90 dark:bg-dark-bg/90 border-b border-gray-200/50 dark:border-dark-border/50 sticky top-0 z-50 backdrop-blur-2xl shadow-lg\">\n      <div className=\"max-w-6xl mx-auto px-4\">\n        <div className=\"flex items-center justify-between h-16\">\n          {/* Logo */}\n          <Link to=\"/\" className=\"flex items-center gap-3 group\">\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 bg-gradient-sunset rounded-2xl blur-lg opacity-70 group-hover:opacity-100 transition-opacity\"></div>\n              <div className=\"relative bg-gradient-sunset p-2.5 rounded-2xl shadow-glow\">\n                <span className=\"text-2xl font-black text-white\">IT</span>\n              </div>\n            </div>\n            <span className=\"text-2xl font-black gradient-text hidden md:block\">friendflix</span>\n          </Link>\n\n          {/* Search Bar - Desktop */}\n          {showSearch && (\n            <form onSubmit={handleSearch} className=\"hidden md:block flex-1 max-w-md mx-8\">\n              <div className=\"relative\">\n                <AiOutlineSearch className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n                <input\n                  type=\"text\"\n                  placeholder=\"Search friendflix...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"w-full pl-12 pr-4 py-3 bg-gray-100 dark:bg-dark-card/80 text-gray-900 dark:text-white border-2 border-transparent rounded-2xl focus:outline-none focus:border-primary-400 focus:bg-white dark:focus:bg-dark-card-hover focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 placeholder:text-gray-400\"\n                />\n              </div>\n            </form>\n          )}\n\n          {/* Navigation Icons - Desktop */}\n          <div className=\"hidden md:flex items-center gap-2\">\n            {/* Home */}\n            <Link \n              to=\"/\" \n              className={`p-3 rounded-xl transition-all duration-200 ${\n                isActive('/') \n                  ? 'bg-gradient-primary text-white shadow-glow-primary' \n                  : 'hover:bg-gray-100 dark:hover:bg-dark-card text-gray-600 dark:text-gray-400 hover:scale-110'\n              }`}\n            >\n              {isActive('/') ? <AiFillHome size={24} /> : <AiOutlineHome size={24} />}\n            </Link>\n\n            {/* Explore */}\n            <Link \n              to=\"/explore\" \n              className={`p-3 rounded-xl transition-all duration-200 ${\n                isActive('/explore') \n                  ? 'bg-gradient-secondary text-white shadow-glow-secondary' \n                  : 'hover:bg-gray-100 dark:hover:bg-dark-card text-gray-600 dark:text-gray-400 hover:scale-110'\n              }`}\n            >\n              <BsCompass size={22} />\n            </Link>\n\n            {/* Reels */}\n            <Link \n              to=\"/reels\" \n              className={`p-3 rounded-xl transition-all duration-200 ${\n                isActive('/reels') \n                  ? 'bg-gradient-sunset text-white shadow-glow' \n                  : 'hover:bg-gray-100 dark:hover:bg-dark-card text-gray-600 dark:text-gray-400 hover:scale-110'\n              }`}\n            >\n              <BsFilm size={22} />\n            </Link>\n\n            {/* Messages */}\n            <Link \n              to=\"/messages\" \n              className={`p-3 rounded-xl transition-all duration-200 relative ${\n                isActive('/messages') \n                  ? 'bg-gradient-ocean text-white shadow-glow-accent' \n                  : 'hover:bg-gray-100 dark:hover:bg-dark-card text-gray-600 dark:text-gray-400 hover:scale-110'\n              }`}\n            >\n              {isActive('/messages') ? <AiFillMessage size={24} /> : <AiOutlineMessage size={24} />}\n              {messageCount > 0 && (\n                <span className=\"absolute -top-1 -right-1 bg-info-500 text-white text-xs rounded-full min-w-[20px] h-5 flex items-center justify-center font-bold shadow-lg border-2 border-white dark:border-dark-bg animate-pulse-slow\">\n                  {messageCount > 9 ? '9+' : messageCount}\n                </span>\n              )}\n            </Link>\n\n            {/* Upload */}\n            <Link \n              to=\"/upload\" \n              className=\"p-3 rounded-xl bg-gradient-primary hover:bg-gradient-sunset text-white shadow-glow-primary hover:shadow-glow transition-all duration-200 hover:scale-110\"\n            >\n              <AiOutlinePlusSquare size={24} />\n            </Link>\n\n            {/* Notifications */}\n            <Link \n              to=\"/notifications\" \n              className={`p-3 rounded-xl transition-all duration-200 relative ${\n                isActive('/notifications') \n                  ? 'bg-gradient-to-r from-danger-400 to-danger-600 text-white shadow-glow' \n                  : 'hover:bg-gray-100 dark:hover:bg-dark-card text-gray-600 dark:text-gray-400 hover:scale-110'\n              }`}\n            >\n              {isActive('/notifications') ? <AiFillHeart size={24} /> : <AiOutlineHeart size={24} />}\n              {unreadCount > 0 && (\n                <span className=\"absolute -top-1 -right-1 bg-danger-500 text-white text-xs rounded-full min-w-[20px] h-5 flex items-center justify-center font-bold shadow-lg border-2 border-white dark:border-dark-bg animate-pulse-slow\">\n                  {unreadCount > 9 ? '9+' : unreadCount}\n                </span>\n              )}\n            </Link>\n\n            {/* Theme Toggle */}\n            <button\n              onClick={toggleTheme}\n              className=\"p-3 rounded-xl hover:bg-gray-100 dark:hover:bg-dark-card text-gray-600 dark:text-gray-400 transition-all duration-200 hover:scale-110\"\n              aria-label=\"Toggle theme\"\n            >\n              {isDark ? <BsSun size={22} className=\"text-warning-400\" /> : <BsMoon size={22} />}\n            </button>\n\n            {/* User Menu */}\n            <div className=\"relative\">\n              <button\n                onClick={() => setShowUserMenu(!showUserMenu)}\n                className=\"focus:outline-none group\"\n              >\n                <div className=\"relative\">\n                  <img\n                    src={user?.avatar}\n                    alt={user?.username}\n                    className=\"h-10 w-10 rounded-full object-cover ring-2 ring-gray-200 dark:ring-dark-border group-hover:ring-primary-400 transition-all duration-200\"\n                  />\n                  <div className=\"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-success-500 rounded-full border-2 border-white dark:border-dark-bg\"></div>\n                </div>\n              </button>\n\n              {showUserMenu && (\n                <>\n                  <div className=\"fixed inset-0 z-40\" onClick={() => setShowUserMenu(false)}></div>\n                  <div className=\"absolute right-0 mt-3 w-64 card p-2 z-50 animate-scale-in\">\n                    <div className=\"px-4 py-3 border-b border-gray-200 dark:border-dark-border\">\n                      <p className=\"font-bold text-gray-900 dark:text-white\">{user?.fullName}</p>\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">@{user?.username}</p>\n                    </div>\n                    \n                    <div className=\"py-2 space-y-1\">\n                      <Link\n                        to={`/profile/${user?.username}`}\n                        className=\"flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-gray-100 dark:hover:bg-dark-card-hover text-gray-700 dark:text-gray-300 transition-colors\"\n                        onClick={() => setShowUserMenu(false)}\n                      >\n                        <FiUser className=\"w-5 h-5\" />\n                        <span className=\"font-medium\">Profile</span>\n                      </Link>\n                      <Link\n                        to=\"/saved\"\n                        className=\"flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-gray-100 dark:hover:bg-dark-card-hover text-gray-700 dark:text-gray-300 transition-colors\"\n                        onClick={() => setShowUserMenu(false)}\n                      >\n                        <FiBookmark className=\"w-5 h-5\" />\n                        <span className=\"font-medium\">Saved</span>\n                      </Link>\n                      <Link\n                        to=\"/settings\"\n                        className=\"flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-gray-100 dark:hover:bg-dark-card-hover text-gray-700 dark:text-gray-300 transition-colors\"\n                        onClick={() => setShowUserMenu(false)}\n                      >\n                        <FiSettings className=\"w-5 h-5\" />\n                        <span className=\"font-medium\">Settings</span>\n                      </Link>\n                      \n                      {user?.role === 'admin' && (\n                        <>\n                          <div className=\"my-2 border-t border-gray-200 dark:border-dark-border\"></div>\n                          <Link\n                            to=\"/admin\"\n                            className=\"flex items-center gap-3 px-4 py-2.5 rounded-xl bg-gradient-to-r from-primary-50 to-accent-50 dark:from-primary-900/20 dark:to-accent-900/20 hover:from-primary-100 hover:to-accent-100 dark:hover:from-primary-900/30 dark:hover:to-accent-900/30 transition-all\"\n                            onClick={() => setShowUserMenu(false)}\n                          >\n                            <FiShield className=\"w-5 h-5 text-primary-500\" />\n                            <span className=\"font-bold gradient-text\">Admin Panel</span>\n                          </Link>\n                        </>\n                      )}\n                    </div>\n\n                    <div className=\"pt-2 mt-2 border-t border-gray-200 dark:border-dark-border\">\n                      <button\n                        onClick={handleLogout}\n                        className=\"flex items-center gap-3 w-full px-4 py-2.5 rounded-xl hover:bg-danger-50 dark:hover:bg-danger-900/20 text-danger-500 transition-colors\"\n                      >\n                        <FiLogOut className=\"w-5 h-5\" />\n                        <span className=\"font-medium\">Logout</span>\n                      </button>\n                    </div>\n                  </div>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Search Bar - Mobile */}\n        {showSearch && (\n          <form onSubmit={handleSearch} className=\"md:hidden pb-4\">\n            <div className=\"relative\">\n              <AiOutlineSearch className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search friendflix...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"w-full pl-12 pr-4 py-3 bg-gray-100 dark:bg-dark-card text-gray-900 dark:text-white border-2 border-transparent rounded-2xl focus:outline-none focus:border-primary-400 focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 placeholder:text-gray-400\"\n              />\n            </div>\n          </form>\n        )}\n      </div>\n\n      {/* Incoming Call Modal */}\n      {incomingCall && (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in\">\n          <div className=\"card max-w-sm w-full p-6 space-y-4 animate-scale-in\">\n            <div className=\"text-center\">\n              <div className=\"w-20 h-20 bg-gradient-sunset rounded-full flex items-center justify-center mx-auto mb-4 animate-glow-pulse\">\n                <span className=\"text-3xl\">ğŸ“</span>\n              </div>\n              <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-2\">\n                Incoming {incomingCall.type || 'call'}\n              </h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">From: {incomingCall.from}</p>\n            </div>\n            <div className=\"flex gap-3\">\n              <button\n                className=\"flex-1 btn-outline\"\n                onClick={() => {\n                  socketService.emit('call:decline', { to: incomingCall.from, roomId: incomingCall.roomId });\n                  setIncomingCall(null);\n                }}\n              >\n                Decline\n              </button>\n              <button\n                className=\"flex-1 btn-gradient\"\n                onClick={() => {\n                  const roomId = incomingCall.roomId;\n                  setIncomingCall(null);\n                  navigate(`/audio-call/${roomId}`);\n                }}\n              >\n                Accept\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </nav>\n  );\n};\n\nexport default Navbar;\n","size_bytes":16213},"backend/models/User.js":{"content":"import mongoose from 'mongoose';\nimport bcrypt from 'bcryptjs';\n\nconst userSchema = new mongoose.Schema(\n  {\n    username: {\n      type: String,\n      required: [true, 'Username is required'],\n      unique: true,\n      trim: true,\n      lowercase: true,\n      minlength: [3, 'Username must be at least 3 characters'],\n      maxlength: [30, 'Username cannot exceed 30 characters'],\n    },\n    email: {\n      type: String,\n      required: [true, 'Email is required'],\n      unique: true,\n      lowercase: true,\n      trim: true,\n      match: [/^\\S+@\\S+\\.\\S+$/, 'Please provide a valid email'],\n    },\n    password: {\n      type: String,\n      required: [true, 'Password is required'],\n      minlength: [6, 'Password must be at least 6 characters'],\n      select: false,\n    },\n    fullName: {\n      type: String,\n      required: [true, 'Full name is required'],\n      trim: true,\n    },\n    avatar: {\n      type: String,\n      default: '/default-avatar.png',\n    },\n    coverImage: {\n      type: String,\n      default: '/default-bg.jpg',\n    },\n    bio: {\n      type: String,\n      maxlength: [150, 'Bio cannot exceed 150 characters'],\n      default: '',\n    },\n    gender: {\n      type: String,\n      enum: ['male', 'female', 'other', 'prefer_not_to_say'],\n      default: 'prefer_not_to_say',\n    },\n    isVerified: {\n      type: Boolean,\n      default: false,\n    },\n    verifiedAt: {\n      type: Date,\n    },\n    isBanned: {\n      type: Boolean,\n      default: false,\n    },\n    bannedAt: {\n      type: Date,\n    },\n    role: {\n      type: String,\n      enum: ['user', 'creator', 'business', 'admin'],\n      default: 'user',\n    },\n    roleUpgradeRequested: {\n      type: Boolean,\n      default: false,\n    },\n    roleUpgradeReason: {\n      type: String,\n      trim: true,\n      maxlength: 200,\n    },\n    subscriber: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    subscribed: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    posts: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Post',\n      },\n    ],\n    savedPosts: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Post',\n      },\n    ],\n    // Premium Subscription\n    isPremium: {\n      type: Boolean,\n      default: false,\n    },\n    premiumSince: {\n      type: Date,\n    },\n    premiumExpiresAt: {\n      type: Date,\n    },\n    premiumPlan: {\n      type: String,\n      enum: ['monthly', 'yearly', 'none'],\n      default: 'none',\n    },\n    // Creator Monetization\n    isMonetizationEnabled: {\n      type: Boolean,\n      default: false,\n    },\n    monetizationApproved: {\n      type: Boolean,\n      default: false,\n    },\n    totalEarnings: {\n      type: Number,\n      default: 0,\n    },\n    pendingPayout: {\n      type: Number,\n      default: 0,\n    },\n    totalWatchTime: {\n      type: Number,\n      default: 0, // in minutes\n    },\n    subscribersCount: {\n      type: Number,\n      default: 0,\n    },\n    // Shorts Fund\n    shortsEarnings: {\n      type: Number,\n      default: 0,\n    },\n    lastShortsFundPayout: {\n      type: Date,\n    },\n    totalShortViews: {\n      type: Number,\n      default: 0,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Hash password before saving\nuserSchema.pre('save', async function (next) {\n  if (!this.isModified('password')) {\n    return next();\n  }\n  const salt = await bcrypt.genSalt(10);\n  this.password = await bcrypt.hash(this.password, salt);\n  next();\n});\n\n// Compare password method\nuserSchema.methods.comparePassword = async function (enteredPassword) {\n  return await bcrypt.compare(enteredPassword, this.password);\n};\n\n// Get user public profile\nuserSchema.methods.toJSON = function () {\n  const user = this.toObject();\n  delete user.password;\n  return user;\n};\n\nconst User = mongoose.model('User', userSchema);\n\nexport default User;\n","size_bytes":3880},"backend/routes/exploreRoutes.js":{"content":"import express from 'express';\nimport {\n  getExplorePosts,\n  getTrendingHashtags,\n  getPostsByHashtag,\n  getSuggestedUsers,\n  getTrendingPosts,\n} from '../controllers/exploreController.js';\nimport { protect } from '../middleware/authMiddleware.js';\n\nconst router = express.Router();\n\nrouter.get('/posts', getExplorePosts);\nrouter.get('/trending', getTrendingPosts);\nrouter.get('/hashtags', getTrendingHashtags);\nrouter.get('/tags/:tag', getPostsByHashtag);\nrouter.get('/users', protect, getSuggestedUsers);\n\nexport default router;\n","size_bytes":531},"frontend/src/pages/Archive.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { postAPI } from '../services/api';\nimport { useNavigate } from 'react-router-dom';\nimport Loader from '../components/Loader';\nimport toast from 'react-hot-toast';\nimport { BsArchive } from 'react-icons/bs';\nimport { AiOutlineEye } from 'react-icons/ai';\n\nconst Archive = () => {\n  const navigate = useNavigate();\n  const [archivedPosts, setArchivedPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchArchivedPosts();\n  }, []);\n\n  const fetchArchivedPosts = async () => {\n    try {\n      // This will fetch user's own posts and filter archived ones\n      const response = await postAPI.getFeed();\n      const archived = response.data.data.filter(post => post.isArchived);\n      setArchivedPosts(archived);\n    } catch (error) {\n      console.error('Failed to load archived posts:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleUnarchive = async (postId) => {\n    try {\n      await postAPI.archivePost(postId);\n      setArchivedPosts(archivedPosts.filter(post => post._id !== postId));\n      toast.success('Post unarchived');\n    } catch (error) {\n      toast.error('Failed to unarchive post');\n    }\n  };\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto px-4 py-8 pb-20 md:pb-8\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-2xl font-bold dark:text-white flex items-center\">\n          <BsArchive className=\"mr-2\" />\n          Archive\n        </h1>\n        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n          Only you can see this\n        </p>\n      </div>\n\n      {archivedPosts.length === 0 ? (\n        <div className=\"card p-12 text-center\">\n          <BsArchive size={64} className=\"mx-auto text-gray-400 mb-4\" />\n          <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n            No archived posts\n          </p>\n          <p className=\"text-sm text-gray-500 dark:text-gray-500\">\n            Posts you archive will appear here\n          </p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-3 gap-1 md:gap-4\">\n          {archivedPosts.map((post) => (\n            <div\n              key={post._id}\n              className=\"aspect-square cursor-pointer relative group\"\n            >\n              <img\n                src={post.media?.[0]?.url || post.mediaUrl}\n                alt=\"Archived post\"\n                className=\"w-full h-full object-cover rounded\"\n              />\n              \n              {/* Multiple images indicator */}\n              {post.media && post.media.length > 1 && (\n                <div className=\"absolute top-2 right-2 bg-black/70 text-white px-2 py-1 rounded text-xs\">\n                  ğŸ“· {post.media.length}\n                </div>\n              )}\n\n              {/* Hover overlay with unarchive button */}\n              <div className=\"absolute inset-0 bg-black/70 opacity-0 group-hover:opacity-100 transition flex flex-col items-center justify-center text-white p-2\">\n                <div className=\"flex items-center space-x-4 mb-4\">\n                  <div className=\"flex items-center\">\n                    â¤ï¸ {post.likes.length}\n                  </div>\n                  <div className=\"flex items-center\">\n                    ğŸ’¬ {post.comments.length}\n                  </div>\n                </div>\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleUnarchive(post._id);\n                  }}\n                  className=\"bg-white text-black px-4 py-2 rounded-lg hover:bg-gray-100 flex items-center space-x-2 text-sm font-semibold\"\n                >\n                  <AiOutlineEye size={18} />\n                  <span>Unarchive</span>\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Info Box */}\n      <div className=\"mt-8 card p-6\">\n        <h3 className=\"font-semibold mb-2 dark:text-white\">About Archive</h3>\n        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">\n          When you archive a post, it will be hidden from your profile.\n        </p>\n        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n          Only you can see your archived posts. You can unarchive them anytime.\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default Archive;\n","size_bytes":4442},"frontend/src/services/api.js":{"content":"import axios from 'axios';\n\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n\n// Create axios instance\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Add token to requests\napi.interceptors.request.use(\n  (config) => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Handle response errors\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    if (error.response?.status === 401) {\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      window.location.href = '/login';\n    }\n    return Promise.reject(error);\n  }\n);\n\n// Auth APIs\nexport const authAPI = {\n  register: (data) => api.post('/auth/register', data),\n  login: (data) => api.post('/auth/login', data),\n  getMe: () => api.get('/auth/me'),\n  logout: () => api.post('/auth/logout'),\n};\n\n// User APIs\nexport const userAPI = {\n  getProfile: (username) => api.get(`/users/${username}`),\n  updateProfile: (formData) => {\n    return api.put('/users/profile', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data',\n      },\n    });\n  },\n  followUser: (userId) => api.post(`/users/${userId}/follow`),\n  searchUsers: (query) => api.get(`/users/search?q=${query}`),\n  getSuggestions: () => api.get('/users/suggestions'),\n  requestRoleUpgrade: (reason) => api.post('/users/role/request', { reason }),\n};\n\n// Post APIs\nexport const postAPI = {\n  createPost: (formData) => {\n    return api.post('/posts', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data',\n      },\n    });\n  },\n  getFeed: (page = 1, limit = 10) => api.get(`/posts/feed?page=${page}&limit=${limit}`),\n  getPost: (postId) => api.get(`/posts/${postId}`),\n  deletePost: (postId) => api.delete(`/posts/${postId}`),\n  likePost: (postId) => api.post(`/posts/${postId}/like`),\n  savePost: (postId) => api.post(`/posts/${postId}/save`),\n  archivePost: (postId) => api.post(`/posts/${postId}/archive`),\n  getSavedPosts: () => api.get('/posts/saved'),\n  addComment: (postId, text) => api.post(`/posts/${postId}/comment`, { text }),\n  getComments: (postId) => api.get(`/posts/${postId}/comments`),\n  deleteComment: (postId, commentId) => api.delete(`/posts/${postId}/comments/${commentId}`),\n  replyToComment: (postId, commentId, text) => api.post(`/posts/${postId}/comments/${commentId}/reply`, { text }),\n  pinComment: (postId, commentId) => api.post(`/posts/${postId}/pin/${commentId}`),\n  unpinComment: (postId) => api.post(`/posts/${postId}/unpin`),\n};\n\n// Notification APIs\nexport const notificationAPI = {\n  getNotifications: (page = 1) => api.get(`/notifications?page=${page}`),\n  markAsRead: (notificationId) => api.put(`/notifications/${notificationId}/read`),\n  markAllAsRead: () => api.put('/notifications/read-all'),\n  deleteNotification: (notificationId) => api.delete(`/notifications/${notificationId}`),\n};\n\n// Message APIs\nexport const messageAPI = {\n  sendMessage: (receiverId, text) => api.post(`/messages/${receiverId}`, { text }),\n  getConversation: (userId) => api.get(`/messages/${userId}`),\n  getConversations: () => api.get('/messages/conversations'),\n  deleteMessage: (messageId) => api.delete(`/messages/${messageId}`),\n  getUnreadCount: () => api.get('/messages/unread/count'),\n  addReaction: (messageId, emoji) => api.post(`/messages/${messageId}/reaction`, { emoji }),\n  removeReaction: (messageId) => api.delete(`/messages/${messageId}/reaction`),\n  // New conversation management APIs\n  toggleStarConversation: (userId) => api.post(`/messages/conversations/${userId}/star`),\n  toggleArchiveConversation: (userId) => api.post(`/messages/conversations/${userId}/archive`),\n  markConversationAsRead: (userId) => api.post(`/messages/conversations/${userId}/read`),\n  markAllConversationsAsRead: () => api.post('/messages/mark-all-read'),\n  getConversationMetadata: (userId) => api.get(`/messages/conversations/${userId}/metadata`),\n  updateConversationSettings: (userId, { readReceiptsEnabled, typingIndicatorEnabled }) => api.post(`/messages/conversations/${userId}/settings`, { readReceiptsEnabled, typingIndicatorEnabled }),\n  updateConversationExpiry: (userId, hours) => api.post(`/messages/conversations/${userId}/expiry`, { hours }),\n  searchMessages: (q, userId) => api.get(`/messages/search?q=${encodeURIComponent(q)}${userId ? `&userId=${userId}` : ''}`),\n  sendVoiceMessage: (receiverId, file) => {\n    const form = new FormData();\n    form.append('voice', file);\n    return api.post(`/messages/${receiverId}/voice`, form, {\n      headers: { 'Content-Type': 'multipart/form-data' },\n    });\n  },\n  sendAttachment: (receiverId, file) => {\n    const form = new FormData();\n    form.append('attachment', file);\n    return api.post(`/messages/${receiverId}/attachments`, form, {\n      headers: { 'Content-Type': 'multipart/form-data' },\n    });\n  },\n};\n\n// Explore APIs\nexport const exploreAPI = {\n  getExplorePosts: () => api.get('/explore/posts'),\n  getTrendingHashtags: () => api.get('/explore/hashtags'),\n  getPostsByHashtag: (tag) => api.get(`/explore/tags/${tag}`),\n  getSuggestedUsers: () => api.get('/explore/users'),\n};\n\n// Story APIs\nexport const storyAPI = {\n  createStory: (formData) => {\n    return api.post('/stories', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data',\n      },\n    });\n  },\n  getsubscribedStories: () => api.get('/stories/subscribed'),\n  getUserStories: (userId) => api.get(`/stories/user/${userId}`),\n  viewStory: (storyId) => api.post(`/stories/${storyId}/view`),\n  replyToStory: (storyId, text) => api.post(`/stories/${storyId}/reply`, { text }),\n  deleteStory: (storyId) => api.delete(`/stories/${storyId}`),\n};\n\n// Group APIs\nexport const groupAPI = {\n  createGroup: (data) => api.post('/groups', data),\n  getUserGroups: () => api.get('/groups'),\n  getGroupById: (groupId) => api.get(`/groups/${groupId}`),\n  sendGroupMessage: (groupId, text) => api.post(`/groups/${groupId}/messages`, { text }),\n  getGroupMessages: (groupId) => api.get(`/groups/${groupId}/messages`),\n  addMember: (groupId, userId) => api.post(`/groups/${groupId}/members`, { userId }),\n  leaveGroup: (groupId) => api.delete(`/groups/${groupId}/leave`),\n};\n\n// Playlist APIs\nexport const playlistAPI = {\n  createPlaylist: (data) => api.post('/playlists', data),\n  getUserPlaylists: (userId) => api.get(`/playlists/user/${userId}`),\n  getPublicPlaylists: () => api.get('/playlists/public'),\n  getPlaylist: (playlistId) => api.get(`/playlists/${playlistId}`),\n  updatePlaylist: (playlistId, data) => api.put(`/playlists/${playlistId}`, data),\n  deletePlaylist: (playlistId) => api.delete(`/playlists/${playlistId}`),\n  addVideoToPlaylist: (playlistId, postId) => api.post(`/playlists/${playlistId}/videos/${postId}`),\n  removeVideoFromPlaylist: (playlistId, postId) => api.delete(`/playlists/${playlistId}/videos/${postId}`),\n};\n\n// Watch Later APIs\nexport const watchLaterAPI = {\n  getWatchLater: () => api.get('/watchlater'),\n  addToWatchLater: (postId) => api.post(`/watchlater/${postId}`),\n  removeFromWatchLater: (postId) => api.delete(`/watchlater/${postId}`),\n  clearWatchLater: () => api.delete('/watchlater'),\n};\n\n// Community APIs\nexport const communityAPI = {\n  createCommunityPost: (formData) => {\n    return api.post('/community', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data',\n      },\n    });\n  },\n  getUserCommunityPosts: (userId) => api.get(`/community/user/${userId}`),\n  getCommunityPost: (postId) => api.get(`/community/${postId}`),\n  updateCommunityPost: (postId, data) => api.put(`/community/${postId}`, data),\n  deleteCommunityPost: (postId) => api.delete(`/community/${postId}`),\n  likeCommunityPost: (postId) => api.post(`/community/${postId}/like`),\n  addCommunityComment: (postId, text) => api.post(`/community/${postId}/comment`, { text }),\n  votePoll: (postId, optionIndex) => api.post(`/community/${postId}/vote`, { optionIndex }),\n  pinCommunityPost: (postId) => api.post(`/community/${postId}/pin`),\n};\n\n// Note APIs\nexport const noteAPI = {\n  createNote: (data) => api.post('/notes', data),\n  getUserNote: (userId) => api.get(`/notes/user/${userId}`),\n  getsubscribedNotes: () => api.get('/notes/subscribed'),\n  deleteNote: (noteId) => api.delete(`/notes/${noteId}`),\n  likeNote: (noteId) => api.post(`/notes/${noteId}/like`),\n  replyToNote: (noteId, content) => api.post(`/notes/${noteId}/reply`, { content }),\n};\n\n// Trending APIs\nexport const trendingAPI = {\n  getTrendingVideos: (timeframe = '7d', limit = 50) => api.get(`/trending/videos?timeframe=${timeframe}&limit=${limit}`),\n  getTrendingReels: (limit = 50) => api.get(`/trending/reels?limit=${limit}`),\n  getTrendingHashtags: (limit = 20) => api.get(`/trending/hashtags?limit=${limit}`),\n  getTrendingCreators: (limit = 20) => api.get(`/trending/creators?limit=${limit}`),\n};\n\nexport default api;\n","size_bytes":9033},"backend/controllers/trendingController.js":{"content":"import Post from '../models/Post.js';\nimport User from '../models/User.js';\n\n// @desc    Get trending videos\n// @route   GET /api/trending/videos\n// @access  Public\nexport const getTrendingVideos = async (req, res) => {\n  try {\n    const timeframe = req.query.timeframe || '7d';\n    const limit = parseInt(req.query.limit) || 50;\n\n    const daysMap = { '1d': 1, '7d': 7, '30d': 30 };\n    const days = daysMap[timeframe] || 7;\n\n    const dateThreshold = new Date();\n    dateThreshold.setDate(dateThreshold.getDate() - days);\n\n    const trendingVideos = await Post.aggregate([\n      {\n        $match: {\n          category: { $in: ['long', 'short'] },\n          visibility: 'public',\n          createdAt: { $gte: dateThreshold },\n        },\n      },\n      {\n        $addFields: {\n          viewCount: { $ifNull: ['$views', 0] },\n          likeCount: { $size: { $ifNull: ['$likes', []] } },\n          commentCount: { $size: { $ifNull: ['$comments', []] } },\n        },\n      },\n      {\n        $addFields: {\n          engagementScore: {\n            $add: [\n              { $multiply: ['$viewCount', 1] },\n              { $multiply: ['$likeCount', 10] },\n              { $multiply: ['$commentCount', 20] },\n            ],\n          },\n        },\n      },\n      {\n        $sort: { engagementScore: -1, createdAt: -1 },\n      },\n      {\n        $limit: limit,\n      },\n    ]);\n\n    const populatedVideos = await Post.populate(trendingVideos, {\n      path: 'author',\n      select: 'username profilePicture fullName verified',\n    });\n\n    res.json({ success: true, videos: populatedVideos });\n  } catch (error) {\n    console.error('Error fetching trending videos:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch trending videos' });\n  }\n};\n\n// @desc    Get trending reels\n// @route   GET /api/trending/reels\n// @access  Public\nexport const getTrendingReels = async (req, res) => {\n  try {\n    const limit = parseInt(req.query.limit) || 50;\n\n    const dateThreshold = new Date();\n    dateThreshold.setDate(dateThreshold.getDate() - 7);\n\n    const trendingReels = await Post.aggregate([\n      {\n        $match: {\n          category: 'short',\n          visibility: 'public',\n          createdAt: { $gte: dateThreshold },\n        },\n      },\n      {\n        $addFields: {\n          viewCount: { $ifNull: ['$views', 0] },\n          likeCount: { $size: { $ifNull: ['$likes', []] } },\n          commentCount: { $size: { $ifNull: ['$comments', []] } },\n        },\n      },\n      {\n        $addFields: {\n          viralScore: {\n            $add: [\n              { $multiply: ['$viewCount', 2] },\n              { $multiply: ['$likeCount', 15] },\n              { $multiply: ['$commentCount', 30] },\n            ],\n          },\n        },\n      },\n      {\n        $sort: { viralScore: -1 },\n      },\n      {\n        $limit: limit,\n      },\n    ]);\n\n    const populatedReels = await Post.populate(trendingReels, {\n      path: 'author',\n      select: 'username profilePicture fullName verified',\n    });\n\n    res.json({ success: true, reels: populatedReels });\n  } catch (error) {\n    console.error('Error fetching trending reels:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch trending reels' });\n  }\n};\n\n// @desc    Get trending hashtags\n// @route   GET /api/trending/hashtags\n// @access  Public\nexport const getTrendingHashtags = async (req, res) => {\n  try {\n    const limit = parseInt(req.query.limit) || 20;\n\n    const dateThreshold = new Date();\n    dateThreshold.setDate(dateThreshold.getDate() - 7);\n\n    const trendingHashtags = await Post.aggregate([\n      {\n        $match: {\n          visibility: 'public',\n          createdAt: { $gte: dateThreshold },\n          hashtags: { $exists: true, $ne: [] },\n        },\n      },\n      {\n        $unwind: '$hashtags',\n      },\n      {\n        $group: {\n          _id: '$hashtags',\n          count: { $sum: 1 },\n          totalLikes: { $sum: { $size: { $ifNull: ['$likes', []] } } },\n          totalComments: { $sum: { $size: { $ifNull: ['$comments', []] } } },\n        },\n      },\n      {\n        $addFields: {\n          popularity: {\n            $add: [\n              { $multiply: ['$count', 5] },\n              { $multiply: ['$totalLikes', 2] },\n              '$totalComments',\n            ],\n          },\n        },\n      },\n      {\n        $sort: { popularity: -1 },\n      },\n      {\n        $limit: limit,\n      },\n      {\n        $project: {\n          hashtag: '$_id',\n          postCount: '$count',\n          popularity: 1,\n          _id: 0,\n        },\n      },\n    ]);\n\n    res.json({ success: true, hashtags: trendingHashtags });\n  } catch (error) {\n    console.error('Error fetching trending hashtags:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch trending hashtags' });\n  }\n};\n\n// @desc    Get trending creators\n// @route   GET /api/trending/creators\n// @access  Public\nexport const getTrendingCreators = async (req, res) => {\n  try {\n    const limit = parseInt(req.query.limit) || 20;\n\n    const dateThreshold = new Date();\n    dateThreshold.setDate(dateThreshold.getDate() - 30);\n\n    const trendingCreators = await User.aggregate([\n      {\n        $match: {\n          role: { $in: ['creator', 'business', 'admin'] },\n        },\n      },\n      {\n        $addFields: {\n          followerCount: { $size: { $ifNull: ['$subscriber', []] } },\n        },\n      },\n      {\n        $lookup: {\n          from: 'posts',\n          let: { userId: '$_id' },\n          pipeline: [\n            {\n              $match: {\n                $expr: { $eq: ['$author', '$$userId'] },\n                createdAt: { $gte: dateThreshold },\n                visibility: 'public',\n              },\n            },\n            {\n              $addFields: {\n                likeCount: { $size: { $ifNull: ['$likes', []] } },\n                commentCount: { $size: { $ifNull: ['$comments', []] } },\n              },\n            },\n            {\n              $group: {\n                _id: null,\n                totalPosts: { $sum: 1 },\n                totalLikes: { $sum: '$likeCount' },\n                totalComments: { $sum: '$commentCount' },\n              },\n            },\n          ],\n          as: 'stats',\n        },\n      },\n      {\n        $unwind: { path: '$stats', preserveNullAndEmptyArrays: true },\n      },\n      {\n        $addFields: {\n          totalPosts: { $ifNull: ['$stats.totalPosts', 0] },\n          totalLikes: { $ifNull: ['$stats.totalLikes', 0] },\n          totalComments: { $ifNull: ['$stats.totalComments', 0] },\n        },\n      },\n      {\n        $addFields: {\n          trendingScore: {\n            $add: [\n              { $multiply: ['$followerCount', 1] },\n              { $multiply: ['$totalPosts', 50] },\n              { $multiply: ['$totalLikes', 10] },\n              { $multiply: ['$totalComments', 20] },\n            ],\n          },\n        },\n      },\n      {\n        $sort: { trendingScore: -1 },\n      },\n      {\n        $limit: limit,\n      },\n      {\n        $project: {\n          username: 1,\n          fullName: 1,\n          profilePicture: 1,\n          verified: 1,\n          bio: 1,\n          followerCount: 1,\n          totalPosts: 1,\n          trendingScore: 1,\n        },\n      },\n    ]);\n\n    res.json({ success: true, creators: trendingCreators });\n  } catch (error) {\n    console.error('Error fetching trending creators:', error);\n    res.status(500).json({ success: false, message: 'Failed to fetch trending creators' });\n  }\n};\n","size_bytes":7491},"frontend/dev-dist/workbox-54d0af47.js":{"content":"define(['exports'], (function (exports) { 'use strict';\n\n    // @ts-ignore\n    try {\n      self['workbox:core:7.2.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Claim any currently available clients once the service worker\n     * becomes active. This is normally used in conjunction with `skipWaiting()`.\n     *\n     * @memberof workbox-core\n     */\n    function clientsClaim() {\n      self.addEventListener('activate', () => self.clients.claim());\n    }\n\n    /*\n      Copyright 2019 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const logger = (() => {\n      // Don't overwrite this value if it's already set.\n      // See https://github.com/GoogleChrome/workbox/pull/2284#issuecomment-560470923\n      if (!('__WB_DISABLE_DEV_LOGS' in globalThis)) {\n        self.__WB_DISABLE_DEV_LOGS = false;\n      }\n      let inGroup = false;\n      const methodToColorMap = {\n        debug: `#7f8c8d`,\n        log: `#2ecc71`,\n        warn: `#f39c12`,\n        error: `#c0392b`,\n        groupCollapsed: `#3498db`,\n        groupEnd: null // No colored prefix on groupEnd\n      };\n      const print = function (method, args) {\n        if (self.__WB_DISABLE_DEV_LOGS) {\n          return;\n        }\n        if (method === 'groupCollapsed') {\n          // Safari doesn't print all console.groupCollapsed() arguments:\n          // https://bugs.webkit.org/show_bug.cgi?id=182754\n          if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {\n            console[method](...args);\n            return;\n          }\n        }\n        const styles = [`background: ${methodToColorMap[method]}`, `border-radius: 0.5em`, `color: white`, `font-weight: bold`, `padding: 2px 0.5em`];\n        // When in a group, the workbox prefix is not displayed.\n        const logPrefix = inGroup ? [] : ['%cworkbox', styles.join(';')];\n        console[method](...logPrefix, ...args);\n        if (method === 'groupCollapsed') {\n          inGroup = true;\n        }\n        if (method === 'groupEnd') {\n          inGroup = false;\n        }\n      };\n      // eslint-disable-next-line @typescript-eslint/ban-types\n      const api = {};\n      const loggerMethods = Object.keys(methodToColorMap);\n      for (const key of loggerMethods) {\n        const method = key;\n        api[method] = (...args) => {\n          print(method, args);\n        };\n      }\n      return api;\n    })();\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const messages = {\n      'invalid-value': ({\n        paramName,\n        validValueDescription,\n        value\n      }) => {\n        if (!paramName || !validValueDescription) {\n          throw new Error(`Unexpected input to 'invalid-value' error.`);\n        }\n        return `The '${paramName}' parameter was given a value with an ` + `unexpected value. ${validValueDescription} Received a value of ` + `${JSON.stringify(value)}.`;\n      },\n      'not-an-array': ({\n        moduleName,\n        className,\n        funcName,\n        paramName\n      }) => {\n        if (!moduleName || !className || !funcName || !paramName) {\n          throw new Error(`Unexpected input to 'not-an-array' error.`);\n        }\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${className}.${funcName}()' must be an array.`;\n      },\n      'incorrect-type': ({\n        expectedType,\n        paramName,\n        moduleName,\n        className,\n        funcName\n      }) => {\n        if (!expectedType || !paramName || !moduleName || !funcName) {\n          throw new Error(`Unexpected input to 'incorrect-type' error.`);\n        }\n        const classNameStr = className ? `${className}.` : '';\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}` + `${funcName}()' must be of type ${expectedType}.`;\n      },\n      'incorrect-class': ({\n        expectedClassName,\n        paramName,\n        moduleName,\n        className,\n        funcName,\n        isReturnValueProblem\n      }) => {\n        if (!expectedClassName || !moduleName || !funcName) {\n          throw new Error(`Unexpected input to 'incorrect-class' error.`);\n        }\n        const classNameStr = className ? `${className}.` : '';\n        if (isReturnValueProblem) {\n          return `The return value from ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\n        }\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\n      },\n      'missing-a-method': ({\n        expectedMethod,\n        paramName,\n        moduleName,\n        className,\n        funcName\n      }) => {\n        if (!expectedMethod || !paramName || !moduleName || !className || !funcName) {\n          throw new Error(`Unexpected input to 'missing-a-method' error.`);\n        }\n        return `${moduleName}.${className}.${funcName}() expected the ` + `'${paramName}' parameter to expose a '${expectedMethod}' method.`;\n      },\n      'add-to-cache-list-unexpected-type': ({\n        entry\n      }) => {\n        return `An unexpected entry was passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' The entry ` + `'${JSON.stringify(entry)}' isn't supported. You must supply an array of ` + `strings with one or more characters, objects with a url property or ` + `Request objects.`;\n      },\n      'add-to-cache-list-conflicting-entries': ({\n        firstEntry,\n        secondEntry\n      }) => {\n        if (!firstEntry || !secondEntry) {\n          throw new Error(`Unexpected input to ` + `'add-to-cache-list-duplicate-entries' error.`);\n        }\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${firstEntry} but different revision details. Workbox is ` + `unable to cache and version the asset correctly. Please remove one ` + `of the entries.`;\n      },\n      'plugin-error-request-will-fetch': ({\n        thrownErrorMessage\n      }) => {\n        if (!thrownErrorMessage) {\n          throw new Error(`Unexpected input to ` + `'plugin-error-request-will-fetch', error.`);\n        }\n        return `An error was thrown by a plugins 'requestWillFetch()' method. ` + `The thrown error message was: '${thrownErrorMessage}'.`;\n      },\n      'invalid-cache-name': ({\n        cacheNameId,\n        value\n      }) => {\n        if (!cacheNameId) {\n          throw new Error(`Expected a 'cacheNameId' for error 'invalid-cache-name'`);\n        }\n        return `You must provide a name containing at least one character for ` + `setCacheDetails({${cacheNameId}: '...'}). Received a value of ` + `'${JSON.stringify(value)}'`;\n      },\n      'unregister-route-but-not-found-with-method': ({\n        method\n      }) => {\n        if (!method) {\n          throw new Error(`Unexpected input to ` + `'unregister-route-but-not-found-with-method' error.`);\n        }\n        return `The route you're trying to unregister was not  previously ` + `registered for the method type '${method}'.`;\n      },\n      'unregister-route-route-not-registered': () => {\n        return `The route you're trying to unregister was not previously ` + `registered.`;\n      },\n      'queue-replay-failed': ({\n        name\n      }) => {\n        return `Replaying the background sync queue '${name}' failed.`;\n      },\n      'duplicate-queue-name': ({\n        name\n      }) => {\n        return `The Queue name '${name}' is already being used. ` + `All instances of backgroundSync.Queue must be given unique names.`;\n      },\n      'expired-test-without-max-age': ({\n        methodName,\n        paramName\n      }) => {\n        return `The '${methodName}()' method can only be used when the ` + `'${paramName}' is used in the constructor.`;\n      },\n      'unsupported-route-type': ({\n        moduleName,\n        className,\n        funcName,\n        paramName\n      }) => {\n        return `The supplied '${paramName}' parameter was an unsupported type. ` + `Please check the docs for ${moduleName}.${className}.${funcName} for ` + `valid input types.`;\n      },\n      'not-array-of-class': ({\n        value,\n        expectedClass,\n        moduleName,\n        className,\n        funcName,\n        paramName\n      }) => {\n        return `The supplied '${paramName}' parameter must be an array of ` + `'${expectedClass}' objects. Received '${JSON.stringify(value)},'. ` + `Please check the call to ${moduleName}.${className}.${funcName}() ` + `to fix the issue.`;\n      },\n      'max-entries-or-age-required': ({\n        moduleName,\n        className,\n        funcName\n      }) => {\n        return `You must define either config.maxEntries or config.maxAgeSeconds` + `in ${moduleName}.${className}.${funcName}`;\n      },\n      'statuses-or-headers-required': ({\n        moduleName,\n        className,\n        funcName\n      }) => {\n        return `You must define either config.statuses or config.headers` + `in ${moduleName}.${className}.${funcName}`;\n      },\n      'invalid-string': ({\n        moduleName,\n        funcName,\n        paramName\n      }) => {\n        if (!paramName || !moduleName || !funcName) {\n          throw new Error(`Unexpected input to 'invalid-string' error.`);\n        }\n        return `When using strings, the '${paramName}' parameter must start with ` + `'http' (for cross-origin matches) or '/' (for same-origin matches). ` + `Please see the docs for ${moduleName}.${funcName}() for ` + `more info.`;\n      },\n      'channel-name-required': () => {\n        return `You must provide a channelName to construct a ` + `BroadcastCacheUpdate instance.`;\n      },\n      'invalid-responses-are-same-args': () => {\n        return `The arguments passed into responsesAreSame() appear to be ` + `invalid. Please ensure valid Responses are used.`;\n      },\n      'expire-custom-caches-only': () => {\n        return `You must provide a 'cacheName' property when using the ` + `expiration plugin with a runtime caching strategy.`;\n      },\n      'unit-must-be-bytes': ({\n        normalizedRangeHeader\n      }) => {\n        if (!normalizedRangeHeader) {\n          throw new Error(`Unexpected input to 'unit-must-be-bytes' error.`);\n        }\n        return `The 'unit' portion of the Range header must be set to 'bytes'. ` + `The Range header provided was \"${normalizedRangeHeader}\"`;\n      },\n      'single-range-only': ({\n        normalizedRangeHeader\n      }) => {\n        if (!normalizedRangeHeader) {\n          throw new Error(`Unexpected input to 'single-range-only' error.`);\n        }\n        return `Multiple ranges are not supported. Please use a  single start ` + `value, and optional end value. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\n      },\n      'invalid-range-values': ({\n        normalizedRangeHeader\n      }) => {\n        if (!normalizedRangeHeader) {\n          throw new Error(`Unexpected input to 'invalid-range-values' error.`);\n        }\n        return `The Range header is missing both start and end values. At least ` + `one of those values is needed. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\n      },\n      'no-range-header': () => {\n        return `No Range header was found in the Request provided.`;\n      },\n      'range-not-satisfiable': ({\n        size,\n        start,\n        end\n      }) => {\n        return `The start (${start}) and end (${end}) values in the Range are ` + `not satisfiable by the cached response, which is ${size} bytes.`;\n      },\n      'attempt-to-cache-non-get-request': ({\n        url,\n        method\n      }) => {\n        return `Unable to cache '${url}' because it is a '${method}' request and ` + `only 'GET' requests can be cached.`;\n      },\n      'cache-put-with-no-response': ({\n        url\n      }) => {\n        return `There was an attempt to cache '${url}' but the response was not ` + `defined.`;\n      },\n      'no-response': ({\n        url,\n        error\n      }) => {\n        let message = `The strategy could not generate a response for '${url}'.`;\n        if (error) {\n          message += ` The underlying error is ${error}.`;\n        }\n        return message;\n      },\n      'bad-precaching-response': ({\n        url,\n        status\n      }) => {\n        return `The precaching request for '${url}' failed` + (status ? ` with an HTTP status of ${status}.` : `.`);\n      },\n      'non-precached-url': ({\n        url\n      }) => {\n        return `createHandlerBoundToURL('${url}') was called, but that URL is ` + `not precached. Please pass in a URL that is precached instead.`;\n      },\n      'add-to-cache-list-conflicting-integrities': ({\n        url\n      }) => {\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${url} with different integrity values. Please remove one of them.`;\n      },\n      'missing-precache-entry': ({\n        cacheName,\n        url\n      }) => {\n        return `Unable to find a precached response in ${cacheName} for ${url}.`;\n      },\n      'cross-origin-copy-response': ({\n        origin\n      }) => {\n        return `workbox-core.copyResponse() can only be used with same-origin ` + `responses. It was passed a response with origin ${origin}.`;\n      },\n      'opaque-streams-source': ({\n        type\n      }) => {\n        const message = `One of the workbox-streams sources resulted in an ` + `'${type}' response.`;\n        if (type === 'opaqueredirect') {\n          return `${message} Please do not use a navigation request that results ` + `in a redirect as a source.`;\n        }\n        return `${message} Please ensure your sources are CORS-enabled.`;\n      }\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const generatorFunction = (code, details = {}) => {\n      const message = messages[code];\n      if (!message) {\n        throw new Error(`Unable to find message for code '${code}'.`);\n      }\n      return message(details);\n    };\n    const messageGenerator = generatorFunction;\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Workbox errors should be thrown with this class.\n     * This allows use to ensure the type easily in tests,\n     * helps developers identify errors from workbox\n     * easily and allows use to optimise error\n     * messages correctly.\n     *\n     * @private\n     */\n    class WorkboxError extends Error {\n      /**\n       *\n       * @param {string} errorCode The error code that\n       * identifies this particular error.\n       * @param {Object=} details Any relevant arguments\n       * that will help developers identify issues should\n       * be added as a key on the context object.\n       */\n      constructor(errorCode, details) {\n        const message = messageGenerator(errorCode, details);\n        super(message);\n        this.name = errorCode;\n        this.details = details;\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /*\n     * This method throws if the supplied value is not an array.\n     * The destructed values are required to produce a meaningful error for users.\n     * The destructed and restructured object is so it's clear what is\n     * needed.\n     */\n    const isArray = (value, details) => {\n      if (!Array.isArray(value)) {\n        throw new WorkboxError('not-an-array', details);\n      }\n    };\n    const hasMethod = (object, expectedMethod, details) => {\n      const type = typeof object[expectedMethod];\n      if (type !== 'function') {\n        details['expectedMethod'] = expectedMethod;\n        throw new WorkboxError('missing-a-method', details);\n      }\n    };\n    const isType = (object, expectedType, details) => {\n      if (typeof object !== expectedType) {\n        details['expectedType'] = expectedType;\n        throw new WorkboxError('incorrect-type', details);\n      }\n    };\n    const isInstance = (object,\n    // Need the general type to do the check later.\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    expectedClass, details) => {\n      if (!(object instanceof expectedClass)) {\n        details['expectedClassName'] = expectedClass.name;\n        throw new WorkboxError('incorrect-class', details);\n      }\n    };\n    const isOneOf = (value, validValues, details) => {\n      if (!validValues.includes(value)) {\n        details['validValueDescription'] = `Valid values are ${JSON.stringify(validValues)}.`;\n        throw new WorkboxError('invalid-value', details);\n      }\n    };\n    const isArrayOfClass = (value,\n    // Need general type to do check later.\n    expectedClass,\n    // eslint-disable-line\n    details) => {\n      const error = new WorkboxError('not-array-of-class', details);\n      if (!Array.isArray(value)) {\n        throw error;\n      }\n      for (const item of value) {\n        if (!(item instanceof expectedClass)) {\n          throw error;\n        }\n      }\n    };\n    const finalAssertExports = {\n      hasMethod,\n      isArray,\n      isInstance,\n      isOneOf,\n      isType,\n      isArrayOfClass\n    };\n\n    // @ts-ignore\n    try {\n      self['workbox:routing:7.2.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * The default HTTP method, 'GET', used when there's no specific method\n     * configured for a route.\n     *\n     * @type {string}\n     *\n     * @private\n     */\n    const defaultMethod = 'GET';\n    /**\n     * The list of valid HTTP methods associated with requests that could be routed.\n     *\n     * @type {Array<string>}\n     *\n     * @private\n     */\n    const validMethods = ['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT'];\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * @param {function()|Object} handler Either a function, or an object with a\n     * 'handle' method.\n     * @return {Object} An object with a handle method.\n     *\n     * @private\n     */\n    const normalizeHandler = handler => {\n      if (handler && typeof handler === 'object') {\n        {\n          finalAssertExports.hasMethod(handler, 'handle', {\n            moduleName: 'workbox-routing',\n            className: 'Route',\n            funcName: 'constructor',\n            paramName: 'handler'\n          });\n        }\n        return handler;\n      } else {\n        {\n          finalAssertExports.isType(handler, 'function', {\n            moduleName: 'workbox-routing',\n            className: 'Route',\n            funcName: 'constructor',\n            paramName: 'handler'\n          });\n        }\n        return {\n          handle: handler\n        };\n      }\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A `Route` consists of a pair of callback functions, \"match\" and \"handler\".\n     * The \"match\" callback determine if a route should be used to \"handle\" a\n     * request by returning a non-falsy value if it can. The \"handler\" callback\n     * is called when there is a match and should return a Promise that resolves\n     * to a `Response`.\n     *\n     * @memberof workbox-routing\n     */\n    class Route {\n      /**\n       * Constructor for Route class.\n       *\n       * @param {workbox-routing~matchCallback} match\n       * A callback function that determines whether the route matches a given\n       * `fetch` event by returning a non-falsy value.\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resolving to a Response.\n       * @param {string} [method='GET'] The HTTP method to match the Route\n       * against.\n       */\n      constructor(match, handler, method = defaultMethod) {\n        {\n          finalAssertExports.isType(match, 'function', {\n            moduleName: 'workbox-routing',\n            className: 'Route',\n            funcName: 'constructor',\n            paramName: 'match'\n          });\n          if (method) {\n            finalAssertExports.isOneOf(method, validMethods, {\n              paramName: 'method'\n            });\n          }\n        }\n        // These values are referenced directly by Router so cannot be\n        // altered by minificaton.\n        this.handler = normalizeHandler(handler);\n        this.match = match;\n        this.method = method;\n      }\n      /**\n       *\n       * @param {workbox-routing-handlerCallback} handler A callback\n       * function that returns a Promise resolving to a Response\n       */\n      setCatchHandler(handler) {\n        this.catchHandler = normalizeHandler(handler);\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * RegExpRoute makes it easy to create a regular expression based\n     * {@link workbox-routing.Route}.\n     *\n     * For same-origin requests the RegExp only needs to match part of the URL. For\n     * requests against third-party servers, you must define a RegExp that matches\n     * the start of the URL.\n     *\n     * @memberof workbox-routing\n     * @extends workbox-routing.Route\n     */\n    class RegExpRoute extends Route {\n      /**\n       * If the regular expression contains\n       * [capture groups]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#grouping-back-references},\n       * the captured values will be passed to the\n       * {@link workbox-routing~handlerCallback} `params`\n       * argument.\n       *\n       * @param {RegExp} regExp The regular expression to match against URLs.\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resulting in a Response.\n       * @param {string} [method='GET'] The HTTP method to match the Route\n       * against.\n       */\n      constructor(regExp, handler, method) {\n        {\n          finalAssertExports.isInstance(regExp, RegExp, {\n            moduleName: 'workbox-routing',\n            className: 'RegExpRoute',\n            funcName: 'constructor',\n            paramName: 'pattern'\n          });\n        }\n        const match = ({\n          url\n        }) => {\n          const result = regExp.exec(url.href);\n          // Return immediately if there's no match.\n          if (!result) {\n            return;\n          }\n          // Require that the match start at the first character in the URL string\n          // if it's a cross-origin request.\n          // See https://github.com/GoogleChrome/workbox/issues/281 for the context\n          // behind this behavior.\n          if (url.origin !== location.origin && result.index !== 0) {\n            {\n              logger.debug(`The regular expression '${regExp.toString()}' only partially matched ` + `against the cross-origin URL '${url.toString()}'. RegExpRoute's will only ` + `handle cross-origin requests if they match the entire URL.`);\n            }\n            return;\n          }\n          // If the route matches, but there aren't any capture groups defined, then\n          // this will return [], which is truthy and therefore sufficient to\n          // indicate a match.\n          // If there are capture groups, then it will return their values.\n          return result.slice(1);\n        };\n        super(match, handler, method);\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const getFriendlyURL = url => {\n      const urlObj = new URL(String(url), location.href);\n      // See https://github.com/GoogleChrome/workbox/issues/2323\n      // We want to include everything, except for the origin if it's same-origin.\n      return urlObj.href.replace(new RegExp(`^${location.origin}`), '');\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * The Router can be used to process a `FetchEvent` using one or more\n     * {@link workbox-routing.Route}, responding with a `Response` if\n     * a matching route exists.\n     *\n     * If no route matches a given a request, the Router will use a \"default\"\n     * handler if one is defined.\n     *\n     * Should the matching Route throw an error, the Router will use a \"catch\"\n     * handler if one is defined to gracefully deal with issues and respond with a\n     * Request.\n     *\n     * If a request matches multiple routes, the **earliest** registered route will\n     * be used to respond to the request.\n     *\n     * @memberof workbox-routing\n     */\n    class Router {\n      /**\n       * Initializes a new Router.\n       */\n      constructor() {\n        this._routes = new Map();\n        this._defaultHandlerMap = new Map();\n      }\n      /**\n       * @return {Map<string, Array<workbox-routing.Route>>} routes A `Map` of HTTP\n       * method name ('GET', etc.) to an array of all the corresponding `Route`\n       * instances that are registered.\n       */\n      get routes() {\n        return this._routes;\n      }\n      /**\n       * Adds a fetch event listener to respond to events when a route matches\n       * the event's request.\n       */\n      addFetchListener() {\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\n        self.addEventListener('fetch', event => {\n          const {\n            request\n          } = event;\n          const responsePromise = this.handleRequest({\n            request,\n            event\n          });\n          if (responsePromise) {\n            event.respondWith(responsePromise);\n          }\n        });\n      }\n      /**\n       * Adds a message event listener for URLs to cache from the window.\n       * This is useful to cache resources loaded on the page prior to when the\n       * service worker started controlling it.\n       *\n       * The format of the message data sent from the window should be as follows.\n       * Where the `urlsToCache` array may consist of URL strings or an array of\n       * URL string + `requestInit` object (the same as you'd pass to `fetch()`).\n       *\n       * ```\n       * {\n       *   type: 'CACHE_URLS',\n       *   payload: {\n       *     urlsToCache: [\n       *       './script1.js',\n       *       './script2.js',\n       *       ['./script3.js', {mode: 'no-cors'}],\n       *     ],\n       *   },\n       * }\n       * ```\n       */\n      addCacheListener() {\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\n        self.addEventListener('message', event => {\n          // event.data is type 'any'\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n          if (event.data && event.data.type === 'CACHE_URLS') {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            const {\n              payload\n            } = event.data;\n            {\n              logger.debug(`Caching URLs from the window`, payload.urlsToCache);\n            }\n            const requestPromises = Promise.all(payload.urlsToCache.map(entry => {\n              if (typeof entry === 'string') {\n                entry = [entry];\n              }\n              const request = new Request(...entry);\n              return this.handleRequest({\n                request,\n                event\n              });\n              // TODO(philipwalton): TypeScript errors without this typecast for\n              // some reason (probably a bug). The real type here should work but\n              // doesn't: `Array<Promise<Response> | undefined>`.\n            })); // TypeScript\n            event.waitUntil(requestPromises);\n            // If a MessageChannel was used, reply to the message on success.\n            if (event.ports && event.ports[0]) {\n              void requestPromises.then(() => event.ports[0].postMessage(true));\n            }\n          }\n        });\n      }\n      /**\n       * Apply the routing rules to a FetchEvent object to get a Response from an\n       * appropriate Route's handler.\n       *\n       * @param {Object} options\n       * @param {Request} options.request The request to handle.\n       * @param {ExtendableEvent} options.event The event that triggered the\n       *     request.\n       * @return {Promise<Response>|undefined} A promise is returned if a\n       *     registered route can handle the request. If there is no matching\n       *     route and there's no `defaultHandler`, `undefined` is returned.\n       */\n      handleRequest({\n        request,\n        event\n      }) {\n        {\n          finalAssertExports.isInstance(request, Request, {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'handleRequest',\n            paramName: 'options.request'\n          });\n        }\n        const url = new URL(request.url, location.href);\n        if (!url.protocol.startsWith('http')) {\n          {\n            logger.debug(`Workbox Router only supports URLs that start with 'http'.`);\n          }\n          return;\n        }\n        const sameOrigin = url.origin === location.origin;\n        const {\n          params,\n          route\n        } = this.findMatchingRoute({\n          event,\n          request,\n          sameOrigin,\n          url\n        });\n        let handler = route && route.handler;\n        const debugMessages = [];\n        {\n          if (handler) {\n            debugMessages.push([`Found a route to handle this request:`, route]);\n            if (params) {\n              debugMessages.push([`Passing the subscribed params to the route's handler:`, params]);\n            }\n          }\n        }\n        // If we don't have a handler because there was no matching route, then\n        // fall back to defaultHandler if that's defined.\n        const method = request.method;\n        if (!handler && this._defaultHandlerMap.has(method)) {\n          {\n            debugMessages.push(`Failed to find a matching route. Falling ` + `back to the default handler for ${method}.`);\n          }\n          handler = this._defaultHandlerMap.get(method);\n        }\n        if (!handler) {\n          {\n            // No handler so Workbox will do nothing. If logs is set of debug\n            // i.e. verbose, we should print out this information.\n            logger.debug(`No route found for: ${getFriendlyURL(url)}`);\n          }\n          return;\n        }\n        {\n          // We have a handler, meaning Workbox is going to handle the route.\n          // print the routing details to the console.\n          logger.groupCollapsed(`Router is responding to: ${getFriendlyURL(url)}`);\n          debugMessages.forEach(msg => {\n            if (Array.isArray(msg)) {\n              logger.log(...msg);\n            } else {\n              logger.log(msg);\n            }\n          });\n          logger.groupEnd();\n        }\n        // Wrap in try and catch in case the handle method throws a synchronous\n        // error. It should still callback to the catch handler.\n        let responsePromise;\n        try {\n          responsePromise = handler.handle({\n            url,\n            request,\n            event,\n            params\n          });\n        } catch (err) {\n          responsePromise = Promise.reject(err);\n        }\n        // Get route's catch handler, if it exists\n        const catchHandler = route && route.catchHandler;\n        if (responsePromise instanceof Promise && (this._catchHandler || catchHandler)) {\n          responsePromise = responsePromise.catch(async err => {\n            // If there's a route catch handler, process that first\n            if (catchHandler) {\n              {\n                // Still include URL here as it will be async from the console group\n                // and may not make sense without the URL\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to route's Catch Handler.`);\n                logger.error(`Error thrown by:`, route);\n                logger.error(err);\n                logger.groupEnd();\n              }\n              try {\n                return await catchHandler.handle({\n                  url,\n                  request,\n                  event,\n                  params\n                });\n              } catch (catchErr) {\n                if (catchErr instanceof Error) {\n                  err = catchErr;\n                }\n              }\n            }\n            if (this._catchHandler) {\n              {\n                // Still include URL here as it will be async from the console group\n                // and may not make sense without the URL\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to global Catch Handler.`);\n                logger.error(`Error thrown by:`, route);\n                logger.error(err);\n                logger.groupEnd();\n              }\n              return this._catchHandler.handle({\n                url,\n                request,\n                event\n              });\n            }\n            throw err;\n          });\n        }\n        return responsePromise;\n      }\n      /**\n       * Checks a request and URL (and optionally an event) against the list of\n       * registered routes, and if there's a match, returns the corresponding\n       * route along with any params generated by the match.\n       *\n       * @param {Object} options\n       * @param {URL} options.url\n       * @param {boolean} options.sameOrigin The result of comparing `url.origin`\n       *     against the current origin.\n       * @param {Request} options.request The request to match.\n       * @param {Event} options.event The corresponding event.\n       * @return {Object} An object with `route` and `params` properties.\n       *     They are populated if a matching route was found or `undefined`\n       *     otherwise.\n       */\n      findMatchingRoute({\n        url,\n        sameOrigin,\n        request,\n        event\n      }) {\n        const routes = this._routes.get(request.method) || [];\n        for (const route of routes) {\n          let params;\n          // route.match returns type any, not possible to change right now.\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n          const matchResult = route.match({\n            url,\n            sameOrigin,\n            request,\n            event\n          });\n          if (matchResult) {\n            {\n              // Warn developers that using an async matchCallback is almost always\n              // not the right thing to do.\n              if (matchResult instanceof Promise) {\n                logger.warn(`While routing ${getFriendlyURL(url)}, an async ` + `matchCallback function was used. Please convert the ` + `subscribed route to use a synchronous matchCallback function:`, route);\n              }\n            }\n            // See https://github.com/GoogleChrome/workbox/issues/2079\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            params = matchResult;\n            if (Array.isArray(params) && params.length === 0) {\n              // Instead of passing an empty array in as params, use undefined.\n              params = undefined;\n            } else if (matchResult.constructor === Object &&\n            // eslint-disable-line\n            Object.keys(matchResult).length === 0) {\n              // Instead of passing an empty object in as params, use undefined.\n              params = undefined;\n            } else if (typeof matchResult === 'boolean') {\n              // For the boolean value true (rather than just something truth-y),\n              // don't set params.\n              // See https://github.com/GoogleChrome/workbox/pull/2134#issuecomment-513924353\n              params = undefined;\n            }\n            // Return early if have a match.\n            return {\n              route,\n              params\n            };\n          }\n        }\n        // If no match was found above, return and empty object.\n        return {};\n      }\n      /**\n       * Define a default `handler` that's called when no routes explicitly\n       * match the incoming request.\n       *\n       * Each HTTP method ('GET', 'POST', etc.) gets its own default handler.\n       *\n       * Without a default handler, unmatched requests will go against the\n       * network as if there were no service worker present.\n       *\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resulting in a Response.\n       * @param {string} [method='GET'] The HTTP method to associate with this\n       * default handler. Each method has its own default.\n       */\n      setDefaultHandler(handler, method = defaultMethod) {\n        this._defaultHandlerMap.set(method, normalizeHandler(handler));\n      }\n      /**\n       * If a Route throws an error while handling a request, this `handler`\n       * will be called and given a chance to provide a response.\n       *\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resulting in a Response.\n       */\n      setCatchHandler(handler) {\n        this._catchHandler = normalizeHandler(handler);\n      }\n      /**\n       * Registers a route with the router.\n       *\n       * @param {workbox-routing.Route} route The route to register.\n       */\n      registerRoute(route) {\n        {\n          finalAssertExports.isType(route, 'object', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route'\n          });\n          finalAssertExports.hasMethod(route, 'match', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route'\n          });\n          finalAssertExports.isType(route.handler, 'object', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route'\n          });\n          finalAssertExports.hasMethod(route.handler, 'handle', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route.handler'\n          });\n          finalAssertExports.isType(route.method, 'string', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route.method'\n          });\n        }\n        if (!this._routes.has(route.method)) {\n          this._routes.set(route.method, []);\n        }\n        // Give precedence to all of the earlier routes by adding this additional\n        // route to the end of the array.\n        this._routes.get(route.method).push(route);\n      }\n      /**\n       * Unregisters a route with the router.\n       *\n       * @param {workbox-routing.Route} route The route to unregister.\n       */\n      unregisterRoute(route) {\n        if (!this._routes.has(route.method)) {\n          throw new WorkboxError('unregister-route-but-not-found-with-method', {\n            method: route.method\n          });\n        }\n        const routeIndex = this._routes.get(route.method).indexOf(route);\n        if (routeIndex > -1) {\n          this._routes.get(route.method).splice(routeIndex, 1);\n        } else {\n          throw new WorkboxError('unregister-route-route-not-registered');\n        }\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    let defaultRouter;\n    /**\n     * Creates a new, singleton Router instance if one does not exist. If one\n     * does already exist, that instance is returned.\n     *\n     * @private\n     * @return {Router}\n     */\n    const getOrCreateDefaultRouter = () => {\n      if (!defaultRouter) {\n        defaultRouter = new Router();\n        // The helpers that use the default Router assume these listeners exist.\n        defaultRouter.addFetchListener();\n        defaultRouter.addCacheListener();\n      }\n      return defaultRouter;\n    };\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Easily register a RegExp, string, or function with a caching\n     * strategy to a singleton Router instance.\n     *\n     * This method will generate a Route for you if needed and\n     * call {@link workbox-routing.Router#registerRoute}.\n     *\n     * @param {RegExp|string|workbox-routing.Route~matchCallback|workbox-routing.Route} capture\n     * If the capture param is a `Route`, all other arguments will be ignored.\n     * @param {workbox-routing~handlerCallback} [handler] A callback\n     * function that returns a Promise resulting in a Response. This parameter\n     * is required if `capture` is not a `Route` object.\n     * @param {string} [method='GET'] The HTTP method to match the Route\n     * against.\n     * @return {workbox-routing.Route} The generated `Route`.\n     *\n     * @memberof workbox-routing\n     */\n    function registerRoute(capture, handler, method) {\n      let route;\n      if (typeof capture === 'string') {\n        const captureUrl = new URL(capture, location.href);\n        {\n          if (!(capture.startsWith('/') || capture.startsWith('http'))) {\n            throw new WorkboxError('invalid-string', {\n              moduleName: 'workbox-routing',\n              funcName: 'registerRoute',\n              paramName: 'capture'\n            });\n          }\n          // We want to check if Express-style wildcards are in the pathname only.\n          // TODO: Remove this log message in v4.\n          const valueToCheck = capture.startsWith('http') ? captureUrl.pathname : capture;\n          // See https://github.com/pillarjs/path-to-regexp#parameters\n          const wildcards = '[*:?+]';\n          if (new RegExp(`${wildcards}`).exec(valueToCheck)) {\n            logger.debug(`The '$capture' parameter contains an Express-style wildcard ` + `character (${wildcards}). Strings are now always interpreted as ` + `exact matches; use a RegExp for partial or wildcard matches.`);\n          }\n        }\n        const matchCallback = ({\n          url\n        }) => {\n          {\n            if (url.pathname === captureUrl.pathname && url.origin !== captureUrl.origin) {\n              logger.debug(`${capture} only partially matches the cross-origin URL ` + `${url.toString()}. This route will only handle cross-origin requests ` + `if they match the entire URL.`);\n            }\n          }\n          return url.href === captureUrl.href;\n        };\n        // If `capture` is a string then `handler` and `method` must be present.\n        route = new Route(matchCallback, handler, method);\n      } else if (capture instanceof RegExp) {\n        // If `capture` is a `RegExp` then `handler` and `method` must be present.\n        route = new RegExpRoute(capture, handler, method);\n      } else if (typeof capture === 'function') {\n        // If `capture` is a function then `handler` and `method` must be present.\n        route = new Route(capture, handler, method);\n      } else if (capture instanceof Route) {\n        route = capture;\n      } else {\n        throw new WorkboxError('unsupported-route-type', {\n          moduleName: 'workbox-routing',\n          funcName: 'registerRoute',\n          paramName: 'capture'\n        });\n      }\n      const defaultRouter = getOrCreateDefaultRouter();\n      defaultRouter.registerRoute(route);\n      return route;\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const _cacheNameDetails = {\n      googleAnalytics: 'googleAnalytics',\n      precache: 'precache-v2',\n      prefix: 'workbox',\n      runtime: 'runtime',\n      suffix: typeof registration !== 'undefined' ? registration.scope : ''\n    };\n    const _createCacheName = cacheName => {\n      return [_cacheNameDetails.prefix, cacheName, _cacheNameDetails.suffix].filter(value => value && value.length > 0).join('-');\n    };\n    const eachCacheNameDetail = fn => {\n      for (const key of Object.keys(_cacheNameDetails)) {\n        fn(key);\n      }\n    };\n    const cacheNames = {\n      updateDetails: details => {\n        eachCacheNameDetail(key => {\n          if (typeof details[key] === 'string') {\n            _cacheNameDetails[key] = details[key];\n          }\n        });\n      },\n      getGoogleAnalyticsName: userCacheName => {\n        return userCacheName || _createCacheName(_cacheNameDetails.googleAnalytics);\n      },\n      getPrecacheName: userCacheName => {\n        return userCacheName || _createCacheName(_cacheNameDetails.precache);\n      },\n      getPrefix: () => {\n        return _cacheNameDetails.prefix;\n      },\n      getRuntimeName: userCacheName => {\n        return userCacheName || _createCacheName(_cacheNameDetails.runtime);\n      },\n      getSuffix: () => {\n        return _cacheNameDetails.suffix;\n      }\n    };\n\n    /*\n      Copyright 2020 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A utility method that makes it easier to use `event.waitUntil` with\n     * async functions and return the result.\n     *\n     * @param {ExtendableEvent} event\n     * @param {Function} asyncFn\n     * @return {Function}\n     * @private\n     */\n    function waitUntil(event, asyncFn) {\n      const returnPromise = asyncFn();\n      event.waitUntil(returnPromise);\n      return returnPromise;\n    }\n\n    // @ts-ignore\n    try {\n      self['workbox:precaching:7.2.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    // Name of the search parameter used to store revision info.\n    const REVISION_SEARCH_PARAM = '__WB_REVISION__';\n    /**\n     * Converts a manifest entry into a versioned URL suitable for precaching.\n     *\n     * @param {Object|string} entry\n     * @return {string} A URL with versioning info.\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function createCacheKey(entry) {\n      if (!entry) {\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\n          entry\n        });\n      }\n      // If a precache manifest entry is a string, it's assumed to be a versioned\n      // URL, like '/app.abcd1234.js'. Return as-is.\n      if (typeof entry === 'string') {\n        const urlObject = new URL(entry, location.href);\n        return {\n          cacheKey: urlObject.href,\n          url: urlObject.href\n        };\n      }\n      const {\n        revision,\n        url\n      } = entry;\n      if (!url) {\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\n          entry\n        });\n      }\n      // If there's just a URL and no revision, then it's also assumed to be a\n      // versioned URL.\n      if (!revision) {\n        const urlObject = new URL(url, location.href);\n        return {\n          cacheKey: urlObject.href,\n          url: urlObject.href\n        };\n      }\n      // Otherwise, construct a properly versioned URL using the custom Workbox\n      // search parameter along with the revision info.\n      const cacheKeyURL = new URL(url, location.href);\n      const originalURL = new URL(url, location.href);\n      cacheKeyURL.searchParams.set(REVISION_SEARCH_PARAM, revision);\n      return {\n        cacheKey: cacheKeyURL.href,\n        url: originalURL.href\n      };\n    }\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A plugin, designed to be used with PrecacheController, to determine the\n     * of assets that were updated (or not updated) during the install event.\n     *\n     * @private\n     */\n    class PrecacheInstallReportPlugin {\n      constructor() {\n        this.updatedURLs = [];\n        this.notUpdatedURLs = [];\n        this.handlerWillStart = async ({\n          request,\n          state\n        }) => {\n          // TODO: `state` should never be undefined...\n          if (state) {\n            state.originalRequest = request;\n          }\n        };\n        this.cachedResponseWillBeUsed = async ({\n          event,\n          state,\n          cachedResponse\n        }) => {\n          if (event.type === 'install') {\n            if (state && state.originalRequest && state.originalRequest instanceof Request) {\n              // TODO: `state` should never be undefined...\n              const url = state.originalRequest.url;\n              if (cachedResponse) {\n                this.notUpdatedURLs.push(url);\n              } else {\n                this.updatedURLs.push(url);\n              }\n            }\n          }\n          return cachedResponse;\n        };\n      }\n    }\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A plugin, designed to be used with PrecacheController, to translate URLs into\n     * the corresponding cache key, based on the current revision info.\n     *\n     * @private\n     */\n    class PrecacheCacheKeyPlugin {\n      constructor({\n        precacheController\n      }) {\n        this.cacheKeyWillBeUsed = async ({\n          request,\n          params\n        }) => {\n          // Params is type any, can't change right now.\n          /* eslint-disable */\n          const cacheKey = (params === null || params === void 0 ? void 0 : params.cacheKey) || this._precacheController.getCacheKeyForURL(request.url);\n          /* eslint-enable */\n          return cacheKey ? new Request(cacheKey, {\n            headers: request.headers\n          }) : request;\n        };\n        this._precacheController = precacheController;\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * @param {string} groupTitle\n     * @param {Array<string>} deletedURLs\n     *\n     * @private\n     */\n    const logGroup = (groupTitle, deletedURLs) => {\n      logger.groupCollapsed(groupTitle);\n      for (const url of deletedURLs) {\n        logger.log(url);\n      }\n      logger.groupEnd();\n    };\n    /**\n     * @param {Array<string>} deletedURLs\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function printCleanupDetails(deletedURLs) {\n      const deletionCount = deletedURLs.length;\n      if (deletionCount > 0) {\n        logger.groupCollapsed(`During precaching cleanup, ` + `${deletionCount} cached ` + `request${deletionCount === 1 ? ' was' : 's were'} deleted.`);\n        logGroup('Deleted Cache Requests', deletedURLs);\n        logger.groupEnd();\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * @param {string} groupTitle\n     * @param {Array<string>} urls\n     *\n     * @private\n     */\n    function _nestedGroup(groupTitle, urls) {\n      if (urls.length === 0) {\n        return;\n      }\n      logger.groupCollapsed(groupTitle);\n      for (const url of urls) {\n        logger.log(url);\n      }\n      logger.groupEnd();\n    }\n    /**\n     * @param {Array<string>} urlsToPrecache\n     * @param {Array<string>} urlsAlreadyPrecached\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function printInstallDetails(urlsToPrecache, urlsAlreadyPrecached) {\n      const precachedCount = urlsToPrecache.length;\n      const alreadyPrecachedCount = urlsAlreadyPrecached.length;\n      if (precachedCount || alreadyPrecachedCount) {\n        let message = `Precaching ${precachedCount} file${precachedCount === 1 ? '' : 's'}.`;\n        if (alreadyPrecachedCount > 0) {\n          message += ` ${alreadyPrecachedCount} ` + `file${alreadyPrecachedCount === 1 ? ' is' : 's are'} already cached.`;\n        }\n        logger.groupCollapsed(message);\n        _nestedGroup(`View newly precached URLs.`, urlsToPrecache);\n        _nestedGroup(`View previously precached URLs.`, urlsAlreadyPrecached);\n        logger.groupEnd();\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    let supportStatus;\n    /**\n     * A utility function that determines whether the current browser supports\n     * constructing a new `Response` from a `response.body` stream.\n     *\n     * @return {boolean} `true`, if the current browser can successfully\n     *     construct a `Response` from a `response.body` stream, `false` otherwise.\n     *\n     * @private\n     */\n    function canConstructResponseFromBodyStream() {\n      if (supportStatus === undefined) {\n        const testResponse = new Response('');\n        if ('body' in testResponse) {\n          try {\n            new Response(testResponse.body);\n            supportStatus = true;\n          } catch (error) {\n            supportStatus = false;\n          }\n        }\n        supportStatus = false;\n      }\n      return supportStatus;\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Allows developers to copy a response and modify its `headers`, `status`,\n     * or `statusText` values (the values settable via a\n     * [`ResponseInit`]{@link https://developer.mozilla.org/en-US/docs/Web/API/Response/Response#Syntax}\n     * object in the constructor).\n     * To modify these values, pass a function as the second argument. That\n     * function will be invoked with a single object with the response properties\n     * `{headers, status, statusText}`. The return value of this function will\n     * be used as the `ResponseInit` for the new `Response`. To change the values\n     * either modify the passed parameter(s) and return it, or return a totally\n     * new object.\n     *\n     * This method is intentionally limited to same-origin responses, regardless of\n     * whether CORS was used or not.\n     *\n     * @param {Response} response\n     * @param {Function} modifier\n     * @memberof workbox-core\n     */\n    async function copyResponse(response, modifier) {\n      let origin = null;\n      // If response.url isn't set, assume it's cross-origin and keep origin null.\n      if (response.url) {\n        const responseURL = new URL(response.url);\n        origin = responseURL.origin;\n      }\n      if (origin !== self.location.origin) {\n        throw new WorkboxError('cross-origin-copy-response', {\n          origin\n        });\n      }\n      const clonedResponse = response.clone();\n      // Create a fresh `ResponseInit` object by cloning the headers.\n      const responseInit = {\n        headers: new Headers(clonedResponse.headers),\n        status: clonedResponse.status,\n        statusText: clonedResponse.statusText\n      };\n      // Apply any user modifications.\n      const modifiedResponseInit = modifier ? modifier(responseInit) : responseInit;\n      // Create the new response from the body stream and `ResponseInit`\n      // modifications. Note: not all browsers support the Response.body stream,\n      // so fall back to reading the entire body into memory as a blob.\n      const body = canConstructResponseFromBodyStream() ? clonedResponse.body : await clonedResponse.blob();\n      return new Response(body, modifiedResponseInit);\n    }\n\n    /*\n      Copyright 2020 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    function stripParams(fullURL, ignoreParams) {\n      const strippedURL = new URL(fullURL);\n      for (const param of ignoreParams) {\n        strippedURL.searchParams.delete(param);\n      }\n      return strippedURL.href;\n    }\n    /**\n     * Matches an item in the cache, ignoring specific URL params. This is similar\n     * to the `ignoreSearch` option, but it allows you to ignore just specific\n     * params (while continuing to match on the others).\n     *\n     * @private\n     * @param {Cache} cache\n     * @param {Request} request\n     * @param {Object} matchOptions\n     * @param {Array<string>} ignoreParams\n     * @return {Promise<Response|undefined>}\n     */\n    async function cacheMatchIgnoreParams(cache, request, ignoreParams, matchOptions) {\n      const strippedRequestURL = stripParams(request.url, ignoreParams);\n      // If the request doesn't include any ignored params, match as normal.\n      if (request.url === strippedRequestURL) {\n        return cache.match(request, matchOptions);\n      }\n      // Otherwise, match by comparing keys\n      const keysOptions = Object.assign(Object.assign({}, matchOptions), {\n        ignoreSearch: true\n      });\n      const cacheKeys = await cache.keys(request, keysOptions);\n      for (const cacheKey of cacheKeys) {\n        const strippedCacheKeyURL = stripParams(cacheKey.url, ignoreParams);\n        if (strippedRequestURL === strippedCacheKeyURL) {\n          return cache.match(cacheKey, matchOptions);\n        }\n      }\n      return;\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * The Deferred class composes Promises in a way that allows for them to be\n     * resolved or rejected from outside the constructor. In most cases promises\n     * should be used directly, but Deferreds can be necessary when the logic to\n     * resolve a promise must be separate.\n     *\n     * @private\n     */\n    class Deferred {\n      /**\n       * Creates a promise and exposes its resolve and reject functions as methods.\n       */\n      constructor() {\n        this.promise = new Promise((resolve, reject) => {\n          this.resolve = resolve;\n          this.reject = reject;\n        });\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    // Callbacks to be executed whenever there's a quota error.\n    // Can't change Function type right now.\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    const quotaErrorCallbacks = new Set();\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Runs all of the callback functions, one at a time sequentially, in the order\n     * in which they were registered.\n     *\n     * @memberof workbox-core\n     * @private\n     */\n    async function executeQuotaErrorCallbacks() {\n      {\n        logger.log(`About to run ${quotaErrorCallbacks.size} ` + `callbacks to clean up caches.`);\n      }\n      for (const callback of quotaErrorCallbacks) {\n        await callback();\n        {\n          logger.log(callback, 'is complete.');\n        }\n      }\n      {\n        logger.log('Finished running callbacks.');\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Returns a promise that resolves and the passed number of milliseconds.\n     * This utility is an async/await-friendly version of `setTimeout`.\n     *\n     * @param {number} ms\n     * @return {Promise}\n     * @private\n     */\n    function timeout(ms) {\n      return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n    // @ts-ignore\n    try {\n      self['workbox:strategies:7.2.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    function toRequest(input) {\n      return typeof input === 'string' ? new Request(input) : input;\n    }\n    /**\n     * A class created every time a Strategy instance instance calls\n     * {@link workbox-strategies.Strategy~handle} or\n     * {@link workbox-strategies.Strategy~handleAll} that wraps all fetch and\n     * cache actions around plugin callbacks and keeps track of when the strategy\n     * is \"done\" (i.e. all added `event.waitUntil()` promises have resolved).\n     *\n     * @memberof workbox-strategies\n     */\n    class StrategyHandler {\n      /**\n       * Creates a new instance associated with the passed strategy and event\n       * that's handling the request.\n       *\n       * The constructor also initializes the state that will be passed to each of\n       * the plugins handling this request.\n       *\n       * @param {workbox-strategies.Strategy} strategy\n       * @param {Object} options\n       * @param {Request|string} options.request A request to run this strategy for.\n       * @param {ExtendableEvent} options.event The event associated with the\n       *     request.\n       * @param {URL} [options.url]\n       * @param {*} [options.params] The return value from the\n       *     {@link workbox-routing~matchCallback} (if applicable).\n       */\n      constructor(strategy, options) {\n        this._cacheKeys = {};\n        /**\n         * The request the strategy is performing (passed to the strategy's\n         * `handle()` or `handleAll()` method).\n         * @name request\n         * @instance\n         * @type {Request}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        /**\n         * The event associated with this request.\n         * @name event\n         * @instance\n         * @type {ExtendableEvent}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        /**\n         * A `URL` instance of `request.url` (if passed to the strategy's\n         * `handle()` or `handleAll()` method).\n         * Note: the `url` param will be present if the strategy was invoked\n         * from a workbox `Route` object.\n         * @name url\n         * @instance\n         * @type {URL|undefined}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        /**\n         * A `param` value (if passed to the strategy's\n         * `handle()` or `handleAll()` method).\n         * Note: the `param` param will be present if the strategy was invoked\n         * from a workbox `Route` object and the\n         * {@link workbox-routing~matchCallback} returned\n         * a truthy value (it will be that value).\n         * @name params\n         * @instance\n         * @type {*|undefined}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        {\n          finalAssertExports.isInstance(options.event, ExtendableEvent, {\n            moduleName: 'workbox-strategies',\n            className: 'StrategyHandler',\n            funcName: 'constructor',\n            paramName: 'options.event'\n          });\n        }\n        Object.assign(this, options);\n        this.event = options.event;\n        this._strategy = strategy;\n        this._handlerDeferred = new Deferred();\n        this._extendLifetimePromises = [];\n        // Copy the plugins list (since it's mutable on the strategy),\n        // so any mutations don't affect this handler instance.\n        this._plugins = [...strategy.plugins];\n        this._pluginStateMap = new Map();\n        for (const plugin of this._plugins) {\n          this._pluginStateMap.set(plugin, {});\n        }\n        this.event.waitUntil(this._handlerDeferred.promise);\n      }\n      /**\n       * Fetches a given request (and invokes any applicable plugin callback\n       * methods) using the `fetchOptions` (for non-navigation requests) and\n       * `plugins` defined on the `Strategy` object.\n       *\n       * The subscribed plugin lifecycle methods are invoked when using this method:\n       * - `requestWillFetch()`\n       * - `fetchDidSucceed()`\n       * - `fetchDidFail()`\n       *\n       * @param {Request|string} input The URL or request to fetch.\n       * @return {Promise<Response>}\n       */\n      async fetch(input) {\n        const {\n          event\n        } = this;\n        let request = toRequest(input);\n        if (request.mode === 'navigate' && event instanceof FetchEvent && event.preloadResponse) {\n          const possiblePreloadResponse = await event.preloadResponse;\n          if (possiblePreloadResponse) {\n            {\n              logger.log(`Using a preloaded navigation response for ` + `'${getFriendlyURL(request.url)}'`);\n            }\n            return possiblePreloadResponse;\n          }\n        }\n        // If there is a fetchDidFail plugin, we need to save a clone of the\n        // original request before it's either modified by a requestWillFetch\n        // plugin or before the original request's body is consumed via fetch().\n        const originalRequest = this.hasCallback('fetchDidFail') ? request.clone() : null;\n        try {\n          for (const cb of this.iterateCallbacks('requestWillFetch')) {\n            request = await cb({\n              request: request.clone(),\n              event\n            });\n          }\n        } catch (err) {\n          if (err instanceof Error) {\n            throw new WorkboxError('plugin-error-request-will-fetch', {\n              thrownErrorMessage: err.message\n            });\n          }\n        }\n        // The request can be altered by plugins with `requestWillFetch` making\n        // the original request (most likely from a `fetch` event) different\n        // from the Request we make. Pass both to `fetchDidFail` to aid debugging.\n        const pluginFilteredRequest = request.clone();\n        try {\n          let fetchResponse;\n          // See https://github.com/GoogleChrome/workbox/issues/1796\n          fetchResponse = await fetch(request, request.mode === 'navigate' ? undefined : this._strategy.fetchOptions);\n          if (\"development\" !== 'production') {\n            logger.debug(`Network request for ` + `'${getFriendlyURL(request.url)}' returned a response with ` + `status '${fetchResponse.status}'.`);\n          }\n          for (const callback of this.iterateCallbacks('fetchDidSucceed')) {\n            fetchResponse = await callback({\n              event,\n              request: pluginFilteredRequest,\n              response: fetchResponse\n            });\n          }\n          return fetchResponse;\n        } catch (error) {\n          {\n            logger.log(`Network request for ` + `'${getFriendlyURL(request.url)}' threw an error.`, error);\n          }\n          // `originalRequest` will only exist if a `fetchDidFail` callback\n          // is being used (see above).\n          if (originalRequest) {\n            await this.runCallbacks('fetchDidFail', {\n              error: error,\n              event,\n              originalRequest: originalRequest.clone(),\n              request: pluginFilteredRequest.clone()\n            });\n          }\n          throw error;\n        }\n      }\n      /**\n       * Calls `this.fetch()` and (in the background) runs `this.cachePut()` on\n       * the response generated by `this.fetch()`.\n       *\n       * The call to `this.cachePut()` automatically invokes `this.waitUntil()`,\n       * so you do not have to manually call `waitUntil()` on the event.\n       *\n       * @param {Request|string} input The request or URL to fetch and cache.\n       * @return {Promise<Response>}\n       */\n      async fetchAndCachePut(input) {\n        const response = await this.fetch(input);\n        const responseClone = response.clone();\n        void this.waitUntil(this.cachePut(input, responseClone));\n        return response;\n      }\n      /**\n       * Matches a request from the cache (and invokes any applicable plugin\n       * callback methods) using the `cacheName`, `matchOptions`, and `plugins`\n       * defined on the strategy object.\n       *\n       * The subscribed plugin lifecycle methods are invoked when using this method:\n       * - cacheKeyWillBeUsed()\n       * - cachedResponseWillBeUsed()\n       *\n       * @param {Request|string} key The Request or URL to use as the cache key.\n       * @return {Promise<Response|undefined>} A matching response, if found.\n       */\n      async cacheMatch(key) {\n        const request = toRequest(key);\n        let cachedResponse;\n        const {\n          cacheName,\n          matchOptions\n        } = this._strategy;\n        const effectiveRequest = await this.getCacheKey(request, 'read');\n        const multiMatchOptions = Object.assign(Object.assign({}, matchOptions), {\n          cacheName\n        });\n        cachedResponse = await caches.match(effectiveRequest, multiMatchOptions);\n        {\n          if (cachedResponse) {\n            logger.debug(`Found a cached response in '${cacheName}'.`);\n          } else {\n            logger.debug(`No cached response found in '${cacheName}'.`);\n          }\n        }\n        for (const callback of this.iterateCallbacks('cachedResponseWillBeUsed')) {\n          cachedResponse = (await callback({\n            cacheName,\n            matchOptions,\n            cachedResponse,\n            request: effectiveRequest,\n            event: this.event\n          })) || undefined;\n        }\n        return cachedResponse;\n      }\n      /**\n       * Puts a request/response pair in the cache (and invokes any applicable\n       * plugin callback methods) using the `cacheName` and `plugins` defined on\n       * the strategy object.\n       *\n       * The subscribed plugin lifecycle methods are invoked when using this method:\n       * - cacheKeyWillBeUsed()\n       * - cacheWillUpdate()\n       * - cacheDidUpdate()\n       *\n       * @param {Request|string} key The request or URL to use as the cache key.\n       * @param {Response} response The response to cache.\n       * @return {Promise<boolean>} `false` if a cacheWillUpdate caused the response\n       * not be cached, and `true` otherwise.\n       */\n      async cachePut(key, response) {\n        const request = toRequest(key);\n        // Run in the next task to avoid blocking other cache reads.\n        // https://github.com/w3c/ServiceWorker/issues/1397\n        await timeout(0);\n        const effectiveRequest = await this.getCacheKey(request, 'write');\n        {\n          if (effectiveRequest.method && effectiveRequest.method !== 'GET') {\n            throw new WorkboxError('attempt-to-cache-non-get-request', {\n              url: getFriendlyURL(effectiveRequest.url),\n              method: effectiveRequest.method\n            });\n          }\n          // See https://github.com/GoogleChrome/workbox/issues/2818\n          const vary = response.headers.get('Vary');\n          if (vary) {\n            logger.debug(`The response for ${getFriendlyURL(effectiveRequest.url)} ` + `has a 'Vary: ${vary}' header. ` + `Consider setting the {ignoreVary: true} option on your strategy ` + `to ensure cache matching and deletion works as expected.`);\n          }\n        }\n        if (!response) {\n          {\n            logger.error(`Cannot cache non-existent response for ` + `'${getFriendlyURL(effectiveRequest.url)}'.`);\n          }\n          throw new WorkboxError('cache-put-with-no-response', {\n            url: getFriendlyURL(effectiveRequest.url)\n          });\n        }\n        const responseToCache = await this._ensureResponseSafeToCache(response);\n        if (!responseToCache) {\n          {\n            logger.debug(`Response '${getFriendlyURL(effectiveRequest.url)}' ` + `will not be cached.`, responseToCache);\n          }\n          return false;\n        }\n        const {\n          cacheName,\n          matchOptions\n        } = this._strategy;\n        const cache = await self.caches.open(cacheName);\n        const hasCacheUpdateCallback = this.hasCallback('cacheDidUpdate');\n        const oldResponse = hasCacheUpdateCallback ? await cacheMatchIgnoreParams(\n        // TODO(philipwalton): the `__WB_REVISION__` param is a precaching\n        // feature. Consider into ways to only add this behavior if using\n        // precaching.\n        cache, effectiveRequest.clone(), ['__WB_REVISION__'], matchOptions) : null;\n        {\n          logger.debug(`Updating the '${cacheName}' cache with a new Response ` + `for ${getFriendlyURL(effectiveRequest.url)}.`);\n        }\n        try {\n          await cache.put(effectiveRequest, hasCacheUpdateCallback ? responseToCache.clone() : responseToCache);\n        } catch (error) {\n          if (error instanceof Error) {\n            // See https://developer.mozilla.org/en-US/docs/Web/API/DOMException#exception-QuotaExceededError\n            if (error.name === 'QuotaExceededError') {\n              await executeQuotaErrorCallbacks();\n            }\n            throw error;\n          }\n        }\n        for (const callback of this.iterateCallbacks('cacheDidUpdate')) {\n          await callback({\n            cacheName,\n            oldResponse,\n            newResponse: responseToCache.clone(),\n            request: effectiveRequest,\n            event: this.event\n          });\n        }\n        return true;\n      }\n      /**\n       * Checks the list of plugins for the `cacheKeyWillBeUsed` callback, and\n       * executes any of those callbacks found in sequence. The final `Request`\n       * object returned by the last plugin is treated as the cache key for cache\n       * reads and/or writes. If no `cacheKeyWillBeUsed` plugin callbacks have\n       * been registered, the passed request is returned unmodified\n       *\n       * @param {Request} request\n       * @param {string} mode\n       * @return {Promise<Request>}\n       */\n      async getCacheKey(request, mode) {\n        const key = `${request.url} | ${mode}`;\n        if (!this._cacheKeys[key]) {\n          let effectiveRequest = request;\n          for (const callback of this.iterateCallbacks('cacheKeyWillBeUsed')) {\n            effectiveRequest = toRequest(await callback({\n              mode,\n              request: effectiveRequest,\n              event: this.event,\n              // params has a type any can't change right now.\n              params: this.params // eslint-disable-line\n            }));\n          }\n          this._cacheKeys[key] = effectiveRequest;\n        }\n        return this._cacheKeys[key];\n      }\n      /**\n       * Returns true if the strategy has at least one plugin with the given\n       * callback.\n       *\n       * @param {string} name The name of the callback to check for.\n       * @return {boolean}\n       */\n      hasCallback(name) {\n        for (const plugin of this._strategy.plugins) {\n          if (name in plugin) {\n            return true;\n          }\n        }\n        return false;\n      }\n      /**\n       * Runs all plugin callbacks matching the given name, in order, passing the\n       * given param object (merged ith the current plugin state) as the only\n       * argument.\n       *\n       * Note: since this method runs all plugins, it's not suitable for cases\n       * where the return value of a callback needs to be applied prior to calling\n       * the next callback. See\n       * {@link workbox-strategies.StrategyHandler#iterateCallbacks}\n       * below for how to handle that case.\n       *\n       * @param {string} name The name of the callback to run within each plugin.\n       * @param {Object} param The object to pass as the first (and only) param\n       *     when executing each callback. This object will be merged with the\n       *     current plugin state prior to callback execution.\n       */\n      async runCallbacks(name, param) {\n        for (const callback of this.iterateCallbacks(name)) {\n          // TODO(philipwalton): not sure why `any` is needed. It seems like\n          // this should work with `as WorkboxPluginCallbackParam[C]`.\n          await callback(param);\n        }\n      }\n      /**\n       * Accepts a callback and returns an iterable of matching plugin callbacks,\n       * where each callback is wrapped with the current handler state (i.e. when\n       * you call each callback, whatever object parameter you pass it will\n       * be merged with the plugin's current state).\n       *\n       * @param {string} name The name fo the callback to run\n       * @return {Array<Function>}\n       */\n      *iterateCallbacks(name) {\n        for (const plugin of this._strategy.plugins) {\n          if (typeof plugin[name] === 'function') {\n            const state = this._pluginStateMap.get(plugin);\n            const statefulCallback = param => {\n              const statefulParam = Object.assign(Object.assign({}, param), {\n                state\n              });\n              // TODO(philipwalton): not sure why `any` is needed. It seems like\n              // this should work with `as WorkboxPluginCallbackParam[C]`.\n              return plugin[name](statefulParam);\n            };\n            yield statefulCallback;\n          }\n        }\n      }\n      /**\n       * Adds a promise to the\n       * [extend lifetime promises]{@link https://w3c.github.io/ServiceWorker/#extendableevent-extend-lifetime-promises}\n       * of the event event associated with the request being handled (usually a\n       * `FetchEvent`).\n       *\n       * Note: you can await\n       * {@link workbox-strategies.StrategyHandler~doneWaiting}\n       * to know when all added promises have settled.\n       *\n       * @param {Promise} promise A promise to add to the extend lifetime promises\n       *     of the event that triggered the request.\n       */\n      waitUntil(promise) {\n        this._extendLifetimePromises.push(promise);\n        return promise;\n      }\n      /**\n       * Returns a promise that resolves once all promises passed to\n       * {@link workbox-strategies.StrategyHandler~waitUntil}\n       * have settled.\n       *\n       * Note: any work done after `doneWaiting()` settles should be manually\n       * passed to an event's `waitUntil()` method (not this handler's\n       * `waitUntil()` method), otherwise the service worker thread my be killed\n       * prior to your work completing.\n       */\n      async doneWaiting() {\n        let promise;\n        while (promise = this._extendLifetimePromises.shift()) {\n          await promise;\n        }\n      }\n      /**\n       * Stops running the strategy and immediately resolves any pending\n       * `waitUntil()` promises.\n       */\n      destroy() {\n        this._handlerDeferred.resolve(null);\n      }\n      /**\n       * This method will call cacheWillUpdate on the available plugins (or use\n       * status === 200) to determine if the Response is safe and valid to cache.\n       *\n       * @param {Request} options.request\n       * @param {Response} options.response\n       * @return {Promise<Response|undefined>}\n       *\n       * @private\n       */\n      async _ensureResponseSafeToCache(response) {\n        let responseToCache = response;\n        let pluginsUsed = false;\n        for (const callback of this.iterateCallbacks('cacheWillUpdate')) {\n          responseToCache = (await callback({\n            request: this.request,\n            response: responseToCache,\n            event: this.event\n          })) || undefined;\n          pluginsUsed = true;\n          if (!responseToCache) {\n            break;\n          }\n        }\n        if (!pluginsUsed) {\n          if (responseToCache && responseToCache.status !== 200) {\n            responseToCache = undefined;\n          }\n          {\n            if (responseToCache) {\n              if (responseToCache.status !== 200) {\n                if (responseToCache.status === 0) {\n                  logger.warn(`The response for '${this.request.url}' ` + `is an opaque response. The caching strategy that you're ` + `using will not cache opaque responses by default.`);\n                } else {\n                  logger.debug(`The response for '${this.request.url}' ` + `returned a status code of '${response.status}' and won't ` + `be cached as a result.`);\n                }\n              }\n            }\n          }\n        }\n        return responseToCache;\n      }\n    }\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * An abstract base class that all other strategy classes must extend from:\n     *\n     * @memberof workbox-strategies\n     */\n    class Strategy {\n      /**\n       * Creates a new instance of the strategy and sets all documented option\n       * properties as public instance properties.\n       *\n       * Note: if a custom strategy class extends the base Strategy class and does\n       * not need more than these properties, it does not need to define its own\n       * constructor.\n       *\n       * @param {Object} [options]\n       * @param {string} [options.cacheName] Cache name to store and retrieve\n       * requests. Defaults to the cache names provided by\n       * {@link workbox-core.cacheNames}.\n       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\n       * to use in conjunction with this caching strategy.\n       * @param {Object} [options.fetchOptions] Values passed along to the\n       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\n       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\n       * `fetch()` requests made by this strategy.\n       * @param {Object} [options.matchOptions] The\n       * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\n       */\n      constructor(options = {}) {\n        /**\n         * Cache name to store and retrieve\n         * requests. Defaults to the cache names provided by\n         * {@link workbox-core.cacheNames}.\n         *\n         * @type {string}\n         */\n        this.cacheName = cacheNames.getRuntimeName(options.cacheName);\n        /**\n         * The list\n         * [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\n         * used by this strategy.\n         *\n         * @type {Array<Object>}\n         */\n        this.plugins = options.plugins || [];\n        /**\n         * Values passed along to the\n         * [`init`]{@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters}\n         * of all fetch() requests made by this strategy.\n         *\n         * @type {Object}\n         */\n        this.fetchOptions = options.fetchOptions;\n        /**\n         * The\n         * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\n         * for any `cache.match()` or `cache.put()` calls made by this strategy.\n         *\n         * @type {Object}\n         */\n        this.matchOptions = options.matchOptions;\n      }\n      /**\n       * Perform a request strategy and returns a `Promise` that will resolve with\n       * a `Response`, invoking all relevant plugin callbacks.\n       *\n       * When a strategy instance is registered with a Workbox\n       * {@link workbox-routing.Route}, this method is automatically\n       * called when the route matches.\n       *\n       * Alternatively, this method can be used in a standalone `FetchEvent`\n       * listener by passing it to `event.respondWith()`.\n       *\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\n       *     properties listed below.\n       * @param {Request|string} options.request A request to run this strategy for.\n       * @param {ExtendableEvent} options.event The event associated with the\n       *     request.\n       * @param {URL} [options.url]\n       * @param {*} [options.params]\n       */\n      handle(options) {\n        const [responseDone] = this.handleAll(options);\n        return responseDone;\n      }\n      /**\n       * Similar to {@link workbox-strategies.Strategy~handle}, but\n       * instead of just returning a `Promise` that resolves to a `Response` it\n       * it will return an tuple of `[response, done]` promises, where the former\n       * (`response`) is equivalent to what `handle()` returns, and the latter is a\n       * Promise that will resolve once any promises that were added to\n       * `event.waitUntil()` as part of performing the strategy have completed.\n       *\n       * You can await the `done` promise to ensure any extra work performed by\n       * the strategy (usually caching responses) completes successfully.\n       *\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\n       *     properties listed below.\n       * @param {Request|string} options.request A request to run this strategy for.\n       * @param {ExtendableEvent} options.event The event associated with the\n       *     request.\n       * @param {URL} [options.url]\n       * @param {*} [options.params]\n       * @return {Array<Promise>} A tuple of [response, done]\n       *     promises that can be used to determine when the response resolves as\n       *     well as when the handler has completed all its work.\n       */\n      handleAll(options) {\n        // Allow for flexible options to be passed.\n        if (options instanceof FetchEvent) {\n          options = {\n            event: options,\n            request: options.request\n          };\n        }\n        const event = options.event;\n        const request = typeof options.request === 'string' ? new Request(options.request) : options.request;\n        const params = 'params' in options ? options.params : undefined;\n        const handler = new StrategyHandler(this, {\n          event,\n          request,\n          params\n        });\n        const responseDone = this._getResponse(handler, request, event);\n        const handlerDone = this._awaitComplete(responseDone, handler, request, event);\n        // Return an array of promises, suitable for use with Promise.all().\n        return [responseDone, handlerDone];\n      }\n      async _getResponse(handler, request, event) {\n        await handler.runCallbacks('handlerWillStart', {\n          event,\n          request\n        });\n        let response = undefined;\n        try {\n          response = await this._handle(request, handler);\n          // The \"official\" Strategy subclasses all throw this error automatically,\n          // but in case a third-party Strategy doesn't, ensure that we have a\n          // consistent failure when there's no response or an error response.\n          if (!response || response.type === 'error') {\n            throw new WorkboxError('no-response', {\n              url: request.url\n            });\n          }\n        } catch (error) {\n          if (error instanceof Error) {\n            for (const callback of handler.iterateCallbacks('handlerDidError')) {\n              response = await callback({\n                error,\n                event,\n                request\n              });\n              if (response) {\n                break;\n              }\n            }\n          }\n          if (!response) {\n            throw error;\n          } else {\n            logger.log(`While responding to '${getFriendlyURL(request.url)}', ` + `an ${error instanceof Error ? error.toString() : ''} error occurred. Using a fallback response provided by ` + `a handlerDidError plugin.`);\n          }\n        }\n        for (const callback of handler.iterateCallbacks('handlerWillRespond')) {\n          response = await callback({\n            event,\n            request,\n            response\n          });\n        }\n        return response;\n      }\n      async _awaitComplete(responseDone, handler, request, event) {\n        let response;\n        let error;\n        try {\n          response = await responseDone;\n        } catch (error) {\n          // Ignore errors, as response errors should be caught via the `response`\n          // promise above. The `done` promise will only throw for errors in\n          // promises passed to `handler.waitUntil()`.\n        }\n        try {\n          await handler.runCallbacks('handlerDidRespond', {\n            event,\n            request,\n            response\n          });\n          await handler.doneWaiting();\n        } catch (waitUntilError) {\n          if (waitUntilError instanceof Error) {\n            error = waitUntilError;\n          }\n        }\n        await handler.runCallbacks('handlerDidComplete', {\n          event,\n          request,\n          response,\n          error: error\n        });\n        handler.destroy();\n        if (error) {\n          throw error;\n        }\n      }\n    }\n    /**\n     * Classes extending the `Strategy` based class should implement this method,\n     * and leverage the {@link workbox-strategies.StrategyHandler}\n     * arg to perform all fetching and cache logic, which will ensure all relevant\n     * cache, cache options, fetch options and plugins are used (per the current\n     * strategy instance).\n     *\n     * @name _handle\n     * @instance\n     * @abstract\n     * @function\n     * @param {Request} request\n     * @param {workbox-strategies.StrategyHandler} handler\n     * @return {Promise<Response>}\n     *\n     * @memberof workbox-strategies.Strategy\n     */\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A {@link workbox-strategies.Strategy} implementation\n     * specifically designed to work with\n     * {@link workbox-precaching.PrecacheController}\n     * to both cache and fetch precached assets.\n     *\n     * Note: an instance of this class is created automatically when creating a\n     * `PrecacheController`; it's generally not necessary to create this yourself.\n     *\n     * @extends workbox-strategies.Strategy\n     * @memberof workbox-precaching\n     */\n    class PrecacheStrategy extends Strategy {\n      /**\n       *\n       * @param {Object} [options]\n       * @param {string} [options.cacheName] Cache name to store and retrieve\n       * requests. Defaults to the cache names provided by\n       * {@link workbox-core.cacheNames}.\n       * @param {Array<Object>} [options.plugins] {@link https://developers.google.com/web/tools/workbox/guides/using-plugins|Plugins}\n       * to use in conjunction with this caching strategy.\n       * @param {Object} [options.fetchOptions] Values passed along to the\n       * {@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters|init}\n       * of all fetch() requests made by this strategy.\n       * @param {Object} [options.matchOptions] The\n       * {@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions|CacheQueryOptions}\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\n       * get the response from the network if there's a precache miss.\n       */\n      constructor(options = {}) {\n        options.cacheName = cacheNames.getPrecacheName(options.cacheName);\n        super(options);\n        this._fallbackToNetwork = options.fallbackToNetwork === false ? false : true;\n        // Redirected responses cannot be used to satisfy a navigation request, so\n        // any redirected response must be \"copied\" rather than cloned, so the new\n        // response doesn't contain the `redirected` flag. See:\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=669363&desc=2#c1\n        this.plugins.push(PrecacheStrategy.copyRedirectedCacheableResponsesPlugin);\n      }\n      /**\n       * @private\n       * @param {Request|string} request A request to run this strategy for.\n       * @param {workbox-strategies.StrategyHandler} handler The event that\n       *     triggered the request.\n       * @return {Promise<Response>}\n       */\n      async _handle(request, handler) {\n        const response = await handler.cacheMatch(request);\n        if (response) {\n          return response;\n        }\n        // If this is an `install` event for an entry that isn't already cached,\n        // then populate the cache.\n        if (handler.event && handler.event.type === 'install') {\n          return await this._handleInstall(request, handler);\n        }\n        // Getting here means something went wrong. An entry that should have been\n        // precached wasn't found in the cache.\n        return await this._handleFetch(request, handler);\n      }\n      async _handleFetch(request, handler) {\n        let response;\n        const params = handler.params || {};\n        // Fall back to the network if we're configured to do so.\n        if (this._fallbackToNetwork) {\n          {\n            logger.warn(`The precached response for ` + `${getFriendlyURL(request.url)} in ${this.cacheName} was not ` + `found. Falling back to the network.`);\n          }\n          const integrityInManifest = params.integrity;\n          const integrityInRequest = request.integrity;\n          const noIntegrityConflict = !integrityInRequest || integrityInRequest === integrityInManifest;\n          // Do not add integrity if the original request is no-cors\n          // See https://github.com/GoogleChrome/workbox/issues/3096\n          response = await handler.fetch(new Request(request, {\n            integrity: request.mode !== 'no-cors' ? integrityInRequest || integrityInManifest : undefined\n          }));\n          // It's only \"safe\" to repair the cache if we're using SRI to guarantee\n          // that the response matches the precache manifest's expectations,\n          // and there's either a) no integrity property in the incoming request\n          // or b) there is an integrity, and it matches the precache manifest.\n          // See https://github.com/GoogleChrome/workbox/issues/2858\n          // Also if the original request users no-cors we don't use integrity.\n          // See https://github.com/GoogleChrome/workbox/issues/3096\n          if (integrityInManifest && noIntegrityConflict && request.mode !== 'no-cors') {\n            this._useDefaultCacheabilityPluginIfNeeded();\n            const wasCached = await handler.cachePut(request, response.clone());\n            {\n              if (wasCached) {\n                logger.log(`A response for ${getFriendlyURL(request.url)} ` + `was used to \"repair\" the precache.`);\n              }\n            }\n          }\n        } else {\n          // This shouldn't normally happen, but there are edge cases:\n          // https://github.com/GoogleChrome/workbox/issues/1441\n          throw new WorkboxError('missing-precache-entry', {\n            cacheName: this.cacheName,\n            url: request.url\n          });\n        }\n        {\n          const cacheKey = params.cacheKey || (await handler.getCacheKey(request, 'read'));\n          // Workbox is going to handle the route.\n          // print the routing details to the console.\n          logger.groupCollapsed(`Precaching is responding to: ` + getFriendlyURL(request.url));\n          logger.log(`Serving the precached url: ${getFriendlyURL(cacheKey instanceof Request ? cacheKey.url : cacheKey)}`);\n          logger.groupCollapsed(`View request details here.`);\n          logger.log(request);\n          logger.groupEnd();\n          logger.groupCollapsed(`View response details here.`);\n          logger.log(response);\n          logger.groupEnd();\n          logger.groupEnd();\n        }\n        return response;\n      }\n      async _handleInstall(request, handler) {\n        this._useDefaultCacheabilityPluginIfNeeded();\n        const response = await handler.fetch(request);\n        // Make sure we defer cachePut() until after we know the response\n        // should be cached; see https://github.com/GoogleChrome/workbox/issues/2737\n        const wasCached = await handler.cachePut(request, response.clone());\n        if (!wasCached) {\n          // Throwing here will lead to the `install` handler failing, which\n          // we want to do if *any* of the responses aren't safe to cache.\n          throw new WorkboxError('bad-precaching-response', {\n            url: request.url,\n            status: response.status\n          });\n        }\n        return response;\n      }\n      /**\n       * This method is complex, as there a number of things to account for:\n       *\n       * The `plugins` array can be set at construction, and/or it might be added to\n       * to at any time before the strategy is used.\n       *\n       * At the time the strategy is used (i.e. during an `install` event), there\n       * needs to be at least one plugin that implements `cacheWillUpdate` in the\n       * array, other than `copyRedirectedCacheableResponsesPlugin`.\n       *\n       * - If this method is called and there are no suitable `cacheWillUpdate`\n       * plugins, we need to add `defaultPrecacheCacheabilityPlugin`.\n       *\n       * - If this method is called and there is exactly one `cacheWillUpdate`, then\n       * we don't have to do anything (this might be a previously added\n       * `defaultPrecacheCacheabilityPlugin`, or it might be a custom plugin).\n       *\n       * - If this method is called and there is more than one `cacheWillUpdate`,\n       * then we need to check if one is `defaultPrecacheCacheabilityPlugin`. If so,\n       * we need to remove it. (This situation is unlikely, but it could happen if\n       * the strategy is used multiple times, the first without a `cacheWillUpdate`,\n       * and then later on after manually adding a custom `cacheWillUpdate`.)\n       *\n       * See https://github.com/GoogleChrome/workbox/issues/2737 for more context.\n       *\n       * @private\n       */\n      _useDefaultCacheabilityPluginIfNeeded() {\n        let defaultPluginIndex = null;\n        let cacheWillUpdatePluginCount = 0;\n        for (const [index, plugin] of this.plugins.entries()) {\n          // Ignore the copy redirected plugin when determining what to do.\n          if (plugin === PrecacheStrategy.copyRedirectedCacheableResponsesPlugin) {\n            continue;\n          }\n          // Save the default plugin's index, in case it needs to be removed.\n          if (plugin === PrecacheStrategy.defaultPrecacheCacheabilityPlugin) {\n            defaultPluginIndex = index;\n          }\n          if (plugin.cacheWillUpdate) {\n            cacheWillUpdatePluginCount++;\n          }\n        }\n        if (cacheWillUpdatePluginCount === 0) {\n          this.plugins.push(PrecacheStrategy.defaultPrecacheCacheabilityPlugin);\n        } else if (cacheWillUpdatePluginCount > 1 && defaultPluginIndex !== null) {\n          // Only remove the default plugin; multiple custom plugins are allowed.\n          this.plugins.splice(defaultPluginIndex, 1);\n        }\n        // Nothing needs to be done if cacheWillUpdatePluginCount is 1\n      }\n    }\n    PrecacheStrategy.defaultPrecacheCacheabilityPlugin = {\n      async cacheWillUpdate({\n        response\n      }) {\n        if (!response || response.status >= 400) {\n          return null;\n        }\n        return response;\n      }\n    };\n    PrecacheStrategy.copyRedirectedCacheableResponsesPlugin = {\n      async cacheWillUpdate({\n        response\n      }) {\n        return response.redirected ? await copyResponse(response) : response;\n      }\n    };\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Performs efficient precaching of assets.\n     *\n     * @memberof workbox-precaching\n     */\n    class PrecacheController {\n      /**\n       * Create a new PrecacheController.\n       *\n       * @param {Object} [options]\n       * @param {string} [options.cacheName] The cache to use for precaching.\n       * @param {string} [options.plugins] Plugins to use when precaching as well\n       * as responding to fetch events for precached assets.\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\n       * get the response from the network if there's a precache miss.\n       */\n      constructor({\n        cacheName,\n        plugins = [],\n        fallbackToNetwork = true\n      } = {}) {\n        this._urlsToCacheKeys = new Map();\n        this._urlsToCacheModes = new Map();\n        this._cacheKeysToIntegrities = new Map();\n        this._strategy = new PrecacheStrategy({\n          cacheName: cacheNames.getPrecacheName(cacheName),\n          plugins: [...plugins, new PrecacheCacheKeyPlugin({\n            precacheController: this\n          })],\n          fallbackToNetwork\n        });\n        // Bind the install and activate methods to the instance.\n        this.install = this.install.bind(this);\n        this.activate = this.activate.bind(this);\n      }\n      /**\n       * @type {workbox-precaching.PrecacheStrategy} The strategy created by this controller and\n       * used to cache assets and respond to fetch events.\n       */\n      get strategy() {\n        return this._strategy;\n      }\n      /**\n       * Adds items to the precache list, removing any duplicates and\n       * stores the files in the\n       * {@link workbox-core.cacheNames|\"precache cache\"} when the service\n       * worker installs.\n       *\n       * This method can be called multiple times.\n       *\n       * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\n       */\n      precache(entries) {\n        this.addToCacheList(entries);\n        if (!this._installAndActiveListenersAdded) {\n          self.addEventListener('install', this.install);\n          self.addEventListener('activate', this.activate);\n          this._installAndActiveListenersAdded = true;\n        }\n      }\n      /**\n       * This method will add items to the precache list, removing duplicates\n       * and ensuring the information is valid.\n       *\n       * @param {Array<workbox-precaching.PrecacheController.PrecacheEntry|string>} entries\n       *     Array of entries to precache.\n       */\n      addToCacheList(entries) {\n        {\n          finalAssertExports.isArray(entries, {\n            moduleName: 'workbox-precaching',\n            className: 'PrecacheController',\n            funcName: 'addToCacheList',\n            paramName: 'entries'\n          });\n        }\n        const urlsToWarnAbout = [];\n        for (const entry of entries) {\n          // See https://github.com/GoogleChrome/workbox/issues/2259\n          if (typeof entry === 'string') {\n            urlsToWarnAbout.push(entry);\n          } else if (entry && entry.revision === undefined) {\n            urlsToWarnAbout.push(entry.url);\n          }\n          const {\n            cacheKey,\n            url\n          } = createCacheKey(entry);\n          const cacheMode = typeof entry !== 'string' && entry.revision ? 'reload' : 'default';\n          if (this._urlsToCacheKeys.has(url) && this._urlsToCacheKeys.get(url) !== cacheKey) {\n            throw new WorkboxError('add-to-cache-list-conflicting-entries', {\n              firstEntry: this._urlsToCacheKeys.get(url),\n              secondEntry: cacheKey\n            });\n          }\n          if (typeof entry !== 'string' && entry.integrity) {\n            if (this._cacheKeysToIntegrities.has(cacheKey) && this._cacheKeysToIntegrities.get(cacheKey) !== entry.integrity) {\n              throw new WorkboxError('add-to-cache-list-conflicting-integrities', {\n                url\n              });\n            }\n            this._cacheKeysToIntegrities.set(cacheKey, entry.integrity);\n          }\n          this._urlsToCacheKeys.set(url, cacheKey);\n          this._urlsToCacheModes.set(url, cacheMode);\n          if (urlsToWarnAbout.length > 0) {\n            const warningMessage = `Workbox is precaching URLs without revision ` + `info: ${urlsToWarnAbout.join(', ')}\\nThis is generally NOT safe. ` + `Learn more at https://bit.ly/wb-precache`;\n            {\n              logger.warn(warningMessage);\n            }\n          }\n        }\n      }\n      /**\n       * Precaches new and updated assets. Call this method from the service worker\n       * install event.\n       *\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\n       * to call it yourself in your event handlers.\n       *\n       * @param {ExtendableEvent} event\n       * @return {Promise<workbox-precaching.InstallResult>}\n       */\n      install(event) {\n        // waitUntil returns Promise<any>\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return waitUntil(event, async () => {\n          const installReportPlugin = new PrecacheInstallReportPlugin();\n          this.strategy.plugins.push(installReportPlugin);\n          // Cache entries one at a time.\n          // See https://github.com/GoogleChrome/workbox/issues/2528\n          for (const [url, cacheKey] of this._urlsToCacheKeys) {\n            const integrity = this._cacheKeysToIntegrities.get(cacheKey);\n            const cacheMode = this._urlsToCacheModes.get(url);\n            const request = new Request(url, {\n              integrity,\n              cache: cacheMode,\n              credentials: 'same-origin'\n            });\n            await Promise.all(this.strategy.handleAll({\n              params: {\n                cacheKey\n              },\n              request,\n              event\n            }));\n          }\n          const {\n            updatedURLs,\n            notUpdatedURLs\n          } = installReportPlugin;\n          {\n            printInstallDetails(updatedURLs, notUpdatedURLs);\n          }\n          return {\n            updatedURLs,\n            notUpdatedURLs\n          };\n        });\n      }\n      /**\n       * Deletes assets that are no longer present in the current precache manifest.\n       * Call this method from the service worker activate event.\n       *\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\n       * to call it yourself in your event handlers.\n       *\n       * @param {ExtendableEvent} event\n       * @return {Promise<workbox-precaching.CleanupResult>}\n       */\n      activate(event) {\n        // waitUntil returns Promise<any>\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return waitUntil(event, async () => {\n          const cache = await self.caches.open(this.strategy.cacheName);\n          const currentlyCachedRequests = await cache.keys();\n          const expectedCacheKeys = new Set(this._urlsToCacheKeys.values());\n          const deletedURLs = [];\n          for (const request of currentlyCachedRequests) {\n            if (!expectedCacheKeys.has(request.url)) {\n              await cache.delete(request);\n              deletedURLs.push(request.url);\n            }\n          }\n          {\n            printCleanupDetails(deletedURLs);\n          }\n          return {\n            deletedURLs\n          };\n        });\n      }\n      /**\n       * Returns a mapping of a precached URL to the corresponding cache key, taking\n       * into account the revision information for the URL.\n       *\n       * @return {Map<string, string>} A URL to cache key mapping.\n       */\n      getURLsToCacheKeys() {\n        return this._urlsToCacheKeys;\n      }\n      /**\n       * Returns a list of all the URLs that have been precached by the current\n       * service worker.\n       *\n       * @return {Array<string>} The precached URLs.\n       */\n      getCachedURLs() {\n        return [...this._urlsToCacheKeys.keys()];\n      }\n      /**\n       * Returns the cache key used for storing a given URL. If that URL is\n       * unversioned, like `/index.html', then the cache key will be the original\n       * URL with a search parameter appended to it.\n       *\n       * @param {string} url A URL whose cache key you want to look up.\n       * @return {string} The versioned URL that corresponds to a cache key\n       * for the original URL, or undefined if that URL isn't precached.\n       */\n      getCacheKeyForURL(url) {\n        const urlObject = new URL(url, location.href);\n        return this._urlsToCacheKeys.get(urlObject.href);\n      }\n      /**\n       * @param {string} url A cache key whose SRI you want to look up.\n       * @return {string} The subresource integrity associated with the cache key,\n       * or undefined if it's not set.\n       */\n      getIntegrityForCacheKey(cacheKey) {\n        return this._cacheKeysToIntegrities.get(cacheKey);\n      }\n      /**\n       * This acts as a drop-in replacement for\n       * [`cache.match()`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/match)\n       * with the subscribed differences:\n       *\n       * - It knows what the name of the precache is, and only checks in that cache.\n       * - It allows you to pass in an \"original\" URL without versioning parameters,\n       * and it will automatically look up the correct cache key for the currently\n       * active revision of that URL.\n       *\n       * E.g., `matchPrecache('index.html')` will find the correct precached\n       * response for the currently active service worker, even if the actual cache\n       * key is `'/index.html?__WB_REVISION__=1234abcd'`.\n       *\n       * @param {string|Request} request The key (without revisioning parameters)\n       * to look up in the precache.\n       * @return {Promise<Response|undefined>}\n       */\n      async matchPrecache(request) {\n        const url = request instanceof Request ? request.url : request;\n        const cacheKey = this.getCacheKeyForURL(url);\n        if (cacheKey) {\n          const cache = await self.caches.open(this.strategy.cacheName);\n          return cache.match(cacheKey);\n        }\n        return undefined;\n      }\n      /**\n       * Returns a function that looks up `url` in the precache (taking into\n       * account revision information), and returns the corresponding `Response`.\n       *\n       * @param {string} url The precached URL which will be used to lookup the\n       * `Response`.\n       * @return {workbox-routing~handlerCallback}\n       */\n      createHandlerBoundToURL(url) {\n        const cacheKey = this.getCacheKeyForURL(url);\n        if (!cacheKey) {\n          throw new WorkboxError('non-precached-url', {\n            url\n          });\n        }\n        return options => {\n          options.request = new Request(url);\n          options.params = Object.assign({\n            cacheKey\n          }, options.params);\n          return this.strategy.handle(options);\n        };\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    let precacheController;\n    /**\n     * @return {PrecacheController}\n     * @private\n     */\n    const getOrCreatePrecacheController = () => {\n      if (!precacheController) {\n        precacheController = new PrecacheController();\n      }\n      return precacheController;\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Removes any URL search parameters that should be ignored.\n     *\n     * @param {URL} urlObject The original URL.\n     * @param {Array<RegExp>} ignoreURLParametersMatching RegExps to test against\n     * each search parameter name. Matches mean that the search parameter should be\n     * ignored.\n     * @return {URL} The URL with any ignored search parameters removed.\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching = []) {\n      // Convert the iterable into an array at the start of the loop to make sure\n      // deletion doesn't mess up iteration.\n      for (const paramName of [...urlObject.searchParams.keys()]) {\n        if (ignoreURLParametersMatching.some(regExp => regExp.test(paramName))) {\n          urlObject.searchParams.delete(paramName);\n        }\n      }\n      return urlObject;\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Generator function that yields possible variations on the original URL to\n     * check, one at a time.\n     *\n     * @param {string} url\n     * @param {Object} options\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function* generateURLVariations(url, {\n      ignoreURLParametersMatching = [/^utm_/, /^fbclid$/],\n      directoryIndex = 'index.html',\n      cleanURLs = true,\n      urlManipulation\n    } = {}) {\n      const urlObject = new URL(url, location.href);\n      urlObject.hash = '';\n      yield urlObject.href;\n      const urlWithoutIgnoredParams = removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching);\n      yield urlWithoutIgnoredParams.href;\n      if (directoryIndex && urlWithoutIgnoredParams.pathname.endsWith('/')) {\n        const directoryURL = new URL(urlWithoutIgnoredParams.href);\n        directoryURL.pathname += directoryIndex;\n        yield directoryURL.href;\n      }\n      if (cleanURLs) {\n        const cleanURL = new URL(urlWithoutIgnoredParams.href);\n        cleanURL.pathname += '.html';\n        yield cleanURL.href;\n      }\n      if (urlManipulation) {\n        const additionalURLs = urlManipulation({\n          url: urlObject\n        });\n        for (const urlToAttempt of additionalURLs) {\n          yield urlToAttempt.href;\n        }\n      }\n    }\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A subclass of {@link workbox-routing.Route} that takes a\n     * {@link workbox-precaching.PrecacheController}\n     * instance and uses it to match incoming requests and handle fetching\n     * responses from the precache.\n     *\n     * @memberof workbox-precaching\n     * @extends workbox-routing.Route\n     */\n    class PrecacheRoute extends Route {\n      /**\n       * @param {PrecacheController} precacheController A `PrecacheController`\n       * instance used to both match requests and respond to fetch events.\n       * @param {Object} [options] Options to control how requests are matched\n       * against the list of precached URLs.\n       * @param {string} [options.directoryIndex=index.html] The `directoryIndex` will\n       * check cache entries for a URLs ending with '/' to see if there is a hit when\n       * appending the `directoryIndex` value.\n       * @param {Array<RegExp>} [options.ignoreURLParametersMatching=[/^utm_/, /^fbclid$/]] An\n       * array of regex's to remove search params when looking for a cache match.\n       * @param {boolean} [options.cleanURLs=true] The `cleanURLs` option will\n       * check the cache for the URL with a `.html` added to the end of the end.\n       * @param {workbox-precaching~urlManipulation} [options.urlManipulation]\n       * This is a function that should take a URL and return an array of\n       * alternative URLs that should be checked for precache matches.\n       */\n      constructor(precacheController, options) {\n        const match = ({\n          request\n        }) => {\n          const urlsToCacheKeys = precacheController.getURLsToCacheKeys();\n          for (const possibleURL of generateURLVariations(request.url, options)) {\n            const cacheKey = urlsToCacheKeys.get(possibleURL);\n            if (cacheKey) {\n              const integrity = precacheController.getIntegrityForCacheKey(cacheKey);\n              return {\n                cacheKey,\n                integrity\n              };\n            }\n          }\n          {\n            logger.debug(`Precaching did not find a match for ` + getFriendlyURL(request.url));\n          }\n          return;\n        };\n        super(match, precacheController.strategy);\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Add a `fetch` listener to the service worker that will\n     * respond to\n     * [network requests]{@link https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers#Custom_responses_to_requests}\n     * with precached assets.\n     *\n     * Requests for assets that aren't precached, the `FetchEvent` will not be\n     * responded to, allowing the event to fall through to other `fetch` event\n     * listeners.\n     *\n     * @param {Object} [options] See the {@link workbox-precaching.PrecacheRoute}\n     * options.\n     *\n     * @memberof workbox-precaching\n     */\n    function addRoute(options) {\n      const precacheController = getOrCreatePrecacheController();\n      const precacheRoute = new PrecacheRoute(precacheController, options);\n      registerRoute(precacheRoute);\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Adds items to the precache list, removing any duplicates and\n     * stores the files in the\n     * {@link workbox-core.cacheNames|\"precache cache\"} when the service\n     * worker installs.\n     *\n     * This method can be called multiple times.\n     *\n     * Please note: This method **will not** serve any of the cached files for you.\n     * It only precaches files. To respond to a network request you call\n     * {@link workbox-precaching.addRoute}.\n     *\n     * If you have a single array of files to precache, you can just call\n     * {@link workbox-precaching.precacheAndRoute}.\n     *\n     * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\n     *\n     * @memberof workbox-precaching\n     */\n    function precache(entries) {\n      const precacheController = getOrCreatePrecacheController();\n      precacheController.precache(entries);\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * This method will add entries to the precache list and add a route to\n     * respond to fetch events.\n     *\n     * This is a convenience method that will call\n     * {@link workbox-precaching.precache} and\n     * {@link workbox-precaching.addRoute} in a single call.\n     *\n     * @param {Array<Object|string>} entries Array of entries to precache.\n     * @param {Object} [options] See the\n     * {@link workbox-precaching.PrecacheRoute} options.\n     *\n     * @memberof workbox-precaching\n     */\n    function precacheAndRoute(entries, options) {\n      precache(entries);\n      addRoute(options);\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const SUBSTRING_TO_FIND = '-precache-';\n    /**\n     * Cleans up incompatible precaches that were created by older versions of\n     * Workbox, by a service worker registered under the current scope.\n     *\n     * This is meant to be called as part of the `activate` event.\n     *\n     * This should be safe to use as long as you don't include `substringToFind`\n     * (defaulting to `-precache-`) in your non-precache cache names.\n     *\n     * @param {string} currentPrecacheName The cache name currently in use for\n     * precaching. This cache won't be deleted.\n     * @param {string} [substringToFind='-precache-'] Cache names which include this\n     * substring will be deleted (excluding `currentPrecacheName`).\n     * @return {Array<string>} A list of all the cache names that were deleted.\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    const deleteOutdatedCaches = async (currentPrecacheName, substringToFind = SUBSTRING_TO_FIND) => {\n      const cacheNames = await self.caches.keys();\n      const cacheNamesToDelete = cacheNames.filter(cacheName => {\n        return cacheName.includes(substringToFind) && cacheName.includes(self.registration.scope) && cacheName !== currentPrecacheName;\n      });\n      await Promise.all(cacheNamesToDelete.map(cacheName => self.caches.delete(cacheName)));\n      return cacheNamesToDelete;\n    };\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Adds an `activate` event listener which will clean up incompatible\n     * precaches that were created by older versions of Workbox.\n     *\n     * @memberof workbox-precaching\n     */\n    function cleanupOutdatedCaches() {\n      // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\n      self.addEventListener('activate', event => {\n        const cacheName = cacheNames.getPrecacheName();\n        event.waitUntil(deleteOutdatedCaches(cacheName).then(cachesDeleted => {\n          {\n            if (cachesDeleted.length > 0) {\n              logger.log(`The subscribed out-of-date precaches were cleaned up ` + `automatically:`, cachesDeleted);\n            }\n          }\n        }));\n      });\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * NavigationRoute makes it easy to create a\n     * {@link workbox-routing.Route} that matches for browser\n     * [navigation requests]{@link https://developers.google.com/web/fundamentals/primers/service-workers/high-performance-loading#first_what_are_navigation_requests}.\n     *\n     * It will only match incoming Requests whose\n     * {@link https://fetch.spec.whatwg.org/#concept-request-mode|mode}\n     * is set to `navigate`.\n     *\n     * You can optionally only apply this route to a subset of navigation requests\n     * by using one or both of the `denylist` and `allowlist` parameters.\n     *\n     * @memberof workbox-routing\n     * @extends workbox-routing.Route\n     */\n    class NavigationRoute extends Route {\n      /**\n       * If both `denylist` and `allowlist` are provided, the `denylist` will\n       * take precedence and the request will not match this route.\n       *\n       * The regular expressions in `allowlist` and `denylist`\n       * are matched against the concatenated\n       * [`pathname`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/pathname}\n       * and [`search`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/search}\n       * portions of the requested URL.\n       *\n       * *Note*: These RegExps may be evaluated against every destination URL during\n       * a navigation. Avoid using\n       * [complex RegExps](https://github.com/GoogleChrome/workbox/issues/3077),\n       * or else your users may see delays when navigating your site.\n       *\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resulting in a Response.\n       * @param {Object} options\n       * @param {Array<RegExp>} [options.denylist] If any of these patterns match,\n       * the route will not handle the request (even if a allowlist RegExp matches).\n       * @param {Array<RegExp>} [options.allowlist=[/./]] If any of these patterns\n       * match the URL's pathname and search parameter, the route will handle the\n       * request (assuming the denylist doesn't match).\n       */\n      constructor(handler, {\n        allowlist = [/./],\n        denylist = []\n      } = {}) {\n        {\n          finalAssertExports.isArrayOfClass(allowlist, RegExp, {\n            moduleName: 'workbox-routing',\n            className: 'NavigationRoute',\n            funcName: 'constructor',\n            paramName: 'options.allowlist'\n          });\n          finalAssertExports.isArrayOfClass(denylist, RegExp, {\n            moduleName: 'workbox-routing',\n            className: 'NavigationRoute',\n            funcName: 'constructor',\n            paramName: 'options.denylist'\n          });\n        }\n        super(options => this._match(options), handler);\n        this._allowlist = allowlist;\n        this._denylist = denylist;\n      }\n      /**\n       * Routes match handler.\n       *\n       * @param {Object} options\n       * @param {URL} options.url\n       * @param {Request} options.request\n       * @return {boolean}\n       *\n       * @private\n       */\n      _match({\n        url,\n        request\n      }) {\n        if (request && request.mode !== 'navigate') {\n          return false;\n        }\n        const pathnameAndSearch = url.pathname + url.search;\n        for (const regExp of this._denylist) {\n          if (regExp.test(pathnameAndSearch)) {\n            {\n              logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL matches this denylist pattern: ` + `${regExp.toString()}`);\n            }\n            return false;\n          }\n        }\n        if (this._allowlist.some(regExp => regExp.test(pathnameAndSearch))) {\n          {\n            logger.debug(`The navigation route ${pathnameAndSearch} ` + `is being used.`);\n          }\n          return true;\n        }\n        {\n          logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL being navigated to doesn't ` + `match the allowlist.`);\n        }\n        return false;\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Helper function that calls\n     * {@link PrecacheController#createHandlerBoundToURL} on the default\n     * {@link PrecacheController} instance.\n     *\n     * If you are creating your own {@link PrecacheController}, then call the\n     * {@link PrecacheController#createHandlerBoundToURL} on that instance,\n     * instead of using this function.\n     *\n     * @param {string} url The precached URL which will be used to lookup the\n     * `Response`.\n     * @param {boolean} [fallbackToNetwork=true] Whether to attempt to get the\n     * response from the network if there's a precache miss.\n     * @return {workbox-routing~handlerCallback}\n     *\n     * @memberof workbox-precaching\n     */\n    function createHandlerBoundToURL(url) {\n      const precacheController = getOrCreatePrecacheController();\n      return precacheController.createHandlerBoundToURL(url);\n    }\n\n    exports.NavigationRoute = NavigationRoute;\n    exports.cleanupOutdatedCaches = cleanupOutdatedCaches;\n    exports.clientsClaim = clientsClaim;\n    exports.createHandlerBoundToURL = createHandlerBoundToURL;\n    exports.precacheAndRoute = precacheAndRoute;\n    exports.registerRoute = registerRoute;\n\n}));\n","size_bytes":129260},"backend/scripts/checkUsers.js":{"content":"import mongoose from 'mongoose';\nimport User from '../models/User.js';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nconst checkUsers = async () => {\n  try {\n    await mongoose.connect(process.env.MONGO_URI);\n    console.log('âœ… MongoDB Connected');\n\n    const users = await User.find({}).limit(5);\n    \n    console.log('\\nğŸ“‹ Current Users:');\n    users.forEach(user => {\n      console.log(`\\nğŸ‘¤ ${user.username}`);\n      console.log(`   Avatar: ${user.avatar}`);\n      console.log(`   Cover: ${user.coverImage || 'Not set'}`);\n    });\n    \n    process.exit(0);\n  } catch (error) {\n    console.error('âŒ Error:', error);\n    process.exit(1);\n  }\n};\n\ncheckUsers();\n","size_bytes":672},"frontend/src/pages/Explore.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport axios from 'axios';\nimport { AiOutlineFire, AiOutlineSearch } from 'react-icons/ai';\nimport { BsHash } from 'react-icons/bs';\n\nconst Explore = () => {\n  const navigate = useNavigate();\n  const [explorePosts, setExplorePosts] = useState([]);\n  const [trendingTags, setTrendingTags] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [activeTab, setActiveTab] = useState('posts'); // posts, tags\n  const [categoryFilter, setCategoryFilter] = useState('all'); // all, images, shorts, long\n\n  useEffect(() => {\n    fetchExploreData();\n  }, []);\n\n  const fetchExploreData = async () => {\n    try {\n      const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n      const [postsRes, tagsRes] = await Promise.all([\n        axios.get(`${API_URL}/explore/posts`),\n        axios.get(`${API_URL}/explore/hashtags`),\n      ]);\n      \n      setExplorePosts(postsRes.data.data);\n      setTrendingTags(tagsRes.data.data);\n    } catch (error) {\n      console.error('Failed to load explore data:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-amber-50 dark:from-dark-bg dark:via-dark-bg dark:to-dark-bg pb-20 md:pb-8\">\n      <div className=\"max-w-6xl mx-auto px-4 py-8\">\n        {/* Header with Gradient */}\n        <div className=\"bg-gradient-primary text-white rounded-3xl p-8 mb-8 shadow-glow\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-4xl font-bold mb-2 flex items-center\">\n                <AiOutlineFire className=\"mr-3\" />\n                Explore\n              </h1>\n              <p className=\"text-purple-100\">Discover trending content & people</p>\n            </div>\n            <div className=\"hidden md:block\">\n              <div className=\"bg-white/20 backdrop-blur-lg rounded-full px-6 py-3 text-2xl font-bold\">\n                ğŸ”¥ Trending\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"flex space-x-4 mb-8\">\n          <button\n            onClick={() => setActiveTab('posts')}\n            className={`flex-1 py-3 rounded-2xl font-semibold transition-all ${\n              activeTab === 'posts'\n                ? 'bg-gradient-primary text-white shadow-glow'\n                : 'bg-white dark:bg-dark-card text-gray-700 dark:text-gray-300'\n            }`}\n          >\n            ğŸ“¸ Posts\n          </button>\n          <button\n            onClick={() => setActiveTab('tags')}\n            className={`flex-1 py-3 rounded-2xl font-semibold transition-all ${\n              activeTab === 'tags'\n                ? 'bg-gradient-primary text-white shadow-glow'\n                : 'bg-white dark:bg-dark-card text-gray-700 dark:text-gray-300'\n            }`}\n          >\n            #ï¸âƒ£ Hashtags\n          </button>\n        </div>\n\n        {/* Content */}\n        {activeTab === 'posts' ? (\n          // Posts Grid\n          <>\n            {/* Trending Reels Shelf */}\n            <div className=\"mb-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <h3 className=\"font-semibold\">Trending Reels</h3>\n              </div>\n              <div className=\"flex gap-3 overflow-x-auto pb-2\">\n                {explorePosts.filter(p => p.category==='short').slice(0,12).map((p) => (\n                  <div key={p._id} className=\"relative min-w-[180px] h-96 rounded-2xl overflow-hidden bg-black cursor-pointer\" onClick={() => navigate('/reels')}>\n                    <video src={p.media?.[0]?.url || p.mediaUrl} className=\"w-full h-full object-cover\" muted playsInline />\n                    <div className=\"absolute bottom-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded-full\">\n                      {typeof p.durationSec==='number' ? `${Math.floor(p.durationSec/60)}:${String(p.durationSec%60).padStart(2,'0')}` : 'Short'}\n                    </div>\n                  </div>\n                ))}\n                {explorePosts.filter(p => p.category==='short').length === 0 && (\n                  <div className=\"text-sm text-gray-500\">No trending reels yet.</div>\n                )}\n              </div>\n            </div>\n\n            {/* Category Filter */}\n            <div className=\"flex gap-2 mb-4\">\n              <button className={`btn-outline ${categoryFilter==='all'?'ring-2 ring-primary':''}`} onClick={() => setCategoryFilter('all')}>All</button>\n              <button className={`btn-outline ${categoryFilter==='images'?'ring-2 ring-primary':''}`} onClick={() => setCategoryFilter('images')}>Images</button>\n              <button className={`btn-outline ${categoryFilter==='shorts'?'ring-2 ring-primary':''}`} onClick={() => setCategoryFilter('shorts')}>Shorts</button>\n              <button className={`btn-outline ${categoryFilter==='long'?'ring-2 ring-primary':''}`} onClick={() => setCategoryFilter('long')}>Long</button>\n            </div>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n            {explorePosts.filter(p => {\n              if (categoryFilter==='all') return true;\n              const cat = p.category;\n              const primaryType = (p.media?.[0]?.type) || p.mediaType;\n              if (categoryFilter==='images') return cat ? cat==='image' : primaryType==='image';\n              if (categoryFilter==='shorts') return cat==='short';\n              if (categoryFilter==='long') return cat==='long';\n              return true;\n            }).map((post) => (\n              <div\n                key={post._id}\n                onClick={() => navigate(`/post/${post._id}`)}\n                className=\"group relative aspect-square cursor-pointer rounded-3xl overflow-hidden shadow-lg hover:shadow-glow transition-all duration-300 hover:scale-105\"\n              >\n                <img\n                  src={post.media?.[0]?.url || post.mediaUrl}\n                  alt=\"Post\"\n                  className=\"w-full h-full object-cover\"\n                />\n                \n                {/* Gradient Overlay */}\n                <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/0 to-black/0 opacity-0 group-hover:opacity-100 transition-opacity\">\n                  <div className=\"absolute bottom-0 left-0 right-0 p-4 text-white\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center space-x-3\">\n                        <span className=\"flex items-center\">\n                          â¤ï¸ {post.likes.length}\n                        </span>\n                        <span className=\"flex items-center\">\n                          ğŸ’¬ {post.comments.length}\n                        </span>\n                      </div>\n                      <div className=\"text-xs bg-white/20 backdrop-blur-sm px-2 py-1 rounded-full\">\n                        ğŸ”¥ {post.engagementScore}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Category Badge */}\n                {post.category && (\n                  <div className=\"absolute top-3 left-3 bg-black/70 text-white px-3 py-1 rounded-full text-xs font-semibold\">\n                    {post.category === 'image' ? 'Image' : post.category === 'short' ? `Short ${typeof post.durationSec==='number' ? `${Math.floor(post.durationSec/60)}:${String(post.durationSec%60).padStart(2,'0')}` : ''}` : `Long ${typeof post.durationSec==='number' ? `${Math.floor(post.durationSec/60)}:${String(post.durationSec%60).padStart(2,'0')}` : ''}`}\n                  </div>\n                )}\n\n                {/* Multiple Images Indicator */}\n                {post.media && post.media.length > 1 && (\n                  <div className=\"absolute top-3 right-3 bg-black/70 backdrop-blur-sm text-white px-3 py-1 rounded-full text-xs font-semibold\">\n                    ğŸ“· {post.media.length}\n                  </div>\n                )}\n              </div>\n            ))}\n            </div>\n          </>\n        ) : (\n          // Trending Hashtags\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {trendingTags.map((tagData, index) => (\n              <Link\n                key={tagData.tag}\n                to={`/explore/tags/${tagData.tag}`}\n                className=\"group bg-white dark:bg-dark-card rounded-3xl p-6 shadow-lg hover:shadow-glow-pink transition-all duration-300 hover:scale-105\"\n              >\n                <div className=\"flex items-center justify-between mb-4\">\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"w-12 h-12 bg-gradient-primary rounded-2xl flex items-center justify-center text-2xl\">\n                      {index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ”¥'}\n                    </div>\n                    <div>\n                      <h3 className=\"text-lg font-bold text-gray-800 dark:text-white\">\n                        #{tagData.tag}\n                      </h3>\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                        {tagData.count} posts\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"text-3xl group-hover:scale-110 transition-transform\">\n                    â†’\n                  </div>\n                </div>\n                \n                {/* Trending Indicator */}\n                {index < 3 && (\n                  <div className=\"bg-gradient-primary text-white text-xs px-3 py-1 rounded-full inline-flex items-center\">\n                    <AiOutlineFire className=\"mr-1\" />\n                    Trending\n                  </div>\n                )}\n              </Link>\n            ))}\n          </div>\n        )}\n\n        {loading && (\n          <div className=\"flex justify-center items-center py-20\">\n            <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-purple-500\"></div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Explore;\n","size_bytes":10272},"backend/models/Note.js":{"content":"import mongoose from 'mongoose';\n\nconst noteSchema = new mongoose.Schema(\n  {\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    content: {\n      type: String,\n      required: [true, 'Note content is required'],\n      trim: true,\n      maxlength: [60, 'Note cannot exceed 60 characters'],\n    },\n    emoji: {\n      type: String,\n      default: '',\n    },\n    expiresAt: {\n      type: Date,\n      required: true,\n      default: () => new Date(Date.now() + 24 * 60 * 60 * 1000),\n    },\n    visibility: {\n      type: String,\n      enum: ['subscriber', 'close_friends'],\n      default: 'subscriber',\n    },\n    likes: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    replies: [\n      {\n        user: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'User',\n        },\n        content: String,\n        createdAt: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n  },\n  {\n    timestamps: true,\n  }\n);\n\nnoteSchema.index({ user: 1 });\nnoteSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 });\n\nconst Note = mongoose.model('Note', noteSchema);\n\nexport default Note;\n","size_bytes":1212},"frontend/src/pages/CreatorDashboard.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport premiumAPI from '../services/premiumAPI';\nimport toast from 'react-hot-toast';\nimport {\n  AiOutlineDollar,\n  AiOutlineEye,\n  AiOutlineHeart,\n  AiOutlineClockCircle,\n  AiOutlineRise,\n  AiOutlineTrophy,\n} from 'react-icons/ai';\nimport { Link } from 'react-router-dom';\n\nconst CreatorDashboard = () => {\n  const { user } = useAuth();\n  const [analytics, setAnalytics] = useState(null);\n  const [earnings, setEarnings] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchDashboardData();\n  }, []);\n\n  const fetchDashboardData = async () => {\n    try {\n      const [analyticsRes, earningsRes] = await Promise.all([\n        premiumAPI.getAnalytics(),\n        premiumAPI.getEarnings(),\n      ]);\n      setAnalytics(analyticsRes.data.data);\n      setEarnings(earningsRes.data.data);\n    } catch (error) {\n      toast.error('Failed to load dashboard data');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleEnableMonetization = async () => {\n    try {\n      await premiumAPI.enableMonetization();\n      toast.success('Monetization enabled successfully!');\n      window.location.reload();\n    } catch (error) {\n      toast.error(error.response?.data?.message || 'Failed to enable monetization');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-primary\"></div>\n      </div>\n    );\n  }\n\n  // Monetization not enabled\n  if (!user?.monetizationApproved) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-purple-900 dark:to-gray-900 py-12 px-4\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-xl text-center\">\n            <AiOutlineDollar size={80} className=\"mx-auto text-green-500 mb-6\" />\n            <h1 className=\"text-3xl font-bold mb-4 dark:text-white\">Start Earning from Your Content</h1>\n            <p className=\"text-gray-600 dark:text-gray-400 mb-8 max-w-2xl mx-auto\">\n              Turn your passion into income! Enable monetization to earn from ads, Super Chats, and more.\n            </p>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n              <div className=\"bg-gray-50 dark:bg-gray-700 rounded-xl p-6\">\n                <h3 className=\"font-semibold mb-2 dark:text-white\">Requirements</h3>\n                <ul className=\"text-left text-sm text-gray-600 dark:text-gray-300 space-y-2\">\n                  <li className=\"flex items-center\">\n                    <AiOutlineHeart className=\"mr-2 text-pink-500\" />\n                    1,000+ subscriber\n                  </li>\n                  <li className=\"flex items-center\">\n                    <AiOutlineClockCircle className=\"mr-2 text-blue-500\" />\n                    4,000 minutes watch time\n                  </li>\n                </ul>\n              </div>\n\n              <div className=\"bg-gray-50 dark:bg-gray-700 rounded-xl p-6\">\n                <h3 className=\"font-semibold mb-2 dark:text-white\">Your Progress</h3>\n                <div className=\"text-left text-sm space-y-2\">\n                  <div>\n                    <p className=\"text-gray-600 dark:text-gray-300\">\n                      subscriber: <span className=\"font-bold dark:text-white\">{user?.subscriber?.length || 0}</span> / 1,000\n                    </p>\n                    <div className=\"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2 mt-1\">\n                      <div\n                        className=\"bg-pink-500 h-2 rounded-full\"\n                        style={{ width: `${Math.min((user?.subscriber?.length || 0) / 10, 100)}%` }}\n                      ></div>\n                    </div>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-600 dark:text-gray-300\">\n                      Watch Time: <span className=\"font-bold dark:text-white\">{user?.totalWatchTime || 0}</span> / 4,000 min\n                    </p>\n                    <div className=\"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2 mt-1\">\n                      <div\n                        className=\"bg-blue-500 h-2 rounded-full\"\n                        style={{ width: `${Math.min((user?.totalWatchTime || 0) / 40, 100)}%` }}\n                      ></div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <button\n              onClick={handleEnableMonetization}\n              className=\"btn-primary text-lg px-8 py-3\"\n              disabled={user?.subscriber?.length < 1000 || user?.totalWatchTime < 4000}\n            >\n              Enable Monetization\n            </button>\n\n            {(user?.subscriber?.length < 1000 || user?.totalWatchTime < 4000) && (\n              <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-4\">\n                Keep creating! You'll be eligible once you meet the requirements.\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold dark:text-white mb-2\">Creator Dashboard</h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">Track your earnings and performance</p>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <AiOutlineDollar size={32} className=\"text-green-500\" />\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\">Total</span>\n            </div>\n            <p className=\"text-3xl font-bold dark:text-white mb-1\">\n              ${analytics?.overview?.totalEarnings?.toFixed(2) || '0.00'}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Earnings</p>\n          </div>\n\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <AiOutlineRise size={32} className=\"text-blue-500\" />\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\">Pending</span>\n            </div>\n            <p className=\"text-3xl font-bold dark:text-white mb-1\">\n              ${analytics?.overview?.pendingPayout?.toFixed(2) || '0.00'}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Pending Payout</p>\n          </div>\n\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <AiOutlineHeart size={32} className=\"text-pink-500\" />\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\">Audience</span>\n            </div>\n            <p className=\"text-3xl font-bold dark:text-white mb-1\">\n              {analytics?.overview?.subscribers || 0}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Subscribers</p>\n          </div>\n\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <AiOutlineClockCircle size={32} className=\"text-purple-500\" />\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\">Hours</span>\n            </div>\n            <p className=\"text-3xl font-bold dark:text-white mb-1\">\n              {Math.floor((analytics?.overview?.totalWatchTime || 0) / 60)}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Watch Hours</p>\n          </div>\n        </div>\n\n        {/* Revenue by Source */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\n            <h3 className=\"text-xl font-bold dark:text-white mb-4\">Revenue by Source</h3>\n            <div className=\"space-y-3\">\n              {analytics?.revenueBySource?.map((source) => (\n                <div key={source._id} className=\"flex items-center justify-between\">\n                  <span className=\"text-gray-700 dark:text-gray-300 capitalize\">\n                    {source._id.replace(/_/g, ' ')}\n                  </span>\n                  <span className=\"font-bold dark:text-white\">${source.total.toFixed(2)}</span>\n                </div>\n              ))}\n              {(!analytics?.revenueBySource || analytics.revenueBySource.length === 0) && (\n                <p className=\"text-gray-500 dark:text-gray-400 text-center py-8\">\n                  No revenue data yet. Keep creating!\n                </p>\n              )}\n            </div>\n          </div>\n\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\n            <h3 className=\"text-xl font-bold dark:text-white mb-4\">Top Performing Videos</h3>\n            <div className=\"space-y-3\">\n              {analytics?.topPosts?.slice(0, 5).map((post) => (\n                <Link\n                  key={post._id}\n                  to={post.category === 'long' ? `/videos?watch=${post._id}` : `/reels`}\n                  className=\"flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded-lg transition\"\n                >\n                  <div className=\"w-20 h-12 bg-black rounded overflow-hidden flex-shrink-0\">\n                    {post.media?.[0]?.url && (\n                      <img src={post.media[0].url} alt={post.title} className=\"w-full h-full object-cover\" />\n                    )}\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-semibold text-sm dark:text-white truncate\">{post.title || 'Untitled'}</p>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                      {post.views || 0} views â€¢ {post.likes?.length || 0} likes\n                    </p>\n                  </div>\n                </Link>\n              ))}\n              {(!analytics?.topPosts || analytics.topPosts.length === 0) && (\n                <p className=\"text-gray-500 dark:text-gray-400 text-center py-8\">\n                  No posts yet. Start creating!\n                </p>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Recent Earnings */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\n          <h3 className=\"text-xl font-bold dark:text-white mb-4\">Recent Earnings</h3>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-b dark:border-gray-700\">\n                  <th className=\"text-left py-3 px-4 text-sm font-semibold dark:text-white\">Date</th>\n                  <th className=\"text-left py-3 px-4 text-sm font-semibold dark:text-white\">Source</th>\n                  <th className=\"text-left py-3 px-4 text-sm font-semibold dark:text-white\">Description</th>\n                  <th className=\"text-right py-3 px-4 text-sm font-semibold dark:text-white\">Amount</th>\n                </tr>\n              </thead>\n              <tbody>\n                {earnings?.recentEarnings?.slice(0, 10).map((earning) => (\n                  <tr key={earning._id} className=\"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700\">\n                    <td className=\"py-3 px-4 text-sm text-gray-600 dark:text-gray-300\">\n                      {new Date(earning.createdAt).toLocaleDateString()}\n                    </td>\n                    <td className=\"py-3 px-4 text-sm text-gray-600 dark:text-gray-300 capitalize\">\n                      {earning.source.replace(/_/g, ' ')}\n                    </td>\n                    <td className=\"py-3 px-4 text-sm text-gray-600 dark:text-gray-300\">\n                      {earning.description || earning.post?.title || '-'}\n                    </td>\n                    <td className=\"py-3 px-4 text-sm font-semibold text-right dark:text-white\">\n                      ${earning.amount.toFixed(3)}\n                    </td>\n                  </tr>\n                ))}\n                {(!earnings?.recentEarnings || earnings.recentEarnings.length === 0) && (\n                  <tr>\n                    <td colSpan=\"4\" className=\"py-8 text-center text-gray-500 dark:text-gray-400\">\n                      No earnings yet. Views and engagement will generate revenue!\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        {/* Info Box */}\n        <div className=\"mt-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-xl p-6\">\n          <h4 className=\"font-semibold text-blue-900 dark:text-blue-200 mb-2\">ğŸ’¡ Maximize Your Earnings</h4>\n          <ul className=\"text-sm text-blue-800 dark:text-blue-300 space-y-1\">\n            <li>â€¢ Create longer videos (&gt;5 min) to enable mid-roll ads</li>\n            <li>â€¢ Encourage viewers to watch till the end for better revenue</li>\n            <li>â€¢ Engage with your audience through comments and live streams</li>\n            <li>â€¢ Enable Super Chat during live streams for direct support</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CreatorDashboard;\n","size_bytes":13726},"backend/controllers/postController.js":{"content":"import Post from '../models/Post.js';\nimport User from '../models/User.js';\nimport Comment from '../models/Comment.js';\nimport Notification from '../models/Notification.js';\nimport { uploadToStorage, deleteFromStorage } from '../config/minio.js';\n\n// @desc    Create new post\n// @route   POST /api/posts\n// @access  Private\nexport const createPost = async (req, res) => {\n  try {\n    const { title, description, caption, tags, location, visibility, madeForKids, allowComments, scheduledAt, videoLanguage, license, topicCategory, playlistName, paidPromotion, ageRestricted, allowEmbedding, locationLat, locationLng, category: rawCategory, derivedFrom, remixType, videoStartSec, videoEndSec, playbackRate } = req.body;\n    const category = (rawCategory || 'image').toLowerCase();\n\n    if (!['image', 'short', 'long'].includes(category)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid category. Use image, short, or long.',\n      });\n    }\n\n    const role = req.user.role;\n    const canUploadLong = ['creator', 'business', 'admin'].includes(role);\n    if (category === 'long' && !canUploadLong) {\n      return res.status(403).json({\n        success: false,\n        message: 'Only creators, business, or admin can upload long videos',\n      });\n    }\n\n    // Basic validations\n    if (!title || !title.trim()) {\n      return res.status(400).json({ success: false, message: 'Title is required' });\n    }\n    if (title.length > 100) {\n      return res.status(400).json({ success: false, message: 'Title cannot exceed 100 characters' });\n    }\n    if (description && description.length > 5000) {\n      return res.status(400).json({ success: false, message: 'Description cannot exceed 5000 characters' });\n    }\n\n    if (!mediaFiles || mediaFiles.length === 0) {\n      return res.status(400).json({\n        success: false,\n        message: 'Please upload at least one image or video',\n      });\n    }\n\n    const mediaFiles = (req.files && req.files.media) ? req.files.media : (req.files ? req.files : (req.file ? [req.file] : []));\n\n    // Validate files by category\n    if (category === 'image') {\n      for (const f of mediaFiles) {\n        if (!f.mimetype.startsWith('image/')) {\n          return res.status(400).json({ success: false, message: 'Only images allowed for image posts' });\n        }\n      }\n    } else {\n      if (mediaFiles.length !== 1) {\n        return res.status(400).json({ success: false, message: 'Only one video allowed for shorts/long videos' });\n      }\n      if (!mediaFiles[0].mimetype.startsWith('video/')) {\n        return res.status(400).json({ success: false, message: 'Only video files allowed for shorts/long videos' });\n      }\n    }\n\n    console.log('ğŸ“¤ Uploading', mediaFiles.length, 'file(s) to MinIO...');\n\n    // Upload all files in parallel\n    const uploadResults = await Promise.all(\n      mediaFiles.map((file) => uploadToStorage(file.buffer, 'friendflix/posts', file.originalname))\n    );\n\n    let durationSec;\n    if (category !== 'image') {\n      durationSec = Math.round(uploadResults[0]?.duration || 0);\n      const limit = category === 'short' ? 60 : 3600;\n      if (!durationSec || durationSec > limit) {\n        const publicId = uploadResults[0]?.public_id;\n        if (publicId) {\n          try {\n            await deleteFromStorage(publicId);\n          } catch (e) {\n            console.warn('MinIO cleanup failed:', e?.message);\n          }\n        }\n        return res.status(400).json({\n          success: false,\n          message: category === 'short' ? 'Shorts must be 60 seconds or less' : 'Long videos must be 1 hour or less',\n        });\n      }\n    }\n\n    const mediaArray = mediaFiles.map((file, idx) => ({\n      url: uploadResults[idx].secure_url,\n      type: file.mimetype.startsWith('video') ? 'video' : 'image',\n    }));\n\n    console.log('âœ… Upload successful!');\n\n    // Optional thumbnail upload\n    let thumbnailUrl;\n    try {\n      const thumbFile = req.files?.thumbnail?.[0];\n      if (thumbFile) {\n        const thumbUpload = await uploadToStorage(thumbFile.buffer, 'friendflix/thumbnails', thumbFile.originalname);\n        thumbnailUrl = thumbUpload.secure_url;\n      }\n    } catch (e) {\n      console.warn('Thumbnail upload failed:', e?.message);\n    }\n\n    // Extract hashtags from caption\n    const hashtags = caption ? caption.match(/#[a-zA-Z0-9_]+/g) || [] : [];\n    const cleanHashtags = hashtags.map(tag => tag.substring(1).toLowerCase());\n\n    // Simple keyword extraction from caption and tags\n    const keywordSet = new Set();\n    if (caption) {\n      caption\n        .toLowerCase()\n        .replace(/[^a-z0-9_\\s#@]/g, ' ')\n        .split(/\\s+/)\n        .filter(w => w && w.length > 3 && !w.startsWith('#') && !w.startsWith('@'))\n        .slice(0, 20)\n        .forEach(w => keywordSet.add(w));\n    }\n    if (tags) {\n      tags.split(',').map(t => t.trim().toLowerCase()).forEach(t => keywordSet.add(t));\n    }\n    const keywords = Array.from(keywordSet);\n    const visibilityVal = ['public', 'private', 'unlisted'].includes((visibility || 'public').toLowerCase())\n      ? (visibility || 'public').toLowerCase()\n      : 'public';\n    const licenseVal = ((license || 'standard').toLowerCase() === 'creative_commons') ? 'creative_commons' : 'standard';\n    const allowEmbeddingVal = typeof allowEmbedding === 'undefined' ? true : String(allowEmbedding) === 'true';\n    const paidPromotionVal = !!paidPromotion;\n    const ageRestrictedVal = !!ageRestricted;\n    const locationLatNum = typeof locationLat !== 'undefined' && locationLat !== '' ? Number(locationLat) : undefined;\n    const locationLngNum = typeof locationLng !== 'undefined' && locationLng !== '' ? Number(locationLng) : undefined;\n    const scheduledDate = scheduledAt ? new Date(scheduledAt) : undefined;\n\n    // Extract mentions from caption\n    const mentions = caption ? caption.match(/@[a-zA-Z0-9_]+/g) || [] : [];\n    const usernames = mentions.map(mention => mention.substring(1));\n    const mentionedUsers = await User.find({ username: { $in: usernames } });\n\n    // Create post\n    const post = await Post.create({\n      author: req.user._id,\n      title: title?.trim() || '',\n      description: description?.trim() || '',\n      caption,\n      media: mediaArray,\n      mediaUrl: mediaArray[0].url, // For backward compatibility\n      mediaType: mediaArray[0].type,\n      thumbnailUrl: thumbnailUrl || undefined,\n      tags: tags ? tags.split(',').map((tag) => tag.trim()) : [],\n      hashtags: cleanHashtags,\n      mentions: mentionedUsers.map(u => u._id),\n      location: location || '',\n      visibility: visibilityVal,\n      madeForKids: !!madeForKids,\n      allowComments: typeof allowComments === 'undefined' ? true : String(allowComments) === 'true',\n      scheduledAt: scheduledDate,\n      videoLanguage: videoLanguage || 'en',\n      license: licenseVal,\n      topicCategory: topicCategory || undefined,\n      playlistName: playlistName || undefined,\n      paidPromotion: paidPromotionVal,\n      ageRestricted: ageRestrictedVal,\n      allowEmbedding: allowEmbeddingVal,\n      locationLat: locationLatNum,\n      locationLng: locationLngNum,\n      category,\n      durationSec: category === 'image' ? undefined : durationSec,\n      derivedFrom: derivedFrom || undefined,\n      remixType: remixType || undefined,\n      keywords,\n      videoStartSec: typeof videoStartSec !== 'undefined' ? Number(videoStartSec) : undefined,\n      videoEndSec: typeof videoEndSec !== 'undefined' ? Number(videoEndSec) : undefined,\n      playbackRate: typeof playbackRate !== 'undefined' ? Number(playbackRate) : undefined,\n    });\n\n    // Add post to user's posts array\n    await User.findByIdAndUpdate(req.user._id, {\n      $push: { posts: post._id },\n    });\n\n    const populatedPost = await Post.findById(post._id).populate(\n      'author',\n      'username fullName avatar'\n    );\n\n    res.status(201).json({\n      success: true,\n      message: 'Post created successfully',\n      data: populatedPost,\n    });\n  } catch (error) {\n    console.error('âŒ Post creation error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message,\n      error: process.env.NODE_ENV === 'development' ? error.stack : undefined,\n    });\n  }\n};\n\n// @desc    Get feed posts (from followed users)\n// @route   GET /api/posts/feed\n// @access  Private\nexport const getFeedPosts = async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const skip = (page - 1) * limit;\n\n    const currentUser = await User.findById(req.user._id);\n\n    // Fetch candidate posts (followed + own), lean for performance\n    const posts = await Post.find({\n      author: { $in: [...currentUser.subscribed, currentUser._id] },\n      isArchived: { $ne: true },\n    })\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit)\n      .populate('author', 'username fullName avatar')\n      .populate({\n        path: 'comments',\n        populate: { path: 'author', select: 'username fullName avatar' },\n        options: { sort: { createdAt: -1 }, limit: 2 },\n      })\n      .lean();\n\n    // Compute simple engagement score (Instagram/friendflix-inspired)\n    const now = Date.now();\n    const halfLifeMs = 24 * 60 * 60 * 1000; // 24h recency decay\n    const scored = posts.map((p) => {\n      const likesCount = (p.likes || []).length;\n      const commentsCount = (p.comments || []).length;\n      const ageMs = Math.max(1, now - new Date(p.createdAt).getTime());\n      const recencyBoost = Math.exp(-ageMs / halfLifeMs);\n      const engagementScore = likesCount * 2 + commentsCount * 3;\n      const score = engagementScore * 0.7 + recencyBoost * 100; // tuneable weights\n      return { ...p, score };\n    });\n\n    // Sort by score desc\n    scored.sort((a, b) => b.score - a.score);\n\n    res.status(200).json({\n      success: true,\n      data: scored,\n      pagination: {\n        page,\n        limit,\n        total: scored.length,\n        pages: Math.ceil(scored.length / limit),\n      },\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// @desc    Get single post\n// @route   GET /api/posts/:id\n// @access  Public\nexport const getPost = async (req, res) => {\n  try {\n    const post = await Post.findById(req.params.id)\n      .populate('author', 'username fullName avatar')\n      .populate({\n        path: 'comments',\n        populate: {\n          path: 'author',\n          select: 'username fullName avatar',\n        },\n        options: { sort: { createdAt: -1 } },\n      })\n      .populate({\n        path: 'pinnedComment',\n        populate: { path: 'author', select: 'username fullName avatar' },\n      });\n\n    if (!post) {\n      return res.status(404).json({\n        success: false,\n        message: 'Post not found',\n      });\n    }\n\n    res.status(200).json({\n      success: true,\n      data: post,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Delete post\n// @route   DELETE /api/posts/:id\n// @access  Private\nexport const deletePost = async (req, res) => {\n  try {\n    const post = await Post.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({\n        success: false,\n        message: 'Post not found',\n      });\n    }\n\n    // Check if user is the author\n    if (post.author.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to delete this post',\n      });\n    }\n\n    // Delete all comments associated with the post\n    await Comment.deleteMany({ post: post._id });\n\n    // Remove post from user's posts array\n    await User.findByIdAndUpdate(req.user._id, {\n      $pull: { posts: post._id },\n    });\n\n    // Delete the post\n    await post.deleteOne();\n\n    res.status(200).json({\n      success: true,\n      message: 'Post deleted successfully',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Like/Unlike post\n// @route   POST /api/posts/:id/like\n// @access  Private\nexport const likePost = async (req, res) => {\n  try {\n    const post = await Post.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({\n        success: false,\n        message: 'Post not found',\n      });\n    }\n\n    const isLiked = post.likes.includes(req.user._id);\n\n    if (isLiked) {\n      // Unlike\n      post.likes = post.likes.filter(\n        (id) => id.toString() !== req.user._id.toString()\n      );\n      await post.save();\n\n      res.status(200).json({\n        success: true,\n        message: 'Post unliked',\n        isLiked: false,\n        likesCount: post.likes.length,\n      });\n    } else {\n      // Like\n      post.likes.push(req.user._id);\n      await post.save();\n\n      // Create notification (if not own post)\n      if (post.author.toString() !== req.user._id.toString()) {\n        const notification = await Notification.create({\n          recipient: post.author,\n          sender: req.user._id,\n          type: 'like',\n          post: post._id,\n          message: `${req.user.username} liked your post`,\n        });\n\n        const populatedNotification = await Notification.findById(\n          notification._id\n        ).populate('sender', 'username fullName avatar');\n\n        // Emit socket event\n        const io = req.app.get('io');\n        io.to(post.author.toString()).emit('notification', populatedNotification);\n      }\n\n      // Emit real-time like update\n      const io = req.app.get('io');\n      io.emit('postLiked', {\n        postId: post._id,\n        userId: req.user._id,\n        likesCount: post.likes.length,\n      });\n\n      res.status(200).json({\n        success: true,\n        message: 'Post liked',\n        isLiked: true,\n        likesCount: post.likes.length,\n      });\n    }\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Add comment to post\n// @route   POST /api/posts/:id/comment\n// @access  Private\nexport const addComment = async (req, res) => {\n  try {\n    const { text } = req.body;\n\n    if (!text || text.trim() === '') {\n      return res.status(400).json({\n        success: false,\n        message: 'Comment text is required',\n      });\n    }\n\n    const post = await Post.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({\n        success: false,\n        message: 'Post not found',\n      });\n    }\n\n    // Create comment\n    const comment = await Comment.create({\n      post: post._id,\n      author: req.user._id,\n      text,\n    });\n\n    // Add comment to post\n    post.comments.push(comment._id);\n    await post.save();\n\n    const populatedComment = await Comment.findById(comment._id).populate(\n      'author',\n      'username fullName avatar'\n    );\n\n    // Notify post author (if not own post)\n    if (post.author.toString() !== req.user._id.toString()) {\n      const notification = await Notification.create({\n        recipient: post.author,\n        sender: req.user._id,\n        type: 'comment',\n        post: post._id,\n        comment: comment._id,\n        message: `${req.user.username} commented on your post`,\n      });\n\n      const populatedNotification = await Notification.findById(notification._id)\n        .populate('sender', 'username fullName avatar');\n\n      // Emit socket event\n      const io = req.app.get('io');\n      io.to(post.author.toString()).emit('notification', populatedNotification);\n    }\n\n    // Mentions notifications (notify mentioned users in this comment)\n    const mentions = text ? text.match(/@[a-zA-Z0-9_]+/g) || [] : [];\n    if (mentions.length) {\n      const usernames = [...new Set(mentions.map((m) => m.substring(1)))];\n      const mentionedUsers = await User.find({ username: { $in: usernames } }, '_id');\n      const notifyUsers = mentionedUsers\n        .map((u) => u._id.toString())\n        .filter((uid) => uid !== req.user._id.toString()); // don't notify self\n\n      for (const uid of notifyUsers) {\n        const mentionNotification = await Notification.create({\n          recipient: uid,\n          sender: req.user._id,\n          type: 'mention',\n          post: post._id,\n          comment: comment._id,\n          message: `${req.user.username} mentioned you in a comment`,\n        });\n\n        const populatedMention = await Notification.findById(mentionNotification._id)\n          .populate('sender', 'username fullName avatar');\n\n        const io = req.app.get('io');\n        io.to(uid).emit('notification', populatedMention);\n      }\n    }\n\n    // Emit real-time comment\n    const io = req.app.get('io');\n    io.emit('newComment', {\n      postId: post._id,\n      comment: populatedComment,\n    });\n\n    res.status(201).json({\n      success: true,\n      message: 'Comment added successfully',\n      data: populatedComment,\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// @desc    Get all comments for a post\n// @route   GET /api/posts/:id/comments\n// @access  Public\nexport const getPostComments = async (req, res) => {\n  try {\n    const comments = await Comment.find({ post: req.params.id })\n      .sort({ createdAt: -1 })\n      .populate('author', 'username fullName avatar');\n\n    res.status(200).json({\n      success: true,\n      data: comments,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Save/Unsave post\n// @route   POST /api/posts/:id/save\n// @access  Private\nexport const savePost = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n    const post = await Post.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({\n        success: false,\n        message: 'Post not found',\n      });\n    }\n\n    const isSaved = user.savedPosts.includes(req.params.id);\n\n    if (isSaved) {\n      // Unsave\n      user.savedPosts = user.savedPosts.filter(\n        (id) => id.toString() !== req.params.id\n      );\n      await user.save();\n\n      res.status(200).json({\n        success: true,\n        message: 'Post unsaved',\n        isSaved: false,\n      });\n    } else {\n      // Save\n      user.savedPosts.push(req.params.id);\n      await user.save();\n\n      res.status(200).json({\n        success: true,\n        message: 'Post saved',\n        isSaved: true,\n      });\n    }\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get saved posts\n// @route   GET /api/posts/saved\n// @access  Private\nexport const getSavedPosts = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id).populate({\n      path: 'savedPosts',\n      populate: {\n        path: 'author',\n        select: 'username fullName avatar',\n      },\n      options: { sort: { createdAt: -1 } },\n    });\n\n    res.status(200).json({\n      success: true,\n      data: user.savedPosts,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Archive/Unarchive post\n// @route   POST /api/posts/:id/archive\n// @access  Private\nexport const archivePost = async (req, res) => {\n  try {\n    const post = await Post.findById(req.params.id);\n\n    if (!post) {\n      return res.status(404).json({\n        success: false,\n        message: 'Post not found',\n      });\n    }\n\n    if (post.author.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized',\n      });\n    }\n\n    post.isArchived = !post.isArchived;\n    await post.save();\n\n    res.status(200).json({\n      success: true,\n      message: post.isArchived ? 'Post archived' : 'Post unarchived',\n      isArchived: post.isArchived,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Delete comment\n// @route   DELETE /api/posts/:postId/comments/:commentId\n// @access  Private\nexport const deleteComment = async (req, res) => {\n  try {\n    const comment = await Comment.findById(req.params.commentId);\n\n    if (!comment) {\n      return res.status(404).json({\n        success: false,\n        message: 'Comment not found',\n      });\n    }\n\n    // Check if user is the author\n    if (comment.author.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to delete this comment',\n      });\n    }\n\n    // Remove comment from post\n    await Post.findByIdAndUpdate(req.params.postId, {\n      $pull: { comments: comment._id },\n    });\n\n    await comment.deleteOne();\n\n    res.status(200).json({\n      success: true,\n      message: 'Comment deleted successfully',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// Reply to a comment (nested threads)\nexport const replyToComment = async (req, res) => {\n  try {\n    const { text } = req.body;\n\n    if (!text || text.trim() === '') {\n      return res.status(400).json({ success: false, message: 'Comment text is required' });\n    }\n\n    const post = await Post.findById(req.params.postId);\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    const parent = await Comment.findById(req.params.commentId);\n    if (!parent || parent.post.toString() !== post._id.toString()) {\n      return res.status(400).json({ success: false, message: 'Invalid parent comment' });\n    }\n\n    const comment = await Comment.create({\n      post: post._id,\n      author: req.user._id,\n      text,\n      parentComment: parent._id,\n    });\n\n    // Add reply to post comments array (flat storage; UI will thread via parentComment)\n    post.comments.push(comment._id);\n    await post.save();\n\n    const populatedComment = await Comment.findById(comment._id).populate('author', 'username fullName avatar');\n\n    // Emit real-time comment\n    const io = req.app.get('io');\n    io.emit('newComment', { postId: post._id, comment: populatedComment });\n\n    res.status(201).json({ success: true, message: 'Reply added successfully', data: populatedComment });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// Pin a comment on a post (author only)\nexport const pinComment = async (req, res) => {\n  try {\n    const post = await Post.findById(req.params.postId);\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    if (post.author.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized to pin comments' });\n    }\n\n    const comment = await Comment.findById(req.params.commentId);\n    if (!comment || comment.post.toString() !== post._id.toString()) {\n      return res.status(400).json({ success: false, message: 'Invalid comment for this post' });\n    }\n\n    post.pinnedComment = comment._id;\n    await post.save();\n\n    const populatedPinned = await Comment.findById(comment._id).populate('author', 'username fullName avatar');\n\n    // Emit real-time pin update\n    const io = req.app.get('io');\n    io.emit('commentPinned', { postId: post._id, comment: populatedPinned });\n\n    res.status(200).json({ success: true, message: 'Comment pinned', data: populatedPinned });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// Unpin comment\nexport const unpinComment = async (req, res) => {\n  try {\n    const post = await Post.findById(req.params.postId);\n    if (!post) {\n      return res.status(404).json({ success: false, message: 'Post not found' });\n    }\n\n    if (post.author.toString() !== req.user._id.toString()) {\n      return res.status(403).json({ success: false, message: 'Not authorized to unpin comments' });\n    }\n\n    post.pinnedComment = null;\n    await post.save();\n\n    const io = req.app.get('io');\n    io.emit('commentPinned', { postId: post._id, comment: null });\n\n    res.status(200).json({ success: true, message: 'Comment unpinned' });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n","size_bytes":24336},"backend/routes/authRoutes.js":{"content":"import express from 'express';\nimport {\n  register,\n  login,\n  getMe,\n  logout,\n} from '../controllers/authController.js';\nimport { protect } from '../middleware/authMiddleware.js';\nimport { authLimiter } from '../middleware/rateLimitMiddleware.js';\n\nconst router = express.Router();\n\nrouter.post('/register', authLimiter, register);\nrouter.post('/login', authLimiter, login);\nrouter.get('/me', protect, getMe);\nrouter.post('/logout', protect, logout);\n\nexport default router;\n","size_bytes":477},"frontend/src/pages/Signup.jsx":{"content":"import { useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { FiMail, FiUser, FiAtSign, FiLock, FiEye, FiEyeOff, FiCheck } from 'react-icons/fi';\n\nconst Signup = () => {\n  const navigate = useNavigate();\n  const { register } = useAuth();\n  const [formData, setFormData] = useState({\n    email: '',\n    fullName: '',\n    username: '',\n    password: '',\n  });\n  const [loading, setLoading] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n\n  const handleChange = (e) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      await register(formData);\n      navigate('/');\n    } catch (error) {\n      console.error('Registration error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const passwordStrength = formData.password.length >= 6;\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 relative overflow-hidden\">\n      {/* Animated Background Gradient Orbs */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-20 -left-20 w-96 h-96 bg-secondary-300/30 rounded-full blur-3xl animate-float\"></div>\n        <div className=\"absolute bottom-20 -right-20 w-96 h-96 bg-accent-300/30 rounded-full blur-3xl animate-float\" style={{animationDelay: '2s'}}></div>\n        <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-primary-300/20 rounded-full blur-3xl animate-float\" style={{animationDelay: '4s'}}></div>\n      </div>\n\n      <div className=\"max-w-md w-full space-y-6 relative z-10 animate-scale-in\">\n        {/* Logo & Header */}\n        <div className=\"text-center space-y-3\">\n          <div className=\"inline-block p-4 bg-gradient-sunset rounded-3xl shadow-glow-lg animate-glow-pulse\">\n            <h1 className=\"text-5xl font-black text-white\">friendflix</h1>\n          </div>\n          <p className=\"text-lg text-gray-600 dark:text-gray-400 font-medium\">\n            Create your account and start sharing\n          </p>\n        </div>\n\n        {/* Signup Card */}\n        <div className=\"card p-8 space-y-6 animate-slide-up\">\n          <form className=\"space-y-4\" onSubmit={handleSubmit}>\n            {/* Email Input */}\n            <div className=\"relative group\">\n              <div className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-primary-500 transition-colors\">\n                <FiMail className=\"w-5 h-5\" />\n              </div>\n              <input\n                type=\"email\"\n                name=\"email\"\n                placeholder=\"Email address\"\n                required\n                autoComplete=\"email\"\n                value={formData.email}\n                onChange={handleChange}\n                className=\"w-full pl-12 pr-4 py-4 bg-gray-50 dark:bg-dark-card-hover border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:outline-none focus:border-primary-400 focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 text-gray-900 dark:text-white placeholder:text-gray-400\"\n              />\n            </div>\n\n            {/* Full Name Input */}\n            <div className=\"relative group\">\n              <div className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-primary-500 transition-colors\">\n                <FiUser className=\"w-5 h-5\" />\n              </div>\n              <input\n                type=\"text\"\n                name=\"fullName\"\n                placeholder=\"Full Name\"\n                required\n                autoComplete=\"name\"\n                value={formData.fullName}\n                onChange={handleChange}\n                className=\"w-full pl-12 pr-4 py-4 bg-gray-50 dark:bg-dark-card-hover border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:outline-none focus:border-primary-400 focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 text-gray-900 dark:text-white placeholder:text-gray-400\"\n              />\n            </div>\n\n            {/* Username Input */}\n            <div className=\"relative group\">\n              <div className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-primary-500 transition-colors\">\n                <FiAtSign className=\"w-5 h-5\" />\n              </div>\n              <input\n                type=\"text\"\n                name=\"username\"\n                placeholder=\"Username\"\n                required\n                autoComplete=\"username\"\n                value={formData.username}\n                onChange={handleChange}\n                className=\"w-full pl-12 pr-4 py-4 bg-gray-50 dark:bg-dark-card-hover border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:outline-none focus:border-primary-400 focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 text-gray-900 dark:text-white placeholder:text-gray-400\"\n              />\n            </div>\n\n            {/* Password Input */}\n            <div className=\"relative group\">\n              <div className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-primary-500 transition-colors\">\n                <FiLock className=\"w-5 h-5\" />\n              </div>\n              <input\n                type={showPassword ? 'text' : 'password'}\n                name=\"password\"\n                placeholder=\"Password (min 6 characters)\"\n                required\n                minLength={6}\n                autoComplete=\"new-password\"\n                value={formData.password}\n                onChange={handleChange}\n                className=\"w-full pl-12 pr-12 py-4 bg-gray-50 dark:bg-dark-card-hover border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:outline-none focus:border-primary-400 focus:ring-4 focus:ring-primary-100 dark:focus:ring-primary-900/30 transition-all duration-200 text-gray-900 dark:text-white placeholder:text-gray-400\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowPassword(!showPassword)}\n                className=\"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\n              >\n                {showPassword ? <FiEyeOff className=\"w-5 h-5\" /> : <FiEye className=\"w-5 h-5\" />}\n              </button>\n            </div>\n\n            {/* Password Strength Indicator */}\n            {formData.password && (\n              <div className=\"flex items-center gap-2 text-sm animate-slide-down\">\n                {passwordStrength ? (\n                  <>\n                    <FiCheck className=\"w-4 h-4 text-success-500\" />\n                    <span className=\"text-success-500 font-medium\">Strong password</span>\n                  </>\n                ) : (\n                  <span className=\"text-gray-500\">Password must be at least 6 characters</span>\n                )}\n              </div>\n            )}\n\n            {/* Submit Button */}\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full btn-gradient disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden group mt-6\"\n            >\n              {loading ? (\n                <div className=\"flex items-center justify-center gap-2\">\n                  <div className=\"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin\"></div>\n                  <span>Creating account...</span>\n                </div>\n              ) : (\n                <span className=\"font-bold text-lg\">Sign Up</span>\n              )}\n            </button>\n          </form>\n\n          {/* Terms Text */}\n          <div className=\"pt-4 border-t border-gray-200 dark:border-dark-border\">\n            <p className=\"text-xs text-center text-gray-500 dark:text-gray-400 leading-relaxed\">\n              By signing up, you agree to our{' '}\n              <Link to=\"/terms\" className=\"text-primary-500 hover:text-primary-600 font-medium\">\n                Terms of Service\n              </Link>\n              {' '}and{' '}\n              <Link to=\"/privacy\" className=\"text-primary-500 hover:text-primary-600 font-medium\">\n                Privacy Policy\n              </Link>\n            </p>\n          </div>\n        </div>\n\n        {/* Login Link Card */}\n        <div className=\"card p-5 text-center animate-slide-up\" style={{animationDelay: '0.1s'}}>\n          <p className=\"text-gray-700 dark:text-gray-300\">\n            Already have an account?{' '}\n            <Link to=\"/login\" className=\"font-bold bg-gradient-sunset bg-clip-text text-transparent hover:opacity-80 transition-opacity\">\n              Log in\n            </Link>\n          </p>\n        </div>\n\n        {/* Features List */}\n        <div className=\"grid grid-cols-3 gap-3 animate-fade-in\" style={{animationDelay: '0.2s'}}>\n          <div className=\"text-center p-4 card-flat\">\n            <div className=\"text-2xl mb-1\">ğŸ“¸</div>\n            <p className=\"text-xs text-gray-600 dark:text-gray-400 font-medium\">Share Photos</p>\n          </div>\n          <div className=\"text-center p-4 card-flat\">\n            <div className=\"text-2xl mb-1\">ğŸ¬</div>\n            <p className=\"text-xs text-gray-600 dark:text-gray-400 font-medium\">Create Reels</p>\n          </div>\n          <div className=\"text-center p-4 card-flat\">\n            <div className=\"text-2xl mb-1\">ğŸ’¬</div>\n            <p className=\"text-xs text-gray-600 dark:text-gray-400 font-medium\">Chat Live</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Signup;\n","size_bytes":9888},"frontend/src/utils/timeAgo.js":{"content":"import { formatDistanceToNow } from 'date-fns';\n\nexport const timeAgo = (date) => {\n  return formatDistanceToNow(new Date(date), { addSuffix: true });\n};\n\nexport const formatDate = (date) => {\n  return new Date(date).toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n};\n","size_bytes":316},"backend/controllers/adminController.js":{"content":"import User from '../models/User.js';\nimport Post from '../models/Post.js';\nimport Message from '../models/Message.js';\nimport Story from '../models/Story.js';\nimport Notification from '../models/Notification.js';\n\n// @desc    Get dashboard statistics\n// @route   GET /api/admin/stats\n// @access  Private/Admin\nexport const getDashboardStats = async (req, res) => {\n  try {\n    const [\n      totalUsers,\n      totalPosts,\n      totalMessages,\n      totalStories,\n      activeUsers,\n      newUsersToday,\n      newPostsToday,\n    ] = await Promise.all([\n      User.countDocuments(),\n      Post.countDocuments(),\n      Message.countDocuments(),\n      Story.countDocuments(),\n      User.countDocuments({ updatedAt: { $gte: new Date(Date.now() - 24 * 60 * 60 * 1000) } }),\n      User.countDocuments({ createdAt: { $gte: new Date(Date.now() - 24 * 60 * 60 * 1000) } }),\n      Post.countDocuments({ createdAt: { $gte: new Date(Date.now() - 24 * 60 * 60 * 1000) } }),\n    ]);\n\n    res.status(200).json({\n      success: true,\n      data: {\n        totalUsers,\n        totalPosts,\n        totalMessages,\n        totalStories,\n        activeUsers,\n        newUsersToday,\n        newPostsToday,\n      },\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get all users with pagination\n// @route   GET /api/admin/users\n// @access  Private/Admin\nexport const getAllUsers = async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 20;\n    const skip = (page - 1) * limit;\n\n    const users = await User.find()\n      .select('-password')\n      .populate('posts')\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit);\n\n    const total = await User.countDocuments();\n\n    res.status(200).json({\n      success: true,\n      data: {\n        users,\n        currentPage: page,\n        totalPages: Math.ceil(total / limit),\n        total,\n      },\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get all posts with pagination\n// @route   GET /api/admin/posts\n// @access  Private/Admin\nexport const getAllPosts = async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 20;\n    const skip = (page - 1) * limit;\n\n    const posts = await Post.find()\n      .populate('author', 'username fullName avatar')\n      .populate('likes', 'username avatar')\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit);\n\n    const total = await Post.countDocuments();\n\n    res.status(200).json({\n      success: true,\n      data: {\n        posts,\n        currentPage: page,\n        totalPages: Math.ceil(total / limit),\n        total,\n      },\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Delete user\n// @route   DELETE /api/admin/users/:userId\n// @access  Private/Admin\nexport const deleteUser = async (req, res) => {\n  try {\n    const user = await User.findById(req.params.userId);\n\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found',\n      });\n    }\n\n    // Delete all user's posts\n    await Post.deleteMany({ author: user._id });\n\n    // Delete all user's messages\n    await Message.deleteMany({\n      $or: [{ sender: user._id }, { receiver: user._id }],\n    });\n\n    // Delete user\n    await user.deleteOne();\n\n    res.status(200).json({\n      success: true,\n      message: 'User deleted successfully',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Delete post\n// @route   DELETE /api/admin/posts/:postId\n// @access  Private/Admin\nexport const deletePost = async (req, res) => {\n  try {\n    const post = await Post.findById(req.params.postId);\n\n    if (!post) {\n      return res.status(404).json({\n        success: false,\n        message: 'Post not found',\n      });\n    }\n\n    // Remove post from user's posts array\n    await User.findByIdAndUpdate(post.author, {\n      $pull: { posts: post._id },\n    });\n\n    await post.deleteOne();\n\n    res.status(200).json({\n      success: true,\n      message: 'Post deleted successfully',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Ban/Unban user\n// @route   PUT /api/admin/users/:userId/ban\n// @access  Private/Admin\nexport const toggleBanUser = async (req, res) => {\n  try {\n    const user = await User.findById(req.params.userId);\n\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found',\n      });\n    }\n\n    user.isBanned = !user.isBanned;\n    await user.save();\n\n    res.status(200).json({\n      success: true,\n      message: user.isBanned ? 'User banned successfully' : 'User unbanned successfully',\n      data: user,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Verify/Unverify user\n// @route   PUT /api/admin/users/:userId/verify\n// @access  Private/Admin\nexport const toggleVerifyUser = async (req, res) => {\n  try {\n    const user = await User.findById(req.params.userId);\n\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found',\n      });\n    }\n\n    user.isVerified = !user.isVerified;\n    user.verifiedAt = user.isVerified ? new Date() : null;\n    await user.save();\n\n    res.status(200).json({\n      success: true,\n      message: user.isVerified ? 'User verified successfully' : 'User unverified',\n      data: user,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Change user role\n// @route   PUT /api/admin/users/:userId/role\n// @access  Private/Admin\nexport const changeUserRole = async (req, res) => {\n  try {\n    const { role } = req.body;\n    const user = await User.findById(req.params.userId);\n\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found',\n      });\n    }\n\n    user.role = role;\n    // Clear upgrade request flags on role change\n    user.roleUpgradeRequested = false;\n    user.roleUpgradeReason = '';\n    await user.save();\n\n    res.status(200).json({\n      success: true,\n      message: 'User role updated successfully',\n      data: user,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get reported content\n// @route   GET /api/admin/reports\n// @access  Private/Admin\nexport const getReports = async (req, res) => {\n  try {\n    // This will be implemented when report model is created\n    res.status(200).json({\n      success: true,\n      data: [],\n      message: 'Reports feature coming soon',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Search users/posts\n// @route   GET /api/admin/search\n// @access  Private/Admin\nexport const adminSearch = async (req, res) => {\n  try {\n    const { query, type } = req.query;\n\n    let results = [];\n\n    if (type === 'users' || !type) {\n      const users = await User.find({\n        $or: [\n          { username: { $regex: query, $options: 'i' } },\n          { fullName: { $regex: query, $options: 'i' } },\n          { email: { $regex: query, $options: 'i' } },\n        ],\n      }).limit(20);\n      results = [...results, ...users];\n    }\n\n    if (type === 'posts' || !type) {\n      const posts = await Post.find({\n        caption: { $regex: query, $options: 'i' },\n      })\n        .populate('author', 'username avatar')\n        .limit(20);\n      results = [...results, ...posts];\n    }\n\n    res.status(200).json({\n      success: true,\n      data: results,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get role upgrade requests\n// @route   GET /api/admin/role-requests\n// @access  Private/Admin\nexport const getRoleRequests = async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 20;\n    const skip = (page - 1) * limit;\n\n    const users = await User.find({ roleUpgradeRequested: true })\n      .select('username fullName avatar email role roleUpgradeReason createdAt')\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(limit);\n\n    const total = await User.countDocuments({ roleUpgradeRequested: true });\n\n    res.status(200).json({\n      success: true,\n      data: {\n        users,\n        currentPage: page,\n        totalPages: Math.ceil(total / limit),\n        total,\n      },\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// @desc    Approve role upgrade request (set role to creator)\n// @route   POST /api/admin/role-requests/:userId/approve\n// @access  Private/Admin\nexport const approveRoleRequest = async (req, res) => {\n  try {\n    const user = await User.findById(req.params.userId);\n    if (!user) {\n      return res.status(404).json({ success: false, message: 'User not found' });\n    }\n\n    user.role = 'creator';\n    user.roleUpgradeRequested = false;\n    user.roleUpgradeReason = '';\n    await user.save();\n\n    res.status(200).json({ success: true, message: 'User upgraded to creator', data: user });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n\n// @desc    Decline role upgrade request\n// @route   POST /api/admin/role-requests/:userId/decline\n// @access  Private/Admin\nexport const declineRoleRequest = async (req, res) => {\n  try {\n    const user = await User.findById(req.params.userId);\n    if (!user) {\n      return res.status(404).json({ success: false, message: 'User not found' });\n    }\n\n    user.roleUpgradeRequested = false;\n    // Optionally store decline reason\n    user.roleUpgradeReason = '';\n    await user.save();\n\n    res.status(200).json({ success: true, message: 'Role upgrade request declined', data: user });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n};\n","size_bytes":10393},"frontend/vite.config.js":{"content":"import { defineConfig } from 'vite';\nimport react from '@vitejs/plugin-react';\nimport { VitePWA } from 'vite-plugin-pwa';\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    VitePWA({\n      registerType: 'autoUpdate',\n      injectRegister: 'auto',\n      workbox: {\n        globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}']\n      },\n      manifest: {\n        name: 'friendflix',\n        short_name: 'friendflix',\n        description: 'Video Sharing Platform',\n        theme_color: '#ffffff',\n        background_color: '#000000',\n        display: 'standalone',\n        start_url: '/',\n        scope: '/',\n        icons: [\n          {\n            src: 'pwa-192x192.png',\n            sizes: '192x192',\n            type: 'image/png'\n          },\n          {\n            src: 'pwa-512x512.png',\n            sizes: '512x512',\n            type: 'image/png'\n          },\n          {\n            src: 'pwa-maskable-192x192.png',\n            sizes: '192x192',\n            type: 'image/png',\n            purpose: 'maskable'\n          },\n          {\n            src: 'pwa-maskable-512x512.png',\n            sizes: '512x512',\n            type: 'image/png',\n            purpose: 'maskable'\n          }\n        ]\n      },\n      devOptions: {\n        enabled: true // Development mode mein bhi PWA enable\n      }\n    })\n  ],\n  server: {\n    host: '0.0.0.0',\n    port: 5000,\n    hmr: true,\n    proxy: {\n      '/api': {\n        target: 'http://localhost:3000',\n        changeOrigin: true,\n      },\n      '/socket.io': {\n        target: 'http://localhost:3000',\n        changeOrigin: true,\n        ws: true,\n      },\n    },\n  },\n});\n","size_bytes":1625},"backend/controllers/authController.js":{"content":"import User from '../models/User.js';\nimport { generateToken } from '../middleware/authMiddleware.js';\n\n// @desc    Register new user\n// @route   POST /api/auth/register\n// @access  Public\nexport const register = async (req, res) => {\n  try {\n    const { username, email, password, fullName } = req.body;\n\n    // Check if user already exists\n    const userExists = await User.findOne({\n      $or: [{ email }, { username }],\n    });\n\n    if (userExists) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists with this email or username',\n      });\n    }\n\n    // Create user with default avatar\n    const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:5173';\n    const user = await User.create({\n      username,\n      email,\n      password,\n      fullName,\n      avatar: `${frontendUrl}/default-avatar.png`,\n      coverImage: `${frontendUrl}/default-bg.jpg`,\n    });\n\n    if (user) {\n      res.status(201).json({\n        success: true,\n        message: 'User registered successfully',\n        data: {\n          _id: user._id,\n          username: user.username,\n          email: user.email,\n          fullName: user.fullName,\n          avatar: user.avatar,\n          bio: user.bio,\n          subscriber: user.subscriber,\n          subscribed: user.subscribed,\n          token: generateToken(user._id),\n        },\n      });\n    }\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Login user\n// @route   POST /api/auth/login\n// @access  Public\nexport const login = async (req, res) => {\n  try {\n    const { email, password } = req.body;\n\n    // Check if user exists\n    const user = await User.findOne({ email }).select('+password');\n\n    if (!user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid email or password',\n      });\n    }\n\n    // Check password\n    const isPasswordMatch = await user.comparePassword(password);\n\n    if (!isPasswordMatch) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid email or password',\n      });\n    }\n\n    res.status(200).json({\n      success: true,\n      message: 'Login successful',\n      data: {\n        _id: user._id,\n        username: user.username,\n        email: user.email,\n        fullName: user.fullName,\n        avatar: user.avatar,\n        bio: user.bio,\n        subscriber: user.subscriber,\n        subscribed: user.subscribed,\n        token: generateToken(user._id),\n      },\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get current user profile\n// @route   GET /api/auth/me\n// @access  Private\nexport const getMe = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id)\n      .populate('subscriber', 'username fullName avatar')\n      .populate('subscribed', 'username fullName avatar');\n\n    res.status(200).json({\n      success: true,\n      data: user,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Logout user (client-side token removal)\n// @route   POST /api/auth/logout\n// @access  Private\nexport const logout = async (req, res) => {\n  res.status(200).json({\n    success: true,\n    message: 'Logout successful',\n  });\n};\n","size_bytes":3379},"SECURITY_AUDIT.md":{"content":" dev# ğŸ”’ Security Audit Report - friendflix\n\n## Executive Summary\nOverall Security Score: **7/10** (Good, but needs improvements)\n\n---\n\n## âœ… Current Security Measures (Good)\n\n### 1. **Authentication & Authorization**\n- âœ… JWT-based authentication\n- âœ… bcrypt password hashing (10 rounds)\n- âœ… Password excluded from queries (`select: false`)\n- âœ… Protected routes with auth middleware\n- âœ… Role-based access control (user, creator, business, admin)\n\n### 2. **API Security**\n- âœ… CORS configured properly\n- âœ… Error handling middleware\n- âœ… Input validation on models\n- âœ… MongoDB injection protection (using Mongoose)\n\n### 3. **Data Protection**\n- âœ… Environment variables for secrets\n- âœ… .gitignore properly configured\n- âœ… Passwords never returned in responses\n\n---\n\n## âŒ Critical Security Issues\n\n### 1. **Missing Rate Limiting** ğŸ”´ HIGH PRIORITY\n**Risk:** Brute force attacks, DDoS, API abuse\n\n**Solution:** Install rate limiting\n```bash\ncd backend\nnpm install express-rate-limit\n```\n\n```javascript\n// backend/server.js\nimport rateLimit from 'express-rate-limit';\n\nconst limiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 100, // limit each IP to 100 requests per windowMs\n  message: 'Too many requests from this IP'\n});\n\napp.use('/api/', limiter);\n\n// Stricter limits for auth\nconst authLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 5,\n  skipSuccessfulRequests: true\n});\n\napp.use('/api/auth/login', authLimiter);\napp.use('/api/auth/register', authLimiter);\n```\n\n### 2. **Missing Security Headers** ğŸ”´ HIGH PRIORITY\n**Risk:** XSS, Clickjacking, MIME-sniffing attacks\n\n**Solution:** Install helmet\n```bash\nnpm install helmet\n```\n\n```javascript\n// backend/server.js\nimport helmet from 'helmet';\n\napp.use(helmet({\n  contentSecurityPolicy: {\n    directives: {\n      defaultSrc: [\"'self'\"],\n      styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n      scriptSrc: [\"'self'\"],\n      imgSrc: [\"'self'\", 'data:', 'https://res.cloudinary.com'],\n    },\n  },\n  crossOriginEmbedderPolicy: false,\n}));\n```\n\n### 3. **No Input Sanitization** ğŸ”´ HIGH PRIORITY\n**Risk:** XSS attacks, MongoDB injection\n\n**Solution:** Install sanitization packages\n```bash\nnpm install express-mongo-sanitize xss-clean\n```\n\n```javascript\nimport mongoSanitize from 'express-mongo-sanitize';\nimport xss from 'xss-clean';\n\napp.use(mongoSanitize()); // Prevent NoSQL injection\napp.use(xss()); // Prevent XSS attacks\n```\n\n### 4. **Weak Password Policy** ğŸŸ¡ MEDIUM PRIORITY\n**Current:** Minimum 6 characters\n**Risk:** Weak passwords easily cracked\n\n**Solution:** Strengthen requirements\n```javascript\n// backend/models/User.js\npassword: {\n  type: String,\n  required: [true, 'Password is required'],\n  minlength: [8, 'Password must be at least 8 characters'],\n  validate: {\n    validator: function(v) {\n      // At least one uppercase, one lowercase, one number\n      return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}$/.test(v);\n    },\n    message: 'Password must contain uppercase, lowercase, and number'\n  },\n  select: false,\n}\n```\n\n### 5. **JWT Token Issues** ğŸŸ¡ MEDIUM PRIORITY\n**Issues:**\n- 30-day expiration is too long\n- No refresh token mechanism\n- Token stored in localStorage (vulnerable to XSS)\n\n**Solution:** Implement refresh tokens\n```javascript\n// Generate access token (short-lived)\nconst accessToken = jwt.sign({ id }, JWT_SECRET, { expiresIn: '15m' });\n\n// Generate refresh token (long-lived)\nconst refreshToken = jwt.sign({ id }, REFRESH_SECRET, { expiresIn: '7d' });\n\n// Store refresh token in httpOnly cookie\nres.cookie('refreshToken', refreshToken, {\n  httpOnly: true,\n  secure: process.env.NODE_ENV === 'production',\n  sameSite: 'strict',\n  maxAge: 7 * 24 * 60 * 60 * 1000 // 7 days\n});\n```\n\n### 6. **Missing HTTPS Enforcement** ğŸŸ¡ MEDIUM PRIORITY\n**Risk:** Man-in-the-middle attacks\n\n**Solution:**\n```javascript\n// backend/server.js\nif (process.env.NODE_ENV === 'production') {\n  app.use((req, res, next) => {\n    if (req.header('x-forwarded-proto') !== 'https') {\n      res.redirect(`https://${req.header('host')}${req.url}`);\n    } else {\n      next();\n    }\n  });\n}\n```\n\n### 7. **No File Upload Validation** ğŸŸ¡ MEDIUM PRIORITY\n**Risk:** Malicious file uploads\n\n**Solution:** Add file validation\n```javascript\n// backend/middleware/uploadMiddleware.js\nimport multer from 'multer';\n\nconst storage = multer.memoryStorage();\n\nconst fileFilter = (req, file, cb) => {\n  // Only allow images and videos\n  if (file.mimetype.startsWith('image/') || file.mimetype.startsWith('video/')) {\n    cb(null, true);\n  } else {\n    cb(new Error('Invalid file type. Only images and videos allowed.'), false);\n  }\n};\n\nexport const upload = multer({\n  storage,\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB\n  },\n  fileFilter,\n});\n```\n\n### 8. **Socket.io Security** ğŸŸ¢ LOW PRIORITY\n**Current:** Basic JWT validation\n**Improvements:**\n```javascript\n// Add more security to socket.io\nio.use((socket, next) => {\n  const token = socket.handshake.auth.token;\n  \n  if (!token) {\n    return next(new Error('Authentication error'));\n  }\n\n  try {\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n    \n    // Check if user still exists and is not banned\n    User.findById(decoded.id).then(user => {\n      if (!user || user.isBanned) {\n        return next(new Error('User not found or banned'));\n      }\n      socket.userId = decoded.id;\n      socket.user = user;\n      next();\n    });\n  } catch (error) {\n    next(new Error('Invalid token'));\n  }\n});\n```\n\n### 9. **Missing Account Security Features**\n**Recommendations:**\n- Two-factor authentication (2FA)\n- Email verification\n- Password reset functionality\n- Login activity tracking\n- Suspicious login detection\n\n### 10. **No Content Security Policy for Uploads**\n**Risk:** Malicious content in user uploads\n\n**Solution:**\n- Scan uploaded files for viruses\n- Strip EXIF data from images\n- Use signed URLs for temporary access\n\n---\n\n## ğŸ› ï¸ Immediate Action Items\n\n### Week 1 (Critical):\n1. âœ… Install and configure helmet\n2. âœ… Add rate limiting\n3. âœ… Implement input sanitization\n4. âœ… Add file upload validation\n\n### Week 2 (High Priority):\n5. â³ Strengthen password requirements\n6. â³ Implement refresh token mechanism\n7. â³ Add email verification\n8. â³ HTTPS enforcement in production\n\n### Week 3 (Medium Priority):\n9. ğŸ“ Add 2FA support\n10. ğŸ“ Implement password reset\n11. ğŸ“ Add login activity logging\n12. ğŸ“ Content moderation tools\n\n### Ongoing:\n- Regular security audits\n- Dependency updates (`npm audit`)\n- Penetration testing\n- Security awareness training\n\n---\n\n## ğŸ“š Security Best Practices Checklist\n\n### Authentication:\n- [x] Password hashing\n- [ ] Password strength requirements (needs improvement)\n- [ ] Email verification\n- [ ] Password reset\n- [ ] 2FA support\n- [ ] Session management\n- [ ] Refresh tokens\n\n### API Security:\n- [ ] Rate limiting (needs implementation)\n- [ ] Input validation (partial)\n- [ ] Input sanitization (needs implementation)\n- [x] CORS configuration\n- [ ] Security headers (needs helmet)\n- [x] Error handling\n- [ ] API versioning\n\n### Data Protection:\n- [x] Environment variables\n- [x] .gitignore configuration\n- [ ] Data encryption at rest\n- [x] Secure password storage\n- [ ] PII handling procedures\n\n### Infrastructure:\n- [ ] HTTPS enforcement\n- [ ] Security monitoring\n- [ ] Backup strategy\n- [ ] Disaster recovery plan\n- [ ] Logging and auditing\n\n### Compliance:\n- [ ] GDPR compliance\n- [ ] Privacy policy\n- [ ] Terms of service\n- [ ] Cookie policy\n- [ ] Data retention policy\n\n---\n\n## ğŸ” Security Testing Tools\n\n### Recommended:\n1. **npm audit** - Check for vulnerable dependencies\n   ```bash\n   npm audit\n   npm audit fix\n   ```\n\n2. **OWASP ZAP** - Web application security scanner\n\n3. **Snyk** - Continuous security monitoring\n   ```bash\n   npm install -g snyk\n   snyk test\n   ```\n\n4. **ESLint Security Plugin**\n   ```bash\n   npm install --save-dev eslint-plugin-security\n   ```\n\n---\n\n## ğŸ“ Contact for Security Issues\n\nIf you discover a security vulnerability, please report it privately to:\n- Email: security@friendflix.com\n- Do NOT create a public GitHub issue\n\n---\n\n## ğŸ“… Next Security Review: [Date + 3 months]\n","size_bytes":8168},"frontend/src/pages/Chat.jsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { messageAPI, userAPI } from '../services/api';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\nimport Loader from '../components/Loader';\nimport { timeAgo } from '../utils/timeAgo';\nimport { AiOutlineSend, AiOutlineArrowLeft, AiOutlinePhone, AiOutlineVideoCamera } from 'react-icons/ai';\nimport { BsThreeDotsVertical } from 'react-icons/bs';\n\nconst Chat = () => {\n  const { username } = useParams();\n  const navigate = useNavigate();\n  const { user: currentUser } = useAuth();\n  const [otherUser, setOtherUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const [isOnline, setIsOnline] = useState(false);\n  const [showMenu, setShowMenu] = useState(false);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isBlocked, setIsBlocked] = useState(false);\n  const [isTyping, setIsTyping] = useState(false);\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\n  const [showReactions, setShowReactions] = useState(null);\n  const [typingEnabled, setTypingEnabled] = useState(true);\n  const [readReceiptsEnabled, setReadReceiptsEnabled] = useState(true);\n  const [expiryHours, setExpiryHours] = useState(null);\n  const messagesEndRef = useRef(null);\n  const typingTimeoutRef = useRef(null);\n  const fileInputRef = useRef(null);\n  const recorderRef = useRef(null);\n  const mediaStreamRef = useRef(null);\n  const chunksRef = useRef([]);\n  const recordTimerRef = useRef(null);\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordSeconds, setRecordSeconds] = useState(0);\n  \n  const reactions = ['ğŸ‘', 'â¤ï¸', 'ğŸ”¥', 'ğŸ˜‚', 'ğŸ˜¢', 'ğŸ˜¡'];\n\n  useEffect(() => {\n    // Reset state when switching conversations\n    setMessages([]);\n    setLoading(true);\n    fetchUserAndMessages();\n    \n    // Cleanup function\n    return () => {\n      setMessages([]);\n      setShowMenu(false);\n    };\n  }, [username]);\n\n  useEffect(() => {\n    if (!otherUser) return;\n\n    const handleNewMessage = (message) => {\n      console.log('ğŸ“¨ New message received:', message);\n      \n      // Check if message belongs to current conversation\n      const isFromOtherUser = message.sender._id === otherUser._id;\n      const isToOtherUser = message.receiver._id === otherUser._id;\n      const isFromCurrentUser = message.sender._id === currentUser._id;\n      const isToCurrentUser = message.receiver._id === currentUser._id;\n\n      // Only add message if it's from the OTHER user to current user\n      // Don't add if it's from current user (already handled by optimistic update)\n      if (isFromOtherUser && isToCurrentUser) {\n        setMessages((prev) => {\n          // Avoid duplicates\n          const exists = prev.some(msg => msg._id === message._id);\n          if (exists) {\n            console.log('âš ï¸ Duplicate message detected, ignoring');\n            return prev;\n          }\n          console.log('âœ… Adding new message from other user');\n          return [...prev, message];\n        });\n        scrollToBottom();\n      }\n    };\n\n    const handleUserOnline = (userId) => {\n      if (userId === otherUser._id) {\n        setIsOnline(true);\n      }\n    };\n\n    const handleUserOffline = (userId) => {\n      if (userId === otherUser._id) {\n        setIsOnline(false);\n      }\n    };\n\n    // Listen for events\n    socketService.on('newMessage', handleNewMessage);\n    socketService.on('userOnline', handleUserOnline);\n    socketService.on('userOffline', handleUserOffline);\n    \n    // Listen for typing status\n    socketService.on('typing', (userId) => {\n      if (userId === otherUser._id) {\n        setIsTyping(true);\n      }\n    });\n\n    socketService.on('stopTyping', (userId) => {\n      if (userId === otherUser._id) {\n        setIsTyping(false);\n      }\n    });\n    \n    // Listen for message reactions\n    socketService.on('messageReaction', (updatedMessage) => {\n      console.log('Reaction received:', updatedMessage);\n      setMessages((prev) =>\n        prev.map((msg) =>\n          msg._id === updatedMessage._id ? updatedMessage : msg\n        )\n      );\n    });\n\n    return () => {\n      socketService.off('newMessage', handleNewMessage);\n      socketService.off('userOnline', handleUserOnline);\n      socketService.off('userOffline', handleUserOffline);\n      socketService.off('typing');\n      socketService.off('stopTyping');\n      socketService.off('messageReaction');\n    };\n  }, [otherUser, currentUser]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (showMenu && !event.target.closest('.menu-container')) {\n        setShowMenu(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [showMenu]);\n\n  const fetchUserAndMessages = async () => {\n    try {\n      // Get other user profile\n      const userResponse = await userAPI.getProfile(username);\n      setOtherUser(userResponse.data.data);\n\n      // Get conversation\n      const messagesResponse = await messageAPI.getConversation(userResponse.data.data._id);\n      setMessages(messagesResponse.data.data);\n\n      // Get per-thread metadata\n      const metaRes = await messageAPI.getConversationMetadata(userResponse.data.data._id);\n      const meta = metaRes.data.data || {};\n      setTypingEnabled(meta.typingIndicatorEnabled ?? true);\n      setReadReceiptsEnabled(meta.readReceiptsEnabled ?? true);\n      setExpiryHours(meta.messageExpiryHours ?? null);\n    } catch (error) {\n      toast.error('Failed to load conversation');\n      navigate('/messages');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const handleTyping = () => {\n    if (!typingEnabled) return;\n    // Emit typing event\n    socketService.emit('typing', { receiverId: otherUser._id });\n\n    // Clear previous timeout\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n\n    // Stop typing after 2 seconds of inactivity\n    typingTimeoutRef.current = setTimeout(() => {\n      socketService.emit('stopTyping', { receiverId: otherUser._id });\n    }, 2000);\n  };\n\n  const handleFileUpload = async (file) => {\n    if (!file) return;\n    try {\n      const response = await messageAPI.sendAttachment(otherUser._id, file);\n      const msg = response.data.data;\n      setMessages(prev => [...prev, msg]);\n      scrollToBottom();\n    } catch (e) {\n      toast.error('Failed to send attachment');\n    }\n  };\n  \n  const handleAddReaction = async (messageId, emoji) => {\n    try {\n      await messageAPI.addReaction(messageId, emoji);\n      setShowReactions(null);\n      // Socket will update the message automatically\n    } catch (error) {\n      toast.error('Failed to add reaction');\n    }\n  };\n\n  const startRecording = async () => {\n    if (isRecording) return;\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      mediaStreamRef.current = stream;\n      const recorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });\n      chunksRef.current = [];\n      recorder.ondataavailable = (e) => { if (e.data.size > 0) chunksRef.current.push(e.data); };\n      recorder.onstop = async () => {\n        const blob = new Blob(chunksRef.current, { type: 'audio/webm' });\n        await sendVoiceMessage(blob);\n        chunksRef.current = [];\n      };\n      recorderRef.current = recorder;\n      recorder.start();\n      setIsRecording(true);\n      setRecordSeconds(0);\n      recordTimerRef.current = setInterval(() => setRecordSeconds((s) => s + 1), 1000);\n    } catch (err) {\n      toast.error('Mic permission denied');\n    }\n  };\n\n  const stopRecording = () => {\n    if (!isRecording) return;\n    try { recorderRef.current?.stop(); } catch {}\n    setIsRecording(false);\n    if (recordTimerRef.current) { clearInterval(recordTimerRef.current); recordTimerRef.current = null; }\n    if (mediaStreamRef.current) { mediaStreamRef.current.getTracks().forEach(t => t.stop()); mediaStreamRef.current = null; }\n  };\n\n  const sendVoiceMessage = async (blob) => {\n    if (!otherUser?._id) return;\n    setSending(true);\n    try {\n      const file = new File([blob], `voice-${Date.now()}.webm`, { type: 'audio/webm' });\n      const response = await messageAPI.sendVoiceMessage(otherUser._id, file);\n      const msg = response.data.data;\n      setMessages(prev => [...prev, msg]);\n      scrollToBottom();\n    } catch (e) {\n      toast.error('Failed to send voice message');\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const handleSend = async (e) => {\n    e.preventDefault();\n\n    if (!newMessage.trim() || sending) return;\n\n    const messageText = newMessage;\n    const tempId = `temp-${Date.now()}`;\n    \n    // Optimistic UI update\n    const tempMessage = {\n      _id: tempId,\n      text: messageText,\n      sender: {\n        _id: currentUser._id,\n        username: currentUser.username,\n        avatar: currentUser.avatar,\n      },\n      receiver: {\n        _id: otherUser._id,\n      },\n      createdAt: new Date().toISOString(),\n    };\n\n    setMessages((prev) => [...prev, tempMessage]);\n    setNewMessage(''); // Clear input immediately\n    \n    // Stop typing indicator\n    socketService.emit('stopTyping', { receiverId: otherUser._id });\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    \n    scrollToBottom();\n    setSending(true);\n    \n    try {\n      const response = await messageAPI.sendMessage(otherUser._id, messageText);\n      const sentMessage = response.data.data;\n      \n      // Replace temp message with real message\n      setMessages((prev) => \n        prev.map(msg => msg._id === tempId ? sentMessage : msg)\n      );\n      scrollToBottom();\n    } catch (error) {\n      // Remove temp message on error\n      setMessages((prev) => prev.filter(msg => msg._id !== tempId));\n      toast.error('Failed to send message');\n      setNewMessage(messageText); // Restore message on error\n    } finally {\n      setSending(false);\n    }\n  };\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  return (\n    <div className=\"flex flex-col h-screen bg-white dark:bg-gray-900\">\n      {/* Chat Header */}\n      <div className=\"bg-white dark:bg-gray-800 border-b dark:border-gray-700 sticky top-0 z-10 shadow-sm\">\n        <div className=\"flex items-center justify-between p-4\">\n          <div className=\"flex items-center space-x-3\">\n            <button\n              onClick={() => navigate('/messages')}\n              className=\"md:hidden hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-full transition\"\n            >\n              <AiOutlineArrowLeft size={24} className=\"dark:text-white\" />\n            </button>\n\n            {/* Avatar - Clickable */}\n            <div \n              className=\"relative cursor-pointer\"\n              onClick={() => navigate(`/profile/${otherUser.username}`)}\n            >\n              <img\n                src={otherUser.avatar}\n                alt={otherUser.username}\n                className=\"h-12 w-12 rounded-full object-cover border-2 border-gray-200 dark:border-gray-600 hover:opacity-80 transition\"\n              />\n              {/* Online Status Indicator */}\n              {isOnline && (\n                <span className=\"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full\"></span>\n              )}\n            </div>\n\n            {/* User Info - Clickable */}\n            <div \n              className=\"flex-1 cursor-pointer\"\n              onClick={() => navigate(`/profile/${otherUser.username}`)}\n            >\n              <p className=\"font-semibold dark:text-white hover:underline\">{otherUser.username}</p>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                {isTyping ? (\n                  <span className=\"text-primary font-medium animate-pulse\">typing...</span>\n                ) : isOnline ? (\n                  <span className=\"text-green-500 font-medium\">â— Online</span>\n                ) : (\n                  otherUser.fullName\n                )}\n              </p>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex items-center space-x-1 md:space-x-2\">\n            <button\n              onClick={() => navigate(`/video-call/${otherUser._id}`)}\n              className=\"p-2 md:p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition touch-target\"\n              title=\"Video Call\"\n            >\n              <AiOutlineVideoCamera size={22} className=\"text-gray-600 dark:text-gray-300 md:w-6 md:h-6\" />\n            </button>\n            <button\n              onClick={() => { socketService.emit('call:invite', { to: otherUser._id, roomId: otherUser._id, type: 'audio', from: currentUser._id }); navigate(`/audio-call/${otherUser._id}?initiator=1`); }}\n              className=\"p-2 md:p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition touch-target\"\n              title=\"Audio Call\"\n            >\n              <AiOutlinePhone size={22} className=\"text-gray-600 dark:text-gray-300 md:w-6 md:h-6\" />\n            </button>\n            \n            {/* Three Dots Menu */}\n            <div className=\"relative menu-container\">\n              <button\n                onClick={() => setShowMenu(!showMenu)}\n                className=\"p-2 md:p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition touch-target\"\n                title=\"More Options\"\n              >\n                <BsThreeDotsVertical size={20} className=\"text-gray-600 dark:text-gray-300\" />\n              </button>\n\n              {/* Dropdown Menu */}\n              {showMenu && (\n                <div className=\"absolute right-0 top-12 w-64 max-w-[90vw] bg-white dark:bg-gray-800 rounded-lg shadow-xl py-2 border border-gray-200 dark:border-gray-700 z-50 animate-fadeIn max-h-[80vh] overflow-y-auto\">\n                  {/* View Profile */}\n                  <button\n                    onClick={() => {\n                      navigate(`/profile/${otherUser.username}`);\n                      setShowMenu(false);\n                    }}\n                    className=\"w-full flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 text-left transition\"\n                  >\n                    <svg className=\"w-5 h-5 text-gray-600 dark:text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n                    </svg>\n                    <div>\n                      <p className=\"font-semibold dark:text-white\">View Profile</p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">See user profile</p>\n                    </div>\n                  </button>\n\n                  {/* Mute Notifications */}\n                  <button\n                    onClick={() => {\n                      setIsMuted(!isMuted);\n                      toast.success(isMuted ? 'Notifications unmuted' : 'Notifications muted');\n                      setShowMenu(false);\n                    }}\n                    className=\"w-full flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 text-left transition\"\n                  >\n                    <svg className=\"w-5 h-5 text-gray-600 dark:text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      {isMuted ? (\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z\" />\n                      ) : (\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z\" clip-rule=\"evenodd\" />\n                      )}\n                      {isMuted && (\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 3l18 18\" />\n                      )}\n                    </svg>\n                    <div>\n                      <p className=\"font-semibold dark:text-white\">{isMuted ? 'Unmute' : 'Mute'} Notifications</p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                        {isMuted ? 'Turn on notifications' : 'Turn off notifications'}\n                      </p>\n                    </div>\n                  </button>\n\n                  {/* Media Visibility */}\n                  <button\n                    onClick={() => {\n                      toast('Media settings coming soon!');\n                      setShowMenu(false);\n                    }}\n                    className=\"w-full flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 text-left transition\"\n                  >\n                    <svg className=\"w-5 h-5 text-gray-600 dark:text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                    </svg>\n                    <div>\n                      <p className=\"font-semibold dark:text-white\">Media Visibility</p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Control media downloads</p>\n                    </div>\n                  </button>\n\n                  {/* Read Receipts Toggle */}\n                  <button\n                    onClick={async () => {\n                      try {\n                        const res = await messageAPI.updateConversationSettings(otherUser._id, { readReceiptsEnabled: !readReceiptsEnabled });\n                        setReadReceiptsEnabled(res.data.data.readReceiptsEnabled);\n                        toast.success(res.data.message || 'Updated');\n                      } catch { toast.error('Failed to update'); }\n                    }}\n                    className=\"w-full flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 text-left transition\"\n                  >\n                    <svg className=\"w-5 h-5 text-gray-600 dark:text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4M7 20h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v11a2 2 0 002 2z\" />\n                    </svg>\n                    <div>\n                      <p className=\"font-semibold dark:text-white\">Read Receipts: {readReceiptsEnabled ? 'On' : 'Off'}</p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Show when messages are read</p>\n                    </div>\n                  </button>\n\n                  {/* Disappearing Messages Toggle */}\n                  <div className=\"px-4 py-2\">\n                    <label className=\"text-xs text-gray-500 dark:text-gray-400\">Disappearing messages</label>\n                    <div className=\"mt-2 flex items-center gap-2\">\n                      <select\n                        value={expiryHours ?? ''}\n                        onChange={async (e) => {\n                          const val = e.target.value === '' ? null : parseInt(e.target.value, 10);\n                          try {\n                            const res = await messageAPI.updateConversationExpiry(otherUser._id, val);\n                            setExpiryHours(res.data.data.messageExpiryHours ?? null);\n                            toast.success(res.data.message || 'Updated');\n                          } catch { toast.error('Failed to update'); }\n                        }}\n                        className=\"border dark:border-gray-700 rounded px-2 py-1 text-sm dark:bg-gray-800 dark:text-white\"\n                      >\n                        <option value=\"\">Off</option>\n                        <option value=\"1\">1 hour</option>\n                        <option value=\"24\">24 hours</option>\n                        <option value=\"168\">7 days</option>\n                      </select>\n                    </div>\n                    {expiryHours ? (\n                      <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Messages will auto-delete after {expiryHours}h.</p>\n                    ) : null}\n                  </div>\n\n                  {/* Clear Chat */}\n                  <button\n                    onClick={() => {\n                      if (confirm('Clear all messages in this chat?')) {\n                        setMessages([]);\n                        toast.success('Chat cleared');\n                      }\n                      setShowMenu(false);\n                    }}\n                    className=\"w-full flex items-center space-x-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 text-left transition\"\n                  >\n                    <svg className=\"w-5 h-5 text-gray-600 dark:text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n                    </svg>\n                    <div>\n                      <p className=\"font-semibold dark:text-white\">Clear Chat</p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Delete all messages</p>\n                    </div>\n                  </button>\n\n                  <hr className=\"my-2 border-gray-200 dark:border-gray-700\" />\n\n                  {/* Block User */}\n                  <button\n                    onClick={() => {\n                      if (confirm(`${isBlocked ? 'Unblock' : 'Block'} ${otherUser.username}?`)) {\n                        setIsBlocked(!isBlocked);\n                        toast.success(isBlocked ? `${otherUser.username} unblocked` : `${otherUser.username} blocked`);\n                      }\n                      setShowMenu(false);\n                    }}\n                    className=\"w-full flex items-center space-x-3 px-4 py-3 hover:bg-red-50 dark:hover:bg-red-900/20 text-left transition\"\n                  >\n                    <svg className=\"w-5 h-5 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636\" />\n                    </svg>\n                    <div>\n                      <p className=\"font-semibold text-red-500\">{isBlocked ? 'Unblock' : 'Block'} {otherUser.username}</p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                        {isBlocked ? 'Allow messages again' : 'Stop receiving messages'}\n                      </p>\n                    </div>\n                  </button>\n\n                  {/* Report User */}\n                  <button\n                    onClick={() => {\n                      toast.error('Report feature coming soon!');\n                      setShowMenu(false);\n                    }}\n                    className=\"w-full flex items-center space-x-3 px-4 py-3 hover:bg-red-50 dark:hover:bg-red-900/20 text-left transition\"\n                  >\n                    <svg className=\"w-5 h-5 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n                    </svg>\n                    <div>\n                      <p className=\"font-semibold text-red-500\">Report User</p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">Report inappropriate content</p>\n                    </div>\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4 pb-32 md:pb-4\">\n        {messages.length === 0 ? (\n          <div className=\"flex items-center justify-center h-full\">\n            <p className=\"text-gray-500 dark:text-gray-400\">\n              No messages yet. Say hi! ğŸ‘‹\n            </p>\n          </div>\n        ) : (\n          <>\n            {messages.map((message, index) => {\n              const isOwnMessage = message.sender._id === currentUser._id;\n              // Show avatar only if:\n              // 1. It's the last message overall, OR\n              // 2. Next message is from different sender\n              const nextMessage = messages[index + 1];\n              const showAvatar = !nextMessage || nextMessage.sender._id !== message.sender._id;\n              \n              return (\n                <div\n                  key={message._id}\n                  className={`flex items-end ${\n                    isOwnMessage ? 'justify-end' : 'justify-start'\n                  }`}\n                >\n                  {/* Left side - for received messages */}\n                  {!isOwnMessage && (\n                    <div className=\"flex items-end space-x-2\">\n                      {/* Avatar - only show for last message in group */}\n                      {showAvatar ? (\n                        <img\n                          src={otherUser.avatar}\n                          alt={otherUser.username}\n                          className=\"h-8 w-8 rounded-full object-cover flex-shrink-0\"\n                        />\n                      ) : (\n                        <div className=\"w-8 flex-shrink-0\"></div>\n                      )}\n                      \n                      {/* Message Bubble */}\n                      <div className=\"relative group\">\n                        <div \n                          className=\"max-w-xs md:max-w-md px-4 py-2 rounded-2xl shadow-sm bg-gray-200 dark:bg-gray-700 text-black dark:text-white rounded-bl-sm cursor-pointer\"\n                          onDoubleClick={() => setShowReactions(message._id)}\n                        >\n                          {message.image ? (\n                            <img src={message.image} alt=\"Image\" className=\"max-w-xs md:max-w-md rounded-md\" />\n                          ) : message.video ? (\n                            <video src={message.video} controls className=\"w-64\" />\n                          ) : message.audio ? (\n                            <audio src={message.audio} controls className=\"w-48\" />\n                          ) : message.fileUrl ? (\n                            <a href={message.fileUrl} target=\"_blank\" rel=\"noreferrer\" className=\"text-blue-600 underline break-words\">{message.fileName || 'Download file'}</a>\n                          ) : (\n                            <p className=\"break-words\">{message.text}</p>\n                          )}\n                          <p className=\"text-xs mt-1 text-gray-500 dark:text-gray-400\">\n                            {timeAgo(message.createdAt)}\n                          </p>\n                        </div>\n                        \n                        {/* Reaction Button (appears on hover) */}\n                        <button\n                          onClick={() => setShowReactions(showReactions === message._id ? null : message._id)}\n                          className=\"absolute -bottom-2 right-2 hidden group-hover:block bg-white dark:bg-gray-800 rounded-full p-1 shadow-lg\"\n                        >\n                          <svg className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z\" clipRule=\"evenodd\" />\n                          </svg>\n                        </button>\n                        \n                        {/* Reactions Popup */}\n                        {showReactions === message._id && (\n                          <div className=\"absolute -bottom-12 left-0 bg-white dark:bg-gray-800 rounded-full shadow-xl px-3 py-2 flex space-x-2 z-50 animate-fadeIn\">\n                            {reactions.map((emoji, idx) => (\n                              <button\n                                key={idx}\n                                onClick={() => handleAddReaction(message._id, emoji)}\n                                className=\"text-2xl hover:scale-125 transition-transform\"\n                              >\n                                {emoji}\n                              </button>\n                            ))}\n                          </div>\n                        )}\n                        \n                        {/* Display Reactions */}\n                        {message.reactions && message.reactions.length > 0 && (\n                          <div className=\"absolute -bottom-5 left-2 flex space-x-1\">\n                            {message.reactions.map((reaction, idx) => (\n                              <span\n                                key={idx}\n                                className=\"bg-white dark:bg-gray-800 rounded-full px-2 py-0.5 text-sm shadow-md border border-gray-200 dark:border-gray-700\"\n                                title={reaction.user?.username}\n                              >\n                                {reaction.emoji}\n                              </span>\n                            ))}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Right side - for sent messages */}\n                  {isOwnMessage && (\n                    <div className=\"flex items-end space-x-2\">\n                      {/* Message Bubble */}\n                      <div className=\"relative group\">\n                        <div \n                          className=\"max-w-xs md:max-w-md px-4 py-2 rounded-2xl shadow-sm bg-gradient-primary text-white rounded-br-sm cursor-pointer\"\n                          onDoubleClick={() => setShowReactions(message._id)}\n                        >\n                          {message.image ? (\n                          <img src={message.image} alt=\"Image\" className=\"max-w-xs md:max-w-md rounded-md\" />\n                          ) : message.video ? (\n                          <video src={message.video} controls className=\"w-64\" />\n                          ) : message.audio ? (\n                          <audio src={message.audio} controls className=\"w-48\" />\n                          ) : message.fileUrl ? (\n                          <a href={message.fileUrl} target=\"_blank\" rel=\"noreferrer\" className=\"text-white underline break-words\">{message.fileName || 'Download file'}</a>\n                          ) : (\n                          <p className=\"break-words\">{message.text}</p>\n                          )}\n                          <p className=\"text-xs mt-1 text-purple-100\">\n                            {timeAgo(message.createdAt)}\n                          </p>\n                        </div>\n                        \n                        {/* Reaction Button (appears on hover) */}\n                        <button\n                          onClick={() => setShowReactions(showReactions === message._id ? null : message._id)}\n                          className=\"absolute -bottom-2 left-2 hidden group-hover:block bg-white dark:bg-gray-800 rounded-full p-1 shadow-lg\"\n                        >\n                          <svg className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z\" clipRule=\"evenodd\" />\n                          </svg>\n                        </button>\n                        \n                        {/* Reactions Popup */}\n                        {showReactions === message._id && (\n                          <div className=\"absolute -bottom-12 right-0 bg-white dark:bg-gray-800 rounded-full shadow-xl px-3 py-2 flex space-x-2 z-50 animate-fadeIn\">\n                            {reactions.map((emoji, idx) => (\n                              <button\n                                key={idx}\n                                onClick={() => handleAddReaction(message._id, emoji)}\n                                className=\"text-2xl hover:scale-125 transition-transform\"\n                              >\n                                {emoji}\n                              </button>\n                            ))}\n                          </div>\n                        )}\n                        \n                        {/* Display Reactions */}\n                        {message.reactions && message.reactions.length > 0 && (\n                          <div className=\"absolute -bottom-5 right-2 flex space-x-1\">\n                            {message.reactions.map((reaction, idx) => (\n                              <span\n                                key={idx}\n                                className=\"bg-white dark:bg-gray-800 rounded-full px-2 py-0.5 text-sm shadow-md border border-gray-200 dark:border-gray-700\"\n                                title={reaction.user?.username}\n                              >\n                                {reaction.emoji}\n                              </span>\n                            ))}\n                          </div>\n                        )}\n                      </div>\n                      \n                      {/* Avatar - only show for last message in group */}\n                      {showAvatar ? (\n                        <img\n                          src={currentUser.avatar}\n                          alt={currentUser.username}\n                          className=\"h-8 w-8 rounded-full object-cover flex-shrink-0\"\n                        />\n                      ) : (\n                        <div className=\"w-8 flex-shrink-0\"></div>\n                      )}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n            <div ref={messagesEndRef} />\n          </>\n        )}\n      </div>\n\n      {/* Message Input */}\n      <div className=\"card dark:bg-gray-800 dark:border-gray-700 rounded-none border-t fixed bottom-16 md:sticky md:bottom-0 left-0 right-0 z-40 safe-bottom\">\n        {/* Emoji Picker */}\n        {showEmojiPicker && (\n          <div className=\"p-4 border-b dark:border-gray-700\">\n            <div className=\"grid grid-cols-8 gap-2\">\n              {['ğŸ˜€', 'ğŸ˜‚', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤”', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜¡', 'ğŸ¤¯', 'ğŸ¥³', 'ğŸ˜‡', 'ğŸ¤—', 'ğŸ™', 'ğŸ‘', 'ğŸ‘', 'ğŸ‘', 'ğŸ™Œ', 'ğŸ’ª', 'â¤ï¸', 'ğŸ’”', 'ğŸ”¥', 'âœ¨', 'ğŸ’¯', 'ğŸ‰', 'ğŸŠ', 'ğŸˆ', 'ğŸ', 'ğŸ†', 'â­', 'ğŸ’«', 'âœ…'].map((emoji, idx) => (\n                <button\n                  key={idx}\n                  type=\"button\"\n                  onClick={() => {\n                    setNewMessage(prev => prev + emoji);\n                    setShowEmojiPicker(false);\n                  }}\n                  className=\"text-2xl hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded transition\"\n                >\n                  {emoji}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n        \n        <form onSubmit={handleSend} className=\"flex items-center space-x-1 md:space-x-2 p-3 md:p-4\">\n          <button\n            type=\"button\"\n            onClick={() => setShowEmojiPicker(!showEmojiPicker)}\n            className=\"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition flex-shrink-0\"\n            title=\"Add emoji\"\n          >\n            <svg className=\"w-5 h-5 md:w-6 md:h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z\" clipRule=\"evenodd\" />\n            </svg>\n          </button>\n          {!isRecording ? (\n            <button\n              type=\"button\"\n              onClick={startRecording}\n              className=\"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition flex-shrink-0 hidden md:block\"\n              title=\"Record voice\"\n            >\n              <svg className=\"w-5 h-5 md:w-6 md:h-6\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                <path d=\"M12 14a3 3 0 003-3V6a3 3 0 00-6 0v5a3 3 0 003 3z\" />\n                <path d=\"M19 11a7 7 0 01-14 0h2a5 5 0 0010 0h2zM12 19v3h-2v-3h2z\" />\n              </svg>\n            </button>\n          ) : (\n            <button\n              type=\"button\"\n              onClick={stopRecording}\n              className=\"px-2 md:px-3 py-1 md:py-2 bg-red-500 text-white text-sm rounded-full transition flex-shrink-0\"\n              title=\"Stop recording\"\n            >\n              {recordSeconds.toString().padStart(2,'0')}s\n            </button>\n          )}\n          \n          <input\n            type=\"text\"\n            placeholder=\"Message...\"\n            value={newMessage}\n            onChange={(e) => {\n              setNewMessage(e.target.value);\n              handleTyping();\n            }}\n            onKeyPress={(e) => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handleSend(e);\n              }\n            }}\n            className=\"flex-1 py-2 px-3 md:px-4 text-sm md:text-base border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-full focus:outline-none focus:ring-2 focus:ring-primary\"\n          />\n          \n          {/* Media Picker Button */}\n          <button\n            type=\"button\"\n            onClick={() => fileInputRef.current?.click()}\n            className=\"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition flex-shrink-0\"\n            title=\"Attach media\"\n          >\n            <svg className=\"w-5 h-5 md:w-6 md:h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\n            </svg>\n          </button>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/*,video/*,audio/*,application/*\"\n            className=\"hidden\"\n            onChange={(e) => handleFileUpload(e.target.files[0])}\n          />\n\n          {/* Camera Button - Hidden on Mobile */}\n          <button\n            type=\"button\"\n            onClick={() => toast('Camera feature coming soon!')}\n            className=\"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition flex-shrink-0 hidden md:block\"\n            title=\"Take photo\"\n          >\n            <svg className=\"w-5 h-5 md:w-6 md:h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\" />\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\" />\n            </svg>\n          </button>\n          <button\n            type=\"submit\"\n            disabled={sending || !newMessage.trim()}\n            className={`p-2 md:p-3 rounded-full transition flex-shrink-0 ${\n              newMessage.trim()\n                ? 'bg-primary text-white hover:bg-blue-600'\n                : 'bg-gray-200 dark:bg-gray-700 text-gray-400 cursor-not-allowed'\n            }`}\n          >\n            <AiOutlineSend size={18} className=\"md:w-5 md:h-5\" />\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default Chat;\n","size_bytes":41004},"frontend/src/pages/Upload.jsx":{"content":"import { useState, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { postAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { AiOutlineCloudUpload } from 'react-icons/ai';\nimport { useAuth } from '../context/AuthContext';\n\nconst Upload = () => {\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  const [category, setCategory] = useState('image');\n  const [previews, setPreviews] = useState([]);\n  const [files, setFiles] = useState([]);\n  const [title, setTitle] = useState('');\n  const [description, setDescription] = useState('');\n  const [caption, setCaption] = useState('');\n  const [visibility, setVisibility] = useState('public');\n  const [madeForKids, setMadeForKids] = useState(false);\n  const [allowComments, setAllowComments] = useState(true);\n  const [thumbnailFile, setThumbnailFile] = useState(null);\n  const [thumbnailPreview, setThumbnailPreview] = useState('');\n  const [scheduledAt, setScheduledAt] = useState('');\n  const [videoLanguage, setVideoLanguage] = useState('en');\n  const [license, setLicense] = useState('standard');\n  const [topicCategory, setTopicCategory] = useState('');\n  const [playlistName, setPlaylistName] = useState('');\n  const [paidPromotion, setPaidPromotion] = useState(false);\n  const [ageRestricted, setAgeRestricted] = useState(false);\n  const [allowEmbedding, setAllowEmbedding] = useState(true);\n  const [locationLat, setLocationLat] = useState('');\n  const [locationLng, setLocationLng] = useState('');\n  const [tags, setTags] = useState('');\n  const [location, setLocation] = useState('');\n  const [loading, setLoading] = useState(false);\n  const routerLocation = useLocation();\n  const [videoStartSec, setVideoStartSec] = useState(0);\n  const [videoEndSec, setVideoEndSec] = useState(60);\n  const [playbackRate, setPlaybackRate] = useState(1);\n\n  const recordStreamRef = useRef(null);\n  const recorderRef = useRef(null);\n  const recordChunksRef = useRef([]);\n  const recordTimerRef = useRef(null);\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordSeconds, setRecordSeconds] = useState(0);\n\n  const handleFileChange = async (e) => {\n    if (!e.target.files || e.target.files.length === 0) {\n      return;\n    }\n\n    const selectedFiles = Array.from(e.target.files);\n\n    // Category-based constraints\n    const isPrivileged = ['creator', 'business', 'admin'].includes(user?.role);\n    if (category === 'long' && !isPrivileged) {\n      toast.error('Only creators, business, or admin can upload long videos');\n      e.target.value = '';\n      return;\n    }\n\n    if (category === 'image') {\n      if (selectedFiles.length > 10) {\n        toast.error('Maximum 10 images allowed');\n        e.target.value = '';\n        return;\n      }\n      for (const file of selectedFiles) {\n        if (!file || !file.type) {\n          toast.error('Invalid file selected');\n          e.target.value = '';\n          return;\n        }\n        if (!file.type.startsWith('image/')) {\n          toast.error('Only images allowed for Image posts');\n          e.target.value = '';\n          return;\n        }\n        if (file.size > 10 * 1024 * 1024) {\n          toast.error('Each image should be less than 10MB');\n          e.target.value = '';\n          return;\n        }\n      }\n    } else {\n      if (selectedFiles.length !== 1) {\n        toast.error('Only one video allowed for Shorts/Long');\n        e.target.value = '';\n        return;\n      }\n      const file = selectedFiles[0];\n      if (!file || !file.type) {\n        toast.error('Invalid file selected');\n        e.target.value = '';\n        return;\n      }\n      if (!file.type.startsWith('video/')) {\n        toast.error('Only video allowed for Shorts/Long');\n        e.target.value = '';\n        return;\n      }\n      if (file.size > 200 * 1024 * 1024) {\n        toast.error('Video should be less than 200MB');\n        e.target.value = '';\n        return;\n      }\n    }\n\n    setFiles(selectedFiles);\n\n    // Create previews and validate video duration if needed\n    const previewPromises = selectedFiles.map((file) => {\n      return new Promise((resolve, reject) => {\n        if (!file) {\n          reject(new Error('Invalid file'));\n          return;\n        }\n\n        if (file.type.startsWith('video/')) {\n          try {\n            const url = URL.createObjectURL(file);\n            const video = document.createElement('video');\n            video.preload = 'metadata';\n            \n            const timeoutId = setTimeout(() => {\n              URL.revokeObjectURL(url);\n              reject(new Error('Video metadata loading timeout'));\n            }, 10000);\n\n            video.onloadedmetadata = () => {\n              clearTimeout(timeoutId);\n              const durationSec = Math.round(video.duration || 0);\n              const limit = category === 'short' ? 60 : 3600;\n              if (category !== 'image' && (durationSec === 0 || durationSec > limit)) {\n                URL.revokeObjectURL(url);\n                reject(new Error(category === 'short' ? 'Shorts must be â‰¤ 60s' : 'Long must be â‰¤ 1 hour'));\n                return;\n              }\n              resolve({ url, type: file.type, durationSec });\n            };\n            \n            video.onerror = (error) => {\n              clearTimeout(timeoutId);\n              URL.revokeObjectURL(url);\n              reject(new Error('Failed to load video metadata. Please try another file.'));\n            };\n\n            video.src = url;\n          } catch (error) {\n            reject(new Error('Failed to process video file'));\n          }\n        } else {\n          try {\n            const reader = new FileReader();\n            reader.onerror = () => {\n              reject(new Error('Failed to read image file'));\n            };\n            reader.onloadend = () => {\n              if (reader.result) {\n                resolve({ url: reader.result, type: file.type });\n              } else {\n                reject(new Error('Failed to read image file'));\n              }\n            };\n            reader.readAsDataURL(file);\n          } catch (error) {\n            reject(new Error('Failed to process image file'));\n          }\n        }\n      });\n    });\n\n    try {\n      const results = await Promise.all(previewPromises);\n      setPreviews(results);\n    } catch (err) {\n      toast.error(err.message || 'Failed to load media file');\n      setFiles([]);\n      setPreviews([]);\n      if (e.target) e.target.value = '';\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    if (files.length === 0) {\n      toast.error('Please select at least one file');\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const formData = new FormData();\n      files.forEach((file) => {\n        formData.append('media', file);\n      });\n      formData.append('title', title);\n      formData.append('description', description);\n      formData.append('caption', caption);\n      formData.append('tags', tags);\n      formData.append('location', location);\n      formData.append('visibility', visibility);\n      formData.append('madeForKids', String(madeForKids));\n      formData.append('allowComments', String(allowComments));\n      if (thumbnailFile) { formData.append('thumbnail', thumbnailFile); }\n      formData.append('category', category);\n      if (scheduledAt) formData.append('scheduledAt', scheduledAt);\n      formData.append('videoLanguage', videoLanguage);\n      formData.append('license', license);\n      if (topicCategory) formData.append('topicCategory', topicCategory);\n      if (playlistName) formData.append('playlistName', playlistName);\n      formData.append('paidPromotion', String(paidPromotion));\n      formData.append('ageRestricted', String(ageRestricted));\n      formData.append('allowEmbedding', String(allowEmbedding));\n      if (locationLat) formData.append('locationLat', String(locationLat));\n      if (locationLng) formData.append('locationLng', String(locationLng));\n\n      // Remix support\n      try {\n        const remixOf = new URLSearchParams(routerLocation.search).get('remixOf');\n        if (remixOf) {\n          formData.append('derivedFrom', remixOf);\n          formData.append('remixType', 'duet');\n          if (category === 'image') {\n            // force short video category for duet\n            formData.set('category', 'short');\n          }\n        }\n      } catch {}\n\n      // Simple video editor metadata\n      if (category !== 'image') {\n        formData.append('videoStartSec', String(videoStartSec || 0));\n        formData.append('videoEndSec', String(videoEndSec || 0));\n        formData.append('playbackRate', String(playbackRate || 1));\n      }\n\n      await postAPI.createPost(formData);\n      toast.success('Post created successfully!');\n      navigate('/');\n    } catch (error) {\n      toast.error(error.response?.data?.message || 'Failed to create post');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const clearPreview = () => {\n    setPreviews([]);\n    setFiles([]);\n  };\n\n  const removeFile = (index) => {\n    setPreviews(previews.filter((_, i) => i !== index));\n    setFiles(files.filter((_, i) => i !== index));\n  };\n\n  // Camera Recording (Video)\n  const startCameraRecording = async () => {\n    try {\n      if (category === 'image') {\n        toast.error('Switch to Shorts/Long to record video');\n        return;\n      }\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\n      recordStreamRef.current = stream;\n      const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });\n      recordChunksRef.current = [];\n      recorder.ondataavailable = (e) => { if (e.data && e.data.size > 0) recordChunksRef.current.push(e.data); };\n      recorder.onstop = async () => {\n        const blob = new Blob(recordChunksRef.current, { type: 'video/webm' });\n        const file = new File([blob], `recording-${Date.now()}.webm`, { type: 'video/webm' });\n        // Generate preview\n        const url = URL.createObjectURL(blob);\n        setPreviews(prev => [...prev, { url, type: 'video/webm', durationSec: recordSeconds }]);\n        setFiles(prev => [...prev, file]);\n        // Cleanup\n        recordChunksRef.current = [];\n        if (recordStreamRef.current) {\n          recordStreamRef.current.getTracks().forEach(t => t.stop());\n          recordStreamRef.current = null;\n        }\n      };\n      recorderRef.current = recorder;\n      recorder.start();\n      setIsRecording(true);\n      setRecordSeconds(0);\n      recordTimerRef.current = setInterval(() => {\n        setRecordSeconds((s) => {\n          const limit = category === 'short' ? 60 : 3600;\n          if (s + 1 >= limit) {\n            stopCameraRecording();\n            return s + 1;\n          }\n          return s + 1;\n        });\n      }, 1000);\n    } catch (err) {\n      toast.error('Camera/mic permission denied');\n    }\n  };\n\n  const stopCameraRecording = () => {\n    try { recorderRef.current?.stop(); } catch {}\n    setIsRecording(false);\n    if (recordTimerRef.current) { clearInterval(recordTimerRef.current); recordTimerRef.current = null; }\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto px-4 py-8\">\n      <h1 className=\"text-2xl font-bold mb-6\">Create New Post</h1>\n\n      <div className=\"card p-6\">\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {/* Category Selector */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Post Type</label>\n            <div className=\"flex gap-2\">\n              <button type=\"button\" className={`btn-outline ${category === 'image' ? 'ring-2 ring-primary' : ''}`} onClick={() => { setCategory('image'); clearPreview(); }}>Image</button>\n              <button type=\"button\" className={`btn-outline ${category === 'short' ? 'ring-2 ring-primary' : ''}`} onClick={() => { setCategory('short'); clearPreview(); }}>Short (â‰¤ 1 min)</button>\n              <button type=\"button\" disabled={!['creator','business','admin'].includes(user?.role)} className={`btn-outline ${category === 'long' ? 'ring-2 ring-primary' : ''} ${!['creator','business','admin'].includes(user?.role) ? 'opacity-50 cursor-not-allowed' : ''}`} onClick={() => { if(['creator','business','admin'].includes(user?.role)){ setCategory('long'); clearPreview(); } }}>Long (â‰¤ 1 hour)</button>\n            </div>\n            {!['creator','business','admin'].includes(user?.role) && (\n              <div className=\"text-xs text-yellow-700 mt-2\">\n                Want to upload long videos? Upgrade to Creator in Settings.\n              </div>\n            )}\n          </div>\n\n          {/* File Upload */}\n          {previews.length === 0 ? (\n            <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-primary transition\">\n              <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\n                <AiOutlineCloudUpload size={64} className=\"mx-auto text-gray-400 mb-4\" />\n                <p className=\"text-gray-600 mb-2\">\n                  Click to upload photo or video\n                </p>\n                <p className=\"text-sm text-gray-400\">Max file size: {category === 'image' ? '10MB/image' : '1500MB video'}</p>\n                <input\n                  id=\"file-upload\"\n                  type=\"file\"\n                  accept={category === 'image' ? 'image/*' : 'video/*'}\n                  multiple={category === 'image'}\n                  onChange={handleFileChange}\n                  className=\"hidden\"\n                />\n              </label>\n              {/* Camera Quick Capture (Mobile) */}\n              <div className=\"mt-4 flex items-center justify-center gap-3\">\n                {category === 'image' ? (\n                  <label className=\"btn-outline cursor-pointer\">\n                    Take Photo\n                    <input type=\"file\" accept=\"image/*\" capture=\"environment\" className=\"hidden\" onChange={handleFileChange} />\n                  </label>\n                ) : (\n                  <>\n                    <label className=\"btn-outline cursor-pointer\">\n                      Capture Video\n                      <input type=\"file\" accept=\"video/*\" capture=\"user\" className=\"hidden\" onChange={handleFileChange} />\n                    </label>\n                    <button type=\"button\" onClick={startCameraRecording} className=\"btn-outline\">\n                      Record (Camera)\n                    </button>\n                  </>\n                )}\n              </div>\n            </div>\n          ) : (\n            <div>\n              {/* Preview Grid */}\n              <div className={`grid gap-4 mb-4 ${\n                previews.length === 1 ? 'grid-cols-1' : 'grid-cols-2'\n              }`}>\n                {previews.map((preview, index) => (\n                  <div key={index} className=\"relative group\">\n                    {preview.type.startsWith('video/') ? (\n                      <video\n                        src={preview.url}\n                        controls\n                        className=\"w-full max-h-64 object-contain rounded-lg bg-black\"\n                      />\n                    ) : (\n                      <img\n                        src={preview.url}\n                        alt={`Preview ${index + 1}`}\n                        className=\"w-full max-h-64 object-contain rounded-lg bg-black\"\n                      />\n                    )}\n                    <button\n                      type=\"button\"\n                      onClick={() => removeFile(index)}\n                      className=\"absolute top-2 right-2 bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 opacity-0 group-hover:opacity-100 transition\"\n                    >\n                      âœ•\n                    </button>\n                    <div className=\"absolute bottom-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-xs\">\n                      {index + 1} / {previews.length}\n                    </div>\n                    {preview.type.startsWith('video/') && preview.durationSec && (\n                      <div className=\"absolute top-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-xs\">\n                        {Math.floor(preview.durationSec/60)}:{String(preview.durationSec%60).padStart(2,'0')}\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n\n              {previews.length < 10 && category === 'image' && (\n                <label htmlFor=\"add-more\" className=\"btn-outline block text-center cursor-pointer mb-4\">\n                  + Add More (Max 10)\n                  <input\n                    id=\"add-more\"\n                    type=\"file\"\n                    accept=\"image/*\"\n                    multiple\n                    onChange={(e) => {\n                      const newFiles = Array.from(e.target.files);\n                      if (files.length + newFiles.length > 10) {\n                        toast.error('Maximum 10 images allowed');\n                        return;\n                      }\n                      handleFileChange(e);\n                    }}\n                    className=\"hidden\"\n                  />\n                </label>\n              )}\n\n              {/* Recording Controls */}\n              {isRecording && (\n                <div className=\"flex items-center gap-3 mb-3\">\n                  <span className=\"px-3 py-1 bg-red-500 text-white rounded-full\">REC {String(recordSeconds).padStart(2,'0')}s</span>\n                  <button type=\"button\" onClick={stopCameraRecording} className=\"btn-secondary\">Stop</button>\n                </div>\n              )}\n\n              {/* Simple Video Editor */}\n              {category !== 'image' && previews.length > 0 && (\n                <div className=\"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg space-y-3\">\n                  <p className=\"text-sm font-semibold dark:text-white\">Simple Editor</p>\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n                    <div>\n                      <label className=\"text-xs text-gray-500 dark:text-gray-400\">Start (sec)</label>\n                      <input type=\"number\" min=\"0\" value={videoStartSec} onChange={(e)=>setVideoStartSec(parseInt(e.target.value||'0',10))} className=\"input-field\" />\n                    </div>\n                    <div>\n                      <label className=\"text-xs text-gray-500 dark:text-gray-400\">End (sec)</label>\n                      <input type=\"number\" min=\"0\" value={videoEndSec} onChange={(e)=>setVideoEndSec(parseInt(e.target.value||'0',10))} className=\"input-field\" />\n                    </div>\n                    <div>\n                      <label className=\"text-xs text-gray-500 dark:text-gray-400\">Speed</label>\n                      <select value={playbackRate} onChange={(e)=>setPlaybackRate(parseFloat(e.target.value))} className=\"input-field\">\n                        <option value={0.5}>0.5x</option>\n                        <option value={0.75}>0.75x</option>\n                        <option value={1}>1x</option>\n                        <option value={1.25}>1.25x</option>\n                        <option value={1.5}>1.5x</option>\n                        <option value={2}>2x</option>\n                      </select>\n                    </div>\n                  </div>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Note: Editing metadata is applied on playback; the uploaded file is not trimmed on server.</p>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Title */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Title\n            </label>\n            <input\n              type=\"text\"\n              value={title}\n              onChange={(e) => setTitle(e.target.value)}\n              placeholder=\"Add a title\"\n              className=\"input-field\"\n              maxLength={100}\n              required\n            />\n            <p className=\"text-xs text-gray-500 mt-1\">{title.length}/100</p>\n          </div>\n\n          {/* Description */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Description\n            </label>\n            <textarea\n              value={description}\n              onChange={(e) => setDescription(e.target.value)}\n              placeholder=\"Describe your content (supports #hashtags and @mentions)\"\n              rows={4}\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent resize-none\"\n              maxLength={5000}\n            />\n            <p className=\"text-xs text-gray-500 mt-1\">{description.length}/5000</p>\n          </div>\n\n          {/* Caption */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Caption\n            </label>\n            <textarea\n              value={caption}\n              onChange={(e) => setCaption(e.target.value)}\n              placeholder=\"Short social caption (optional)\"\n              rows={3}\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent resize-none\"\n            />\n            <button\n              type=\"button\"\n              onClick={() => {\n                const tagList = (tags || '').split(',').map(t=>t.trim()).filter(Boolean);\n                const auto = tagList.slice(0,3).map(t=>`#${t.replace(/\\s+/g,'')}`).join(' ');\n                setCaption(prev => prev ? prev : auto ? `${auto}\\n` : '');\n                toast.success('Caption suggested');\n              }}\n              className=\"mt-2 btn-outline\"\n            >\n              Auto Caption\n            </button>\n          </div>\n\n          {/* Location, Visibility & Audience */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              Details\n            </label>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n              <input\n                type=\"text\"\n                value={location}\n                onChange={(e) => setLocation(e.target.value)}\n                placeholder=\"Add location...\"\n                className=\"input-field\"\n              />\n              <div>\n                <label className=\"text-xs text-gray-500 dark:text-gray-400\">Visibility</label>\n                <select value={visibility} onChange={(e)=>setVisibility(e.target.value)} className=\"input-field\">\n                  <option value=\"public\">Public</option>\n                  <option value=\"unlisted\">Unlisted</option>\n                  <option value=\"private\">Private</option>\n                </select>\n              </div>\n            </div>\n            <div className=\"mt-3 flex flex-wrap items-center gap-6\">\n              <label className=\"flex items-center gap-2 text-sm\">\n                <input type=\"checkbox\" checked={madeForKids} onChange={(e)=>setMadeForKids(e.target.checked)} />\n                Made for kids\n              </label>\n              <label className=\"flex items-center gap-2 text-sm\">\n                <input type=\"checkbox\" checked={allowComments} onChange={(e)=>setAllowComments(e.target.checked)} />\n                Allow comments\n              </label>\n            </div>\n\n            {/* Advanced Settings */}\n            <div className=\"mt-4 space-y-3\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                <div>\n                  <label className=\"text-xs text-gray-500 dark:text-gray-400\">Schedule publish</label>\n                  <input type=\"datetime-local\" value={scheduledAt} onChange={(e)=>setScheduledAt(e.target.value)} className=\"input-field\" />\n                </div>\n                <div>\n                  <label className=\"text-xs text-gray-500 dark:text-gray-400\">Video language</label>\n                  <select value={videoLanguage} onChange={(e)=>setVideoLanguage(e.target.value)} className=\"input-field\">\n                    <option value=\"en\">English</option>\n                    <option value=\"hi\">Hindi</option>\n                    <option value=\"ur\">Urdu</option>\n                    <option value=\"es\">Spanish</option>\n                  </select>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                <div>\n                  <label className=\"text-xs text-gray-500 dark:text-gray-400\">License</label>\n                  <select value={license} onChange={(e)=>setLicense(e.target.value)} className=\"input-field\">\n                    <option value=\"standard\">Standard friendflix License</option>\n                    <option value=\"creative_commons\">Creative Commons</option>\n                  </select>\n                </div>\n                <div>\n                  <label className=\"text-xs text-gray-500 dark:text-gray-400\">Category</label>\n                  <select value={topicCategory} onChange={(e)=>setTopicCategory(e.target.value)} className=\"input-field\">\n                    <option value=\"\">Select category</option>\n                    <option value=\"Education\">Education</option>\n                    <option value=\"Music\">Music</option>\n                    <option value=\"Gaming\">Gaming</option>\n                    <option value=\"Comedy\">Comedy</option>\n                    <option value=\"News\">News</option>\n                    <option value=\"Sports\">Sports</option>\n                    <option value=\"Travel\">Travel</option>\n                    <option value=\"Tech\">Tech</option>\n                  </select>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                <div>\n                  <label className=\"text-xs text-gray-500 dark:text-gray-400\">Playlist</label>\n                  <input type=\"text\" value={playlistName} onChange={(e)=>setPlaylistName(e.target.value)} placeholder=\"Playlist name\" className=\"input-field\" />\n                </div>\n                <div>\n                  <label className=\"text-xs text-gray-500 dark:text-gray-400\">Custom thumbnail</label>\n                  <input \n                    type=\"file\" \n                    accept=\"image/*\" \n                    onChange={(e) => {\n                      if (!e.target.files || e.target.files.length === 0) {\n                        return;\n                      }\n                      const f = e.target.files[0];\n                      if (!f || !f.type) {\n                        toast.error('Invalid file selected');\n                        e.target.value = '';\n                        return;\n                      }\n                      if (!f.type.startsWith('image/')) {\n                        toast.error('Only image files allowed');\n                        e.target.value = '';\n                        return;\n                      }\n                      if (f.size > 10 * 1024 * 1024) {\n                        toast.error('Thumbnail should be less than 10MB');\n                        e.target.value = '';\n                        return;\n                      }\n                      setThumbnailFile(f);\n                      try {\n                        const reader = new FileReader();\n                        reader.onerror = () => {\n                          toast.error('Failed to read thumbnail file');\n                          setThumbnailFile(null);\n                          setThumbnailPreview('');\n                          e.target.value = '';\n                        };\n                        reader.onloadend = () => {\n                          if (reader.result) {\n                            setThumbnailPreview(reader.result);\n                          } else {\n                            toast.error('Failed to load thumbnail preview');\n                            setThumbnailFile(null);\n                            setThumbnailPreview('');\n                          }\n                        };\n                        reader.readAsDataURL(f);\n                      } catch (error) {\n                        toast.error('Failed to process thumbnail');\n                        setThumbnailFile(null);\n                        setThumbnailPreview('');\n                        e.target.value = '';\n                      }\n                    }} \n                    className=\"input-field\" \n                  />\n                </div>\n              </div>\n              {thumbnailPreview && (\n                <div className=\"mt-2\">\n                  <img src={thumbnailPreview} alt=\"Thumbnail preview\" className=\"w-40 h-24 object-cover rounded border\" />\n                </div>\n              )}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                <div>\n                  <label className=\"text-xs text-gray-500 dark:text-gray-400\">Latitude (optional)</label>\n                  <input type=\"number\" value={locationLat} onChange={(e)=>setLocationLat(e.target.value)} className=\"input-field\" />\n                </div>\n                <div>\n                  <label className=\"text-xs text-gray-500 dark:text-gray-400\">Longitude (optional)</label>\n                  <input type=\"number\" value={locationLng} onChange={(e)=>setLocationLng(e.target.value)} className=\"input-field\" />\n                </div>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-6\">\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={paidPromotion} onChange={(e)=>setPaidPromotion(e.target.checked)} />\n                  Contains paid promotion\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={ageRestricted} onChange={(e)=>setAgeRestricted(e.target.checked)} />\n                  Age-restricted (18+)\n                </label>\n                <label className=\"flex items-center gap-2 text-sm\">\n                  <input type=\"checkbox\" checked={allowEmbedding} onChange={(e)=>setAllowEmbedding(e.target.checked)} />\n                  Allow embedding\n                </label>\n              </div>\n            </div>\n          </div>\n\n          {/* Tags */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              Tags (comma separated)\n            </label>\n            <input\n              type=\"text\"\n              value={tags}\n              onChange={(e) => setTags(e.target.value)}\n              placeholder=\"nature, travel, food\"\n              className=\"input-field\"\n            />\n          </div>\n\n          {/* Tips */}\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg\">\n            <p className=\"text-sm text-blue-800 dark:text-blue-300\">\n              ğŸ’¡ <strong>Pro Tips:</strong>\n            </p>\n            <ul className=\"text-sm text-blue-700 dark:text-blue-400 mt-2 space-y-1 ml-5 list-disc\">\n              <li>Use #hashtags to reach more people</li>\n              <li>Mention @username to tag someone</li>\n              <li>Upload up to 10 images/videos</li>\n            </ul>\n          </div>\n\n          {/* Submit Button */}\n          <div className=\"flex space-x-4\">\n            <button\n              type=\"submit\"\n              disabled={loading || files.length === 0}\n              className=\"flex-1 btn-primary disabled:opacity-50\"\n            >\n              {loading ? 'Uploading...' : `Share ${files.length > 1 ? `${files.length} items` : 'Post'}`}\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => navigate('/')}\n              className=\"flex-1 btn-secondary\"\n            >\n              Cancel\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default Upload;\n","size_bytes":31941},"backend/routes/subscriptionRoutes.js":{"content":"import express from 'express';\nimport { protect } from '../middleware/authMiddleware.js';\nimport User from '../models/User.js';\nimport Subscription from '../models/Subscription.js';\n\nconst router = express.Router();\n\n// @route   GET /api/subscription/plans\n// @desc    Get subscription plans\n// @access  Public\nrouter.get('/plans', (req, res) => {\n  const plans = [\n    {\n      id: 'monthly',\n      name: 'Premium Monthly',\n      price: 9.99,\n      currency: 'USD',\n      features: [\n        'Ad-free experience',\n        'Background playback',\n        'Download videos for offline viewing',\n        'Early access to new features',\n        'Priority customer support'\n      ],\n    },\n    {\n      id: 'yearly',\n      name: 'Premium Yearly',\n      price: 99.99,\n      currency: 'USD',\n      savings: 20,\n      features: [\n        'All Monthly features',\n        'Save 2 months (20% off)',\n        'Exclusive yearly subscriber badge',\n        'Premium content library access'\n      ],\n    },\n  ];\n\n  res.json({ success: true, data: plans });\n});\n\n// @route   POST /api/subscription/subscribe\n// @desc    Subscribe to premium (demo mode - no real payment)\n// @access  Private\nrouter.post('/subscribe', protect, async (req, res) => {\n  try {\n    const { plan } = req.body; // 'monthly' or 'yearly'\n\n    if (!['monthly', 'yearly'].includes(plan)) {\n      return res.status(400).json({ success: false, message: 'Invalid plan' });\n    }\n\n    const amount = plan === 'monthly' ? 9.99 : 99.99;\n    const durationMonths = plan === 'monthly' ? 1 : 12;\n    const expiresAt = new Date();\n    expiresAt.setMonth(expiresAt.getMonth() + durationMonths);\n\n    // Create subscription record\n    const subscription = await Subscription.create({\n      user: req.user._id,\n      plan,\n      status: 'active',\n      amount,\n      expiresAt,\n      paymentMethod: 'demo',\n      transactionId: `DEMO_${Date.now()}`,\n    });\n\n    // Update user\n    await User.findByIdAndUpdate(req.user._id, {\n      isPremium: true,\n      premiumSince: new Date(),\n      premiumExpiresAt: expiresAt,\n      premiumPlan: plan,\n    });\n\n    res.json({\n      success: true,\n      message: 'Premium subscription activated!',\n      data: subscription,\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\n// @route   POST /api/subscription/cancel\n// @desc    Cancel premium subscription\n// @access  Private\nrouter.post('/cancel', protect, async (req, res) => {\n  try {\n    // Find active subscription\n    const subscription = await Subscription.findOne({\n      user: req.user._id,\n      status: 'active',\n    });\n\n    if (!subscription) {\n      return res.status(404).json({ success: false, message: 'No active subscription found' });\n    }\n\n    // Update subscription\n    subscription.status = 'cancelled';\n    subscription.autoRenew = false;\n    await subscription.save();\n\n    // Note: User keeps premium until expiration date\n    res.json({\n      success: true,\n      message: 'Subscription cancelled. Premium benefits will continue until ' + subscription.expiresAt.toLocaleDateString(),\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\n// @route   GET /api/subscription/status\n// @desc    Get user's subscription status\n// @access  Private\nrouter.get('/status', protect, async (req, res) => {\n  try {\n    const subscription = await Subscription.findOne({\n      user: req.user._id,\n      status: 'active',\n    }).sort('-createdAt');\n\n    const user = await User.findById(req.user._id).select('isPremium premiumPlan premiumExpiresAt premiumSince');\n\n    res.json({\n      success: true,\n      data: {\n        isPremium: user.isPremium,\n        plan: user.premiumPlan,\n        expiresAt: user.premiumExpiresAt,\n        since: user.premiumSince,\n        subscription,\n      },\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\nexport default router;\n","size_bytes":3970},"frontend/src/services/aiService.js":{"content":"import api from './api';\n\nexport const aiService = {\n  // Get caption suggestions\n  getCaptionSuggestions: async (imageDescription) => {\n    const response = await api.post('/ai/captions', { imageDescription });\n    return response.data;\n  },\n\n  // Get hashtag suggestions\n  getHashtagSuggestions: async (content) => {\n    const response = await api.post('/ai/hashtags', { content });\n    return response.data;\n  },\n\n  // Get bio suggestions\n  getBioSuggestions: async (interests) => {\n    const response = await api.post('/ai/bio-suggestions', { interests });\n    return response.data;\n  },\n\n  // Moderate content (admin)\n  moderateContent: async (text) => {\n    const response = await api.post('/ai/moderate', { text });\n    return response.data;\n  }\n};","size_bytes":755},"backend/messageController.js":{"content":"","size_bytes":0},"backend/scripts/listAdmins.js":{"content":"import mongoose from 'mongoose';\nimport dotenv from 'dotenv';\nimport User from '../models/User.js';\n\n// Load environment variables\ndotenv.config();\n\nconst listAdmins = async () => {\n  try {\n    // Connect to database\n    await mongoose.connect(process.env.MONGO_URI);\n    console.log('âœ… Connected to MongoDB\\n');\n\n    // Find all admin users\n    const admins = await User.find({ role: 'admin' }).select(\n      'fullName username email role createdAt'\n    );\n\n    if (admins.length === 0) {\n      console.log('â„¹ï¸  No admin users found');\n      console.log('\\nTo make a user admin, run:');\n      console.log('node scripts/makeUserAdmin.js <email-or-username>');\n      process.exit(0);\n    }\n\n    console.log(`ğŸ” Found ${admins.length} admin user(s):\\n`);\n    console.log('â•'.repeat(80));\n\n    admins.forEach((admin, index) => {\n      console.log(`\\n${index + 1}. ${admin.fullName}`);\n      console.log(`   Username: @${admin.username}`);\n      console.log(`   Email: ${admin.email}`);\n      console.log(`   Role: ${admin.role}`);\n      console.log(`   Member Since: ${admin.createdAt.toLocaleDateString()}`);\n      console.log('â”€'.repeat(80));\n    });\n\n    console.log('\\nâœ… Total Admins:', admins.length);\n\n    process.exit(0);\n  } catch (error) {\n    console.error('âŒ Error:', error.message);\n    process.exit(1);\n  }\n};\n\nlistAdmins();\n","size_bytes":1351},"frontend/src/pages/Analytics.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { postAPI, userAPI } from '../services/api';\nimport {\n  AiOutlineHeart,\n  AiOutlineComment,\n  AiOutlineEye,\n  AiOutlineRise,\n} from 'react-icons/ai';\nimport { BsGraphUp, BsPeople, BsImage } from 'react-icons/bs';\n\nconst Analytics = () => {\n  const { user } = useAuth();\n  const [stats, setStats] = useState({\n    totalPosts: 0,\n    totalLikes: 0,\n    totalComments: 0,\n    totalViews: 0,\n    subscriber: 0,\n    subscribed: 0,\n    engagementRate: 0,\n  });\n  const [topPosts, setTopPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchAnalytics();\n  }, []);\n\n  const fetchAnalytics = async () => {\n    try {\n      const [postsRes, profileRes] = await Promise.all([\n        postAPI.getFeed(),\n        userAPI.getProfile(user.username),\n      ]);\n\n      const userPosts = postsRes.data.data.filter(\n        (post) => post.author._id === user._id\n      );\n\n      const totalLikes = userPosts.reduce((sum, post) => sum + post.likes.length, 0);\n      const totalComments = userPosts.reduce(\n        (sum, post) => sum + post.comments.length,\n        0\n      );\n\n      // Sort posts by engagement\n      const sortedPosts = userPosts\n        .map((post) => ({\n          ...post,\n          engagement: post.likes.length * 2 + post.comments.length,\n        }))\n        .sort((a, b) => b.engagement - a.engagement)\n        .slice(0, 5);\n\n      setStats({\n        totalPosts: userPosts.length,\n        totalLikes,\n        totalComments,\n        totalViews: totalLikes + totalComments * 3, // Estimate\n        subscriber: profileRes.data.data.subscriber.length,\n        subscribed: profileRes.data.data.subscribed.length,\n        engagementRate:\n          userPosts.length > 0\n            ? ((totalLikes + totalComments) / userPosts.length).toFixed(1)\n            : 0,\n      });\n      setTopPosts(sortedPosts);\n    } catch (error) {\n      console.error('Failed to fetch analytics:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-purple-500\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-amber-50 dark:from-dark-bg dark:via-dark-bg dark:to-dark-bg pb-20 md:pb-8\">\n      <div className=\"max-w-6xl mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"bg-gradient-primary text-white rounded-3xl p-8 mb-8 shadow-glow\">\n          <h1 className=\"text-4xl font-bold mb-2 flex items-center\">\n            <BsGraphUp className=\"mr-3\" />\n            Analytics Dashboard\n          </h1>\n          <p className=\"text-purple-100\">Track your friendflix performance</p>\n        </div>\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8\">\n          {/* Total Posts */}\n          <div className=\"bg-white dark:bg-dark-card rounded-3xl p-6 shadow-lg hover:shadow-glow transition-all\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <BsImage className=\"text-purple-500\" size={32} />\n              <span className=\"text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 px-2 py-1 rounded-full\">\n                Posts\n              </span>\n            </div>\n            <p className=\"text-3xl font-bold text-gray-800 dark:text-white mb-1\">\n              {stats.totalPosts}\n            </p>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">Total Posts</p>\n          </div>\n\n          {/* Total Likes */}\n          <div className=\"bg-white dark:bg-dark-card rounded-3xl p-6 shadow-lg hover:shadow-glow-pink transition-all\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <AiOutlineHeart className=\"text-red-500\" size={32} />\n              <span className=\"text-xs bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-2 py-1 rounded-full\">\n                Likes\n              </span>\n            </div>\n            <p className=\"text-3xl font-bold text-gray-800 dark:text-white mb-1\">\n              {stats.totalLikes}\n            </p>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">Total Likes</p>\n          </div>\n\n          {/* Total Comments */}\n          <div className=\"bg-white dark:bg-dark-card rounded-3xl p-6 shadow-lg hover:shadow-glow transition-all\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <AiOutlineComment className=\"text-blue-500\" size={32} />\n              <span className=\"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-1 rounded-full\">\n                Comments\n              </span>\n            </div>\n            <p className=\"text-3xl font-bold text-gray-800 dark:text-white mb-1\">\n              {stats.totalComments}\n            </p>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n              Total Comments\n            </p>\n          </div>\n\n          {/* subscriber */}\n          <div className=\"bg-white dark:bg-dark-card rounded-3xl p-6 shadow-lg hover:shadow-glow transition-all\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <BsPeople className=\"text-green-500\" size={32} />\n              <span className=\"text-xs bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-2 py-1 rounded-full\">\n                subscriber\n              </span>\n            </div>\n            <p className=\"text-3xl font-bold text-gray-800 dark:text-white mb-1\">\n              {stats.subscriber}\n            </p>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">subscriber</p>\n          </div>\n        </div>\n\n        {/* Engagement Rate Card */}\n        <div className=\"bg-gradient-secondary text-white rounded-3xl p-8 mb-8 shadow-glow\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-purple-200 mb-2\">Average Engagement per Post</p>\n              <p className=\"text-5xl font-bold\">{stats.engagementRate}</p>\n            </div>\n            <div className=\"w-24 h-24 bg-white/20 backdrop-blur-lg rounded-full flex items-center justify-center\">\n              <AiOutlineRise size={48} />\n            </div>\n          </div>\n        </div>\n\n        {/* Top Performing Posts */}\n        <div className=\"bg-white dark:bg-dark-card rounded-3xl p-8 shadow-lg\">\n          <h2 className=\"text-2xl font-bold mb-6 text-gray-800 dark:text-white\">\n            ğŸ† Top Performing Posts\n          </h2>\n          <div className=\"space-y-4\">\n            {topPosts.map((post, index) => (\n              <div\n                key={post._id}\n                className=\"flex items-center space-x-4 p-4 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-2xl hover:scale-105 transition-transform\"\n              >\n                <div className=\"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center text-white font-bold\">\n                  {index + 1}\n                </div>\n                <img\n                  src={post.media?.[0]?.url || post.mediaUrl}\n                  alt=\"Post\"\n                  className=\"w-16 h-16 rounded-xl object-cover\"\n                />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 line-clamp-2\">\n                    {post.caption || 'No caption'}\n                  </p>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"flex items-center space-x-2 text-sm mb-1\">\n                    <AiOutlineHeart className=\"text-red-500\" />\n                    <span className=\"font-semibold\">{post.likes.length}</span>\n                  </div>\n                  <div className=\"flex items-center space-x-2 text-sm\">\n                    <AiOutlineComment className=\"text-blue-500\" />\n                    <span className=\"font-semibold\">{post.comments.length}</span>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Growth Insights */}\n        <div className=\"grid md:grid-cols-2 gap-6 mt-8\">\n          <div className=\"bg-gradient-to-br from-green-400 to-blue-500 text-white rounded-3xl p-6 shadow-glow\">\n            <h3 className=\"text-xl font-bold mb-4\">ğŸ“ˆ Growth Tips</h3>\n            <ul className=\"space-y-2 text-sm\">\n              <li>âœ“ Post consistently (3-5 times/week)</li>\n              <li>âœ“ Use trending hashtags</li>\n              <li>âœ“ Engage with your audience</li>\n              <li>âœ“ Share stories daily</li>\n            </ul>\n          </div>\n\n          <div className=\"bg-gradient-to-br from-purple-400 to-pink-500 text-white rounded-3xl p-6 shadow-glow-pink\">\n            <h3 className=\"text-xl font-bold mb-4\">ğŸ¯ Quick Stats</h3>\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span>subscribed</span>\n                <span className=\"font-bold\">{stats.subscribed}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Est. Reach</span>\n                <span className=\"font-bold\">{stats.totalViews}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Interactions</span>\n                <span className=\"font-bold\">\n                  {stats.totalLikes + stats.totalComments}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Analytics;\n","size_bytes":9820},"frontend/src/pages/AudioCall.jsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\nimport { BsMicMute, BsMic } from 'react-icons/bs';\nimport { AiOutlinePhone, AiOutlineAudio } from 'react-icons/ai';\n\nconst AudioCall = () => {\n  const { roomId } = useParams();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const isInitiatorQuery = new URLSearchParams(location.search).get('initiator') === '1';\n  const { user } = useAuth();\n\n  const [localStream, setLocalStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isInitiator, setIsInitiator] = useState(isInitiatorQuery);\n  const [callStatus, setCallStatus] = useState('connecting'); // connecting, connected, ended\n  const [callDuration, setCallDuration] = useState(0);\n\n  const localAudioRef = useRef(null);\n  const remoteAudioRef = useRef(null);\n  const peerConnection = useRef(null);\n  const durationInterval = useRef(null);\n  const participantsRef = useRef(new Set());\n  const startedRef = useRef(false);\n\n  useEffect(() => {\n    initializeCall();\n    socketService.emit('call:join', { roomId });\n\n    // Wait for second participant before starting offer (avoids missing offer)\n    socketService.on('call:participant', ({ userId }) => {\n      if (userId && userId !== user._id) {\n        participantsRef.current.add(userId);\n        if (isInitiator && !startedRef.current) {\n          startedRef.current = true;\n          startCall();\n        }\n      }\n    });\n\n    // Socket signaling handlers\n    socketService.on('call:offer', async ({ offer }) => {\n      if (!peerConnection.current) return;\n      // Only non-initiator should handle offer, and only when stable\n      if (isInitiator || peerConnection.current.signalingState !== 'stable') return;\n      await peerConnection.current.setRemoteDescription(offer);\n      const answer = await peerConnection.current.createAnswer();\n      await peerConnection.current.setLocalDescription(answer);\n      socketService.emit('call:answer', { roomId, answer, from: user._id });\n      setCallStatus('connected');\n      startCallDuration();\n    });\n\n    socketService.on('call:answer', async ({ answer }) => {\n      if (!peerConnection.current) return;\n      // Only initiator applies remote answer\n      if (!isInitiator) return;\n      await peerConnection.current.setRemoteDescription(answer);\n      setCallStatus('connected');\n      startCallDuration();\n    });\n\n    socketService.on('call:ice-candidate', async ({ candidate }) => {\n      try {\n        await peerConnection.current?.addIceCandidate(candidate);\n      } catch (e) {\n        console.error('Failed to add ICE candidate', e);\n      }\n    });\n\n    socketService.on('endCall', () => {\n      // Avoid false end before connection\n      if (callStatus === 'connected') {\n        endCall();\n      }\n    });\n\n    return () => {\n      endCall();\n      socketService.off('call:offer');\n      socketService.off('call:answer');\n      socketService.off('call:ice-candidate');\n      socketService.off('endCall');\n      socketService.off('call:participant');\n    };\n  }, []);\n\n  const initializeCall = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: false,\n        audio: true,\n      });\n\n      setLocalStream(stream);\n      if (localAudioRef.current) {\n        localAudioRef.current.srcObject = stream;\n      }\n\n      setupPeerConnection(stream);\n      toast.success('Microphone ready');\n      // Auto-start only when second participant joins (handled by call:participant)\n      // if (isInitiatorQuery) { startCall(); }\n    } catch (error) {\n      console.error('Failed to get audio:', error);\n      toast.error('Failed to access microphone');\n    }\n  };\n\n  const setupPeerConnection = async (stream) => {\n    const configuration = {\n      iceServers: [\n        { urls: 'stun:stun.l.google.com:19302' },\n        ...(function(){\n          try {\n            const env = import.meta.env.VITE_TURN_SERVERS;\n            if (!env) return [];\n            const servers = JSON.parse(env);\n            return servers;\n          } catch {\n            return [];\n          }\n        })(),\n      ],\n    };\n    const pc = new RTCPeerConnection(configuration);\n    peerConnection.current = pc;\n\n    stream.getTracks().forEach((track) => pc.addTrack(track, stream));\n\n    const remote = new MediaStream();\n    setRemoteStream(remote);\n    if (remoteAudioRef.current) {\n      remoteAudioRef.current.srcObject = remote;\n    }\n    pc.ontrack = (event) => {\n      event.streams[0].getTracks().forEach((track) => remote.addTrack(track));\n    };\n\n    pc.onicecandidate = (event) => {\n      if (event.candidate) {\n        socketService.emit('call:ice-candidate', { roomId, candidate: event.candidate });\n      }\n    };\n\n    setCallStatus('connecting');\n  };\n\n  const startCallDuration = () => {\n    durationInterval.current = setInterval(() => {\n      setCallDuration((prev) => prev + 1);\n    }, 1000);\n  };\n\n  const startCall = async () => {\n    try {\n      setIsInitiator(true);\n      startedRef.current = true;\n      if (!peerConnection.current) return toast.error('Call not ready');\n      const offer = await peerConnection.current.createOffer();\n      await peerConnection.current.setLocalDescription(offer);\n      socketService.emit('call:offer', { roomId, offer, from: user._id });\n    } catch (e) {\n      console.error('Failed to start call', e);\n      toast.error('Failed to start call');\n    }\n  };\n\n  const toggleMute = () => {\n    if (localStream) {\n      localStream.getAudioTracks().forEach((track) => {\n        track.enabled = !track.enabled;\n      });\n      setIsMuted(!isMuted);\n    }\n  };\n\n  const endCall = () => {\n    if (localStream) {\n      localStream.getTracks().forEach((track) => track.stop());\n    }\n    if (remoteStream) {\n      remoteStream.getTracks().forEach((track) => track.stop());\n    }\n    if (durationInterval.current) {\n      clearInterval(durationInterval.current);\n    }\n    if (peerConnection.current) {\n      try { peerConnection.current.close(); } catch {}\n      peerConnection.current = null;\n    }\n    setCallStatus('ended');\n    socketService.emit('endCall', { roomId });\n    if (callDuration > 0) {\n      setTimeout(() => {\n        navigate('/messages');\n      }, 2000);\n    } else {\n      navigate('/messages');\n    }\n  };\n\n  const formatDuration = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"h-screen bg-gradient-to-br from-blue-900 via-indigo-900 to-black flex flex-col\">\n      <div className=\"flex-1 relative flex items-center justify-center\">\n        <div className=\"text-center text-white\">\n          <div className=\"w-32 h-32 bg-gradient-primary rounded-full flex items-center justify-center mb-4 animate-pulse\">\n            <AiOutlineAudio size={64} />\n          </div>\n          <p className=\"text-2xl font-bold mb-2\">Audio Call</p>\n          <p className=\"text-indigo-200\">{callStatus === 'connected' ? 'Connected' : 'Connecting...'}</p>\n          <div className=\"mt-4 font-mono\">{formatDuration(callDuration)}</div>\n        </div>\n        {/* Hidden audio elements */}\n        <audio ref={localAudioRef} autoPlay muted playsInline />\n        <audio ref={remoteAudioRef} autoPlay playsInline />\n      </div>\n\n      {/* Controls */}\n      <div className=\"p-8 bg-black/50 backdrop-blur-lg\">\n        <div className=\"flex items-center justify-center space-x-6\">\n          <button\n            onClick={toggleMute}\n            className={`w-16 h-16 rounded-full flex items-center justify-center transition-all ${\n              isMuted ? 'bg-red-500 hover:bg-red-600' : 'bg-white/20 hover:bg-white/30'\n            }`}\n          >\n            {isMuted ? <BsMicMute className=\"text-white\" size={24} /> : <BsMic className=\"text-white\" size={24} />}\n          </button>\n\n          <button\n            onClick={endCall}\n            className=\"w-20 h-20 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center transition-all hover:scale-110 shadow-glow\"\n          >\n            <AiOutlinePhone className=\"text-white rotate-135\" size={32} />\n          </button>\n\n          <button\n            onClick={startCall}\n            className=\"w-16 h-16 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-all\"\n            title=\"Start Call\"\n          >\n            <AiOutlineAudio className=\"text-white\" size={24} />\n          </button>\n        </div>\n      </div>\n\n      {callStatus === 'ended' && callDuration > 0 && (\n        <div className=\"absolute inset-0 bg-black/90 flex items-center justify-center z-50\">\n          <div className=\"text-center text-white\">\n            <div className=\"text-6xl mb-4\">ğŸ§</div>\n            <h2 className=\"text-3xl font-bold mb-2\">Call Ended</h2>\n            <p className=\"text-xl text-indigo-200 mb-2\">Duration: {formatDuration(callDuration)}</p>\n            {callDuration > 0 && <p className=\"text-gray-400\">Redirecting...</p>}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AudioCall;\n","size_bytes":9383},"backend/controllers/storyController.js":{"content":"import Story from '../models/Story.js';\nimport User from '../models/User.js';\nimport { uploadToStorage } from '../config/minio.js';\n\n// @desc    Create story\n// @route   POST /api/stories\n// @access  Private\nexport const createStory = async (req, res) => {\n  try {\n    const { caption } = req.body;\n\n    if (!req.file) {\n      return res.status(400).json({\n        success: false,\n        message: 'Please upload an image or video',\n      });\n    }\n\n    console.log('ğŸ“¤ Uploading story to MinIO...');\n    const result = await uploadToStorage(req.file.buffer, 'friendflix/stories', req.file.originalname);\n    console.log('âœ… Story upload successful');\n\n    const mediaType = req.file.mimetype.startsWith('video') ? 'video' : 'image';\n\n    const story = await Story.create({\n      author: req.user._id,\n      mediaUrl: result.secure_url,\n      mediaType,\n      caption: caption || '',\n    });\n\n    const populatedStory = await Story.findById(story._id).populate(\n      'author',\n      'username fullName avatar'\n    );\n\n    res.status(201).json({\n      success: true,\n      message: 'Story created successfully',\n      data: populatedStory,\n    });\n  } catch (error) {\n    console.error('âŒ Story creation error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get stories from subscribed users\n// @route   GET /api/stories/subscribed\n// @access  Private\nexport const getsubscribedStories = async (req, res) => {\n  try {\n    const currentUser = await User.findById(req.user._id);\n\n    // Get stories from followed users + own stories\n    const stories = await Story.find({\n      author: { $in: [...currentUser.subscribed, currentUser._id] },\n      expiresAt: { $gt: new Date() },\n    })\n      .sort({ createdAt: -1 })\n      .populate('author', 'username fullName avatar')\n      .populate('views.user', 'username avatar')\n      .populate('replies.user', 'username avatar');\n\n    // Group stories by author\n    const groupedStories = {};\n    stories.forEach((story) => {\n      const authorId = story.author._id.toString();\n      if (!groupedStories[authorId]) {\n        groupedStories[authorId] = {\n          author: story.author,\n          stories: [],\n          hasViewed: false,\n        };\n      }\n      groupedStories[authorId].stories.push(story);\n      \n      // Check if current user has viewed any story from this author\n      const hasViewed = story.views.some(\n        (view) => view.user._id.toString() === req.user._id.toString()\n      );\n      if (!hasViewed) {\n        groupedStories[authorId].hasViewed = false;\n      }\n    });\n\n    res.status(200).json({\n      success: true,\n      data: Object.values(groupedStories),\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Get user's stories\n// @route   GET /api/stories/user/:userId\n// @access  Private\nexport const getUserStories = async (req, res) => {\n  try {\n    const stories = await Story.find({\n      author: req.params.userId,\n      expiresAt: { $gt: new Date() },\n    })\n      .sort({ createdAt: -1 })\n      .populate('author', 'username fullName avatar')\n      .populate('views.user', 'username avatar')\n      .populate('replies.user', 'username avatar');\n\n    res.status(200).json({\n      success: true,\n      data: stories,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    View story\n// @route   POST /api/stories/:id/view\n// @access  Private\nexport const viewStory = async (req, res) => {\n  try {\n    const story = await Story.findById(req.params.id);\n\n    if (!story) {\n      return res.status(404).json({\n        success: false,\n        message: 'Story not found',\n      });\n    }\n\n    // Check if user already viewed\n    const alreadyViewed = story.views.some(\n      (view) => view.user.toString() === req.user._id.toString()\n    );\n\n    if (!alreadyViewed) {\n      story.views.push({ user: req.user._id });\n      await story.save();\n    }\n\n    res.status(200).json({\n      success: true,\n      message: 'Story viewed',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Reply to story\n// @route   POST /api/stories/:id/reply\n// @access  Private\nexport const replyToStory = async (req, res) => {\n  try {\n    const { text } = req.body;\n\n    if (!text || text.trim() === '') {\n      return res.status(400).json({\n        success: false,\n        message: 'Reply text is required',\n      });\n    }\n\n    const story = await Story.findById(req.params.id);\n\n    if (!story) {\n      return res.status(404).json({\n        success: false,\n        message: 'Story not found',\n      });\n    }\n\n    story.replies.push({\n      user: req.user._id,\n      text,\n    });\n\n    await story.save();\n\n    const populatedStory = await Story.findById(story._id)\n      .populate('author', 'username fullName avatar')\n      .populate('replies.user', 'username avatar');\n\n    // Send as message to story author\n    const io = req.app.get('io');\n    io.to(story.author.toString()).emit('storyReply', {\n      storyId: story._id,\n      from: req.user,\n      text,\n    });\n\n    res.status(200).json({\n      success: true,\n      message: 'Reply sent',\n      data: populatedStory,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n\n// @desc    Delete story\n// @route   DELETE /api/stories/:id\n// @access  Private\nexport const deleteStory = async (req, res) => {\n  try {\n    const story = await Story.findById(req.params.id);\n\n    if (!story) {\n      return res.status(404).json({\n        success: false,\n        message: 'Story not found',\n      });\n    }\n\n    if (story.author.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized',\n      });\n    }\n\n    await story.deleteOne();\n\n    res.status(200).json({\n      success: true,\n      message: 'Story deleted',\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: error.message,\n    });\n  }\n};\n","size_bytes":6202},"backend/models/CommunityPost.js":{"content":"import mongoose from 'mongoose';\n\nconst communityPostSchema = new mongoose.Schema(\n  {\n    creator: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    content: {\n      type: String,\n      required: [true, 'Community post content is required'],\n      trim: true,\n      maxlength: [10000, 'Content cannot exceed 10000 characters'],\n    },\n    type: {\n      type: String,\n      enum: ['text', 'image', 'poll', 'video'],\n      default: 'text',\n    },\n    media: {\n      url: String,\n      type: {\n        type: String,\n        enum: ['image', 'video'],\n      },\n    },\n    poll: {\n      question: String,\n      options: [\n        {\n          text: String,\n          votes: [\n            {\n              type: mongoose.Schema.Types.ObjectId,\n              ref: 'User',\n            },\n          ],\n        },\n      ],\n      expiresAt: Date,\n    },\n    likes: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User',\n      },\n    ],\n    comments: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Comment',\n      },\n    ],\n    pinned: {\n      type: Boolean,\n      default: false,\n    },\n    visibility: {\n      type: String,\n      enum: ['public', 'subscribers'],\n      default: 'public',\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\ncommunityPostSchema.index({ creator: 1, createdAt: -1 });\n\nconst CommunityPost = mongoose.model('CommunityPost', communityPostSchema);\n\nexport default CommunityPost;\n","size_bytes":1481},"backend/models/Story.js":{"content":"import mongoose from 'mongoose';\n\nconst storySchema = new mongoose.Schema(\n  {\n    author: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    mediaUrl: {\n      type: String,\n      required: true,\n    },\n    mediaType: {\n      type: String,\n      enum: ['image', 'video'],\n      default: 'image',\n    },\n    caption: {\n      type: String,\n      maxlength: [200, 'Caption cannot exceed 200 characters'],\n      trim: true,\n    },\n    views: [\n      {\n        user: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'User',\n        },\n        viewedAt: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n    replies: [\n      {\n        user: {\n          type: mongoose.Schema.Types.ObjectId,\n          ref: 'User',\n        },\n        text: {\n          type: String,\n          required: true,\n        },\n        createdAt: {\n          type: Date,\n          default: Date.now,\n        },\n      },\n    ],\n    expiresAt: {\n      type: Date,\n      default: () => new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours\n      index: { expires: 0 }, // Auto-delete when expired\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for faster queries\nstorySchema.index({ author: 1, createdAt: -1 });\n\n\nconst Story = mongoose.model('Story', storySchema);\n\nexport default Story;\n","size_bytes":1357},"backend/routes/superChatRoutes.js":{"content":"import express from 'express';\nimport { protect } from '../middleware/authMiddleware.js';\nimport LiveStream from '../models/LiveStream.js';\nimport Revenue from '../models/Revenue.js';\nimport User from '../models/User.js';\n\nconst router = express.Router();\n\n// @route   POST /api/superchat/send\n// @desc    Send Super Chat during live stream\n// @access  Private\nrouter.post('/send', protect, async (req, res) => {\n  try {\n    const { streamId, amount, message } = req.body;\n\n    if (!streamId || !amount || amount < 1) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid Super Chat data. Minimum amount is $1.',\n      });\n    }\n\n    const stream = await LiveStream.findById(streamId).populate('host');\n\n    if (!stream) {\n      return res.status(404).json({ success: false, message: 'Stream not found' });\n    }\n\n    if (stream.status !== 'live') {\n      return res.status(400).json({ success: false, message: 'Stream is not live' });\n    }\n\n    // Add Super Chat to stream\n    const superChat = {\n      user: req.user._id,\n      amount,\n      message: message || '',\n      timestamp: new Date(),\n      highlighted: amount >= 5, // Highlight if $5 or more\n    };\n\n    stream.superChats.push(superChat);\n    stream.totalEarnings += amount;\n    await stream.save();\n\n    // Create revenue record\n    const revenue = 0.7 * amount; // Creator gets 70%, platform takes 30%\n    \n    await Revenue.create({\n      creator: stream.host._id,\n      source: 'super_chat',\n      amount: revenue,\n      liveStream: stream._id,\n      description: `Super Chat: $${amount} from ${req.user.username}`,\n      month: new Date().getMonth() + 1,\n      year: new Date().getFullYear(),\n    });\n\n    // Update creator earnings\n    await User.findByIdAndUpdate(stream.host._id, {\n      $inc: {\n        totalEarnings: revenue,\n        pendingPayout: revenue,\n      },\n    });\n\n    // Emit socket event for real-time display\n    const io = req.app.get('io');\n    io.to(`stream_${streamId}`).emit('newSuperChat', {\n      ...superChat,\n      user: {\n        _id: req.user._id,\n        username: req.user.username,\n        avatar: req.user.avatar,\n      },\n    });\n\n    res.json({\n      success: true,\n      message: 'Super Chat sent successfully!',\n      data: superChat,\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\n// @route   GET /api/superchat/:streamId\n// @desc    Get all Super Chats for a stream\n// @access  Public\nrouter.get('/:streamId', async (req, res) => {\n  try {\n    const stream = await LiveStream.findById(req.params.streamId)\n      .populate('superChats.user', 'username avatar');\n\n    if (!stream) {\n      return res.status(404).json({ success: false, message: 'Stream not found' });\n    }\n\n    res.json({\n      success: true,\n      data: stream.superChats,\n    });\n  } catch (error) {\n    res.status(500).json({ success: false, message: error.message });\n  }\n});\n\nexport default router;\n","size_bytes":2973},"backend/routes/userRoutes.js":{"content":"import express from 'express';\nimport {\n  getUserProfile,\n  updateProfile,\n  followUser,\n  searchUsers,\n  getUserSuggestions,\n  requestRoleUpgrade,\n} from '../controllers/userController.js';\nimport { protect } from '../middleware/authMiddleware.js';\nimport { upload } from '../config/minio.js';\n\nconst router = express.Router();\n\nrouter.get('/search', searchUsers);\nrouter.get('/suggestions', protect, getUserSuggestions);\nrouter.get('/:username', getUserProfile);\nrouter.put('/profile', protect, upload.fields([{ name: 'avatar', maxCount: 1 }, { name: 'cover', maxCount: 1 }]), updateProfile);\nrouter.post('/role/request', protect, requestRoleUpgrade);\nrouter.post('/:id/follow', protect, followUser);\n\nexport default router;\n","size_bytes":727},"frontend/src/pages/Notifications.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { notificationAPI } from '../services/api';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\nimport { timeAgo } from '../utils/timeAgo';\nimport Loader from '../components/Loader';\nimport { AiOutlineHeart, AiOutlineComment, AiOutlineUserAdd } from 'react-icons/ai';\n\nconst Notifications = () => {\n  const [notifications, setNotifications] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchNotifications();\n\n    // Listen for real-time notifications\n    socketService.on('notification', (notification) => {\n      setNotifications((prev) => [notification, ...prev]);\n    });\n\n    return () => {\n      socketService.off('notification');\n    };\n  }, []);\n\n  const fetchNotifications = async () => {\n    try {\n      const response = await notificationAPI.getNotifications();\n      setNotifications(response.data.data);\n      \n      // Emit event to reset notification count in navbar/bottomnav\n      window.dispatchEvent(new CustomEvent('notificationsViewed'));\n    } catch (error) {\n      toast.error('Failed to load notifications');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleMarkAsRead = async (notificationId) => {\n    try {\n      await notificationAPI.markAsRead(notificationId);\n      setNotifications((prev) =>\n        prev.map((notif) =>\n          notif._id === notificationId ? { ...notif, read: true } : notif\n        )\n      );\n    } catch (error) {\n      console.error('Failed to mark as read:', error);\n    }\n  };\n\n  const handleMarkAllAsRead = async () => {\n    try {\n      await notificationAPI.markAllAsRead();\n      setNotifications((prev) =>\n        prev.map((notif) => ({ ...notif, read: true }))\n      );\n      toast.success('All notifications marked as read');\n    } catch (error) {\n      toast.error('Failed to mark all as read');\n    }\n  };\n\n  const getNotificationIcon = (type) => {\n    switch (type) {\n      case 'like':\n        return <AiOutlineHeart className=\"text-red-500\" size={24} />;\n      case 'comment':\n        return <AiOutlineComment className=\"text-blue-500\" size={24} />;\n      case 'follow':\n        return <AiOutlineUserAdd className=\"text-green-500\" size={24} />;\n      default:\n        return null;\n    }\n  };\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto px-4 py-8\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h1 className=\"text-2xl font-bold\">Notifications</h1>\n        {notifications.some((n) => !n.read) && (\n          <button\n            onClick={handleMarkAllAsRead}\n            className=\"text-primary text-sm font-semibold hover:text-blue-700\"\n          >\n            Mark all as read\n          </button>\n        )}\n      </div>\n\n      <div className=\"card\">\n        {notifications.length === 0 ? (\n          <div className=\"p-8 text-center text-gray-500\">\n            No notifications yet\n          </div>\n        ) : (\n          <div className=\"divide-y divide-gray-200\">\n            {notifications.map((notification) => (\n              <div\n                key={notification._id}\n                onClick={() => !notification.read && handleMarkAsRead(notification._id)}\n                className={`flex items-start space-x-4 p-4 hover:bg-gray-50 transition cursor-pointer ${\n                  !notification.read ? 'bg-blue-50' : ''\n                }`}\n              >\n                {/* Icon */}\n                <div className=\"flex-shrink-0 mt-1\">\n                  {getNotificationIcon(notification.type)}\n                </div>\n\n                {/* Sender Avatar */}\n                <Link to={`/profile/${notification.sender.username}`}>\n                  <img\n                    src={notification.sender.avatar}\n                    alt={notification.sender.username}\n                    className=\"h-10 w-10 rounded-full object-cover\"\n                  />\n                </Link>\n\n                {/* Content */}\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm\">\n                    <Link\n                      to={`/profile/${notification.sender.username}`}\n                      className=\"font-semibold hover:underline\"\n                    >\n                      {notification.sender.username}\n                    </Link>{' '}\n                    {notification.message.replace(notification.sender.username, '').trim()}\n                  </p>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {timeAgo(notification.createdAt)}\n                  </p>\n                </div>\n\n                {/* Post Thumbnail */}\n                {notification.post && (\n                  <Link to={`/post/${notification.post._id}`}>\n                    <img\n                      src={notification.post.mediaUrl}\n                      alt=\"Post\"\n                      className=\"h-12 w-12 object-cover rounded\"\n                    />\n                  </Link>\n                )}\n\n                {/* Unread Indicator */}\n                {!notification.read && (\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"h-2 w-2 bg-primary rounded-full\"></div>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Notifications;\n","size_bytes":5446},"backend/services/deepseekService.js":{"content":"import OpenAI from 'openai';\n\n// Initialize DeepSeek client only if API key is provided\nlet deepseekClient = null;\nif (process.env.DEEPSEEK_API_KEY) {\n  deepseekClient = new OpenAI({\n    apiKey: process.env.DEEPSEEK_API_KEY,\n    baseURL: 'https://api.deepseek.com'\n  });\n}\n\nexport class DeepSeekService {\n  // AI-powered content suggestions\n  static async generateCaptionSuggestions(imageDescription) {\n    if (!deepseekClient) {\n      return ['Share your moment!', 'Creating memories âœ¨', 'Life through my lens ğŸ“¸'];\n    }\n    \n    try {\n      const response = await deepseekClient.chat.completions.create({\n        model: 'deepseek-chat',\n        messages: [\n          {\n            role: 'system',\n            content: 'You are a social media expert. Generate 3 engaging Instagram-style captions based on the image description. Keep them short, trendy, and engaging.'\n          },\n          {\n            role: 'user',\n            content: `Image description: ${imageDescription}`\n          }\n        ],\n        max_tokens: 150\n      });\n      \n      return response.choices[0].message.content.split('\\n').filter(caption => caption.trim());\n    } catch (error) {\n      console.error('DeepSeek Caption Error:', error);\n      return ['Share your moment!', 'Creating memories âœ¨', 'Life through my lens ğŸ“¸'];\n    }\n  }\n\n  // AI-powered hashtag suggestions\n  static async generateHashtags(content) {\n    if (!deepseekClient) {\n      return ['#friendflix', '#social', '#share', '#moment'];\n    }\n    \n    try {\n      const response = await deepseekClient.chat.completions.create({\n        model: 'deepseek-chat',\n        messages: [\n          {\n            role: 'system',\n            content: 'Generate 10 relevant Instagram hashtags for the given content. Return only hashtags separated by spaces.'\n          },\n          {\n            role: 'user',\n            content: `Content: ${content}`\n          }\n        ],\n        max_tokens: 100\n      });\n      \n      return response.choices[0].message.content.split(' ').filter(tag => tag.startsWith('#'));\n    } catch (error) {\n      console.error('DeepSeek Hashtags Error:', error);\n      return ['#friendflix', '#social', '#share', '#moment'];\n    }\n  }\n\n  // AI content moderation (for admin)\n  static async moderateContent(text) {\n    if (!deepseekClient) {\n      return { appropriate: true, reason: 'AI moderation not available', confidence: 0 };\n    }\n    \n    try {\n      const response = await deepseekClient.chat.completions.create({\n        model: 'deepseek-chat',\n        messages: [\n          {\n            role: 'system',\n            content: 'Analyze this social media content for inappropriate content, hate speech, or spam. Return JSON: {appropriate: boolean, reason: string, confidence: number}'\n          },\n          {\n            role: 'user',\n            content: `Content to moderate: ${text}`\n          }\n        ],\n        response_format: { type: 'json_object' }\n      });\n      \n      return JSON.parse(response.choices[0].message.content);\n    } catch (error) {\n      console.error('DeepSeek Moderation Error:', error);\n      return { appropriate: true, reason: 'Error analyzing content', confidence: 0 };\n    }\n  }\n\n  // AI-powered user suggestions\n  static async generateBioSuggestions(userInterests) {\n    if (!deepseekClient) {\n      return ['Digital creator âœ¨', 'Sharing my journey ğŸ“±', 'Creating content that inspires ğŸŒŸ'];\n    }\n    \n    try {\n      const response = await deepseekClient.chat.completions.create({\n        model: 'deepseek-chat',\n        messages: [\n          {\n            role: 'system',\n            content: 'Generate 3 creative and engaging Instagram bio suggestions based on user interests. Keep them under 150 characters.'\n          },\n          {\n            role: 'user',\n            content: `User interests: ${userInterests}`\n          }\n        ],\n        max_tokens: 200\n      });\n      \n      return response.choices[0].message.content.split('\\n').filter(bio => bio.trim());\n    } catch (error) {\n      console.error('DeepSeek Bio Error:', error);\n      return ['Digital creator âœ¨', 'Sharing my journey ğŸ“±', 'Creating content that inspires ğŸŒŸ'];\n    }\n  }\n}","size_bytes":4183},"frontend/src/components/StoryStickers.jsx":{"content":"import { useState } from 'react';\nimport { AiOutlineCheck } from 'react-icons/ai';\n\n// Poll Sticker Component\nexport const PollSticker = ({ poll, onVote, hasVoted }) => {\n  const [selectedOption, setSelectedOption] = useState(null);\n\n  const handleVote = (optionIndex) => {\n    if (hasVoted) return;\n    setSelectedOption(optionIndex);\n    onVote(optionIndex);\n  };\n\n  const totalVotes = poll.options.reduce((sum, opt) => sum + opt.votes, 0);\n\n  return (\n    <div className=\"bg-white/10 backdrop-blur-lg rounded-3xl p-4 w-full max-w-xs\">\n      <p className=\"text-white font-bold mb-3 text-center\">{poll.question}</p>\n      \n      <div className=\"space-y-2\">\n        {poll.options.map((option, index) => {\n          const percentage = totalVotes > 0 ? (option.votes / totalVotes) * 100 : 0;\n          const isSelected = selectedOption === index;\n          const isWinning = option.votes === Math.max(...poll.options.map(o => o.votes));\n\n          return (\n            <button\n              key={index}\n              onClick={() => handleVote(index)}\n              disabled={hasVoted}\n              className={`relative w-full text-left p-3 rounded-2xl overflow-hidden transition-all ${\n                hasVoted\n                  ? isWinning\n                    ? 'bg-gradient-primary'\n                    : 'bg-white/20'\n                  : 'bg-white/20 hover:bg-white/30'\n              } ${isSelected ? 'ring-2 ring-white' : ''}`}\n            >\n              {/* Progress Bar */}\n              {hasVoted && (\n                <div\n                  className=\"absolute inset-0 bg-white/20\"\n                  style={{ width: `${percentage}%` }}\n                ></div>\n              )}\n\n              {/* Content */}\n              <div className=\"relative flex items-center justify-between\">\n                <span className=\"text-white font-semibold\">{option.text}</span>\n                {hasVoted && (\n                  <span className=\"text-white font-bold\">{percentage.toFixed(0)}%</span>\n                )}\n                {isSelected && !hasVoted && (\n                  <AiOutlineCheck className=\"text-white\" size={20} />\n                )}\n              </div>\n            </button>\n          );\n        })}\n      </div>\n\n      {hasVoted && (\n        <p className=\"text-white/80 text-xs text-center mt-2\">\n          {totalVotes} {totalVotes === 1 ? 'vote' : 'votes'}\n        </p>\n      )}\n    </div>\n  );\n};\n\n// Quiz Sticker Component\nexport const QuizSticker = ({ quiz, onAnswer, hasAnswered }) => {\n  const [selectedAnswer, setSelectedAnswer] = useState(null);\n  const [showResult, setShowResult] = useState(false);\n\n  const handleAnswer = (answerIndex) => {\n    if (hasAnswered) return;\n    \n    setSelectedAnswer(answerIndex);\n    setShowResult(true);\n    onAnswer(answerIndex);\n  };\n\n  return (\n    <div className=\"bg-gradient-to-br from-purple-500 to-pink-500 rounded-3xl p-4 w-full max-w-xs\">\n      <div className=\"text-center mb-3\">\n        <span className=\"bg-white/20 backdrop-blur-sm px-4 py-1 rounded-full text-white text-sm font-bold\">\n          QUIZ\n        </span>\n      </div>\n      \n      <p className=\"text-white font-bold mb-4 text-center\">{quiz.question}</p>\n      \n      <div className=\"space-y-2\">\n        {quiz.options.map((option, index) => {\n          const isCorrect = index === quiz.correctAnswer;\n          const isSelected = selectedAnswer === index;\n\n          return (\n            <button\n              key={index}\n              onClick={() => handleAnswer(index)}\n              disabled={hasAnswered}\n              className={`w-full text-left p-3 rounded-2xl font-semibold transition-all ${\n                showResult\n                  ? isCorrect\n                    ? 'bg-green-500 text-white'\n                    : isSelected\n                    ? 'bg-red-500 text-white'\n                    : 'bg-white/20 text-white/60'\n                  : 'bg-white/30 hover:bg-white/40 text-white'\n              }`}\n            >\n              <div className=\"flex items-center justify-between\">\n                <span>{option}</span>\n                {showResult && isCorrect && <span>âœ…</span>}\n                {showResult && isSelected && !isCorrect && <span>âŒ</span>}\n              </div>\n            </button>\n          );\n        })}\n      </div>\n\n      {showResult && (\n        <p className=\"text-white text-center mt-3 text-sm\">\n          {selectedAnswer === quiz.correctAnswer ? 'ğŸ‰ Correct!' : 'ğŸ˜… Try again next time!'}\n        </p>\n      )}\n    </div>\n  );\n};\n\n// Slider Sticker Component\nexport const SliderSticker = ({ slider, onSlide, hasSlid }) => {\n  const [value, setValue] = useState(50);\n\n  const handleSlide = (e) => {\n    if (hasSlid) return;\n    const newValue = parseInt(e.target.value);\n    setValue(newValue);\n  };\n\n  const handleSubmit = () => {\n    if (hasSlid) return;\n    onSlide(value);\n  };\n\n  return (\n    <div className=\"bg-white/10 backdrop-blur-lg rounded-3xl p-4 w-full max-w-xs\">\n      <p className=\"text-white font-bold mb-4 text-center\">{slider.question}</p>\n      \n      <div className=\"mb-3\">\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"100\"\n          value={value}\n          onChange={handleSlide}\n          disabled={hasSlid}\n          className=\"w-full h-3 bg-white/20 rounded-full appearance-none cursor-pointer\"\n          style={{\n            background: `linear-gradient(to right, #8B5CF6 0%, #EC4899 ${value}%, rgba(255,255,255,0.2) ${value}%, rgba(255,255,255,0.2) 100%)`,\n          }}\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between text-white text-sm mb-3\">\n        <span>{slider.minLabel || 'ğŸ˜¢'}</span>\n        <span className=\"font-bold text-2xl\">{value}</span>\n        <span>{slider.maxLabel || 'ğŸ˜'}</span>\n      </div>\n\n      {!hasSlid && (\n        <button\n          onClick={handleSubmit}\n          className=\"w-full btn-primary\"\n        >\n          Submit\n        </button>\n      )}\n\n      {hasSlid && (\n        <p className=\"text-white/80 text-xs text-center\">Thanks for your response!</p>\n      )}\n    </div>\n  );\n};\n\n// Question Sticker Component\nexport const QuestionSticker = ({ onSubmit }) => {\n  const [answer, setAnswer] = useState('');\n  const [submitted, setSubmitted] = useState(false);\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (!answer.trim() || submitted) return;\n    \n    onSubmit(answer);\n    setSubmitted(true);\n  };\n\n  return (\n    <div className=\"bg-gradient-to-br from-blue-500 to-purple-500 rounded-3xl p-4 w-full max-w-xs\">\n      <p className=\"text-white font-bold mb-3 text-center\">Ask me anything!</p>\n      \n      {!submitted ? (\n        <form onSubmit={handleSubmit}>\n          <input\n            type=\"text\"\n            value={answer}\n            onChange={(e) => setAnswer(e.target.value)}\n            placeholder=\"Type your answer...\"\n            className=\"w-full bg-white/20 text-white placeholder-white/60 px-4 py-3 rounded-2xl focus:outline-none focus:ring-2 focus:ring-white mb-2\"\n            maxLength={100}\n          />\n          <button\n            type=\"submit\"\n            disabled={!answer.trim()}\n            className={`w-full py-2 rounded-2xl font-semibold transition-all ${\n              answer.trim()\n                ? 'bg-white text-purple-600 hover:scale-105'\n                : 'bg-white/20 text-white/40 cursor-not-allowed'\n            }`}\n          >\n            Send\n          </button>\n        </form>\n      ) : (\n        <div className=\"text-center text-white\">\n          <p className=\"text-4xl mb-2\">âœ…</p>\n          <p className=\"text-sm\">Response sent!</p>\n        </div>\n      )}\n    </div>\n  );\n};\n","size_bytes":7634},"frontend/src/pages/Videos.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { postAPI, exploreAPI, userAPI } from '../services/api';\nimport { useAuth } from '../context/AuthContext';\nimport toast from 'react-hot-toast';\nimport {\n  AiOutlineHeart,\n  AiFillHeart,\n  AiOutlineComment,\n  AiOutlineShareAlt,\n  AiOutlineEye,\n} from 'react-icons/ai';\nimport { BsBookmark, BsBookmarkFill } from 'react-icons/bs';\nimport VideoAd from '../components/VideoAd';\nimport { AD_CONFIG } from '../utils/adConfig';\n\nconst Videos = () => {\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const watchId = searchParams.get('watch');\n  \n  const [videos, setVideos] = useState([]);\n  const [currentVideo, setCurrentVideo] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [comments, setComments] = useState([]);\n  const [commentText, setCommentText] = useState('');\n  const [commentsLoading, setCommentsLoading] = useState(false);\n  const [showAd, setShowAd] = useState(false);\n  const [adType, setAdType] = useState('pre-roll');\n  const [midRollShown, setMidRollShown] = useState(false);\n\n  useEffect(() => {\n    fetchVideos();\n  }, []);\n\n  useEffect(() => {\n    if (watchId && videos.length > 0) {\n      const video = videos.find(v => v._id === watchId);\n      if (video) {\n        setCurrentVideo(video);\n        fetchComments(watchId);\n        if (AD_CONFIG.videoAds.preRoll.enabled) {\n          setShowAd(true);\n          setAdType('pre-roll');\n        }\n      }\n    }\n  }, [watchId, videos]);\n\n  const fetchVideos = async () => {\n    try {\n      const response = await exploreAPI.getExplorePosts();\n      const data = response.data.data || [];\n      const longVideos = data.filter((post) => post.category === 'long').map(v => ({\n        ...v,\n        comments: v.comments || [],\n        likes: v.likes || []\n      }));\n      setVideos(longVideos);\n    } catch (error) {\n      toast.error('Failed to load videos');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchComments = async (postId) => {\n    setCommentsLoading(true);\n    try {\n      const res = await postAPI.getComments(postId);\n      setComments(res.data.data || []);\n    } catch {\n      toast.error('Failed to load comments');\n      setComments([]);\n    } finally {\n      setCommentsLoading(false);\n    }\n  };\n\n  const handleAddComment = async (e) => {\n    e.preventDefault();\n    if (!commentText.trim() || !currentVideo) return;\n    try {\n      const res = await postAPI.addComment(currentVideo._id, commentText.trim());\n      setComments((prev) => [...prev, res.data.data]);\n      setCommentText('');\n      setVideos((prev) => prev.map(v => v._id === currentVideo._id ? { ...v, comments: [...(v.comments || []), res.data.data] } : v));\n      if (currentVideo) {\n        setCurrentVideo({\n          ...currentVideo,\n          comments: [...(currentVideo.comments || []), res.data.data]\n        });\n      }\n    } catch {\n      toast.error('Failed to add comment');\n    }\n  };\n\n  const handleLike = async (postId) => {\n    try {\n      const response = await postAPI.likePost(postId);\n      const isLiked = response.data.isLiked;\n      setVideos(videos.map(v => \n        v._id === postId \n          ? { ...v, likes: isLiked ? [...(v.likes || []), user._id] : (v.likes || []).filter(id => id !== user._id) }\n          : v\n      ));\n      if (currentVideo && currentVideo._id === postId) {\n        setCurrentVideo({\n          ...currentVideo,\n          likes: isLiked ? [...(currentVideo.likes || []), user._id] : (currentVideo.likes || []).filter(id => id !== user._id)\n        });\n      }\n    } catch (error) {\n      toast.error('Failed to like video');\n    }\n  };\n\n  const handleVideoProgress = (e) => {\n    const video = e.target;\n    const currentTime = video.currentTime;\n    const interval = AD_CONFIG.videoAds.midRoll.interval;\n    \n    if (AD_CONFIG.videoAds.midRoll.enabled && currentTime >= interval && !midRollShown && video.duration > interval + 10) {\n      video.pause();\n      setMidRollShown(true);\n      setAdType('mid-roll');\n      setShowAd(true);\n    }\n  };\n\n  const handleAdComplete = () => {\n    setShowAd(false);\n    const videoEl = document.getElementById('main-video');\n    if (videoEl) videoEl.play();\n  };\n\n  const handleShare = async (video) => {\n    try {\n      const url = `${window.location.origin}/videos?watch=${video._id}`;\n      if (navigator.share) {\n        await navigator.share({\n          title: video.title || 'Watch on friendflix',\n          text: video.description || 'Check this video!',\n          url,\n        });\n      } else {\n        await navigator.clipboard.writeText(url);\n        toast.success('Link copied to clipboard');\n      }\n    } catch (e) {\n      toast.error('Unable to share');\n    }\n  };\n\n  const formatDuration = (seconds) => {\n    if (!seconds) return '0:00';\n    const hrs = Math.floor(seconds / 3600);\n    const mins = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    if (hrs > 0) {\n      return `${hrs}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;\n    }\n    return `${mins}:${String(secs).padStart(2, '0')}`;\n  };\n\n  const formatViews = (count) => {\n    if (!count) return '0 views';\n    if (count >= 1000000) return `${(count / 1000000).toFixed(1)}M views`;\n    if (count >= 1000) return `${(count / 1000).toFixed(1)}K views`;\n    return `${count} views`;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-16 w-16 border-t-4 border-purple-500\"></div>\n      </div>\n    );\n  }\n\n  if (videos.length === 0) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-100 to-pink-100 dark:from-gray-900 dark:to-gray-800\">\n        <div className=\"text-center\">\n          <div className=\"text-6xl mb-4\">ğŸ¥</div>\n          <h2 className=\"text-2xl font-bold mb-2 dark:text-white\">No Long Videos Yet</h2>\n          <p className=\"text-gray-600 dark:text-gray-400\">Be the first to upload a long-form video!</p>\n          <button onClick={() => navigate('/upload')} className=\"btn-primary mt-4\">Upload Video</button>\n        </div>\n      </div>\n    );\n  }\n\n  if (currentVideo) {\n    return (\n      <>\n        {showAd && (\n          <VideoAd\n            type={adType}\n            duration={\n              adType === 'pre-roll' ? AD_CONFIG.videoAds.preRoll.duration :\n              AD_CONFIG.videoAds.midRoll.duration\n            }\n            onComplete={handleAdComplete}\n            onSkip={handleAdComplete}\n          />\n        )}\n        <div className=\"max-w-7xl mx-auto px-4 py-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            <div className=\"lg:col-span-2\">\n              <div className=\"bg-black rounded-lg overflow-hidden mb-4\">\n                <video\n                  id=\"main-video\"\n                  src={currentVideo.media?.[0]?.url || currentVideo.mediaUrl}\n                  controls\n                  autoPlay\n                  className=\"w-full\"\n                  onTimeUpdate={handleVideoProgress}\n                  onLoadedMetadata={(e) => {\n                    if (typeof currentVideo.playbackRate === 'number') {\n                      try { e.target.playbackRate = currentVideo.playbackRate; } catch {}\n                    }\n                  }}\n                />\n              </div>\n\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 mb-4\">\n                <h1 className=\"text-2xl font-bold mb-2 dark:text-white\">{currentVideo.title}</h1>\n                <div className=\"flex items-center justify-between mb-4\">\n                  <div className=\"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400\">\n                    <span className=\"flex items-center gap-1\">\n                      <AiOutlineEye /> {formatViews(currentVideo.views)}\n                    </span>\n                    <span>{new Date(currentVideo.createdAt).toLocaleDateString()}</span>\n                  </div>\n                  <div className=\"flex items-center space-x-4\">\n                    <button \n                      onClick={() => handleLike(currentVideo._id)}\n                      className=\"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition\"\n                    >\n                      {currentVideo.likes.includes(user?._id) ? (\n                        <AiFillHeart size={20} className=\"text-red-500\" />\n                      ) : (\n                        <AiOutlineHeart size={20} />\n                      )}\n                      <span>{currentVideo.likes.length}</span>\n                    </button>\n                    <button \n                      onClick={() => handleShare(currentVideo)}\n                      className=\"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition\"\n                    >\n                      <AiOutlineShareAlt size={20} />\n                      Share\n                    </button>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center space-x-4 py-4 border-t dark:border-gray-700\">\n                  <img\n                    src={currentVideo.author.avatar}\n                    alt={currentVideo.author.username}\n                    className=\"w-12 h-12 rounded-full cursor-pointer\"\n                    onClick={() => navigate(`/profile/${currentVideo.author.username}`)}\n                  />\n                  <div className=\"flex-1\">\n                    <p \n                      className=\"font-semibold dark:text-white cursor-pointer hover:underline\"\n                      onClick={() => navigate(`/profile/${currentVideo.author.username}`)}\n                    >\n                      {currentVideo.author.username}\n                    </p>\n                    <p className=\"text-sm text-gray-500\">{currentVideo.author.subscriber?.length || 0} subscriber</p>\n                  </div>\n                  <button className=\"btn-primary\">Subscribe</button>\n                </div>\n\n                <div className=\"py-4 border-t dark:border-gray-700\">\n                  <p className=\"text-gray-800 dark:text-gray-200 whitespace-pre-wrap\">{currentVideo.description}</p>\n                </div>\n              </div>\n\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4\">\n                <h3 className=\"font-semibold text-lg mb-4 dark:text-white\">\n                  {comments.length} Comments\n                </h3>\n                \n                <form onSubmit={handleAddComment} className=\"flex items-start gap-3 mb-6\">\n                  <img src={user?.avatar} alt=\"You\" className=\"w-10 h-10 rounded-full\" />\n                  <div className=\"flex-1\">\n                    <input\n                      type=\"text\"\n                      placeholder=\"Add a comment...\"\n                      value={commentText}\n                      onChange={(e) => setCommentText(e.target.value)}\n                      className=\"w-full px-4 py-2 border-b-2 border-gray-300 dark:border-gray-600 focus:border-primary dark:bg-gray-800 dark:text-white outline-none\"\n                    />\n                    <div className=\"flex justify-end gap-2 mt-2\">\n                      <button \n                        type=\"button\" \n                        onClick={() => setCommentText('')}\n                        className=\"btn-outline\"\n                      >\n                        Cancel\n                      </button>\n                      <button \n                        type=\"submit\" \n                        disabled={!commentText.trim()}\n                        className=\"btn-primary disabled:opacity-50\"\n                      >\n                        Comment\n                      </button>\n                    </div>\n                  </div>\n                </form>\n\n                <div className=\"space-y-4\">\n                  {commentsLoading ? (\n                    <div className=\"text-sm text-gray-500\">Loading comments...</div>\n                  ) : comments.length === 0 ? (\n                    <div className=\"text-sm text-gray-500 text-center py-8\">No comments yet. Be the first!</div>\n                  ) : (\n                    comments.map((comment) => (\n                      <div key={comment._id} className=\"flex items-start gap-3\">\n                        <img \n                          src={comment.author.avatar} \n                          alt={comment.author.username} \n                          className=\"w-10 h-10 rounded-full cursor-pointer\"\n                          onClick={() => navigate(`/profile/${comment.author.username}`)}\n                        />\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <span \n                              className=\"font-semibold text-sm dark:text-white cursor-pointer hover:underline\"\n                              onClick={() => navigate(`/profile/${comment.author.username}`)}\n                            >\n                              {comment.author.username}\n                            </span>\n                            <span className=\"text-xs text-gray-500\">\n                              {new Date(comment.createdAt).toLocaleDateString()}\n                            </span>\n                          </div>\n                          <p className=\"text-sm mt-1 dark:text-gray-300\">{comment.text}</p>\n                        </div>\n                      </div>\n                    ))\n                  )}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"lg:col-span-1\">\n              <h3 className=\"font-semibold mb-4 dark:text-white\">More Videos</h3>\n              <div className=\"space-y-3\">\n                {videos.filter(v => v._id !== currentVideo._id).slice(0, 10).map((video) => (\n                  <div\n                    key={video._id}\n                    onClick={() => {\n                      navigate(`/videos?watch=${video._id}`);\n                      setMidRollShown(false);\n                      setCurrentVideo(video);\n                      fetchComments(video._id);\n                      if (AD_CONFIG.videoAds.preRoll.enabled) {\n                        setShowAd(true);\n                        setAdType('pre-roll');\n                      }\n                    }}\n                    className=\"flex gap-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg p-2 transition\"\n                  >\n                    <div className=\"relative min-w-[168px] h-24 bg-black rounded-lg overflow-hidden\">\n                      <video \n                        src={video.media?.[0]?.url || video.mediaUrl} \n                        className=\"w-full h-full object-cover\"\n                        muted\n                      />\n                      <div className=\"absolute bottom-1 right-1 bg-black/80 text-white text-xs px-1 rounded\">\n                        {formatDuration(video.durationSec)}\n                      </div>\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h4 className=\"font-semibold text-sm line-clamp-2 dark:text-white\">{video.title}</h4>\n                      <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">{video.author.username}</p>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-500\">\n                        {formatViews(video.views)} â€¢ {new Date(video.createdAt).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <div className=\"max-w-7xl mx-auto px-4 py-8\">\n      <h1 className=\"text-3xl font-bold mb-6 dark:text-white\">Long Videos</h1>\n      \n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n        {videos.map((video) => (\n          <div\n            key={video._id}\n            onClick={() => navigate(`/videos?watch=${video._id}`)}\n            className=\"cursor-pointer group\"\n          >\n            <div className=\"relative bg-black rounded-lg overflow-hidden mb-2\">\n              <video \n                src={video.media?.[0]?.url || video.mediaUrl} \n                className=\"w-full aspect-video object-cover group-hover:scale-105 transition-transform duration-200\"\n                muted\n              />\n              <div className=\"absolute bottom-2 right-2 bg-black/80 text-white text-xs px-2 py-1 rounded\">\n                {formatDuration(video.durationSec)}\n              </div>\n            </div>\n            \n            <div className=\"flex gap-3\">\n              <img\n                src={video.author.avatar}\n                alt={video.author.username}\n                className=\"w-10 h-10 rounded-full\"\n              />\n              <div className=\"flex-1 min-w-0\">\n                <h3 className=\"font-semibold text-sm line-clamp-2 dark:text-white group-hover:text-primary transition\">\n                  {video.title}\n                </h3>\n                <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\n                  {video.author.username}\n                </p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-500\">\n                  {formatViews(video.views)} â€¢ {new Date(video.createdAt).toLocaleDateString()}\n                </p>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default Videos;\n","size_bytes":17767},"frontend/dev-dist/registerSW.js":{"content":"if('serviceWorker' in navigator) navigator.serviceWorker.register('/dev-sw.js?dev-sw', { scope: '/', type: 'classic' })","size_bytes":119},"frontend/src/context/AuthContext.jsx":{"content":"import { createContext, useContext, useState, useEffect } from 'react';\nimport { authAPI } from '../services/api';\nimport socketService from '../services/socket';\nimport toast from 'react-hot-toast';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [token, setToken] = useState(localStorage.getItem('token'));\n\n  useEffect(() => {\n    if (token) {\n      checkAuth();\n      socketService.connect(token);\n    } else {\n      setLoading(false);\n    }\n  }, [token]);\n\n  const checkAuth = async () => {\n    try {\n      const response = await authAPI.getMe();\n      setUser(response.data.data);\n    } catch (error) {\n      console.error('Auth check failed:', error);\n      logout();\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const login = async (email, password) => {\n    try {\n      const response = await authAPI.login({ email, password });\n      const { token, ...userData } = response.data.data;\n      \n      localStorage.setItem('token', token);\n      localStorage.setItem('user', JSON.stringify(userData));\n      setToken(token);\n      setUser(userData);\n      \n      socketService.connect(token);\n      toast.success('Welcome back!');\n      \n      return response.data;\n    } catch (error) {\n      const message = error.response?.data?.message || 'Login failed';\n      toast.error(message);\n      throw error;\n    }\n  };\n\n  const register = async (userData) => {\n    try {\n      const response = await authAPI.register(userData);\n      const { token, ...user } = response.data.data;\n      \n      localStorage.setItem('token', token);\n      localStorage.setItem('user', JSON.stringify(user));\n      setToken(token);\n      setUser(user);\n      \n      socketService.connect(token);\n      toast.success('Account created successfully!');\n      \n      return response.data;\n    } catch (error) {\n      const message = error.response?.data?.message || 'Registration failed';\n      toast.error(message);\n      throw error;\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    setToken(null);\n    setUser(null);\n    socketService.disconnect();\n    toast.success('Logged out successfully');\n  };\n\n  const updateUser = (updatedData) => {\n    const updatedUser = { ...user, ...updatedData };\n    setUser(updatedUser);\n    localStorage.setItem('user', JSON.stringify(updatedUser));\n  };\n\n  const value = {\n    user,\n    token,\n    loading,\n    login,\n    register,\n    logout,\n    updateUser,\n    isAuthenticated: !!user,\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n","size_bytes":2893},"backend/models/Subscription.js":{"content":"import mongoose from 'mongoose';\n\nconst subscriptionSchema = new mongoose.Schema(\n  {\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true,\n    },\n    plan: {\n      type: String,\n      enum: ['monthly', 'yearly'],\n      required: true,\n    },\n    status: {\n      type: String,\n      enum: ['active', 'expired', 'cancelled', 'pending'],\n      default: 'pending',\n    },\n    amount: {\n      type: Number,\n      required: true,\n    },\n    currency: {\n      type: String,\n      default: 'USD',\n    },\n    startDate: {\n      type: Date,\n      default: Date.now,\n    },\n    expiresAt: {\n      type: Date,\n      required: true,\n    },\n    autoRenew: {\n      type: Boolean,\n      default: true,\n    },\n    paymentMethod: {\n      type: String,\n      enum: ['card', 'paypal', 'stripe', 'razorpay', 'demo'],\n      default: 'demo',\n    },\n    transactionId: {\n      type: String,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index for quick lookups\nsubscriptionSchema.index({ user: 1, status: 1 });\nsubscriptionSchema.index({ expiresAt: 1 });\n\nconst Subscription = mongoose.model('Subscription', subscriptionSchema);\n\nexport default Subscription;\n","size_bytes":1182},"backend/scripts/fixAvatars.js":{"content":"import mongoose from 'mongoose';\nimport User from '../models/User.js';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nconst fixAvatars = async () => {\n  try {\n    await mongoose.connect(process.env.MONGO_URI);\n    console.log('âœ… MongoDB Connected');\n\n    const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:5173';\n    \n    // Update all users with demo/placeholder avatars\n    const result = await User.updateMany(\n      {\n        $or: [\n          { avatar: /cloudinary\\.com\\/demo/ },\n          { avatar: /ui-avatars\\.com/ },\n          { avatar: { $exists: false } },\n          { avatar: '' }\n        ]\n      },\n      {\n        $set: {\n          avatar: `${frontendUrl}/default-avatar.png`\n        }\n      }\n    );\n\n    console.log(`âœ… Fixed ${result.modifiedCount} user avatars`);\n    \n    // Also set cover image if missing\n    const coverResult = await User.updateMany(\n      {\n        $or: [\n          { coverImage: { $exists: false } },\n          { coverImage: '' },\n          { coverImage: null }\n        ]\n      },\n      {\n        $set: {\n          coverImage: `${frontendUrl}/default-bg.jpg`\n        }\n      }\n    );\n\n    console.log(`âœ… Set ${coverResult.modifiedCount} cover images`);\n    \n    process.exit(0);\n  } catch (error) {\n    console.error('âŒ Error:', error);\n    process.exit(1);\n  }\n};\n\nfixAvatars();\n","size_bytes":1343},"netlify.toml":{"content":"# Netlify configuration for friendflix Frontend\n\n[build]\n  base = \"frontend\"\n  command = \"npm run build\"\n  publish = \"dist\"\n\n# Redirect all requests to index.html for client-side routing\n[[redirects]]\n  from = \"/*\"\n  to = \"/index.html\"\n  status = 200\n\n# Environment variables (configure in Netlify dashboard)\n# VITE_API_URL - Your backend URL from Render\n# VITE_SOCKET_URL - Your backend URL from Render (same as API URL)\n","size_bytes":421},"frontend/src/pages/SchedulePost.jsx":{"content":"import { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport toast from 'react-hot-toast';\nimport { AiOutlineCalendar, AiOutlineClockCircle } from 'react-icons/ai';\nimport { BsCheckCircle } from 'react-icons/bs';\n\nconst SchedulePost = () => {\n  const navigate = useNavigate();\n  const [scheduledPosts, setScheduledPosts] = useState([\n    {\n      id: 1,\n      caption: 'Morning vibes â˜€ï¸',\n      media: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400',\n      scheduledFor: new Date(Date.now() + 86400000),\n      status: 'scheduled',\n    },\n    {\n      id: 2,\n      caption: 'Sunset beauty ğŸŒ…',\n      media: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400',\n      scheduledFor: new Date(Date.now() + 172800000),\n      status: 'scheduled',\n    },\n  ]);\n\n  const [showScheduleModal, setShowScheduleModal] = useState(false);\n  const [scheduleDate, setScheduleDate] = useState('');\n  const [scheduleTime, setScheduleTime] = useState('');\n\n  const cancelScheduledPost = (postId) => {\n    setScheduledPosts(scheduledPosts.filter(post => post.id !== postId));\n    toast.success('Scheduled post cancelled');\n  };\n\n  const formatScheduledDate = (date) => {\n    const now = new Date();\n    const scheduled = new Date(date);\n    const diffTime = scheduled - now;\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n\n    if (diffDays === 0) return 'Today';\n    if (diffDays === 1) return 'Tomorrow';\n    return scheduled.toLocaleDateString('en-US', { \n      month: 'short', \n      day: 'numeric',\n      year: 'numeric'\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-amber-50 dark:from-dark-bg dark:via-dark-bg dark:to-dark-bg pb-20 md:pb-8\">\n      <div className=\"max-w-4xl mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"bg-gradient-primary text-white rounded-3xl p-8 mb-8 shadow-glow\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-4xl font-bold mb-2 flex items-center\">\n                <AiOutlineCalendar className=\"mr-3\" />\n                Scheduled Posts\n              </h1>\n              <p className=\"text-purple-100\">Plan your content in advance</p>\n            </div>\n            <button\n              onClick={() => setShowScheduleModal(true)}\n              className=\"hidden md:block bg-white/20 backdrop-blur-lg hover:bg-white/30 px-6 py-3 rounded-2xl font-semibold transition-all hover:scale-105\"\n            >\n              + Schedule New\n            </button>\n          </div>\n        </div>\n\n        {/* Quick Stats */}\n        <div className=\"grid grid-cols-3 gap-4 mb-8\">\n          <div className=\"card p-6 text-center\">\n            <p className=\"text-3xl font-bold bg-gradient-primary bg-clip-text text-transparent\">\n              {scheduledPosts.length}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Scheduled</p>\n          </div>\n          <div className=\"card p-6 text-center\">\n            <p className=\"text-3xl font-bold text-green-500\">\n              {scheduledPosts.filter(p => p.status === 'published').length}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Published</p>\n          </div>\n          <div className=\"card p-6 text-center\">\n            <p className=\"text-3xl font-bold text-blue-500\">\n              {scheduledPosts.filter(p => new Date(p.scheduledFor) < new Date(Date.now() + 86400000)).length}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Next 24h</p>\n          </div>\n        </div>\n\n        {/* Scheduled Posts List */}\n        <div className=\"space-y-4\">\n          {scheduledPosts.length === 0 ? (\n            <div className=\"card p-12 text-center\">\n              <AiOutlineCalendar size={64} className=\"mx-auto text-gray-400 mb-4\" />\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                No scheduled posts yet\n              </p>\n              <button\n                onClick={() => setShowScheduleModal(true)}\n                className=\"btn-primary\"\n              >\n                Schedule Your First Post\n              </button>\n            </div>\n          ) : (\n            scheduledPosts.map((post) => (\n              <div\n                key={post.id}\n                className=\"card overflow-hidden hover:shadow-glow transition-all\"\n              >\n                <div className=\"flex items-center space-x-4 p-4\">\n                  {/* Thumbnail */}\n                  <img\n                    src={post.media}\n                    alt=\"Post preview\"\n                    className=\"w-24 h-24 rounded-2xl object-cover\"\n                  />\n\n                  {/* Content */}\n                  <div className=\"flex-1\">\n                    <p className=\"font-semibold dark:text-white mb-1 line-clamp-2\">\n                      {post.caption}\n                    </p>\n                    <div className=\"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400\">\n                      <span className=\"flex items-center\">\n                        <AiOutlineCalendar className=\"mr-1\" />\n                        {formatScheduledDate(post.scheduledFor)}\n                      </span>\n                      <span className=\"flex items-center\">\n                        <AiOutlineClockCircle className=\"mr-1\" />\n                        {new Date(post.scheduledFor).toLocaleTimeString('en-US', {\n                          hour: '2-digit',\n                          minute: '2-digit',\n                        })}\n                      </span>\n                    </div>\n                    \n                    {/* Status Badge */}\n                    <div className=\"mt-2\">\n                      {post.status === 'scheduled' ? (\n                        <span className=\"inline-flex items-center bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1 rounded-full text-xs font-semibold\">\n                          <AiOutlineClockCircle className=\"mr-1\" />\n                          Scheduled\n                        </span>\n                      ) : (\n                        <span className=\"inline-flex items-center bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-3 py-1 rounded-full text-xs font-semibold\">\n                          <BsCheckCircle className=\"mr-1\" />\n                          Published\n                        </span>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Actions */}\n                  <div className=\"flex flex-col space-y-2\">\n                    <button\n                      onClick={() => toast('Edit functionality coming soon!')}\n                      className=\"px-4 py-2 bg-gradient-primary text-white rounded-2xl text-sm font-semibold hover:shadow-glow transition-all\"\n                    >\n                      Edit\n                    </button>\n                    <button\n                      onClick={() => cancelScheduledPost(post.id)}\n                      className=\"px-4 py-2 bg-red-500 text-white rounded-2xl text-sm font-semibold hover:bg-red-600 transition-all\"\n                    >\n                      Cancel\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n\n        {/* Schedule Modal */}\n        {showScheduleModal && (\n          <div className=\"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\n            <div className=\"bg-white dark:bg-dark-card rounded-3xl p-8 max-w-md w-full shadow-glow\">\n              <h2 className=\"text-2xl font-bold mb-6 bg-gradient-primary bg-clip-text text-transparent\">\n                Schedule Post\n              </h2>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">\n                    Date\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={scheduleDate}\n                    onChange={(e) => setScheduleDate(e.target.value)}\n                    min={new Date().toISOString().split('T')[0]}\n                    className=\"w-full px-4 py-3 border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:border-primary focus:outline-none dark:bg-dark-bg dark:text-white\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">\n                    Time\n                  </label>\n                  <input\n                    type=\"time\"\n                    value={scheduleTime}\n                    onChange={(e) => setScheduleTime(e.target.value)}\n                    className=\"w-full px-4 py-3 border-2 border-gray-200 dark:border-dark-border rounded-2xl focus:border-primary focus:outline-none dark:bg-dark-bg dark:text-white\"\n                  />\n                </div>\n\n                <div className=\"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-2xl\">\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                    ğŸ’¡ <strong>Pro Tip:</strong> Best times to post are 9 AM, 12 PM, and 7 PM\n                  </p>\n                </div>\n\n                <div className=\"flex space-x-3 mt-6\">\n                  <button\n                    onClick={() => setShowScheduleModal(false)}\n                    className=\"flex-1 py-3 bg-gray-200 dark:bg-dark-border rounded-2xl font-semibold hover:bg-gray-300 dark:hover:bg-dark-border/80 transition\"\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    onClick={() => {\n                      toast.success('Post scheduled successfully!');\n                      setShowScheduleModal(false);\n                    }}\n                    className=\"flex-1 btn-primary\"\n                  >\n                    Schedule\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Mobile FAB */}\n        <button\n          onClick={() => setShowScheduleModal(true)}\n          className=\"md:hidden fixed bottom-20 right-4 w-16 h-16 bg-gradient-primary rounded-full shadow-glow flex items-center justify-center text-white text-3xl hover:scale-110 transition-all z-40\"\n        >\n          +\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default SchedulePost;\n","size_bytes":10628},"frontend/src/pages/CreateStory.jsx":{"content":"import { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { storyAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { AiOutlineCloudUpload, AiOutlineClose } from 'react-icons/ai';\n\nconst CreateStory = () => {\n  const navigate = useNavigate();\n  const [preview, setPreview] = useState(null);\n  const [file, setFile] = useState(null);\n  const [caption, setCaption] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const handleFileChange = (e) => {\n    const selectedFile = e.target.files[0];\n    \n    if (!selectedFile) return;\n\n    if (!selectedFile.type.startsWith('image/') && !selectedFile.type.startsWith('video/')) {\n      toast.error('Please select an image or video file');\n      return;\n    }\n\n    if (selectedFile.size > 5 * 1024 * 1024) {\n      toast.error('File size should be less than 5MB');\n      return;\n    }\n\n    setFile(selectedFile);\n    \n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPreview(reader.result);\n    };\n    reader.readAsDataURL(selectedFile);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    if (!file) {\n      toast.error('Please select a file');\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const formData = new FormData();\n      formData.append('media', file);\n      formData.append('caption', caption);\n\n      await storyAPI.createStory(formData);\n      toast.success('Story created successfully!');\n      navigate('/');\n    } catch (error) {\n      toast.error(error.response?.data?.message || 'Failed to create story');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-black flex flex-col\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 bg-gray-900\">\n        <button\n          onClick={() => navigate('/')}\n          className=\"text-white hover:bg-gray-800 p-2 rounded-full\"\n        >\n          <AiOutlineClose size={24} />\n        </button>\n        <h1 className=\"text-white text-lg font-semibold\">Create Story</h1>\n        <button\n          onClick={handleSubmit}\n          disabled={loading || !file}\n          className={`px-6 py-2 rounded-full font-semibold ${\n            file && !loading\n              ? 'bg-primary text-white hover:bg-blue-600'\n              : 'bg-gray-700 text-gray-400 cursor-not-allowed'\n          }`}\n        >\n          {loading ? 'Sharing...' : 'Share'}\n        </button>\n      </div>\n\n      {/* Content */}\n      <div className=\"flex-1 flex items-center justify-center p-4\">\n        {!preview ? (\n          <div className=\"text-center\">\n            <label\n              htmlFor=\"story-upload\"\n              className=\"cursor-pointer inline-flex flex-col items-center\"\n            >\n              <div className=\"w-32 h-32 rounded-full bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500 flex items-center justify-center mb-4\">\n                <div className=\"w-28 h-28 rounded-full bg-black flex items-center justify-center\">\n                  <AiOutlineCloudUpload size={48} className=\"text-white\" />\n                </div>\n              </div>\n              <p className=\"text-white text-lg mb-2\">Add to Your Story</p>\n              <p className=\"text-gray-400 text-sm\">Share a photo or video</p>\n              <input\n                id=\"story-upload\"\n                type=\"file\"\n                accept=\"image/*,video/*\"\n                onChange={handleFileChange}\n                className=\"hidden\"\n              />\n            </label>\n          </div>\n        ) : (\n          <div className=\"max-w-md w-full\">\n            {file?.type.startsWith('video/') ? (\n              <video\n                src={preview}\n                controls\n                className=\"w-full max-h-[70vh] object-contain rounded-lg\"\n              />\n            ) : (\n              <img\n                src={preview}\n                alt=\"Preview\"\n                className=\"w-full max-h-[70vh] object-contain rounded-lg\"\n              />\n            )}\n\n            {/* Caption Input */}\n            <div className=\"mt-4\">\n              <input\n                type=\"text\"\n                value={caption}\n                onChange={(e) => setCaption(e.target.value)}\n                placeholder=\"Add a caption...\"\n                maxLength={200}\n                className=\"w-full px-4 py-3 bg-gray-900 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary\"\n              />\n              <p className=\"text-gray-500 text-xs mt-1 text-right\">\n                {caption.length}/200\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CreateStory;\n","size_bytes":4732},"PERFORMANCE_OPTIMIZATION.md":{"content":"# ğŸš€ Performance Optimization Guide\n\n## Current Performance Issues\n\n### 1. **No Code Splitting**\nAll routes are loaded upfront. Implement lazy loading:\n\n```jsx\n// frontend/src/App.jsx\nimport { lazy, Suspense } from 'react';\n\nconst Feed = lazy(() => import('./pages/Feed'));\nconst Profile = lazy(() => import('./pages/Profile'));\nconst Messages = lazy(() => import('./pages/Messages'));\n// ... other pages\n\n// Wrap routes with Suspense\n<Suspense fallback={<Loader />}>\n  <Routes>\n    <Route path=\"/\" element={<Feed />} />\n    {/* ... */}\n  </Routes>\n</Suspense>\n```\n\n### 2. **Missing Database Indexes**\nAdd these indexes for better query performance:\n\n```javascript\n// User model\nuserSchema.index({ email: 1 });\nuserSchema.index({ username: 1 });\nuserSchema.index({ subscriber: 1 });\nuserSchema.index({ subscribed: 1 });\nuserSchema.index({ createdAt: -1 });\nuserSchema.index({ role: 1 });\nuserSchema.index({ isVerified: 1 });\n\n// Post model (already has some)\npostSchema.index({ author: 1, createdAt: -1 });\npostSchema.index({ createdAt: -1 });\npostSchema.index({ hashtags: 1 }); // Add this\npostSchema.index({ 'likes': 1 }); // Add this\npostSchema.index({ isArchived: 1 }); // Add this\n\n// Message model\nmessageSchema.index({ sender: 1, receiver: 1, createdAt: -1 });\nmessageSchema.index({ conversation: 1, createdAt: -1 });\n\n// Story model\nstorySchema.index({ author: 1, expiresAt: -1 });\nstorySchema.index({ expiresAt: 1 }); // For auto-deletion\n```\n\n### 3. **No Caching Layer**\nImplement Redis for caching:\n\n```bash\nnpm install redis\n```\n\n```javascript\n// backend/config/redis.js\nimport { createClient } from 'redis';\n\nconst redisClient = createClient({\n  url: process.env.REDIS_URL || 'redis://localhost:6379'\n});\n\nredisClient.on('error', (err) => console.error('Redis Error:', err));\nredisClient.connect();\n\nexport default redisClient;\n```\n\n**What to cache:**\n- User profiles (5-10 minutes TTL)\n- Post feed (1-2 minutes TTL)\n- Trending hashtags (10 minutes TTL)\n- User suggestions (30 minutes TTL)\n\n### 4. **Inefficient Queries**\nUse `.lean()` for read-only queries:\n\n```javascript\n// âŒ Slow\nconst posts = await Post.find({ author: userId });\n\n// âœ… Faster (returns plain JS objects)\nconst posts = await Post.find({ author: userId }).lean();\n```\n\n### 5. **No Image Optimization**\nImplement client-side image compression:\n\n```bash\nnpm install browser-image-compression\n```\n\n```javascript\nimport imageCompression from 'browser-image-compression';\n\nconst options = {\n  maxSizeMB: 1,\n  maxWidthOrHeight: 1920,\n  useWebWorker: true\n};\n\nconst compressedFile = await imageCompression(file, options);\n```\n\n### 6. **Missing Pagination Metadata**\nUpdate API responses to include pagination:\n\n```javascript\nexport const getFeed = async (req, res) => {\n  const page = parseInt(req.query.page) || 1;\n  const limit = parseInt(req.query.limit) || 10;\n  const skip = (page - 1) * limit;\n\n  const total = await Post.countDocuments({ /* filters */ });\n  const posts = await Post.find({ /* filters */ })\n    .skip(skip)\n    .limit(limit)\n    .lean();\n\n  res.json({\n    success: true,\n    data: posts,\n    pagination: {\n      page,\n      limit,\n      total,\n      pages: Math.ceil(total / limit),\n      hasMore: page < Math.ceil(total / limit)\n    }\n  });\n};\n```\n\n### 7. **Bundle Size Optimization**\n\n#### Frontend:\n```bash\n# Analyze bundle size\nnpm run build -- --analyze\n\n# Tree-shake unused code\n# Use dynamic imports for heavy libraries\n```\n\n#### Vite Config:\n```javascript\n// vite.config.js\nexport default {\n  build: {\n    rollupOptions: {\n      output: {\n        manualChunks: {\n          'react-vendor': ['react', 'react-dom', 'react-router-dom'],\n          'ui-vendor': ['react-hot-toast', 'react-icons'],\n        }\n      }\n    }\n  }\n}\n```\n\n### 8. **Enable Compression**\n```bash\nnpm install compression\n```\n\n```javascript\n// server.js\nimport compression from 'compression';\n\napp.use(compression());\n```\n\n### 9. **Use CDN for Static Assets**\n- Serve images via Cloudinary CDN\n- Use different image sizes for different devices\n- Implement responsive images\n\n```jsx\n<img\n  srcSet={`\n    ${cloudinaryUrl}/w_400/${image} 400w,\n    ${cloudinaryUrl}/w_800/${image} 800w,\n    ${cloudinaryUrl}/w_1200/${image} 1200w\n  `}\n  sizes=\"(max-width: 600px) 400px, (max-width: 1200px) 800px, 1200px\"\n  src={`${cloudinaryUrl}/w_800/${image}`}\n  alt=\"Post\"\n/>\n```\n\n### 10. **Database Connection Pooling**\nAlready handled by Mongoose, but ensure proper configuration:\n\n```javascript\nmongoose.connect(process.env.MONGO_URI, {\n  maxPoolSize: 10,\n  minPoolSize: 5,\n  socketTimeoutMS: 45000,\n});\n```\n\n## Performance Monitoring\n\n### Add Performance Metrics:\n```javascript\n// backend/middleware/performanceMiddleware.js\nexport const performanceLogger = (req, res, next) => {\n  const start = Date.now();\n  \n  res.on('finish', () => {\n    const duration = Date.now() - start;\n    console.log(`${req.method} ${req.path} - ${duration}ms`);\n    \n    // Log slow queries (> 1 second)\n    if (duration > 1000) {\n      console.warn(`âš ï¸ Slow request: ${req.method} ${req.path} - ${duration}ms`);\n    }\n  });\n  \n  next();\n};\n```\n\n## Recommended Tools\n\n1. **Frontend Performance:**\n   - Lighthouse CI\n   - Web Vitals\n   - React DevTools Profiler\n\n2. **Backend Performance:**\n   - MongoDB Compass (Query Profiler)\n   - New Relic / DataDog\n   - PM2 (Process monitoring)\n\n3. **Load Testing:**\n   - Apache JMeter\n   - K6\n   - Artillery\n\n## Action Items Priority\n\n### High Priority:\n1. âœ… Add database indexes\n2. âœ… Implement code splitting\n3. âœ… Add compression middleware\n4. âœ… Optimize images (Cloudinary transformations)\n\n### Medium Priority:\n5. â³ Implement Redis caching\n6. â³ Add pagination metadata\n7. â³ Use .lean() for read queries\n\n### Low Priority:\n8. ğŸ“ Client-side image compression\n9. ğŸ“ Performance monitoring\n10. ğŸ“ CDN optimization\n\n## Expected Improvements\n\nWith these optimizations:\n- **Initial Load Time:** 40-60% faster\n- **API Response Time:** 50-70% faster\n- **Database Queries:** 3-5x faster\n- **Bundle Size:** 30-40% smaller\n","size_bytes":6021},"frontend/src/components/VideoAd.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { AiOutlineClose } from 'react-icons/ai';\n\nconst VideoAd = ({ \n  type = 'pre-roll',\n  duration = 5,\n  onComplete,\n  onSkip \n}) => {\n  const [countdown, setCountdown] = useState(duration);\n  const [canSkip, setCanSkip] = useState(false);\n  const [isVisible, setIsVisible] = useState(true);\n\n  useEffect(() => {\n    if (countdown > 0) {\n      const timer = setTimeout(() => {\n        setCountdown(countdown - 1);\n        if (countdown === 2) {\n          setCanSkip(true);\n        }\n      }, 1000);\n      return () => clearTimeout(timer);\n    } else {\n      handleComplete();\n    }\n  }, [countdown]);\n\n  const handleComplete = () => {\n    setIsVisible(false);\n    if (onComplete) onComplete();\n  };\n\n  const handleSkip = () => {\n    setIsVisible(false);\n    if (onSkip) onSkip();\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center\">\n      <div className=\"relative w-full max-w-4xl aspect-video bg-gray-900 rounded-lg overflow-hidden\">\n        <div className=\"absolute top-4 right-4 z-10\">\n          <div className=\"bg-black bg-opacity-70 text-white px-3 py-1 rounded text-sm\">\n            {type === 'pre-roll' ? 'Video will play in ' : 'Ad: '}\n            {countdown}s\n          </div>\n        </div>\n\n        {canSkip && (\n          <button\n            onClick={handleSkip}\n            className=\"absolute top-4 left-4 z-10 bg-white text-black px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-gray-200 transition\"\n          >\n            <AiOutlineClose size={16} />\n            Skip Ad\n          </button>\n        )}\n\n        <div className=\"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-600 to-orange-500\">\n          <div className=\"text-center text-white p-8\">\n            <div className=\"text-6xl mb-4\">ğŸ“º</div>\n            <h3 className=\"text-2xl font-bold mb-2\">Advertisement</h3>\n            <p className=\"text-sm opacity-80\">\n              {type === 'pre-roll' && 'Your video will start shortly'}\n              {type === 'mid-roll' && 'Your video will resume shortly'}\n              {type === 'post-roll' && 'Thanks for watching'}\n            </p>\n            <div className=\"mt-6\">\n              <div className=\"w-full bg-gray-700 rounded-full h-2\">\n                <div \n                  className=\"bg-white h-2 rounded-full transition-all duration-1000\"\n                  style={{ width: `${((duration - countdown) / duration) * 100}%` }}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default VideoAd;\n","size_bytes":2680},"WARP.md":{"content":"# WARP.md\n\nThis file provides guidance to WARP (warp.dev) when working with code in this repository.\n\nProject overview\n- Monorepo with two apps:\n  - backend: Node.js/Express + MongoDB (Mongoose), Socket.io, Cloudinary, JWT auth, optional DeepSeek AI integration\n  - frontend: React (Vite), React Router, Tailwind, Axios, Socket.io client\n- Backend exposes REST APIs under /api/* and a Socket.io server; frontend consumes via Axios and a Vite dev proxy.\n\nCore commands\n- Install\n  - Backend: cd backend && npm install\n  - Frontend: cd frontend && npm install\n- Develop\n  - Backend API (nodemon): cd backend && npm run dev\n  - Frontend (Vite): cd frontend && npm run dev\n- Build/Run\n  - Frontend build: cd frontend && npm run build\n  - Frontend preview (serves dist): cd frontend && npm run preview\n  - Backend start (no build step): cd backend && npm start\n- Health checks (no formal test suite configured)\n  - MongoDB connectivity: node backend/test-db.js\n  - Cloudinary connectivity: node backend/test-cloudinary.js\n- Admin utilities\n  - Make a user admin: node backend/scripts/makeUserAdmin.js <email-or-username>\n  - List admins: node backend/scripts/listAdmins.js\n  - Inspect a few users: node backend/scripts/checkUsers.js\n  - Fix default avatars/covers: node backend/scripts/fixAvatars.js\n  - Update default images in bulk: node backend/scripts/updateDefaultImages.js\n\nEnvironment and configuration\n- Backend .env (create in backend/)\n  - MONGO_URI=mongodb://localhost:27017/friendflix\n  - JWT_SECRET=... (required)\n  - PORT=5000\n  - CLOUDINARY_CLOUD_NAME=...\n  - CLOUDINARY_API_KEY=...\n  - CLOUDINARY_API_SECRET=...\n  - FRONTEND_URL=http://localhost:5173\n  - NODE_ENV=development\n  - Optional: DEEPSEEK_API_KEY=... (for AI features)\n- Frontend .env (create in frontend/)\n  - VITE_API_URL=http://localhost:5000/api\n  - VITE_SOCKET_URL=http://localhost:5000\n- Notes\n  - Vite dev server proxies /api to http://localhost:5000 (vite.config.js).\n  - README references .env.example files; they are not presentâ€”manually create .env files with the keys above.\n\nHigh-level architecture\n- Backend (Express + Mongoose)\n  - server.js bootstraps: loads env, connects Mongo (config/db.js), creates HTTP server, attaches Socket.io (socket/socket.js), registers middleware, and mounts routes:\n    - /api/auth, /api/users, /api/posts, /api/notifications, /api/messages, /api/stories, /api/explore, /api/admin, /api/ai\n  - Middleware\n    - authMiddleware.protect verifies JWT and populates req.user\n    - adminMiddleware enforces admin/creator access\n    - errorMiddleware provides notFound and errorHandler\n  - Models (MongoDB): User, Post, Comment, Story, Message, Notification, Highlight, LiveStream, VideoCall\n  - File uploads: config/cloudinary.js uses multer memory storage + Cloudinary uploader with basic transformations\n  - Realtime: socket/socket.js sets up JWT-authenticated Socket.io, tracks online users, and emits typing/online/offline events\n  - AI integration: services/deepseekService.js wraps DeepSeek Chat Completions via OpenAI SDK (requires DEEPSEEK_API_KEY)\n- Frontend (React + Vite)\n  - Routing and pages in src/App.jsx; most routes are wrapped in <ProtectedRoute/>\n  - State/contexts: src/context/AuthContext.jsx (auth, token persistence, and socket connect), ThemeContext.jsx\n  - API layer: src/services/api.js (Axios instance with auth header + 401 handler), feature-specific client modules (authAPI, userAPI, postAPI, notificationAPI, messageAPI, exploreAPI, storyAPI)\n  - Realtime: src/services/socket.js manages the Socket.io client session; AuthContext connects using the JWT token\n  - UI: TailwindCSS, component library under src/components/*\n\nDevelopment workflow notes\n- Start backend and frontend in two terminals during development; the frontend proxies API calls.\n- Socket.io requires a valid JWT in the auth handshake (frontend passes the token from localStorage).\n- The backend prints an environment-variable readiness check on startup and logs Cloudinary config presence.\n\nGotchas for agents\n- The AI routes import '../middleware/auth.js' but the actual auth middleware is exported from middleware/authMiddleware.js as protect. If AI endpoints fail authorization, check/align the import and usage.\n- The backend does not serve the frontend build by default; for production, deploy the frontend dist/ separately (or add Express static serving if desired).\n\nKey references from README.md\n- Prereqs: Node 16+, MongoDB (local or Atlas), Cloudinary account\n- Local dev URLs: Frontend http://localhost:5173, Backend http://localhost:5000\n- Admin panel usage: create an admin via the makeUserAdmin.js script; then access /admin after login\n\n\n\n\n\n\n3d47e0EauZL78cxh  pass cluster\n\n\nalokawashti86_db_user user name ","size_bytes":4732},"frontend/src/components/Highlights.jsx":{"content":"import { useState } from 'react';\nimport { AiOutlinePlus } from 'react-icons/ai';\n\nconst Highlights = ({ highlights = [], onCreateHighlight, onViewHighlight }) => {\n  const [showCreateModal, setShowCreateModal] = useState(false);\n\n  return (\n    <div className=\"py-4\">\n      <div className=\"flex items-center space-x-4 overflow-x-auto scrollbar-hide pb-2\">\n        {/* Create New Highlight */}\n        <button\n          onClick={() => setShowCreateModal(true)}\n          className=\"flex-shrink-0 flex flex-col items-center group\"\n        >\n          <div className=\"w-20 h-20 rounded-full border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center group-hover:border-primary transition-all group-hover:scale-110\">\n            <AiOutlinePlus size={32} className=\"text-gray-400 group-hover:text-primary\" />\n          </div>\n          <span className=\"text-xs mt-2 text-gray-600 dark:text-gray-400\">New</span>\n        </button>\n\n        {/* Existing Highlights */}\n        {highlights.map((highlight) => (\n          <button\n            key={highlight._id}\n            onClick={() => onViewHighlight(highlight)}\n            className=\"flex-shrink-0 flex flex-col items-center group\"\n          >\n            <div className=\"relative\">\n              <div className=\"w-20 h-20 rounded-full bg-gradient-primary p-0.5 group-hover:scale-110 transition-transform\">\n                <img\n                  src={highlight.coverImage}\n                  alt={highlight.title}\n                  className=\"w-full h-full rounded-full object-cover border-2 border-white dark:border-dark-bg\"\n                />\n              </div>\n              <div className=\"absolute -bottom-1 -right-1 bg-gradient-primary rounded-full p-1 text-white text-xs font-bold\">\n                {highlight.stories.length}\n              </div>\n            </div>\n            <span className=\"text-xs mt-2 text-gray-800 dark:text-gray-200 font-medium truncate w-20 text-center\">\n              {highlight.title}\n            </span>\n          </button>\n        ))}\n      </div>\n\n      {/* Create Highlight Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white dark:bg-dark-card rounded-3xl p-6 max-w-md w-full shadow-glow\">\n            <h2 className=\"text-2xl font-bold mb-4 bg-gradient-primary bg-clip-text text-transparent\">\n              Create Highlight\n            </h2>\n            <input\n              type=\"text\"\n              placeholder=\"Highlight name (e.g., Travel, Food)\"\n              className=\"w-full px-4 py-3 border-2 border-gray-200 dark:border-dark-border rounded-2xl mb-4 focus:border-primary focus:outline-none dark:bg-dark-bg dark:text-white\"\n              maxLength={50}\n            />\n            <div className=\"flex space-x-3\">\n              <button\n                onClick={() => setShowCreateModal(false)}\n                className=\"flex-1 py-3 bg-gray-200 dark:bg-dark-border rounded-2xl font-semibold hover:bg-gray-300 transition\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={() => {\n                  onCreateHighlight();\n                  setShowCreateModal(false);\n                }}\n                className=\"flex-1 btn-primary\"\n              >\n                Create\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Highlights;\n","size_bytes":3519},"backend/config/minio.js":{"content":"import { Client } from 'minio';\nimport multer from 'multer';\nimport dotenv from 'dotenv';\nimport { Readable } from 'stream';\n\ndotenv.config();\n\nconst isMinIOConfigured = \n  process.env.MINIO_ENDPOINT &&\n  process.env.MINIO_PORT &&\n  process.env.MINIO_ACCESS_KEY &&\n  process.env.MINIO_SECRET_KEY &&\n  process.env.MINIO_BUCKET;\n\nlet minioClient;\n\nif (isMinIOConfigured) {\n  minioClient = new Client({\n    endPoint: process.env.MINIO_ENDPOINT,\n    port: parseInt(process.env.MINIO_PORT),\n    useSSL: process.env.MINIO_USE_SSL === 'true',\n    accessKey: process.env.MINIO_ACCESS_KEY,\n    secretKey: process.env.MINIO_SECRET_KEY,\n  });\n  \n  console.log('âœ… MinIO configured successfully!');\n  console.log(`ğŸ“¦ Using bucket: ${process.env.MINIO_BUCKET}`);\n  \n  const bucketName = process.env.MINIO_BUCKET;\n  minioClient.bucketExists(bucketName, (err, exists) => {\n    if (err) {\n      console.error('âŒ Error checking bucket:', err);\n      return;\n    }\n    if (!exists) {\n      console.log(`ğŸ“¦ Creating bucket: ${bucketName}`);\n      minioClient.makeBucket(bucketName, 'us-east-1', (err) => {\n        if (err) {\n          console.error('âŒ Error creating bucket:', err);\n        } else {\n          console.log(`âœ… Bucket created: ${bucketName}`);\n          \n          const policy = {\n            Version: '2012-10-17',\n            Statement: [\n              {\n                Effect: 'Allow',\n                Principal: { AWS: ['*'] },\n                Action: ['s3:GetObject'],\n                Resource: [`arn:aws:s3:::${bucketName}/*`],\n              },\n            ],\n          };\n          minioClient.setBucketPolicy(bucketName, JSON.stringify(policy), (err) => {\n            if (err) {\n              console.error('âŒ Error setting bucket policy:', err);\n            } else {\n              console.log('âœ… Bucket policy set to public read');\n            }\n          });\n        }\n      });\n    } else {\n      console.log(`âœ… Bucket exists: ${bucketName}`);\n    }\n  });\n} else {\n  console.warn('âš ï¸  MinIO not configured - file uploads will be disabled');\n  console.warn('Set MINIO_ENDPOINT, MINIO_PORT, MINIO_ACCESS_KEY, MINIO_SECRET_KEY, and MINIO_BUCKET');\n}\n\nexport { isMinIOConfigured as isStorageConfigured };\n\nconst storage = multer.memoryStorage();\n\nexport const upload = multer({\n  storage,\n  limits: {\n    fileSize: 200 * 1024 * 1024,\n  },\n  fileFilter: (req, file, cb) => {\n    if (\n      file.mimetype.startsWith('image/') ||\n      file.mimetype.startsWith('video/') ||\n      file.mimetype.startsWith('audio/') ||\n      file.mimetype.startsWith('application/')\n    ) {\n      cb(null, true);\n    } else {\n      cb(new Error('Only image, video, audio and document files are allowed!'), false);\n    }\n  },\n});\n\nexport const uploadMultiple = multer({\n  storage,\n  limits: {\n    fileSize: 200 * 1024 * 1024,\n  },\n  fileFilter: (req, file, cb) => {\n    if (file.mimetype.startsWith('image/') || file.mimetype.startsWith('video/')) {\n      cb(null, true);\n    } else {\n      cb(new Error('Only image and video files are allowed!'), false);\n    }\n  },\n}).array('media', 10);\n\nexport const uploadToStorage = (fileBuffer, folder = 'friendflix', originalName = 'file') => {\n  if (!isMinIOConfigured) {\n    return Promise.reject(new Error('MinIO is not configured. Please set up your credentials.'));\n  }\n  \n  return new Promise((resolve, reject) => {\n    const timestamp = Date.now();\n    const fileName = `${folder}/${timestamp}-${originalName}`;\n    const bucketName = process.env.MINIO_BUCKET;\n    \n    const stream = Readable.from(fileBuffer);\n    \n    minioClient.putObject(bucketName, fileName, stream, fileBuffer.length, (err, etag) => {\n      if (err) {\n        console.error('âŒ MinIO upload error:', err);\n        return reject(err);\n      }\n      \n      const useSSL = process.env.MINIO_USE_SSL === 'true';\n      const protocol = useSSL ? 'https' : 'http';\n      const endpoint = process.env.MINIO_ENDPOINT;\n      const port = process.env.MINIO_PORT;\n      const portSuffix = (port === '80' && !useSSL) || (port === '443' && useSSL) ? '' : `:${port}`;\n      \n      const publicUrl = `${protocol}://${endpoint}${portSuffix}/${bucketName}/${fileName}`;\n      \n      resolve({\n        secure_url: publicUrl,\n        public_id: fileName,\n        etag: etag,\n        resource_type: 'auto',\n      });\n    });\n  });\n};\n\nexport const deleteFromStorage = (publicId) => {\n  if (!isMinIOConfigured) {\n    return Promise.reject(new Error('MinIO is not configured'));\n  }\n  \n  return new Promise((resolve, reject) => {\n    const bucketName = process.env.MINIO_BUCKET;\n    minioClient.removeObject(bucketName, publicId, (err) => {\n      if (err) {\n        console.error('âŒ MinIO delete error:', err);\n        return reject(err);\n      }\n      resolve({ result: 'ok' });\n    });\n  });\n};\n\nexport default minioClient;\n","size_bytes":4830}},"version":2}